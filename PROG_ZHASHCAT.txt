  REPORT zprueba.

  TABLES: usr02, ust04.

  PARAMETERS: p_hash  RADIOBUTTON GROUP g,
              p_passc RADIOBUTTON GROUP g,
              p_bcode RADIOBUTTON GROUP g,
              p_noblk AS CHECKBOX DEFAULT 'X', "No usuario bloqueados
              p_sapal AS CHECKBOX DEFAULT 'X'. "Sólo SAP ALL
  SELECT-OPTIONS: s_bname FOR usr02-bname,
                  s_ustyp FOR usr02-ustyp DEFAULT 'A',
                  s_fulac FOR usr02-pwdlgndate,
                  s_profi FOR ust04-profile,
                  s_class FOR usr02-class DEFAULT 'PORTAL-EMPLE' SIGN E OPTION EQ.

  PARAMETERS: p_cuser AS CHECKBOX,
              p_regla AS CHECKBOX DEFAULT 'X',
              p_ext   AS CHECKBOX,
              p_post  AS CHECKBOX,
              p_pass  AS CHECKBOX DEFAULT 'X',
              p_usr02 AS CHECKBOX DEFAULT 'X',
              p_dir   TYPE text255 DEFAULT 'c:\temp\txt\',
              p_check AS CHECKBOX.

  INITIALIZATION.

    DATA l_fecha TYPE dats.
    l_fecha = sy-datum - 365.
    APPEND VALUE  #( option = 'GE' sign = 'I' low = l_fecha ) TO s_fulac.

  START-OF-SELECTION.

    DATA: i_fichero     TYPE TABLE OF string,
          l_fichero     TYPE string,
          l_passwords   TYPE string,
          i_passwords   TYPE TABLE OF string,
          l_reglas      TYPE string,
          i_reglas      TYPE TABLE OF string,
          l_extensiones TYPE string,
          i_extensiones TYPE TABLE OF string,
          adrp          TYPE adrp,
          l_tipo_clave  TYPE string,
          l_file TYPE string.

    DATA: BEGIN OF i_usr02 OCCURS 0,
      bname TYPE usr02-bname,
bcode TYPE usr02-bcode,
gltgv TYPE usr02-gltgv,
gltgb TYPE usr02-gltgb,
ustyp TYPE usr02-ustyp,
class TYPE usr02-class,
locnt TYPE usr02-locnt,
uflag TYPE usr02-uflag,
accnt TYPE usr02-accnt,
aname TYPE usr02-aname,
erdat TYPE usr02-erdat,
trdat TYPE usr02-trdat,
ltime TYPE usr02-ltime,
versn TYPE usr02-versn,
codvn TYPE usr02-codvn,
zbvmaster TYPE usr02-zbvmaster,
passcode TYPE usr02-passcode,
pwdchgdate TYPE usr02-pwdchgdate,
pwdstate TYPE usr02-pwdstate,
reserved TYPE usr02-reserved,
pwdhistory TYPE usr02-pwdhistory,
pwdlgndate TYPE usr02-pwdlgndate,
pwdsetdate TYPE usr02-pwdsetdate,
pwdinitial TYPE usr02-pwdinitial,
pwdlockdate TYPE usr02-pwdlockdate,
pwdsaltedhash TYPE usr02-pwdsaltedhash,
security_policy TYPE usr02-security_policy,
      END OF i_usr02.

    IF p_bcode = 'X' OR p_passc = 'X'.
      p_cuser = 'X'.
    ENDIF.

    IF p_check IS INITIAL.
      IF p_usr02 = 'X'.
        SELECT * FROM usr02
          INTO CORRESPONDING FIELDS OF TABLE i_usr02.
        l_file = 'USR02_' && sy-sysid.
*        PERFORM concat_ruta USING l_file 'XLSX' CHANGING l_file.
        zcl_ap_abap2xls=>alv_2_xls( tabla = i_usr02[] grabar = 'X' ruta = p_dir nombre_fichero = l_file ).
      ENDIF.

      DATA: lv_usr02 TYPE usr02.
      DATA: lv_string  TYPE string,
            lv_string2 TYPE string,
            lv_string3 TYPE string,
            lv_string4 TYPE string,
            r_gltgb    TYPE RANGE OF usr02-gltgb,
            r_uflag    TYPE RANGE OF usr02-uflag,
            r_bname    TYPE RANGE OF usr02-bname,
            r_ustyp    TYPE RANGE OF usr02-ustyp,
            r_pwdinitial TYPE RANGE OF usr02-pwdinitial.

      IF p_noblk = 'X'.
        APPEND VALUE #( option = 'EQ' sign = 'I' low = 0 ) TO r_uflag.

        APPEND VALUE #( option = 'EQ' sign = 'I' low = '00000000' ) TO r_gltgb.
        APPEND VALUE #( option = 'GE' sign = 'I' low = sy-datum ) TO r_gltgb.

        APPEND VALUE #( option = 'NE' sign = 'I' low = '1' ) TO r_pwdinitial.
      ENDIF.

      IF p_sapal = 'X'.
        SELECT bname FROM ust04
          INTO lv_usr02-bname
         WHERE bname IN s_bname
           AND profile IN ('SAP_ALL', 'PA_GRV_ALL*', 'S_A.DEVELOP', 'Z&XXACESIS21').
          APPEND VALUE #( option = 'EQ' sign = 'I' low = lv_usr02-bname ) TO r_bname.
        ENDSELECT.
      ELSE.
        SELECT bname FROM ust04
          INTO lv_usr02-bname
         WHERE bname IN s_bname
           AND profile IN s_profi.
          APPEND VALUE #( option = 'EQ' sign = 'I' low = lv_usr02-bname ) TO r_bname.
        ENDSELECT.
      ENDIF.

      SELECT * FROM usr02 INTO lv_usr02
        WHERE bname IN r_bname
          AND bname IN s_bname
          AND ustyp IN s_ustyp
          AND class IN s_class
          AND uflag IN r_uflag
          AND gltgb IN r_gltgb
          AND pwdlgndate IN s_fulac
          AND pwdinitial IN r_pwdinitial.
        IF p_hash = 'X'.
          IF lv_usr02-pwdsaltedhash IS INITIAL.
            CONTINUE.
          ENDIF.
          lv_string = lv_usr02-pwdsaltedhash.
        ELSEIF p_passc = 'X'.
          IF lv_usr02-passcode = '0000000000000000000000000000000000000000'.
            CONTINUE.
          ELSE.
            lv_string = lv_usr02-passcode.
          ENDIF.
        ELSEIF p_bcode = 'X'.
          IF lv_usr02-bcode = '0000000000000000'.
            CONTINUE.
          ENDIF.
          lv_string = lv_usr02-bcode.
        ENDIF.
        IF p_cuser = 'X'.
          CONCATENATE lv_usr02-bname '$' lv_string INTO lv_string.
        ENDIF.

        APPEND lv_string TO i_fichero.

        APPEND lv_usr02-bname TO i_passwords.
        SELECT SINGLE * FROM adrp JOIN usr21 ON adrp~persnumber = usr21~persnumber
          INTO CORRESPONDING FIELDS OF adrp
         WHERE bname = lv_usr02-bname.
        PERFORM collect_pass USING adrp-name_first.
        PERFORM collect_pass USING adrp-name_last.

        DATA: l_pernr TYPE persno.
        SELECT SINGLE pernr FROM pa0105
          INTO l_pernr
         WHERE ( usrid_long = lv_usr02-bname
            OR   usrid = lv_usr02-bname )
           AND endda >= sy-datum
           AND begda <= sy-datum.
        IF sy-subrc = 0.
          DATA pa0002 TYPE pa0002.
          SELECT perid gbdat nachn nach2 vorna gbort FROM pa0002
            INTO CORRESPONDING FIELDS OF pa0002
            WHERE pernr = l_pernr.
            IF pa0002-perid(2) = 'ES'.
              lv_string = pa0002-perid+2(10).
            ELSE.
              lv_string = pa0002-perid(10).
            ENDIF.
            COLLECT lv_string INTO i_passwords.
            PERFORM collect_pass USING pa0002-nachn.
            PERFORM collect_pass USING pa0002-nach2.
            PERFORM collect_pass USING pa0002-vorna.
            PERFORM collect_pass USING pa0002-gbort.

            IF NOT pa0002-gbdat IS INITIAL.
              lv_string = pa0002-gbdat.
              COLLECT lv_string INTO i_passwords.
              lv_string = pa0002-gbdat+6(2) && pa0002-gbdat+4(2) && pa0002-gbdat(4).
              COLLECT lv_string INTO i_passwords.
              lv_string = pa0002-gbdat+6(2) && pa0002-gbdat+4(2) && pa0002-gbdat+2(2).
              COLLECT lv_string INTO i_passwords.

              lv_string = pa0002-nachn && pa0002-gbdat(4).
              PERFORM collect_pass USING lv_string.
              lv_string = pa0002-nach2 && pa0002-gbdat(4).
              PERFORM collect_pass USING lv_string.
              lv_string = pa0002-vorna && pa0002-gbdat(4).
              PERFORM collect_pass USING lv_string.

              lv_string = pa0002-nachn && pa0002-gbdat+2(2).
              PERFORM collect_pass USING lv_string.
              lv_string = pa0002-nach2 && pa0002-gbdat+2(2).
              PERFORM collect_pass USING lv_string.
              lv_string = pa0002-vorna && pa0002-gbdat+2(2).
              PERFORM collect_pass USING lv_string.
            ENDIF.
          ENDSELECT.

          DATA pa0006 TYPE pa0006.
          SELECT ort01 FROM pa0006
            INTO CORRESPONDING FIELDS OF pa0006
           WHERE pernr = l_pernr.
            PERFORM collect_pass USING pa0006-ort01.
          ENDSELECT.

          DATA pa0021 TYPE pa0021.
          SELECT favor fgbdt  FROM pa0021
            INTO CORRESPONDING FIELDS OF pa0021
           WHERE pernr = l_pernr.
            PERFORM collect_pass USING pa0021-favor.

            IF NOT pa0021-fgbdt IS INITIAL.
              lv_string = pa0021-fgbdt.
              COLLECT lv_string INTO i_passwords.
              lv_string = pa0021-fgbdt+6(2) && pa0021-fgbdt+4(2) && pa0021-fgbdt(4).
              COLLECT lv_string INTO i_passwords.
              lv_string = pa0021-fgbdt+6(2) && pa0021-fgbdt+4(2) && pa0021-fgbdt+2(2).
              COLLECT lv_string INTO i_passwords.
            ENDIF.
          ENDSELECT.
        ENDIF.

      ENDSELECT.

      IF p_bcode = 'X'.
        l_fichero = sy-sysid && '_BCODE'.
        l_tipo_clave = '-m 7700'.
      ELSEIF p_passc = 'X'.
        l_fichero = sy-sysid && '_PASSCODE'.
        l_tipo_clave = '-m 7800'.
      ELSEIF p_hash = 'X'.
        l_fichero = sy-sysid && '_HASH'.
        l_tipo_clave = '-m 10300'.
      ENDIF.
      l_passwords = l_fichero && `_PASSWORDS.txt`.


      PERFORM concat_ruta USING l_fichero 'TXT' CHANGING l_file.

      PERFORM grabar TABLES i_fichero USING l_file.

      "-a 1 Combinar 2 ficheros
      "-a 3 Fuerza bruta
      "-a 6 Diccionario con extensión

*  -a | Mode
*   ===+======
*    0 | Straight
*    1 | Combination
*    3 | Brute-force
*    6 | Hybrid Wordlist + Mask
*    7 | Hybrid Mask + Wordlist

      " -p : Separator char for hashlists and outfile

      l_reglas = l_fichero && `_REGLAS.txt`.
      l_extensiones = l_fichero && `_EXTENSIONES.txt`.

      IF p_regla = 'X'.
        DATA(l_cmd) = `hashcat -a 0 ` && l_tipo_clave && ` -p : --session=all -o ` && l_fichero && `_SALIDA1.txt` && ` --outfile-format=2 --markov-disable --force `
                      && ` -r ` && l_reglas && ` `
                      && l_fichero && `.txt ` && l_passwords.
        CLEAR i_fichero.
        APPEND l_cmd TO i_fichero.

        IF p_pass = 'X'.
          l_cmd = `hashcat -a 0 ` && l_tipo_clave && ` -p : --session=all -o ` && l_fichero && `_SALIDA1.txt` && ` --outfile-format=2 --markov-disable --force `
                        && ` -r ` && l_reglas && ` `
                        && l_fichero && `.txt ` && 'PASSWORDS.TXT'.
          APPEND l_cmd TO i_fichero.
        ENDIF.


        DATA l_file_cmd TYPE string.
        lv_string = l_fichero && '_REGLAS'.
        PERFORM concat_ruta USING lv_string 'BAT' CHANGING l_file_cmd.

        PERFORM grabar TABLES i_fichero USING l_file_cmd.


      ENDIF.


      IF p_post = 'X'.
        DATA(l_cmd2) = `hashcat -a 6 ` && l_tipo_clave && ` -p : --session=all -o ` && l_fichero && `_SALIDA2.txt` && ` --outfile-format=2 --markov-disable --force `
                      && l_fichero && `.txt ` && l_passwords && ` ?a?a?a`.
        CLEAR i_fichero.
        APPEND l_cmd2 TO i_fichero.

        lv_string = l_fichero && '_POST'.
        PERFORM concat_ruta USING lv_string 'BAT' CHANGING l_file_cmd.

        PERFORM grabar TABLES i_fichero USING l_file_cmd.
      ENDIF.

      IF p_ext = 'X'.

        DATA(l_cmd3) = `hashcat -a 1 ` && l_tipo_clave && ` -p : --session=all -o ` && l_fichero && `_SALIDA3.txt` && ` --outfile-format=2 --markov-disable --force `
                      && l_fichero && `.txt ` && l_passwords && ` ` && l_extensiones.
        CLEAR i_fichero.
        APPEND l_cmd3 TO i_fichero.

        lv_string = l_fichero && '_EXT'.
        PERFORM concat_ruta USING lv_string 'BAT' CHANGING l_file_cmd.
        PERFORM grabar TABLES i_fichero USING l_file_cmd.
      ENDIF.

      SORT i_passwords.
      DELETE ADJACENT DUPLICATES FROM i_passwords.
      lv_string = l_passwords.
      PERFORM concat_ruta USING lv_string '' CHANGING l_passwords.

      PERFORM grabar TABLES i_passwords USING l_passwords.

      IF p_regla = 'X'.

        DATA: l_digito TYPE numc1,
              l_mes    TYPE numc2,
              l_anyo   TYPE numc4.

        APPEND '$1$2$3' TO i_reglas.
        APPEND '$-$1$2$3' TO i_reglas.
        APPEND '$1$2$3$4' TO i_reglas.
        APPEND '$-$1$2$3$4' TO i_reglas.
        APPEND '$1$2$3$4$5' TO i_reglas.
        APPEND '$-$1$2$3$4$5' TO i_reglas.

        DO 10 TIMES.
          APPEND l_digito TO i_extensiones.
          lv_string = '-' && l_digito. APPEND lv_string TO i_extensiones.
          ADD 1 TO l_digito.

          APPEND '$' && l_digito TO i_reglas.
          APPEND '$-$' && l_digito TO i_reglas.
        ENDDO.


        l_anyo = '2000'.
        DO 30 TIMES.
          APPEND l_mes TO i_extensiones.
          APPEND '$' && l_mes(1) && '$' && l_mes+1(1)  TO i_reglas.
          APPEND l_anyo TO i_extensiones.
          APPEND '$' && l_anyo(1) && '$' && l_anyo+1(1) && '$' && l_anyo+2(1) && '$' && l_anyo+3(1)  TO i_reglas.
          lv_string = '-' && l_mes. APPEND lv_string TO i_extensiones.
          APPEND '$-$' && l_mes(1) && '$' && l_mes+1(1)  TO i_reglas.
          lv_string = '-' && l_anyo. APPEND lv_string TO i_extensiones.
          APPEND '$-$' && l_anyo(1) && '$' && l_anyo+1(1) && '$' && l_anyo+2(1) && '$' && l_anyo+3(1)  TO i_reglas.
          ADD 1 TO l_mes.
          ADD 1 TO l_anyo.
        ENDDO.

        DATA(i_r) = i_reglas.
        LOOP AT i_r INTO DATA(r).
          APPEND `c ` && r TO i_reglas.
          APPEND `l ` && r TO i_reglas.
          APPEND `u ` && r TO i_reglas.
          APPEND `c ` && r TO i_reglas.
        ENDLOOP.

        LOOP AT i_r INTO r.
          APPEND `sa@ ` && r TO i_reglas.
          APPEND `se3 ` && r TO i_reglas.
          APPEND `sl1 ` && r TO i_reglas.
          APPEND `so0 ` && r TO i_reglas.
        ENDLOOP.

        lv_string = l_reglas.
        PERFORM concat_ruta USING lv_string '' CHANGING l_reglas.

        APPEND 'se3' TO i_reglas. "Reemplazar (s) caracter con otro
        APPEND 'sl!' TO i_reglas.
        APPEND 'sl1' TO i_reglas.
        APPEND 'so0' TO i_reglas.
        APPEND ':' TO i_reglas.  "Nada
        APPEND 'l' TO i_reglas.  "Todo minusculas
        APPEND 'u' TO i_reglas.  "Todo mayuscualas
        APPEND 'c' TO i_reglas.  "Capitaliza la primera


        SORT i_reglas.
        DELETE ADJACENT DUPLICATES FROM i_reglas.
        PERFORM grabar TABLES i_reglas USING l_reglas.
      ENDIF.

      IF p_ext = 'X'.
        lv_string = l_extensiones.
        PERFORM concat_ruta USING lv_string '' CHANGING l_extensiones.
        APPEND '123' TO i_extensiones.
        APPEND '1234' TO i_extensiones.
        APPEND '12345' TO i_extensiones.


        SORT i_extensiones.
        PERFORM grabar TABLES i_extensiones USING l_extensiones.
      ENDIF.
    ELSE.
      DATA: l_potfile TYPE string,
            i_pot     TYPE TABLE OF string.


      PERFORM concat_ruta USING 'hashcat.potfile' '' CHANGING l_potfile.

      PERFORM leer TABLES i_pot USING l_potfile.

      IF p_usr02 = 'X'.
        DATA(l_ruta_bd) = zcl_ap_ficheros=>concat_ruta( fichero =  'USR02_' && sy-sysid && '.xlsx' directorio = p_dir ).

        IF zcl_ap_ficheros=>existe(  l_ruta_bd ) = 'X'.
          NEW zcl_ap_abap2xls( )->lee_fichero( EXPORTING fichero = l_ruta_bd
                                                         get_datos = 'X' huge      = '' mostrar_error = ''
                                               IMPORTING datos   = i_usr02[] ).
        ENDIF.
      ENDIF.

      LOOP AT i_pot ASSIGNING FIELD-SYMBOL(<pot>).
        SPLIT <pot> AT ':' INTO lv_string l_potfile.

        CLEAR lv_usr02.
        READ TABLE i_usr02 WITH KEY pwdsaltedhash = lv_string.
        IF sy-subrc = 0.
          MOVE-CORRESPONDING i_usr02 TO lv_usr02.
        ELSE.
          SELECT SINGLE * FROM usr02
            INTO lv_usr02
           WHERE pwdsaltedhash = lv_string.
        ENDIF.
        IF NOT lv_usr02 IS INITIAL.
          CLEAR lv_string2.
          IF lv_usr02-uflag IS INITIAL.
            FORMAT COLOR COL_HEADING.
          ELSE.
            FORMAT COLOR COL_NEGATIVE.
            lv_string2 = 'BLOQUEADO'.
          ENDIF.
          WRITE: / lv_usr02-bname, l_potfile, lv_string2.

          CONCATENATE lv_usr02-bname l_potfile lv_string2 INTO lv_string SEPARATED BY ` - `.
          APPEND lv_string TO i_fichero.

          DATA: auth_tab TYPE TABLE OF ust04.
          SELECT * FROM ust04
            INTO TABLE auth_tab
            WHERE bname = lv_usr02-bname.

          FORMAT COLOR OFF.
          lv_string = 'Perfiles:'.
          LOOP AT auth_tab INTO DATA(auth_rec).
            CONCATENATE lv_string auth_rec-profile INTO lv_string SEPARATED BY space.
          ENDLOOP.
          IF lv_string CS 'SAP_ALL'.
            FORMAT COLOR COL_POSITIVE.
          ENDIF.
          WRITE: / lv_string.

          APPEND lv_string TO i_fichero.

          IF NOT lv_usr02-class IS INITIAL.
            lv_string = 'Class:' && lv_usr02-class.
            WRITE: / lv_string.
            APPEND lv_string TO i_fichero.
          ENDIF.

        ENDIF.
      ENDLOOP.

      lv_string = sy-sysid && '_CLAVES'.
      PERFORM concat_ruta USING lv_string 'TXT' CHANGING l_fichero.
      PERFORM grabar TABLES i_fichero USING l_fichero.

    ENDIF.


  FORM collect_pass USING pe_string.

    lv_string = pe_string.
    REPLACE ALL OCCURRENCES OF '(' IN lv_string WITH ''.
    REPLACE ALL OCCURRENCES OF ')' IN lv_string WITH ''.
    SPLIT lv_string AT ` ` INTO lv_string lv_string2 lv_string3 lv_string4.

    IF strlen( lv_string ) > 2.
      COLLECT lv_string INTO i_passwords.
    ENDIF.
    IF strlen( lv_string2 ) > 2.
      COLLECT lv_string2 INTO i_passwords.
    ENDIF.
    IF strlen( lv_string3 ) > 2.
      COLLECT lv_string3 INTO i_passwords.
    ENDIF.
    IF strlen( lv_string4 ) > 2.
      COLLECT lv_string4 INTO i_passwords.
    ENDIF.

  ENDFORM.


  FORM concat_ruta USING fichero extension
        CHANGING ruta TYPE string.

    DATA: l_ext(30),
          l_directorio TYPE string,
          l_dir_temp TYPE string,
          l_separador.
    DATA: l_lon TYPE i,
          l_char(1000),
          l_letra.

    l_char = p_dir.
    l_lon = strlen( l_char ).
    IF l_lon > 1.
      l_lon = l_lon - 1.
    ENDIF.
    l_letra = l_char+l_lon(1).

    IF l_letra = '\'.
      CONCATENATE p_dir fichero INTO ruta.
    ELSE.
      CONCATENATE p_dir '\' fichero INTO ruta.
    ENDIF.


    IF NOT extension IS INITIAL.
      CONCATENATE '.' extension INTO l_ext.
      IF NOT fichero CS l_ext.
        CONCATENATE ruta l_ext INTO ruta.
      ENDIF.
    ENDIF.



  ENDFORM.

  FORM grabar TABLES tabla USING fichero.

    TRY.
        CALL METHOD cl_gui_frontend_services=>gui_download
          EXPORTING
            filename                = fichero
            filetype                = 'ASC'
*           append                  = SPACE
*           write_field_separator   = SPACE
*           header                  = '00'
*           trunc_trailing_blanks   = space
*           write_lf                = 'X'
*           col_select              = SPACE
*           col_select_mask         = SPACE
            dat_mode                = ''
*           confirm_overwrite       = SPACE
*           no_auth_check           = SPACE
*           codepage                = l_codepage
*           ignore_cerr             = ABAP_TRUE
*           replacement             = '#'
*           write_bom               = SPACE
*           trunc_trailing_blanks_eol = trunc
*           write_lf_after_last_line  = write_lf_after_last_line
*           wk1_n_format            = SPACE
*           wk1_n_size              = SPACE
*           wk1_t_format            = SPACE
*           wk1_t_size              = SPACE
*    IMPORTING
*           filelength              =
          CHANGING
            data_tab                = tabla[]
          EXCEPTIONS
            file_write_error        = 1
            no_batch                = 2
            gui_refuse_filetransfer = 3
            invalid_type            = 4
            no_authority            = 5
            unknown_error           = 6
            header_not_allowed      = 7
            separator_not_allowed   = 8
            filesize_not_allowed    = 9
            header_too_long         = 10
            dp_error_create         = 11
            dp_error_send           = 12
            dp_error_write          = 13
            unknown_dp_error        = 14
            access_denied           = 15
            dp_out_of_memory        = 16
            disk_full               = 17
            dp_timeout              = 18
            file_not_found          = 19
            dataprovider_exception  = 20
            control_flush_error     = 21
            not_supported_by_gui    = 22
            error_no_gui            = 23
            OTHERS                  = 24.
      CATCH cx_root INTO DATA(lx_root).
        MESSAGE lx_root->if_message~get_text( ) TYPE 'E'.
    ENDTRY.

  ENDFORM.

  FORM leer TABLES tabla USING fichero.

    TRY.
        CALL METHOD cl_gui_frontend_services=>gui_upload
          EXPORTING
            filename                = fichero
            filetype                = 'ASC'
*           has_field_separator     = l_sep
*           header_length           = 0
*           read_by_line            = 'X'
*           dat_mode                = l_sep
*           codepage                = codepage
*           ignore_cerr             = ABAP_TRUE
*           replacement             = '#'
*           virus_scan_profile      =
*    IMPORTING
*           filelength              = filelength
*           header                  =
          CHANGING
            data_tab                = tabla[]
          EXCEPTIONS
            file_open_error         = 1
            file_read_error         = 2
            no_batch                = 3
            gui_refuse_filetransfer = 4
            invalid_type            = 5
            no_authority            = 6
            unknown_error           = 7
            bad_data_format         = 8
            header_not_allowed      = 9
            separator_not_allowed   = 10
            header_too_long         = 11
            unknown_dp_error        = 12
            access_denied           = 13
            dp_out_of_memory        = 14
            disk_full               = 15
            dp_timeout              = 16
            not_supported_by_gui    = 17
            error_no_gui            = 18
            OTHERS                  = 19.
      CATCH cx_root INTO DATA(lx_root).
        MESSAGE lx_root->if_message~get_text( ) TYPE 'E'.
    ENDTRY.

  ENDFORM.

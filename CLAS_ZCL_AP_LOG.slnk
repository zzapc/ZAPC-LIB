<?xml version="1.0" encoding="utf-8"?>
<CLAS CLSNAME="ZCL_AP_LOG" VERSION="1" LANGU="S" DESCRIPT="Log" CATEGORY="00" EXPOSURE="2" STATE="1" RELEASE="0" CLSFINAL="X" CLSCCINCL="X" FIXPT="X" UNICODE="X" CLSBCCAT="00" DURATION_TYPE="0 " RISK_LEVEL="0 ">
 <localImplementation>*&quot;* local class implementation for public class
*&quot;* use this source file for the implementation part of
*&quot;* local helper classes</localImplementation>
 <localTypes>*&quot;* use this source file for any type declarations (class
*&quot;* definitions, interfaces or data types) you need for method
*&quot;* implementation or private method&apos;s signature</localTypes>
 <localMacros>*&quot;* use this source file for any macro definitions you need
*&quot;* in the implementation part of the class</localMacros>
 <textPool>
  <language SPRAS="S">
   <textElement ID="I" KEY="DDM" ENTRY="Debe definir un destinatario para mail del log" LENGTH="92 "/>
   <textElement ID="I" KEY="ELL" ENTRY="el" LENGTH="12 "/>
   <textElement ID="I" KEY="ERR" ENTRY="Error en" LENGTH="18 "/>
   <textElement ID="I" KEY="HOR" ENTRY="hora" LENGTH="14 "/>
   <textElement ID="I" KEY="KEY" ENTRY="clave" LENGTH="15 "/>
   <textElement ID="I" KEY="MSG" ENTRY="Mensaje" LENGTH="17 "/>
   <textElement ID="I" KEY="MSP" ENTRY="Mensajes proceso" LENGTH="26 "/>
   <textElement ID="I" KEY="REP" ENTRY="report" LENGTH="16 "/>
   <textElement ID="I" KEY="SPE" ENTRY="Se ha producido un error en" LENGTH="54 "/>
   <textElement ID="I" KEY="USR" ENTRY="Usuario" LENGTH="17 "/>
  </language>
 </textPool>
 <typeUsage CLSNAME="ZCL_AP_LOG" TYPEGROUP="ABAP" VERSION="1" TPUTYPE="0" IMPLICIT="X"/>
 <forwardDeclaration>ABAP</forwardDeclaration>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="CLAVE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="15 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ZLOG-CLAVE" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="ERROR" VERSION="1" LANGU="S" DESCRIPT="Parámetro de retorno" EXPOSURE="2" STATE="1" EDITORDER="12 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="BAL_S_MSG" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="GRABAR_SIEMPRE" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="3 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ABAP_BOOL" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="GUARDAR_TABLA_INTERNA" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="16 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ABAP_BOOL" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="HAY_CAMBIOS" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="2 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ABAP_BOOL" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="I_LOG" VERSION="1" LANGU="S" DESCRIPT="Tipo tabla ZLOG" EXPOSURE="2" STATE="1" EDITORDER="13 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ZLOG_T" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="I_TABLA_ERRORES" VERSION="1" LANGU="S" DESCRIPT="Tipo tabla para BAPIRETURN1" EXPOSURE="2" STATE="1" EDITORDER="11 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="PS_MESSAGES" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="LOG_HANDLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="14 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="BALLOGHNDL" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="L_MSG" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje 01" EXPOSURE="2" STATE="1" EDITORDER="7 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="MSGV1" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="L_MSG2" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje 02" EXPOSURE="2" STATE="1" EDITORDER="8 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="MSGV2" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="L_MSG3" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje 03" EXPOSURE="2" STATE="1" EDITORDER="9 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="MSGV3" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="L_MSG4" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje 04" EXPOSURE="2" STATE="1" EDITORDER="10 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="MSGV4" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="NO_GRABAR_LOG" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="17 " ATTDECLTYP="0" ATTVALUE="&apos;&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ABAP_BOOL" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="PROB_HIGH" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Clase de problema de mensaje" EXPOSURE="2" STATE="1" EDITORDER="3 " ATTDECLTYP="2" ATTVALUE="&apos;3&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="BAL_S_MSG-PROBCLASS" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="PROB_LOW" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Clase de problema de mensaje" EXPOSURE="2" STATE="1" EDITORDER="5 " ATTDECLTYP="2" ATTVALUE="&apos;1&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="BAL_S_MSG-PROBCLASS" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="PROB_MEDIUM" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Clase de problema de mensaje" EXPOSURE="2" STATE="1" EDITORDER="4 " ATTDECLTYP="2" ATTVALUE="&apos;2&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="BAL_S_MSG-PROBCLASS" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="PROB_NONE" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Clase de problema de mensaje" EXPOSURE="2" STATE="1" EDITORDER="6 " ATTDECLTYP="2" ATTVALUE="&apos; &apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="BAL_S_MSG-PROBCLASS" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="PROB_VERY_HIGH" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Clase de problema de mensaje" EXPOSURE="2" STATE="1" EDITORDER="2 " ATTDECLTYP="2" ATTVALUE="&apos;4&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="BAL_S_MSG-PROBCLASS" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="S_LOG" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Datos de cabecera de log" EXPOSURE="2" STATE="1" EDITORDER="1 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="BAL_S_LOG" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_LOG" CMPNAME="S_MSG" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Datos de un mensaje" EXPOSURE="0" STATE="1" EDITORDER="1 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="BAL_S_MSG" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="APPEND_BAPIRET2" VERSION="1" LANGU="S" DESCRIPT="Añadir contenido tabla BAPIMATRET2" EXPOSURE="2" STATE="1" EDITORDER="15 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="APPEND_BAPIRET2" SCONAME="RETURN" VERSION="1" LANGU="S" DESCRIPT="Return Messages" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BAPIRET2"/>
  <source>METHOD append_bapiret2.
    DATA: l_type TYPE sy-msgty,
          l_prob TYPE balprobcl.

    CHECK NOT return IS INITIAL.

    l_type = return-type.

* Los datos batch input para el dynpro xxx no existen.
    IF return-id = &apos;00&apos; AND return-number = &apos;344&apos;.
      l_type = &apos;E&apos;.
    ENDIF.

    CASE l_type.
      WHEN &apos;S&apos; OR &apos;I&apos;. l_prob = prob_none.
      WHEN &apos;W&apos;. l_prob = prob_low.
      WHEN OTHERS. l_prob = prob_very_high.
    ENDCASE.

    msg( msgty = l_type
         msgid = return-id
         msgno = return-number
         msgv1 = return-message_v1
         msgv2 = return-message_v2
         msgv3 = return-message_v3
         msgv4 = return-message_v4
         prob  = l_prob ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="APPEND_BAPIRETURN" VERSION="1" LANGU="S" DESCRIPT="Añadir contenido tabla BAPIMATRET2" EXPOSURE="2" STATE="1" EDITORDER="17 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="APPEND_BAPIRETURN" SCONAME="RETURN" VERSION="1" LANGU="S" DESCRIPT="Return Messages" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BAPIRETURN"/>
  <source>METHOD append_bapireturn.
    DATA: l_prob   TYPE balprobcl,
          l_id     TYPE msgid,
          l_number TYPE sy-msgno.

    CASE return-type.
      WHEN &apos;S&apos; OR &apos;I&apos;. l_prob = prob_none.
      WHEN &apos;W&apos;. l_prob = prob_low.
      WHEN OTHERS. l_prob = prob_very_high.
    ENDCASE.

    l_id = return-code(2).
    l_number = return-code+2.

    msg( msgty = return-type
         msgid = l_id
         msgno = l_number
         msgv1 = return-message_v1
         msgv2 = return-message_v2
         msgv3 = return-message_v3
         msgv4 = return-message_v4
         prob  = l_prob ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="APPEND_BDCT" VERSION="1" LANGU="S" DESCRIPT="Añadir contenido tabla BAPIMATRETURN2" EXPOSURE="2" STATE="1" EDITORDER="16 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="APPEND_BDCT" SCONAME="I_RETURN" VERSION="1" LANGU="S" DESCRIPT="Return Messages" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TAB_BDCMSGCOLL"/>
  <source>METHOD append_bdct.
    DATA: l_bdc    TYPE bdcmsgcoll,
          l_return TYPE bapiret2.

    LOOP AT i_return INTO l_bdc.
      CLEAR l_return.
      l_return-type       = l_bdc-msgtyp.
      l_return-id         = l_bdc-msgid.
      l_return-number     = l_bdc-msgnr.
      l_return-message_v1 = l_bdc-msgv1.
      l_return-message_v2 = l_bdc-msgv2.
      l_return-message_v3 = l_bdc-msgv3.
      l_return-message_v4 = l_bdc-msgv4.

      append_bapiret2( l_return ).
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="APPEND_MATRETURN2" VERSION="1" LANGU="S" DESCRIPT="Añadir contenido tabla BAPIMATRETURN2" EXPOSURE="2" STATE="1" EDITORDER="13 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="APPEND_MATRETURN2" SCONAME="I_RETURN" VERSION="1" LANGU="S" DESCRIPT="Return Messages" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ZCL_AP_MATERIAL=&gt;TT_BAPI_MATRETURN2"/>
  <source>METHOD append_matreturn2.
    DATA: l_return TYPE bapi_matreturn2,
          l_prob   TYPE balprobcl.

    LOOP AT i_return INTO l_return.

      CASE l_return-type.
        WHEN &apos;S&apos; OR &apos;I&apos;. l_prob = prob_none.
        WHEN &apos;W&apos;. l_prob = prob_low.
        WHEN OTHERS. l_prob = prob_very_high.
      ENDCASE.

      msg( msgty = l_return-type
           msgid = l_return-id
           msgno = l_return-number
           msgv1 = l_return-message_v1
           msgv2 = l_return-message_v2
           msgv3 = l_return-message_v3
           msgv4 = l_return-message_v4
           prob  = l_prob ).
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="APPEND_RETURN" VERSION="1" LANGU="S" DESCRIPT="Añadir contenido tabla BAPIRETURN" EXPOSURE="2" STATE="1" EDITORDER="11 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="APPEND_RETURN" SCONAME="I_RETURN" VERSION="1" LANGU="S" DESCRIPT="Return Messages" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="FMFG_T_BAPIRETURN"/>
  <source>METHOD append_return.
    DATA: l_return TYPE bapireturn,
          l_id     TYPE msgid,
          l_number TYPE sy-msgno,
          l_prob   TYPE balprobcl.

    LOOP AT i_return INTO l_return.
      l_id = l_return-code(2).
      l_number = l_return-code+2.

      CASE l_return-type.
        WHEN &apos;S&apos; OR &apos;I&apos;. l_prob = prob_none.
        WHEN &apos;W&apos;. l_prob = prob_low.
        WHEN OTHERS. l_prob = prob_very_high.
      ENDCASE.

      msg( msgty = l_return-type
           msgid = l_id
           msgno = l_number
           msgv1 = l_return-message_v1
           msgv2 = l_return-message_v2
           msgv3 = l_return-message_v3
           msgv4 = l_return-message_v4
           prob  = l_prob ).
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="APPEND_RETURN2" VERSION="1" LANGU="S" DESCRIPT="Añadir contenido tabla BAPIMATRETURN2" EXPOSURE="2" STATE="1" EDITORDER="14 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="APPEND_RETURN2" SCONAME="I_RETURN" VERSION="1" LANGU="S" DESCRIPT="Return Messages" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BAPIRET2_T"/>
  <source>METHOD append_return2.
    DATA l_return TYPE bapiret2.

    LOOP AT i_return INTO l_return.
      append_bapiret2( l_return ).
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="BORRAR_LOG" VERSION="1" LANGU="S" DESCRIPT="Borrar log" EXPOSURE="2" STATE="1" EDITORDER="18 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="BORRAR_LOG" SCONAME="LOG" VERSION="1" LANGU="S" DESCRIPT="Log de aplicación: Número de log" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BALOGNR"/>
  <source>METHOD borrar_log.
    DATA i_t_lognumber TYPE bal_t_logn.

    APPEND log TO i_t_lognumber.
    CALL FUNCTION &apos;BAL_DB_DELETE&apos;
      EXPORTING
*       I_T_LOGS_TO_DELETE =
*       I_T_LOG_HANDLE     =
        i_t_lognumber      = i_t_lognumber
*       I_CLIENT           = SY-MANDT
        i_in_update_task   = &apos; &apos;
        i_with_commit_work = &apos;X&apos;
*       I_PACKAGE_SIZE     = 100
      EXCEPTIONS
        no_logs_specified  = 1
        OTHERS             = 2.

    COMMIT WORK AND WAIT.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="BORRAR_LOGS" VERSION="1" LANGU="S" DESCRIPT="Borrar logs" EXPOSURE="2" STATE="1" EDITORDER="19 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="BORRAR_LOGS" SCONAME="OBJECT" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Nombre objeto (sigla de aplicación)" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="BORRAR_LOGS" SCONAME="SUBOBJECT" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Objeto inferior" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="BORRAR_LOGS" SCONAME="EXTNUMBER" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Identificación externa" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="BORRAR_LOGS" SCONAME="FECHA" VERSION="1" LANGU="S" DESCRIPT="Campo de tipo DATS" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DATS" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="BORRAR_LOGS" SCONAME="VACIOS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <source>METHOD borrar_logs.
    DATA: r_obj    TYPE RANGE OF balobj_d,
          r_fec    TYPE RANGE OF baldate,
          r_num    TYPE RANGE OF baldbcntal,
          lr_obj   LIKE LINE OF r_obj,
          lr_sub   LIKE LINE OF r_obj,
          r_sub    TYPE RANGE OF balsubobj,
          lr_ext   LIKE LINE OF r_obj,
          r_ext    TYPE RANGE OF balnrext,
          lr_fec   LIKE LINE OF r_fec,
          lr_num   LIKE LINE OF r_num,
          l_tabla  TYPE tabname,
          i_balhdr TYPE balhdr_t.

    IF NOT object IS INITIAL.
      lr_obj-option = &apos;EQ&apos;.
      lr_obj-sign   = &apos;I&apos;.
      lr_obj-low    = object.
      APPEND lr_obj TO r_obj.
    ENDIF.
    IF NOT subobject IS INITIAL.
      lr_sub-option = &apos;EQ&apos;.
      lr_sub-sign   = &apos;I&apos;.
      lr_sub-low    = subobject.
      APPEND lr_sub TO r_sub.
    ENDIF.
    IF NOT extnumber IS INITIAL.
      lr_ext-option = &apos;EQ&apos;.
      lr_ext-sign   = &apos;I&apos;.
      lr_ext-low    = extnumber.
      APPEND lr_ext TO r_ext.
    ENDIF.
    IF NOT fecha IS INITIAL.
      lr_fec-option = &apos;EQ&apos;.
      lr_fec-sign   = &apos;I&apos;.
      lr_fec-low    = fecha.
      APPEND lr_fec TO r_fec.
    ENDIF.
    IF NOT vacios IS INITIAL.
      lr_num-option = &apos;EQ&apos;.
      lr_num-sign   = &apos;I&apos;.
      lr_num-low    = 0.
      APPEND lr_num TO r_num.
    ENDIF.

    l_tabla = &apos;BALHDR&apos;.
    SELECT * FROM (l_tabla)
      INTO TABLE i_balhdr
     WHERE object     IN r_obj
       AND subobject  IN r_sub
       AND extnumber  IN r_ext
       AND aldate     IN r_fec
       AND msg_cnt_al IN r_num.

    IF sy-subrc = 0.
      CALL FUNCTION &apos;BAL_DB_DELETE&apos;
        EXPORTING
          i_t_logs_to_delete = i_balhdr
*         I_T_LOG_HANDLE     =
*         i_t_lognumber      = i_t_lognumber
*         I_CLIENT           = SY-MANDT
          i_in_update_task   = &apos;&apos;
          i_with_commit_work = &apos;X&apos;
*         I_PACKAGE_SIZE     = 100
        EXCEPTIONS
          no_logs_specified  = 1
          OTHERS             = 2.

      COMMIT WORK AND WAIT.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="BORRAR_LOGSZ" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="36 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="BORRAR_LOGSZ" SCONAME="DIAS_ERROR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="INT2" PARVALUE="90"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="BORRAR_LOGSZ" SCONAME="DIAS_WARNING" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="INT2" PARVALUE="45"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="BORRAR_LOGSZ" SCONAME="DIAS_RESTO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="INT2" PARVALUE="30"/>
  <source>METHOD borrar_logsz.
    FIELD-SYMBOLS &lt;log&gt; TYPE zlog_param.

    DATA: r_proceso    TYPE RANGE OF zlog_param-proceso,
          i_logs_param TYPE TABLE OF zlog_param,
          l_fecha      TYPE d,
          lr_proceso   LIKE LINE OF r_proceso.

    SELECT proceso dias_error dias_warning dias_resto FROM zlog_param &quot;#EC CI_NOFIELD
      INTO CORRESPONDING FIELDS OF TABLE i_logs_param
     WHERE dias_error   &lt;&gt; 0
        OR dias_warning &lt;&gt; 0
        OR dias_resto   &lt;&gt; 0.

    CLEAR r_proceso.
    LOOP AT i_logs_param ASSIGNING &lt;log&gt; WHERE dias_error &lt;&gt; 0. &quot;#EC CI_STDSEQ
      l_fecha = sy-datum - &lt;log&gt;-dias_error.
      DELETE FROM (zcl_c=&gt;tabla_zlog)
       WHERE proceso = &lt;log&gt;-proceso
         AND fecha   &lt; l_fecha
         AND msgty   = &apos;E&apos;.
      CLEAR lr_proceso.
      lr_proceso-option = &apos;EQ&apos;.
      lr_proceso-sign   = &apos;E&apos;.
      lr_proceso-low    = &lt;log&gt;-proceso.
      APPEND lr_proceso TO r_proceso.
    ENDLOOP.
    IF NOT dias_error IS INITIAL.
      l_fecha = sy-datum - dias_error.
      DELETE FROM (zcl_c=&gt;tabla_zlog)
       WHERE proceso IN r_proceso
         AND fecha    &lt; l_fecha
         AND msgty    = &apos;E&apos;.
    ENDIF.

    CLEAR r_proceso.
    LOOP AT i_logs_param ASSIGNING &lt;log&gt; WHERE dias_warning &lt;&gt; 0. &quot;#EC CI_STDSEQ
      l_fecha = sy-datum - &lt;log&gt;-dias_warning.
      DELETE FROM (zcl_c=&gt;tabla_zlog)
       WHERE proceso = &lt;log&gt;-proceso
         AND fecha   &lt; l_fecha
         AND msgty   = &apos;W&apos;.
      CLEAR lr_proceso.
      lr_proceso-option = &apos;EQ&apos;.
      lr_proceso-sign   = &apos;E&apos;.
      lr_proceso-low    = &lt;log&gt;-proceso.
      APPEND lr_proceso TO r_proceso.
    ENDLOOP.
    IF NOT dias_warning IS INITIAL.
      l_fecha = sy-datum - dias_warning.
      DELETE FROM (zcl_c=&gt;tabla_zlog)
       WHERE proceso IN r_proceso
         AND fecha    &lt; l_fecha
         AND msgty    = &apos;W&apos;.
    ENDIF.

    CLEAR r_proceso.
    LOOP AT i_logs_param ASSIGNING &lt;log&gt; WHERE dias_resto &lt;&gt; 0. &quot;#EC CI_STDSEQ
      l_fecha = sy-datum - &lt;log&gt;-dias_resto.
      DELETE FROM (zcl_c=&gt;tabla_zlog)
       WHERE     proceso  = &lt;log&gt;-proceso
         AND     fecha    &lt; l_fecha
         AND NOT msgty   IN ( &apos;E&apos;, &apos;W&apos; ).
      CLEAR lr_proceso.
      lr_proceso-option = &apos;EQ&apos;.
      lr_proceso-sign   = &apos;E&apos;.
      lr_proceso-low    = &lt;log&gt;-proceso.
      APPEND lr_proceso TO r_proceso.
    ENDLOOP.
    IF NOT dias_resto IS INITIAL.
      l_fecha = sy-datum - dias_resto.
      DELETE FROM (zcl_c=&gt;tabla_zlog)
       WHERE     proceso IN r_proceso
         AND     fecha    &lt; l_fecha
         AND NOT msgty   IN ( &apos;E&apos;, &apos;W&apos; ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="CONSTRUCTOR" VERSION="1" LANGU="S" DESCRIPT="CONSTRUCTOR" EXPOSURE="2" STATE="1" EDITORDER="1 " DISPID="0 " MTDTYPE="2" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="CONSTRUCTOR" SCONAME="EXTNUMBER" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Identificación externa" CMPTYPE="1" MTDTYPE="2" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="CONSTRUCTOR" SCONAME="OBJECT" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Nombre objeto (sigla de aplicación)" CMPTYPE="1" MTDTYPE="2" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="CONSTRUCTOR" SCONAME="SUBOBJECT" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Objeto inferior" CMPTYPE="1" MTDTYPE="2" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="CONSTRUCTOR" SCONAME="REPORT" VERSION="1" LANGU="S" DESCRIPT="Programa ABAP, llamadas en procesos externos" CMPTYPE="1" MTDTYPE="2" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-CPROG" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="CONSTRUCTOR" SCONAME="GRABAR_SIEMPRE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="CONSTRUCTOR" SCONAME="DIAS_VALIDEZ" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="60"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="CONSTRUCTOR" SCONAME="CLAVE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="CONSTRUCTOR" SCONAME="GUARDAR_TABLA_INTERNA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <source>METHOD constructor.
    CLEAR s_log.
    s_log-object    = object.
    s_log-subobject = subobject.

    IF extnumber IS INITIAL.
      CONCATENATE sy-datum &apos;_&apos; sy-uzeit INTO s_log-extnumber.
    ELSE.
      s_log-extnumber = extnumber.
    ENDIF.
    s_log-aluser = sy-uname.
    IF report IS INITIAL.
      s_log-alprog = sy-cprog.
    ELSE.
      s_log-alprog = report.
    ENDIF.
    s_log-aldate_del = sy-datum + dias_validez.

* ... see structure BAL_S_LOG for further data ...
* ... which can be added to a log header       ...
* create a log
    IF NOT s_log-subobject IS INITIAL.
      CALL FUNCTION &apos;BAL_LOG_CREATE&apos;
        EXPORTING
          i_s_log      = s_log
        IMPORTING
          e_log_handle = log_handle
        EXCEPTIONS
          OTHERS       = 1.
    ENDIF.

    CLEAR hay_cambios.

    me-&gt;grabar_siempre        = grabar_siempre.
    me-&gt;clave                 = clave.
    me-&gt;guardar_tabla_interna = guardar_tabla_interna.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="ENVIAR_LOG_POR_MAIL" VERSION="1" LANGU="S" DESCRIPT="Envia log por mail" EXPOSURE="2" STATE="1" EDITORDER="24 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="ENVIAR_LOG_POR_MAIL" SCONAME="INFO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="ENVIAR_LOG_POR_MAIL" SCONAME="ERRORES" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="ENVIAR_LOG_POR_MAIL" SCONAME="WARNINGS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="ENVIAR_LOG_POR_MAIL" SCONAME="TITULO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="ENVIAR_LOG_POR_MAIL" SCONAME="DESTINATARIO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="ENVIAR_LOG_POR_MAIL" SCONAME="AVISO_USUARIO_ONLINE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="ENVIAR_LOG_POR_MAIL" SCONAME="LOG_COMPLETO_EN_ADJUNTO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <source>METHOD enviar_log_por_mail.
    &quot; TODO: parameter ERRORES is never used (ABAP cleaner)

    DATA: i_logm   TYPE zlog_t,
          l_param  TYPE zlog_param,
          o_mail   TYPE REF TO zcl_ap_envio_mail,
          l_string TYPE string,
          l_log    TYPE zlog.

    i_logm = i_log.

    IF info = &apos;&apos;.
      DELETE i_logm WHERE msgty = &apos;I&apos; OR msgty = &apos;S&apos;.    &quot;#EC CI_STDSEQ
    ENDIF.
    IF warnings = &apos;&apos;.
      DELETE i_logm WHERE msgty = &apos;W&apos;.                   &quot;#EC CI_STDSEQ
    ENDIF.

    IF i_logm IS INITIAL.
      RETURN.
    ENDIF.

    SELECT SINGLE * FROM zlog_param
      INTO l_param
     WHERE proceso = s_log-object.

    o_mail = NEW #(
        usar_clases = &apos;X&apos; ).

    IF destinatario IS INITIAL.
      IF l_param-email IS INITIAL.
        MESSAGE &apos;Debe definir un destinatario para mail del log&apos;(ddm) TYPE &apos;E&apos;.
      ELSE.
        o_mail-&gt;add_destinatario( destinatario = l_param-email ).
      ENDIF.
    ELSE.
      o_mail-&gt;add_destinatario( destinatario = destinatario ).
    ENDIF.

    IF aviso_usuario_online = &apos;X&apos;.
      o_mail-&gt;add_destinatario( destinatario = sy-uname ).
    ENDIF.

    o_mail-&gt;cabecera_html( ).

    IF titulo IS INITIAL.
      IF s_log-object = s_log-alprog.
        CONCATENATE &apos;Mensajes proceso&apos;(msp) s_log-object sy-datum sy-uzeit INTO l_string SEPARATED BY space.
      ELSE.
        CONCATENATE &apos;Mensajes proceso&apos;(msp) s_log-object s_log-alprog sy-datum sy-uzeit INTO l_string SEPARATED BY space.
      ENDIF.

      o_mail-&gt;add_parrafo_html( l_string ).
    ENDIF.

    o_mail-&gt;set_text( &apos;&lt;font size=&quot;2&quot;&gt;&apos; ).
    o_mail-&gt;inicio_tabla_html( longitud = 1600
                               c1 = l_param-msgv1
                               c2 = l_param-msgv2
                               c3 = l_param-msgv3
                               c4 = l_param-msgv4
                               c5 = &apos;Mensaje&apos;(msg) ).

    LOOP AT i_logm INTO l_log.
      o_mail-&gt;add_fila_html( c1 = l_log-msgv1
                             c2 = l_log-msgv2
                             c3 = l_log-msgv3
                             c4 = l_log-msgv4
                             c5 = l_log-message ).
    ENDLOOP.

    o_mail-&gt;fin_tabla_html( ).
    o_mail-&gt;set_text( &apos;&lt;/font&gt;&apos; ).
    o_mail-&gt;set_text( &apos;&lt;/body&gt;&lt;/html&gt;&apos; ).

    CONCATENATE titulo l_string INTO l_string SEPARATED BY space.

    IF log_completo_en_adjunto IS INITIAL.
      o_mail-&gt;add_itab_alv_as_xls( EXPORTING descripcion = &apos;Mensajes&apos;(msg) CHANGING itab = i_logm ).
    ELSE.
      o_mail-&gt;add_itab_alv_as_xls( EXPORTING descripcion = &apos;Mensajes&apos;(msg) CHANGING itab = i_log ).
    ENDIF.

    o_mail-&gt;envio_mail(
        subject             = l_string
        html                = &apos;X&apos;
        forzar_mail_externo = &apos;X&apos; ).

    o_mail-&gt;free( ).
    &quot; TODO: remove needless CLEAR (ABAP cleaner)
    CLEAR o_mail.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="FREE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="27 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD free.
    IF NOT log_handle IS INITIAL.
      CALL FUNCTION &apos;BAL_LOG_REFRESH&apos;
        EXPORTING
          i_log_handle  = log_handle
        EXCEPTIONS
          log_not_found = 1.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="GET_CONTENIDO_MENSAJE" VERSION="1" LANGU="S" DESCRIPT="Devuelve el contenido del mensaje" EXPOSURE="2" STATE="1" EDITORDER="21 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="GET_CONTENIDO_MENSAJE" SCONAME="LOGNUMBER" VERSION="1" LANGU="S" DESCRIPT="Log de aplicación: Número de log" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BALHDR-LOGNUMBER" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="GET_CONTENIDO_MENSAJE" SCONAME="I_RETURN" VERSION="1" LANGU="S" DESCRIPT="Tabla con estructuras de retorno" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="BAPIRET2_T"/>
  <source>METHOD get_contenido_mensaje.
    DATA: g_r_lognumber  TYPE bal_s_logn,
          g_s_log_filter TYPE bal_s_lfil,
          g_t_log_header TYPE balhdr_t,
          i_msg          TYPE bal_t_msgh,
          l_return       TYPE bapiret2,
          l_message      TYPE bal_s_msg,
          l_header       TYPE balhdr.

    g_r_lognumber-sign   = &apos;I&apos;.
    g_r_lognumber-option = &apos;EQ&apos;.
    g_r_lognumber-low    = lognumber.
    APPEND g_r_lognumber TO g_s_log_filter-lognumber.

    CALL FUNCTION &apos;BAL_DB_SEARCH&apos;
      EXPORTING
        i_s_log_filter = g_s_log_filter
      IMPORTING
        e_t_log_header = g_t_log_header
      EXCEPTIONS
        OTHERS         = 0.

    CALL FUNCTION &apos;BAL_DB_LOAD&apos;
      EXPORTING
        i_t_log_header = g_t_log_header
      IMPORTING
        e_t_msg_handle = i_msg
      EXCEPTIONS
        OTHERS         = 0.

    LOOP AT i_msg ASSIGNING FIELD-SYMBOL(&lt;msg&gt;).

      CLEAR l_return.
      CALL FUNCTION &apos;BAL_LOG_MSG_READ&apos;
        EXPORTING
          i_s_msg_handle = &lt;msg&gt;
          i_langu        = sy-langu
        IMPORTING
          e_s_msg        = l_message
*         E_EXISTS_ON_DB =
*         e_txt_msgty    = l_return-type
*         e_txt_msgid    = l_return-id
*         e_txt_detlevel =
*         e_txt_probclass                =
          e_txt_msg      = l_return-message
*         E_WARNING_TEXT_NOT_FOUND       =
        EXCEPTIONS
          log_not_found  = 1
          msg_not_found  = 2
          OTHERS         = 3.

      MOVE-CORRESPONDING l_message TO l_return.
      l_return-type       = l_message-msgty.
      l_return-id         = l_message-msgid.
      l_return-number     = l_message-msgno.
      l_return-message_v1 = l_message-msgv1.
      l_return-message_v2 = l_message-msgv2.
      l_return-message_v3 = l_message-msgv3.
      l_return-message_v4 = l_message-msgv4.

      IF l_return-message IS INITIAL.
        CALL FUNCTION &apos;BAL_DSP_TXT_MSG_READ&apos;
          EXPORTING
            i_langu        = sy-langu
            i_msgid        = l_message-msgid
            i_msgno        = l_message-msgno
            i_msgv1        = l_message-msgv1
            i_msgv2        = l_message-msgv2
            i_msgv3        = l_message-msgv3
            i_msgv4        = l_message-msgv4
          IMPORTING
            e_message_text = l_return-message.
      ENDIF.
      APPEND l_return TO i_return.
    ENDLOOP.
    IF NOT l_header-log_handle IS INITIAL.
      CALL FUNCTION &apos;BAL_LOG_REFRESH&apos;
        EXPORTING
          i_log_handle  = l_header-log_handle
        EXCEPTIONS
          log_not_found = 1
          OTHERS        = 2.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="GET_TEXT_MESSAGE" VERSION="1" LANGU="S" DESCRIPT="Devuelve el texto formateado del mensaje" EXPOSURE="2" STATE="1" EDITORDER="20 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="GET_TEXT_MESSAGE" SCONAME="RETURN" VERSION="1" LANGU="S" DESCRIPT="Parámetro de retorno" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BAPIRET2"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="GET_TEXT_MESSAGE" SCONAME="MESSAGE" VERSION="1" LANGU="S" DESCRIPT="Texto de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="BAPIRET2-MESSAGE"/>
  <source>METHOD get_text_message.
    MESSAGE ID return-id TYPE return-type NUMBER return-number
            WITH return-message_v1 return-message_v2 return-message_v3 return-message_v4
            INTO message.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="GRABAR" VERSION="1" LANGU="S" DESCRIPT="Grabar log" EXPOSURE="2" STATE="1" EDITORDER="8 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="GRABAR" SCONAME="REFRESH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <source>METHOD grabar.
    IF NOT ( hay_cambios = &apos;X&apos; OR grabar_siempre = &apos;X&apos; ).
      RETURN.
    ENDIF.

    CALL FUNCTION &apos;BAL_DB_SAVE&apos;
      EXPORTING
*       I_CLIENT         = SY-MANDT
*       I_IN_UPDATE_TASK = &apos; &apos;
        i_save_all       = &apos;X&apos;
*       I_T_LOG_HANDLE   =
* IMPORTING
*       E_NEW_LOGNUMBERS =
      EXCEPTIONS
        log_not_found    = 1
        save_not_allowed = 2
        numbering_error  = 3
        OTHERS           = 4.
    IF sy-subrc &lt;&gt; 0.
      MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ELSE.
      IF refresh = &apos;X&apos;.
        free( ).
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="GRABAR_CAMBIOS" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="35 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="GRABAR_CAMBIOS" SCONAME="TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="GRABAR_CAMBIOS" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="GRABAR_CAMBIOS" SCONAME="NEW" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="GRABAR_CAMBIOS" SCONAME="OLD" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="GRABAR_CAMBIOS" SCONAME="PROGNAME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-CPROG"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="GRABAR_CAMBIOS" SCONAME="PROCESO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;CAMBIOS&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="GRABAR_CAMBIOS" SCONAME="CLAVE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="GRABAR_CAMBIOS" SCONAME="CAMPO_CLAVE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <source>METHOD grabar_cambios.
    DATA: o_dato  TYPE REF TO data,
          l_where TYPE string,
          l_old   TYPE string.

    FIELD-SYMBOLS &lt;fs&gt; TYPE any.

    IF old IS INITIAL AND NOT campo_clave IS INITIAL AND NOT tabla IS INITIAL AND NOT clave IS INITIAL.
      TRY.
          ASSIGN (&apos;NEW&apos;) TO &lt;fs&gt;.
          CREATE DATA o_dato LIKE &lt;fs&gt;.
          ASSIGN o_dato-&gt;* TO &lt;fs&gt;.

          CONCATENATE &apos;&apos;&apos;&apos; clave &apos;&apos;&apos;&apos; INTO l_where.
          CONCATENATE campo_clave &apos;=&apos; l_where INTO l_where SEPARATED BY space.
          SELECT SINGLE (campo) FROM (tabla)
            INTO &lt;fs&gt;
           WHERE (l_where).
          l_old = &lt;fs&gt;.
        CATCH cx_root.
          EXIT.
      ENDTRY.
    ELSE.
      l_old = old.
    ENDIF.

    IF new &lt;&gt; l_old.
      zcl_ap_log=&gt;set_log(
          proceso  = proceso
          progname = progname
          clave    = clave
          msgty    = &apos;I&apos;
          msgv1    = tabla
          msgv2    = campo
          msgv3    = new
          msgv4    = l_old ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="32 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="MSGID" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="MSGTY" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;E&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="MSGNO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;398&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="MSGV1" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="MSGV2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="MSGV3" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="MSGV4" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="MESSAGE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="FICHERO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="CLAVE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="P1" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="P2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="12 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="P3" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="13 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="P4" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="14 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="P5" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="15 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="P6" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="16 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="P7" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="17 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="P8" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="18 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="P9" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="19 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="P10" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="20 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="SOLO_PRIMERA_VEZ" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="21 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="P11" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="22 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="P12" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="23 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="P13" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="24 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="P14" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="25 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="P15" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="26 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="UNAME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="27 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-UNAME" PARVALUE="SY-UNAME"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOG" SCONAME="ZLOG" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="28 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="ZLOG"/>
  <source>METHOD log.
    DATA l_clave TYPE zlog-clave.

    IF no_grabar_log = &apos;X&apos;.
      RETURN.
    ENDIF.

    IF NOT clave IS INITIAL.
      l_clave = clave.
    ELSE.
      l_clave = me-&gt;clave.
    ENDIF.

    zlog = set_log( proceso  = s_log-object
                      progname = s_log-alprog
                      clave    = l_clave
             msgid    = msgid
             msgty    = msgty
             msgno    = msgno
             msgv1    = msgv1
             msgv2    = msgv2
             msgv3    = msgv3
             msgv4    = msgv4
             p1 = p1 p2 = p2 p3 = p3 p4 = p4 p5 = p5 p6 = p6 p7 = p7 p8 = p8 p9 = p9 p10 = p10 p11 = p11 p12 = p12 p13 = p13 p14 = p14 p15 = p15
             message  = message
             fichero  = fichero
             solo_primera_vez = solo_primera_vez
             uname = uname ).

    IF guardar_tabla_interna = &apos;X&apos; AND NOT zlog IS INITIAL.
      APPEND zlog TO i_log.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="33 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="MSGID" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="MSGTY" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;E&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="MSGNO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;398&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="MSGV1" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="MSGV2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="MSGV3" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="MSGV4" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="MESSAGE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="FICHERO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="CLAVE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="P1" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="P2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="12 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="P3" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="13 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="P4" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="14 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="P5" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="15 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="P6" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="16 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="P7" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="17 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="P8" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="18 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="P9" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="19 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="P10" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="20 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="SOLO_PRIMERA_VEZ" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="21 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="LOGM" SCONAME="MSG" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="22 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="BAPI_MSG"/>
  <source>METHOD logm.
    DATA l_zlog TYPE zlog.

    l_zlog = log( clave    = clave
             msgid    = msgid
             msgty    = msgty
             msgno    = msgno
             msgv1    = msgv1
             msgv2    = msgv2
             msgv3    = msgv3
             msgv4    = msgv4
             p1 = p1 p2 = p2 p3 = p3 p4 = p4 p5 = p5 p6 = p6 p7 = p7 p8 = p8 p9 = p9 p10 = p10
             message  = message
             fichero  = fichero
             solo_primera_vez = solo_primera_vez ).

    msg = l_zlog-message.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="MSG" VERSION="1" LANGU="S" DESCRIPT="Mensaje" EXPOSURE="2" STATE="1" EDITORDER="2 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG" SCONAME="MSGTY" VERSION="1" LANGU="S" DESCRIPT="Tipo de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGTY" PARVALUE="SY-MSGTY"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG" SCONAME="MSGID" VERSION="1" LANGU="S" DESCRIPT="Clase de mensajes" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGID" PARVALUE="SY-MSGID"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG" SCONAME="MSGNO" VERSION="1" LANGU="S" DESCRIPT="Número de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-MSGNO"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG" SCONAME="MSGV1" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG" SCONAME="MSGV2" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG" SCONAME="MSGV3" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG" SCONAME="MSGV4" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG" SCONAME="PROB" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Clase de problema de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BALPROBCL" PARVALUE="PROB_HIGH"/>
  <source>METHOD msg.
* define data of message for Application Log
    s_msg-msgty     = msgty.
    s_msg-msgid     = msgid.
    s_msg-msgno     = msgno.
    s_msg-msgv1     = msgv1.
    s_msg-msgv2     = msgv2.
    s_msg-msgv3     = msgv3.
    s_msg-msgv4     = msgv4.
    s_msg-probclass = prob.
    CONDENSE: s_msg-msgv1, s_msg-msgv2, s_msg-msgv3, s_msg-msgv4.
* ... see structure BAL_S_LOG or report SBAL_DEMO_02 for ...
* ... further data which can be added to a message       ...

* add this message to log file
* we do not specify I_LOG_HANDLE since we want to add this message
* to the default log. If it does not exist we do not care
* (EXCEPTIONS log_not_found = 0).
    CALL FUNCTION &apos;BAL_LOG_MSG_ADD&apos;
      EXPORTING
        i_s_msg       = s_msg
*       I_LOG_HANDLE  =
      EXCEPTIONS
        log_not_found = 0
        OTHERS        = 1.
    IF sy-subrc &lt;&gt; 0.
      MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ENDIF.

    hay_cambios = &apos;X&apos;.

    APPEND s_msg TO i_tabla_errores.

    IF guardar_tabla_interna = &apos;X&apos;.
      log( msgty = msgty
         msgid = msgid
         msgno = msgno
         msgv1 = msgv1
         msgv2 = msgv2
         msgv3 = msgv3
         msgv4 = msgv4 ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_398" VERSION="1" LANGU="S" DESCRIPT="Mensaje" EXPOSURE="2" STATE="1" EDITORDER="10 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_398" SCONAME="MSGTY" VERSION="1" LANGU="S" DESCRIPT="Tipo de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGTY"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_398" SCONAME="MSGID" VERSION="1" LANGU="S" DESCRIPT="Clase de mensajes" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGID" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_398" SCONAME="MSGNO" VERSION="1" LANGU="S" DESCRIPT="Número de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGNO" PARVALUE="&apos;398&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_398" SCONAME="MSGV1" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGV1"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_398" SCONAME="MSGV2" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGV2" PARVALUE="&apos; &apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_398" SCONAME="MSGV3" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGV3" PARVALUE="&apos; &apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_398" SCONAME="MSGV4" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGV4" PARVALUE="&apos; &apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_398" SCONAME="PROB" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Clase de problema de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BALPROBCL" PARVALUE="PROB_VERY_HIGH"/>
  <source>METHOD msg_398.
    DATA l_prob TYPE balprobcl.

    CASE msgty.
      WHEN &apos;E&apos;.
        l_prob = prob_very_high.
      WHEN &apos;W&apos;.
        l_prob = prob_low.
      WHEN &apos;I&apos;.
        l_prob = prob_none.
    ENDCASE.

    msg( msgty = msgty
         msgid = msgid
         msgno = msgno
         msgv1 = msgv1
         msgv2 = msgv2
         msgv3 = msgv3
         msgv4 = msgv4
         prob  = l_prob ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_ERROR" VERSION="1" LANGU="S" DESCRIPT="Mensaje" EXPOSURE="2" STATE="1" EDITORDER="3 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_ERROR" SCONAME="MSGTY" VERSION="1" LANGU="S" DESCRIPT="Tipo de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGTY" PARVALUE="&apos;E&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_ERROR" SCONAME="MSGID" VERSION="1" LANGU="S" DESCRIPT="Clase de mensajes" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGID" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_ERROR" SCONAME="MSGNO" VERSION="1" LANGU="S" DESCRIPT="Número de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGNO" PARVALUE="&apos;398&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_ERROR" SCONAME="MSGV1" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_ERROR" SCONAME="MSGV2" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos; &apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_ERROR" SCONAME="MSGV3" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos; &apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_ERROR" SCONAME="MSGV4" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos; &apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_ERROR" SCONAME="PROB" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Clase de problema de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BALPROBCL" PARVALUE="PROB_VERY_HIGH"/>
  <source>METHOD msg_error.
    msg( msgty = msgty
         msgid = msgid
         msgno = msgno
         msgv1 = msgv1
         msgv2 = msgv2
         msgv3 = msgv3
         msgv4 = msgv4
         prob  = prob ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_INFO" VERSION="1" LANGU="S" DESCRIPT="Mensaje" EXPOSURE="2" STATE="1" EDITORDER="4 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_INFO" SCONAME="MSGTY" VERSION="1" LANGU="S" DESCRIPT="Tipo de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGTY" PARVALUE="&apos;I&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_INFO" SCONAME="MSGID" VERSION="1" LANGU="S" DESCRIPT="Clase de mensajes" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGID" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_INFO" SCONAME="MSGNO" VERSION="1" LANGU="S" DESCRIPT="Número de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGNO" PARVALUE="&apos;398&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_INFO" SCONAME="MSGV1" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_INFO" SCONAME="MSGV2" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos; &apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_INFO" SCONAME="MSGV3" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos; &apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_INFO" SCONAME="MSGV4" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos; &apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_INFO" SCONAME="PROB" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Clase de problema de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BALPROBCL" PARVALUE="PROB_NONE"/>
  <source>METHOD msg_info.
    DATA l_msgv1 TYPE msgv1.

    l_msgv1 = msgv1.
    msg( msgty = msgty
         msgid = msgid
         msgno = msgno
         msgv1 = l_msgv1
         msgv2 = msgv2
         msgv3 = msgv3
         msgv4 = msgv4
         prob  = prob ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_OPERACION" VERSION="1" LANGU="S" DESCRIPT="Operacionón" EXPOSURE="2" STATE="1" EDITORDER="9 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_OPERACION" SCONAME="SUBRC" VERSION="1" LANGU="S" DESCRIPT="Código retorno de sentencias ABAP" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-SUBRC" PARVALUE="SY-SUBRC"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_OPERACION" SCONAME="TEXTO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;" PARPREFERD="X"/>
  <source>METHOD msg_operacion.
    DATA l_msgv2 TYPE msgv2.

    IF subrc &lt;&gt; 0.
      l_msgv2 = sy-subrc.
    ENDIF.
    msg_succes( msgv1 = texto msgv2 = l_msgv2 ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SUCCES" VERSION="1" LANGU="S" DESCRIPT="Mensaje" EXPOSURE="2" STATE="1" EDITORDER="6 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SUCCES" SCONAME="MSGTY" VERSION="1" LANGU="S" DESCRIPT="Tipo de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGTY" PARVALUE="&apos;S&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SUCCES" SCONAME="MSGID" VERSION="1" LANGU="S" DESCRIPT="Clase de mensajes" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGID" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SUCCES" SCONAME="MSGNO" VERSION="1" LANGU="S" DESCRIPT="Número de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGNO" PARVALUE="&apos;398&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SUCCES" SCONAME="MSGV1" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SUCCES" SCONAME="MSGV2" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos; &apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SUCCES" SCONAME="MSGV3" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos; &apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SUCCES" SCONAME="MSGV4" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos; &apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SUCCES" SCONAME="PROB" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Clase de problema de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BALPROBCL" PARVALUE="PROB_NONE"/>
  <source>METHOD msg_succes.
    msg( msgty = msgty
         msgid = msgid
         msgno = msgno
         msgv1 = msgv1
         msgv2 = msgv2
         msgv3 = msgv3
         msgv4 = msgv4
         prob  = prob ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SYST" VERSION="1" LANGU="S" DESCRIPT="Mensaje" EXPOSURE="2" STATE="1" EDITORDER="26 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SYST" SCONAME="MSGTY" VERSION="1" LANGU="S" DESCRIPT="Tipo de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGTY" PARVALUE="SY-MSGTY"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SYST" SCONAME="MSGID" VERSION="1" LANGU="S" DESCRIPT="Clase de mensajes" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGID" PARVALUE="SY-MSGID"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SYST" SCONAME="MSGNO" VERSION="1" LANGU="S" DESCRIPT="Número de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-MSGNO"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SYST" SCONAME="MSGV1" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-MSGV1"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SYST" SCONAME="MSGV2" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-MSGV2"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SYST" SCONAME="MSGV3" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-MSGV3"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SYST" SCONAME="MSGV4" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-MSGV4"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_SYST" SCONAME="PROB" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Clase de problema de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BALPROBCL" PARVALUE="PROB_HIGH"/>
  <source>METHOD msg_syst.
    &quot; TODO: parameter PROB is never used (ABAP cleaner)

* define data of message for Application Log
    s_msg-msgty = msgty.
    s_msg-msgid = msgid.
    s_msg-msgno = msgno.
    s_msg-msgv1 = msgv1.
    s_msg-msgv2 = msgv2.
    s_msg-msgv3 = msgv3.
    s_msg-msgv4 = msgv4.

    CASE msgty.
      WHEN &apos;E&apos; OR &apos;&apos; OR &apos;A&apos;.
        s_msg-probclass = prob_very_high.
      WHEN &apos;S&apos; OR &apos;I&apos;.
        s_msg-probclass = prob_none.
      WHEN &apos;W&apos;.
        s_msg-probclass = prob_low.

    ENDCASE.
* ... see structure BAL_S_LOG or report SBAL_DEMO_02 for ...
* ... further data which can be added to a message       ...

* add this message to log file
* we do not specify I_LOG_HANDLE since we want to add this message
* to the default log. If it does not exist we do not care
* (EXCEPTIONS log_not_found = 0).
    CALL FUNCTION &apos;BAL_LOG_MSG_ADD&apos;
      EXPORTING
        i_s_msg       = s_msg
*       I_LOG_HANDLE  =
      EXCEPTIONS
        log_not_found = 0
        OTHERS        = 1.
    IF sy-subrc &lt;&gt; 0.
      MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ENDIF.

    hay_cambios = &apos;X&apos;.

    APPEND s_msg TO i_tabla_errores.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_WARNING" VERSION="1" LANGU="S" DESCRIPT="Mensaje" EXPOSURE="2" STATE="1" EDITORDER="5 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_WARNING" SCONAME="MSGTY" VERSION="1" LANGU="S" DESCRIPT="Tipo de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGTY" PARVALUE="&apos;W&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_WARNING" SCONAME="MSGID" VERSION="1" LANGU="S" DESCRIPT="Clase de mensajes" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGID" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_WARNING" SCONAME="MSGNO" VERSION="1" LANGU="S" DESCRIPT="Número de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-MSGNO" PARVALUE="&apos;398&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_WARNING" SCONAME="MSGV1" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_WARNING" SCONAME="MSGV2" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos; &apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_WARNING" SCONAME="MSGV3" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos; &apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_WARNING" SCONAME="MSGV4" VERSION="1" LANGU="S" DESCRIPT="Variable de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos; &apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="MSG_WARNING" SCONAME="PROB" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Clase de problema de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BALPROBCL" PARVALUE="PROB_LOW"/>
  <source>METHOD msg_warning.
    msg( msgty = msgty
         msgid = msgid
         msgno = msgno
         msgv1 = msgv1
         msgv2 = msgv2
         msgv3 = msgv3
         msgv4 = msgv4
         prob  = prob ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="SAVE_ILOG" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="34 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SAVE_ILOG" SCONAME="NUEVA_CLAVE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <source>METHOD save_ilog.
    FIELD-SYMBOLS &lt;zlog&gt; TYPE zlog.

    IF NOT nueva_clave IS INITIAL.
      LOOP AT i_log ASSIGNING &lt;zlog&gt;.
        DELETE zlog FROM &lt;zlog&gt;.

        &lt;zlog&gt;-clave = nueva_clave.
      ENDLOOP.
    ENDIF.

    MODIFY zlog FROM TABLE i_log.

    LOOP AT i_log ASSIGNING FIELD-SYMBOL(&lt;log&gt;) WHERE msgty = &apos;M&apos; AND message CS &apos;&amp;&apos;.
      SPLIT &lt;log&gt;-message AT &apos;&amp;&apos; INTO DATA(l_email) DATA(l_asunto).
      zcl_ap_envio_mail=&gt;mail( direccion = l_email
                               subject   = l_asunto
                               texto     = l_asunto ).
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="28 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="PROCESO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="PROGNAME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-CPROG"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="CLAVE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="MSGID" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="MSGTY" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;E&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="MSGNO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="MSGV1" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="MSGV2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="MSGV3" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="MSGV4" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="MESSAGE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="FICHERO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="12 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="MAIL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="13 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="SOLO_PRIMERA_VEZ" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="14 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="P1" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="15 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="P2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="16 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="P3" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="17 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="P4" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="18 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="P5" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="19 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="P6" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="20 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="P7" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="21 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="P8" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="22 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="P9" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="23 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="P10" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="24 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="P15" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="25 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="P14" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="26 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="P13" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="27 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="P12" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="28 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="P11" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="29 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="UNAME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="30 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-UNAME" PARVALUE="SY-UNAME"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_LOG" SCONAME="ZLOG" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="31 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="ZLOG"/>
  <source>METHOD set_log.
    DATA: l_message   TYPE message,
          zlog_param  TYPE zlog_param,
          &quot; TODO: variable is assigned but never used (ABAP cleaner)
          l_zlog      TYPE zlog,
          l_direccion TYPE string,
          l_subject   TYPE string,
          l_texto     TYPE solisti1,
          i_textos    TYPE rspc_t_text.

    l_message = message.
    IF message IS INITIAL AND NOT p1 IS INITIAL.
      l_message = zcl_ap_utils=&gt;concat( p1 = p1 p2 = p2 p3 = p3 p4 = p4 p5 = p5 p6 = p6 p7 = p7 p8 = p8 p9 = p9 p10 = p10 p11 = p11 p12 = p12 p13 = p13 p14 = p14 p15 = p15 ).
    ENDIF.

    CLEAR zlog.
    zlog-proceso  = proceso.
    zlog-progname = progname.
    zlog-clave    = clave.
    zlog-fecha    = sy-datum.
    zlog-hora     = sy-uzeit.
    zlog-usuario  = uname.
    zlog-msgid    = msgid.
    zlog-msgty    = msgty.
    zlog-msgno    = msgno.
    zlog-msgv1    = msgv1.
    zlog-msgv2    = msgv2.
    zlog-msgv3    = msgv3.
    zlog-msgv4    = msgv4.
    zlog-message  = l_message.

    IF         l_message IS INITIAL
       AND NOT msgno     IS INITIAL
       AND NOT msgid     IS INITIAL.
      MESSAGE ID msgid TYPE &apos;S&apos; NUMBER msgno
              WITH msgv1 msgv2 msgv3 msgv4
              INTO zlog-message.
    ENDIF.

    zlog-fichero = fichero.

    CLEAR zlog_param.
    SELECT SINGLE solo_tipos endda email FROM zlog_param
      INTO CORRESPONDING FIELDS OF zlog_param
     WHERE proceso = zlog-proceso.
    IF NOT zlog_param-endda IS INITIAL.
* Si hay fecha fin es que han limitado la grabación del lo a una fecha tope
      IF sy-datum &gt; zlog_param-endda.
        RETURN.
      ENDIF.
    ENDIF.
    IF NOT zlog_param-solo_tipos IS INITIAL.
* Sólo grabaremos determinados tipos de error
      IF zcl_ap_lista=&gt;es_elemento( lista = zlog_param-solo_tipos elemento = msgty ) = &apos;&apos;.
        RETURN.
      ENDIF.
    ENDIF.

    IF solo_primera_vez = &apos;X&apos;.
      SELECT SINGLE proceso FROM (zcl_c=&gt;tabla_zlog)
        INTO l_zlog-proceso
             WHERE proceso  = proceso
               AND progname = progname
               AND clave    = clave
               AND msgv1    = msgv1
               AND msgv2    = msgv2
               AND msgv3    = msgv3
               AND msgv4    = msgv4
               AND msgty    = msgty
               AND msgid    = msgid
               AND msgno    = msgno
               AND message  = l_message
               AND fichero  = fichero.
      IF sy-subrc = 0.
        RETURN.
      ENDIF.
    ENDIF.

    SELECT MAX( indice ) FROM (zcl_c=&gt;tabla_zlog)
      INTO zlog-indice
     WHERE proceso  = zlog-proceso
       AND progname = zlog-progname
       AND clave    = zlog-clave
       AND fecha    = zlog-fecha
       AND hora     = zlog-hora
       AND usuario  = zlog-usuario.
    zlog-indice = zlog-indice + 1.

    TRY.
        INSERT (zcl_c=&gt;tabla_zlog) FROM zlog.

        IF NOT mail IS INITIAL AND zlog-msgty = &apos;E&apos;.
          IF mail = &apos;X&apos;.
            l_direccion = zlog_param-email.
          ELSE.
            l_direccion = mail.
          ENDIF.

          IF NOT l_direccion IS INITIAL.
            CONCATENATE &apos;Error en&apos;(err) zlog-proceso zlog-clave INTO l_subject SEPARATED BY space.

            l_texto = zcl_ap_utils=&gt;concat( p1 = &apos;Se ha producido un error en&apos;(spe) p2 = zlog-proceso p3 = &apos;clave&apos;(key) p4 = zlog-clave p5 = &apos;report&apos;(rep) p6 = zlog-progname ).
            APPEND l_texto TO i_textos.
            l_texto = zcl_ap_utils=&gt;concat( p1 = &apos;Usuario&apos;(usr) p2 = zlog-usuario p3 = &apos;el&apos;(ell) p4 = zlog-fecha p5 = &apos;hora&apos;(hor) p6 = zlog-hora ).
            APPEND l_texto TO i_textos.
            l_texto = zlog-message.
            APPEND l_texto TO i_textos.

            zcl_ap_envio_mail=&gt;mail( subject   = l_subject
                                     direccion = l_direccion
                                     commit    = &apos;&apos;
                                     i_textos  = i_textos ).
          ENDIF.
        ENDIF.

      CATCH cx_root INTO DATA(cx_root).
        MESSAGE cx_root-&gt;get_text( ) TYPE &apos;I&apos;.
    ENDTRY.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" VERSION="1" LANGU="S" DESCRIPT="Graba el registro en tabla ZLOG" EXPOSURE="2" STATE="1" EDITORDER="22 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="MSGID" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="MSGTY" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;E&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="MSGNO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;398&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="MSGV1" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="MSGV2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="MSGV3" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="MSGV4" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="MESSAGE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="FICHERO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="CLAVE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="P1" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="P2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="12 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="P3" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="13 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="P4" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="14 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="P5" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="15 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="P6" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="16 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="P7" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="17 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="P8" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="18 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG" SCONAME="P9" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="19 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <source>METHOD set_tabla_log.
    DATA l_zlog TYPE zlog.

    l_zlog = log( clave    = clave
             msgid    = msgid
             msgty    = msgty
             msgno    = msgno
             msgv1    = msgv1
             msgv2    = msgv2
             msgv3    = msgv3
             msgv4    = msgv4
             p1 = p1 p2 = p2 p3 = p3 p4 = p4 p5 = p5 p6 = p6 p7 = p7 p8 = p8 p9 = p9
             message  = message
             fichero  = fichero ).

    IF guardar_tabla_interna IS INITIAL.
      APPEND l_zlog TO i_log.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_FROM_BAPIRET2" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="29 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_FROM_BAPIRET2" SCONAME="BAPIRET2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BAPIRET2" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_FROM_BAPIRET2" SCONAME="CLAVE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <source>METHOD set_tabla_log_from_bapiret2.
    DATA l_zlog TYPE zlog.

    l_zlog = set_log( proceso  = s_log-object
                      progname = s_log-alprog
                      clave    = clave
                      msgid    = bapiret2-id
                      msgty    = bapiret2-type
                      msgno    = bapiret2-number
                      msgv1    = bapiret2-message_v1
                      msgv2    = bapiret2-message_v2
                      msgv3    = bapiret2-message_v3
                      msgv4    = bapiret2-message_v4
                      message  = bapiret2-message ).

    APPEND l_zlog TO i_log.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_FROM_BAPIRET2_T" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="30 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_FROM_BAPIRET2_T" SCONAME="BAPIRET2_T" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BAPIRET2_T" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_FROM_BAPIRET2_T" SCONAME="CLAVE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <source>METHOD set_tabla_log_from_bapiret2_t.
    DATA: bapiret2 TYPE bapiret2,
          l_zlog   TYPE zlog.

    LOOP AT bapiret2_t INTO bapiret2.
      l_zlog = set_log( proceso  = s_log-object
                        progname = s_log-alprog
                        clave    = clave
                        msgid    = bapiret2-id
                        msgty    = bapiret2-type
                        msgno    = bapiret2-number
                        msgv1    = bapiret2-message_v1
                        msgv2    = bapiret2-message_v2
                        msgv3    = bapiret2-message_v3
                        msgv4    = bapiret2-message_v4
                        message  = bapiret2-message ).

      APPEND l_zlog TO i_log.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_SYST" VERSION="1" LANGU="S" DESCRIPT="Graba el registro en tabla ZLOG" EXPOSURE="2" STATE="1" EDITORDER="23 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_SYST" SCONAME="MSGID" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-MSGID"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_SYST" SCONAME="MSGTY" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-MSGTY"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_SYST" SCONAME="MSGNO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-MSGNO"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_SYST" SCONAME="MSGV1" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-MSGV1"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_SYST" SCONAME="MSGV2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-MSGV2"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_SYST" SCONAME="MSGV3" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-MSGV3"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_SYST" SCONAME="MSGV4" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-MSGV4"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_SYST" SCONAME="MESSAGE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_SYST" SCONAME="FICHERO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SET_TABLA_LOG_SYST" SCONAME="CLAVE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <source>METHOD set_tabla_log_syst.
    &quot; TODO: parameter MESSAGE is never used (ABAP cleaner)

    set_tabla_log( msgid = msgid
                   msgty = msgty
                   msgno = msgno
                   msgv1 = msgv1
                   msgv2 = msgv2
                   msgv3 = msgv3
                   msgv4 = msgv4
                   fichero = fichero
                   clave = clave ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="SHOW_LOG" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="31 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SHOW_LOG" SCONAME="SHOW_MSGV1" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SHOW_LOG" SCONAME="SHOW_MSGV2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="SHOW_LOG" SCONAME="TITULO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <source>METHOD show_log.
    DATA o_popup TYPE REF TO zcl_ap_popup.

    FIELD-SYMBOLS &lt;log&gt; TYPE zlog.

    CHECK NOT i_log IS INITIAL.

    o_popup = NEW #( ).

    LOOP AT i_log ASSIGNING &lt;log&gt;.
      o_popup-&gt;add_message( msgty = &lt;log&gt;-msgty
                            msgid = &lt;log&gt;-msgid
                            msgno = &lt;log&gt;-msgno
                            msgv1 = &lt;log&gt;-msgv1
                            msgv2 = &lt;log&gt;-msgv2
                            msgv3 = &lt;log&gt;-msgv3
                            msgv4 = &lt;log&gt;-msgv4
                            message = &lt;log&gt;-message ).
    ENDLOOP.

    o_popup-&gt;show_errores( show_msgv1 = show_msgv1 show_msgv2 = show_msgv2 titulo = titulo ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="VER_LOG" VERSION="1" LANGU="S" DESCRIPT="Visualizar log" EXPOSURE="2" STATE="1" EDITORDER="7 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD ver_log.
***************************************************************
* display log file
***************************************************************
* - we do not specify a display profile I_S_DISPLAY_PROFILE
*   since we want to use the standard profile
* - we also do not specify any filter (I_S_LOG_FILTER, ...
*   I_T_MSG_HANDLE) since we want to display all messages available
    CALL FUNCTION &apos;BAL_DSP_LOG_DISPLAY&apos;
*      EXPORTING
*           I_S_LOG_FILTER         =
*           I_T_LOG_CONTEXT_FILTER =
*           I_S_MSG_FILTER         =
*           I_T_MSG_CONTEXT_FILTER =
*           I_T_LOG_HANDLE         =
*           I_T_MSG_HANDLE         =
*           I_S_DISPLAY_PROFILE    =
*           I_AMODAL               = &apos; &apos;
      EXCEPTIONS
        OTHERS = 1.
    IF sy-subrc &lt;&gt; 0.
      MESSAGE ID sy-msgid TYPE &apos;S&apos; NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="VER_LOGNUMBER" VERSION="1" LANGU="S" DESCRIPT="Visualiza log a partir de log number" EXPOSURE="2" STATE="1" EDITORDER="25 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="VER_LOGNUMBER" SCONAME="LOGNUMBER" VERSION="1" LANGU="S" DESCRIPT="Log de aplicación: Número de log" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BALHDR-LOGNUMBER"/>
  <source>METHOD ver_lognumber.
    TYPES: BEGIN OF  t_lognumber,
             item TYPE balhdr-lognumber,
           END OF t_lognumber.

    DATA i_lognumbers TYPE TABLE OF t_lognumber.

    APPEND lognumber TO i_lognumbers.

    CALL FUNCTION &apos;APPL_LOG_DISPLAY_WITH_LOGNO&apos;
* EXPORTING
*   OBJECT_ATTRIBUTE                     = 0
*   SUBOBJECT_ATTRIBUTE                  = 0
*   EXTERNAL_NUMBER_ATTRIBUTE            = 0
*   TITLE_LIST_SCREEN                    = &apos; &apos;
*   COLUMN_SELECTION                     = &apos;11112221122   &apos;
*   COLUMN_SELECTION_MSG_JUMP            = &apos;1&apos;
*   EXTERNAL_NUMBER_DISPLAY_LENGTH       = 20
*   I_S_DISPLAY_PROFILE                  =
* IMPORTING
*   NUMBER_OF_PROTOCOLS                  =
      TABLES
        lognumbers   = i_lognumbers
      EXCEPTIONS
        no_authority = 1
        OTHERS       = 2.

    IF sy-subrc &lt;&gt; 0.
      MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_LOG" CMPNAME="VER_LOGS" VERSION="1" LANGU="S" DESCRIPT="Visualizar logs (estático)" EXPOSURE="2" STATE="1" EDITORDER="12 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="VER_LOGS" SCONAME="OBJECT" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Nombre objeto (sigla de aplicación)" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BALOBJ_D"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="VER_LOGS" SCONAME="SUBOBJECT" VERSION="1" LANGU="S" DESCRIPT="Log aplicación: Objeto inferior" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="BALSUBOBJ"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="VER_LOGS" SCONAME="EXTNUMBER" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="VER_LOGS" SCONAME="REPORT" VERSION="1" LANGU="S" DESCRIPT="Programa de llamada" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-CPROG" PARVALUE="SY-CPROG"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="VER_LOGS" SCONAME="BORRAR_LOGS_VACIOS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="VER_LOGS" SCONAME="DATE_FROM" VERSION="1" LANGU="S" DESCRIPT="Campo de tipo DATS" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DATS" PARVALUE="SY-DATUM"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="VER_LOGS" SCONAME="DATE_TO" VERSION="1" LANGU="S" DESCRIPT="Campo de tipo DATS" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DATS" PARVALUE="SY-DATUM"/>
  <parameter CLSNAME="ZCL_AP_LOG" CMPNAME="VER_LOGS" SCONAME="INMEDIATO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <source>METHOD ver_logs.
    DATA l_external_number TYPE balhdr-extnumber.

    IF borrar_logs_vacios = &apos;X&apos;.
      borrar_logs( object = object
                   subobject = subobject
                   extnumber = extnumber
                   vacios    = &apos;X&apos; ).
    ENDIF.

    l_external_number = extnumber.

    CALL FUNCTION &apos;APPL_LOG_DISPLAY&apos;
      EXPORTING
        object                         = object
        object_attribute               = 0
        subobject                      = subobject
        subobject_attribute            = 0
        external_number                = l_external_number
        external_number_attribute      = 0
        title_list_screen              = &apos; &apos;
        title_selection_screen         = &apos; &apos;
        date_from                      = date_from          &quot;#EC DOM_EQUAL
        date_to                        = date_to            &quot;#EC DOM_EQUAL
        time_to                        = &apos;235959&apos;           &quot;#EC DOM_EQUAL
        external_number_display_length = 20
        i_variant_report               = report
        suppress_selection_dialog      = inmediato
      EXCEPTIONS
        no_authority                   = 01.
  ENDMETHOD.</source>
 </method>
</CLAS>

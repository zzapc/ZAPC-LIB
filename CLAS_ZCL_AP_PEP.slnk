<?xml version="1.0" encoding="utf-8"?>
<CLAS CLSNAME="ZCL_AP_PEP" VERSION="1" LANGU="S" DESCRIPT="Elementos PEP" CATEGORY="00" EXPOSURE="2" STATE="1" RELEASE="0" CLSCCINCL="X" FIXPT="X" UNICODE="X" CLSBCCAT="00" DURATION_TYPE="0 " RISK_LEVEL="0 ">
 <localImplementation>*&quot;* local class implementation for public class
*&quot;* use this source file for the implementation part of
*&quot;* local helper classes</localImplementation>
 <localTypes>*&quot;* use this source file for any type declarations (class
*&quot;* definitions, interfaces or data types) you need for method
*&quot;* implementation or private method&apos;s signature</localTypes>
 <localMacros>*&quot;* use this source file for any macro definitions you need
*&quot;* in the implementation part of the class</localMacros>
 <typeUsage CLSNAME="ZCL_AP_PEP" TYPEGROUP="ABAP" VERSION="1" TPUTYPE="0" IMPLICIT="X"/>
 <forwardDeclaration>ABAP</forwardDeclaration>
 <attribute CLSNAME="ZCL_AP_PEP" CMPNAME="C_ESTADO_DMBL" VERSION="1" LANGU="S" DESCRIPT="Bloqueo datos maestros" EXPOSURE="2" STATE="1" EDITORDER="4 " ATTDECLTYP="2" ATTVALUE="&apos;I0065&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="JEST-STAT" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_PEP" CMPNAME="C_ESTADO_IMBL" VERSION="1" LANGU="S" DESCRIPT="Bloqueo imputación" EXPOSURE="2" STATE="1" EDITORDER="3 " ATTDECLTYP="2" ATTVALUE="&apos;I0064&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="JEST-STAT" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_PEP" CMPNAME="C_ESTADO_LIBS" VERSION="1" LANGU="S" DESCRIPT="Liberar sólo SM" EXPOSURE="2" STATE="1" EDITORDER="5 " ATTDECLTYP="2" ATTVALUE="&apos;E0001&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="JEST-STAT" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_PEP" CMPNAME="C_EVENTO" VERSION="1" LANGU="S" DESCRIPT="Evento" EXPOSURE="2" STATE="1" EDITORDER="1 " ATTDECLTYP="2" ATTVALUE="&apos;EV&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="CHAR2" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_PEP" CMPNAME="C_FERIA" VERSION="1" LANGU="S" DESCRIPT="Feria" EXPOSURE="2" STATE="1" EDITORDER="2 " ATTDECLTYP="2" ATTVALUE="&apos;CF&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="CHAR2" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <method CLSNAME="ZCL_AP_PEP" CMPNAME="CONTIENE_STATUS" VERSION="1" LANGU="S" DESCRIPT="Contiene status" EXPOSURE="2" STATE="1" EDITORDER="10 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="CONTIENE_STATUS" SCONAME="PEP" VERSION="1" LANGU="S" DESCRIPT="Elemento del plan de estructura de proyecto (elemento PEP)" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="EKKN-PS_PSP_PNR"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="CONTIENE_STATUS" SCONAME="STATUS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="CONTIENE_STATUS" SCONAME="SPRAS" VERSION="1" LANGU="S" DESCRIPT="Clave de idioma del entorno de texto actual" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-LANGU" PARVALUE="SY-LANGU"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="CONTIENE_STATUS" SCONAME="STATUS_EXCLUIR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="CONTIENE_STATUS" SCONAME="STSMA" VERSION="1" LANGU="S" DESCRIPT="Esquema de status" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TJ30T-STSMA" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="CONTIENE_STATUS" SCONAME="USUARIO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="CONTIENE_STATUS" SCONAME="SI_CONTIENE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="ABAP_BOOL"/>
  <source>METHOD contiene_status.
    DATA: i_status  TYPE TABLE OF j_txt04,
          l_txt04   TYPE j_txt04,
          l_objnr   TYPE jest-objnr,
          l_istat   TYPE j_status,
          r_status  TYPE RANGE OF j_status,
          lr_status LIKE LINE OF r_status.

    SPLIT status AT &apos;,&apos; INTO TABLE i_status.

    LOOP AT i_status INTO l_txt04.
      IF usuario IS INITIAL.
        SELECT istat FROM tj02t                         &quot;#EC CI_GENBUFF
          INTO l_istat
         WHERE spras = spras
           AND txt04 = l_txt04.

        CLEAR lr_status.
        lr_status-option = &apos;EQ&apos;.
        lr_status-sign   = &apos;I&apos;.
        lr_status-low    = l_istat.
        APPEND lr_status TO r_status.
      ENDSELECT.
    ELSE.
      IF NOT stsma IS INITIAL.
        SELECT estat FROM tj30t
          INTO l_istat
          UP TO 1 ROWS
         WHERE stsma = stsma
           AND spras = spras
           AND txt04 = l_txt04
         ORDER BY PRIMARY KEY.
        ENDSELECT.
      ELSE.
        SELECT estat FROM tj30t
          INTO l_istat
          UP TO 1 ROWS
         WHERE stsma = stsma
           AND spras = spras
           AND txt04 = l_txt04
         ORDER BY PRIMARY KEY.
        ENDSELECT.
      ENDIF.
      IF sy-subrc = 0.
        CLEAR lr_status.
        lr_status-option = &apos;EQ&apos;.
        lr_status-sign   = &apos;I&apos;.
        lr_status-low    = l_istat.
        APPEND lr_status TO r_status.
      ENDIF.
    ENDIF.

  ENDLOOP.

  IF NOT status_excluir IS INITIAL.
    REFRESH i_status.
    SPLIT status_excluir AT &apos;,&apos; INTO TABLE i_status.
    LOOP AT i_status INTO l_txt04.
      IF usuario IS INITIAL.
        SELECT SINGLE istat FROM tj02t                  &quot;#EC CI_GENBUFF
          INTO l_istat
         WHERE spras = spras
           AND txt04 = l_txt04.
      ELSE.
        IF NOT stsma IS INITIAL.
          SELECT SINGLE estat FROM tj30t
            INTO l_istat
           WHERE stsma = stsma
             AND spras = spras
             AND txt04 = l_txt04.
        ELSE.
          SELECT estat FROM tj30t
            INTO l_istat
            UP TO 1 ROWS
           WHERE stsma = stsma
             AND spras = spras
             AND txt04 = l_txt04
           ORDER BY PRIMARY KEY.
          ENDSELECT.
        ENDIF.
      ENDIF.
      IF sy-subrc = 0.
        CLEAR lr_status.
        lr_status-option = &apos;EQ&apos;.
        lr_status-sign   = &apos;E&apos;.
        lr_status-low    = l_istat.
        APPEND lr_status TO r_status.
      ENDIF.
    ENDLOOP.
  ENDIF.

  IF r_status IS INITIAL.
    EXIT.
  ENDIF.

  CONCATENATE &apos;PR&apos; pep INTO l_objnr.

  SELECT SINGLE stat FROM  jest
    INTO l_istat
   WHERE objnr  = l_objnr
     AND stat   IN r_status
     AND inact  = &apos;&apos;.
  IF sy-subrc = 0.
    si_contiene = &apos;X&apos;.
  ENDIF.

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_PEP" CMPNAME="ES_INACTIVO" VERSION="1" LANGU="S" DESCRIPT="Comprueba si el PEP está inactivo" EXPOSURE="2" STATE="1" EDITORDER="4 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="ES_INACTIVO" SCONAME="PEP" VERSION="1" LANGU="S" DESCRIPT="Elemento del plan de estructura de proyecto (elemento PEP)" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="EKKN-PS_PSP_PNR"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="ES_INACTIVO" SCONAME="SI" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="ABAP_BOOL"/>
  <source>METHOD es_inactivo.
  DATA: l_objnr TYPE jest-objnr,
        l_jest  TYPE jest.

  CONCATENATE &apos;PR&apos; pep INTO l_objnr.

  CLEAR si.
  SELECT SINGLE objnr FROM jest
    INTO l_jest-objnr
   WHERE objnr =  l_objnr
     AND stat  = c_estado_imbl
     AND inact = &apos;&apos;.
  IF sy-subrc = 0.
    si = &apos;X&apos;.
  ENDIF.


ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_PEP" CMPNAME="GET_EXTERNO" VERSION="1" LANGU="S" DESCRIPT="Devuelve el PEP en formato externo" EXPOSURE="2" STATE="1" EDITORDER="1 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_EXTERNO" SCONAME="PEP" VERSION="1" LANGU="S" DESCRIPT="Elemento del plan de estructura de proyecto (elemento PEP)" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="EKKN-PS_PSP_PNR"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_EXTERNO" SCONAME="TEXTO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD get_externo.

  CALL FUNCTION &apos;CONVERSION_EXIT_ABPSP_OUTPUT&apos;
    EXPORTING
      input  = pep
    IMPORTING
      output = texto.


ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_PEP" CMPNAME="GET_INTERNO" VERSION="1" LANGU="S" DESCRIPT="Devuelve el PEP en formato externo" EXPOSURE="2" STATE="1" EDITORDER="3 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_INTERNO" SCONAME="PEP" VERSION="1" LANGU="S" DESCRIPT="Elemento del plan de estructura de proyecto (elemento PEP)" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="0" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_INTERNO" SCONAME="OBJNR" VERSION="1" LANGU="S" DESCRIPT="Elemento del plan de estructura de proyecto (elemento PEP)" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="EKKN-PS_PSP_PNR"/>
  <source>METHOD get_interno.

*  CALL FUNCTION &apos;CONVERSION_EXIT_ABPSP_INPUT&apos;
*    EXPORTING
*      input  = pep
*    IMPORTING
*      output = objnr.

  CALL FUNCTION &apos;CONVERSION_EXIT_KONPR_INPUT&apos;               &quot;#EC EXISTS
    EXPORTING
      input         = pep
    IMPORTING
      output        = objnr
    EXCEPTIONS
      not_found     = 1
      error_message = 999. &quot;Cualquier otra excepción!

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PEP_PADRE" VERSION="1" LANGU="S" DESCRIPT="Devuelve el PEP padre" EXPOSURE="2" STATE="1" EDITORDER="5 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PEP_PADRE" SCONAME="PEP" VERSION="1" LANGU="S" DESCRIPT="Elemento del plan de estructura de proyecto (elemento PEP)" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="EKKN-PS_PSP_PNR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PEP_PADRE" SCONAME="POSID" VERSION="1" LANGU="S" DESCRIPT="Elemento del plan de estructura de proyecto (elemento PEP)" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="PRPS-POSID" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PEP_PADRE" SCONAME="PADRE" VERSION="1" LANGU="S" DESCRIPT="Elemento del plan de estructura de proyecto (elemento PEP)" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="EKKN-PS_PSP_PNR"/>
  <source>METHOD get_pep_padre.
  DATA l_pep TYPE prps-pspnr.

  IF pep IS INITIAL.
    l_pep = get_interno( posid ).
  ELSE.
    l_pep = pep.
  ENDIF.

  CLEAR padre.
  SELECT SINGLE up FROM prhi
    INTO padre
   WHERE posnr = l_pep.


ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PROJ_EXT" VERSION="1" LANGU="S" DESCRIPT="Devuelve PSPNR" EXPOSURE="2" STATE="1" EDITORDER="9 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PROJ_EXT" SCONAME="PSPNR" VERSION="1" LANGU="S" DESCRIPT="Definición proyecto (interna)" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="0" TYPTYPE="1" TYPE="PROJ-PSPNR"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PROJ_EXT" SCONAME="PROYECTO" VERSION="1" LANGU="S" DESCRIPT="Definición del proyecto" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="PROJ-PSPID"/>
  <source>METHOD get_proj_ext.

  CALL FUNCTION &apos;CONVERSION_EXIT_KONPD_OUTPUT&apos;
    EXPORTING
      input  = pspnr
    IMPORTING
      output = proyecto.
*   PSELT         = PSELT

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PROJ_INT" VERSION="1" LANGU="S" DESCRIPT="Devuelve PSPNR" EXPOSURE="2" STATE="1" EDITORDER="8 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PROJ_INT" SCONAME="PROYECTO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PROJ_INT" SCONAME="PSPNR" VERSION="1" LANGU="S" DESCRIPT="Definición proyecto (interna)" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="PROJ-PSPNR"/>
  <source>METHOD get_proj_int.

  CALL FUNCTION &apos;CONVERSION_EXIT_KONPD_INPUT&apos;
    EXPORTING
      input     = proyecto
    IMPORTING
      output    = pspnr
*     PROJWA    = PROJWA
    EXCEPTIONS
      not_found = 1.

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PROYECTO_FROM_OBJNR" VERSION="1" LANGU="S" DESCRIPT="Devuelve el proyecto del nº de objeto (PR...)" EXPOSURE="2" STATE="1" EDITORDER="11 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PROYECTO_FROM_OBJNR" SCONAME="PEP" VERSION="1" LANGU="S" DESCRIPT="Nº objeto del PEP (PR...)" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="PRPS-OBJNR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PROYECTO_FROM_OBJNR" SCONAME="PADRE" VERSION="1" LANGU="S" DESCRIPT="Proyecto" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="EKKN-PS_PSP_PNR"/>
  <source>METHOD get_proyecto_from_objnr.
  IF NOT pep IS INITIAL.
    CLEAR padre.
    SELECT psphi FROM prps                              &quot;#EC CI_NOFIELD
      INTO padre
      UP TO 1 ROWS
     WHERE objnr = pep
     ORDER BY PRIMARY KEY.
    ENDSELECT.
  ENDIF.
ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PROYECTO_FROM_PEP" VERSION="1" LANGU="S" DESCRIPT="Devuelve el proyecto del PEP" EXPOSURE="2" STATE="1" EDITORDER="6 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PROYECTO_FROM_PEP" SCONAME="PEP" VERSION="1" LANGU="S" DESCRIPT="Elemento del plan de estructura de proyecto (elemento PEP)" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="EKKN-PS_PSP_PNR" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PROYECTO_FROM_PEP" SCONAME="POSID" VERSION="1" LANGU="S" DESCRIPT="Elemento del plan de estructura de proyecto (elemento PEP)" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="PRPS-POSID" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PROYECTO_FROM_PEP" SCONAME="PADRE" VERSION="1" LANGU="S" DESCRIPT="Elemento del plan de estructura de proyecto (elemento PEP)" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="EKKN-PS_PSP_PNR"/>
  <source>METHOD get_proyecto_from_pep.
  DATA l_pep TYPE prps-pspnr.

  IF pep IS INITIAL.
    l_pep = get_interno( posid ).
  ELSE.
    l_pep = pep.
  ENDIF.

  CLEAR padre.
  SELECT SINGLE psphi FROM prps
    INTO padre
   WHERE pspnr = l_pep.

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PSPNR" VERSION="1" LANGU="S" DESCRIPT="Devuelve PSPNR" EXPOSURE="2" STATE="1" EDITORDER="7 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PSPNR" SCONAME="PROYECTO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_PSPNR" SCONAME="PSPNR" VERSION="1" LANGU="S" DESCRIPT="Definición proyecto (interna)" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="PROJ-PSPNR"/>
  <source>METHOD get_pspnr.

  CALL FUNCTION &apos;CONVERSION_EXIT_KONPD_INPUT&apos;
    EXPORTING
      input     = proyecto
    IMPORTING
      output    = pspnr
*     PROJWA    = PROJWA
    EXCEPTIONS
      not_found = 1.

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_PEP" CMPNAME="GET_STATUS" VERSION="1" LANGU="S" DESCRIPT="Devuelve los status del PEP" EXPOSURE="2" STATE="1" EDITORDER="2 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_STATUS" SCONAME="PEP" VERSION="1" LANGU="S" DESCRIPT="Elemento del plan de estructura de proyecto (elemento PEP)" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="EKKN-PS_PSP_PNR"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="GET_STATUS" SCONAME="STATUS" VERSION="1" LANGU="S" DESCRIPT="Denominación del status de actualización" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="STTXT"/>
  <source>METHOD get_status.
  DATA l_objnr TYPE jest-objnr.

  CONCATENATE &apos;PR&apos; pep INTO l_objnr.

  CALL FUNCTION &apos;STATUS_TEXT_EDIT&apos;
    EXPORTING
      objnr            = l_objnr
      spras            = sy-langu
      flg_user_stat    = &apos;X&apos;
    IMPORTING
      line             = status
    EXCEPTIONS
      object_not_found = 01.


ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_PEP" CMPNAME="VISUALIZAR" VERSION="1" LANGU="S" DESCRIPT="Visualiza PEP" EXPOSURE="2" STATE="1" EDITORDER="12 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="VISUALIZAR" SCONAME="PEP" VERSION="1" LANGU="S" DESCRIPT="Elemento del plan de estructura de proyecto (elemento PEP)" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_PEP" CMPNAME="VISUALIZAR" SCONAME="PROYECTO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <source>METHOD visualizar.
  DATA l_posid TYPE ps_posid.

  WRITE pep TO l_posid.

  IF proyecto = &apos;X&apos;.
    SET PARAMETER ID &apos;PSP&apos; FIELD l_posid.
    SET PARAMETER ID &apos;PRO&apos; FIELD &apos;&apos;.
  ELSE.
    SET PARAMETER ID &apos;PSP&apos; FIELD &apos;&apos;.
    SET PARAMETER ID &apos;PRO&apos; FIELD l_posid.
  ENDIF.
  CALL TRANSACTION &apos;CJ13&apos; AND SKIP FIRST SCREEN.

ENDMETHOD.</source>
 </method>
</CLAS>

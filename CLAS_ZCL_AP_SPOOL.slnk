<?xml version="1.0" encoding="utf-8"?>
<CLAS CLSNAME="ZCL_AP_SPOOL" VERSION="1" LANGU="S" DESCRIPT="Gestión de Spool" CATEGORY="00" EXPOSURE="2" STATE="1" RELEASE="0" CLSCCINCL="X" FIXPT="X" UNICODE="X" CLSBCCAT="00" DURATION_TYPE="0 " RISK_LEVEL="0 " ZSAPLINK_PLUGIN_MAJOR_VERSION="0 " ZSAPLINK_PLUGIN_MINOR_VERSION="1 " ZSAPLINK_PLUGIN_BUILD_VERSION="0 " ZSAPLINK_PLUGIN_INFO1="ZSAPLINK_CLASS is part of the main ZSAPLINK project --&gt; This plugin found there instead of ZSAPLINK_PLUGINS projects" ZSAPLINK_PLUGIN_INFO2="SAPLINK homepage: https://www.assembla.com/spaces/saplink/wiki" ZSAPLINK_PLUGIN_INFO3="Download from https://www.assembla.com/code/saplink/subversion/nodes" ZSAPLINK_PLUGIN_INFO4="and navigate to:  trunk -&gt; core -&gt; ZSAPLINK -&gt; CLAS -&gt; ZSAPLINK_CLASS.slnk">
 <localImplementation>*&quot;* local class implementation for public class
*&quot;* use this source file for the implementation part of
*&quot;* local helper classes</localImplementation>
 <localTypes>*&quot;* use this source file for any type declarations (class
*&quot;* definitions, interfaces or data types) you need for method
*&quot;* implementation or private method&apos;s signature</localTypes>
 <localMacros>*&quot;* use this source file for any macro definitions you need
*&quot;* in the implementation part of the class</localMacros>
 <typeUsage CLSNAME="ZCL_AP_SPOOL" TYPEGROUP="ABAP" VERSION="1" TPUTYPE="0" IMPLICIT="X"/>
 <forwardDeclaration>ABAP</forwardDeclaration>
 <attribute CLSNAME="ZCL_AP_SPOOL" CMPNAME="ARCHI_PARAMETERS" VERSION="1" LANGU="S" DESCRIPT="Estructura ImageLink" EXPOSURE="2" STATE="1" EDITORDER="2 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ARC_PARAMS" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_SPOOL" CMPNAME="PRINT_PARAMETERS" VERSION="1" LANGU="S" DESCRIPT="Estructura para transferir parámetros impr." EXPOSURE="2" STATE="1" EDITORDER="1 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="PRI_PARAMS" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_SPOOL" CMPNAME="TIME" VERSION="1" LANGU="S" DESCRIPT="Hora de creación de una orden SPOOL" EXPOSURE="2" STATE="1" EDITORDER="3 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="TSP01-RQCRETIME" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <method CLSNAME="ZCL_AP_SPOOL" CMPNAME="CONSTRUCTOR" VERSION="1" LANGU="S" DESCRIPT="CONSTRUCTOR" EXPOSURE="2" STATE="1" EDITORDER="1 " DISPID="0 " MTDTYPE="2" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>method CONSTRUCTOR.

  get_parameters( ).

endmethod.</source>
 </method>
 <method CLSNAME="ZCL_AP_SPOOL" CMPNAME="GET_CSV_FROM_SPOOL" VERSION="1" LANGU="S" DESCRIPT="Devuelve el contenido del spool en modo texto" EXPOSURE="2" STATE="1" EDITORDER="8 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_SPOOL" CMPNAME="GET_CSV_FROM_SPOOL" SCONAME="RQIDENT" VERSION="1" LANGU="S" DESCRIPT="SPOOL: Número de orden SPOOL" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_SPOOL" CMPNAME="GET_CSV_FROM_SPOOL" SCONAME="I_TEXTO" VERSION="1" LANGU="S" DESCRIPT="Línea de texto" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="LIST_STRING_TABLE"/>
  <source>METHOD get_csv_from_spool.
  DATA: l_rqident TYPE tsp01-rqident,
        listobject TYPE  table_abaplist.

  l_rqident = rqident.

  SUBMIT rspolist EXPORTING LIST TO MEMORY AND RETURN
                  WITH rqident = l_rqident.

  CALL FUNCTION &apos;LIST_FROM_MEMORY&apos;
    TABLES
      listobject = listobject
    EXCEPTIONS
      not_found  = 1.

  CALL FUNCTION &apos;LIST_TO_DAT&apos;
    EXPORTING
      list_index         = -1
    CHANGING
      listobject         = listobject
      listdat            = i_texto
    EXCEPTIONS
      empty_list         = 1
      list_index_invalid = 2.

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_SPOOL" CMPNAME="GET_HORA_IMPRESION" VERSION="1" LANGU="S" DESCRIPT="Recupera hora en formato impresión" EXPOSURE="2" STATE="1" EDITORDER="3 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>method GET_HORA_IMPRESION.
  DATA: l_fecha LIKE sy-datum,
        l_hora LIKE sy-uzeit.

  l_fecha = sy-datum.
  l_hora  = sy-uzeit.

  CALL FUNCTION &apos;BDL_GET_GREENWICH_TIME&apos;
    IMPORTING
      tag     = l_fecha
      uhrzeit = l_hora.

  CONCATENATE l_fecha l_hora &apos;00&apos; INTO time.

endmethod.</source>
 </method>
 <method CLSNAME="ZCL_AP_SPOOL" CMPNAME="GET_PARAMETERS" VERSION="1" LANGU="S" DESCRIPT="Recupera parámetros de usuario" EXPOSURE="2" STATE="1" EDITORDER="2 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_SPOOL" CMPNAME="GET_PARAMETERS" SCONAME="DEJAR_EN_SPOOL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <source>method GET_PARAMETERS.
  DATA: valid_flag(1) TYPE c.

  CALL FUNCTION &apos;GET_PRINT_PARAMETERS&apos;
    EXPORTING
      no_dialog              = &apos;X&apos;
    IMPORTING
      out_parameters         = print_parameters
      out_archive_parameters = archi_parameters
      valid                  = valid_flag
    EXCEPTIONS
      invalid_print_params   = 2
      OTHERS                 = 4.

  IF dejar_en_spool = &apos;X&apos;.
    print_parameters-primm = &apos;&apos;. &quot;Impresión inmediata
    print_parameters-prrel = &apos;&apos;.  &quot;Borrar tras salida
    print_parameters-prnew = &apos;X&apos;. &quot;Orden de spool nueva
    print_parameters-armod = &apos;1&apos;. &quot;Imprimir.
  ENDIF.


endmethod.</source>
 </method>
 <method CLSNAME="ZCL_AP_SPOOL" CMPNAME="GET_SPOOL_FROM_HORA" VERSION="1" LANGU="S" DESCRIPT="Devuelve el nº de spool desde la hora marcada" EXPOSURE="2" STATE="1" EDITORDER="4 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_SPOOL" CMPNAME="GET_SPOOL_FROM_HORA" SCONAME="UNAME" VERSION="1" LANGU="S" DESCRIPT="Usuario" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-UNAME" PARVALUE="SY-UNAME"/>
  <parameter CLSNAME="ZCL_AP_SPOOL" CMPNAME="GET_SPOOL_FROM_HORA" SCONAME="RQIDENT" VERSION="1" LANGU="S" DESCRIPT="SPOOL: Número de orden SPOOL" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="TSP01-RQIDENT"/>
  <source>METHOD get_spool_from_hora.

  CLEAR rqident.
  SELECT rqident FROM tsp01                             &quot;#EC CI_NOFIRST
    INTO rqident
   WHERE rqclient = sy-mandt
     AND rqowner  = uname
     AND rqcretime &gt;= time.
  ENDSELECT.

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_SPOOL" CMPNAME="GET_TXT_FROM_SPOOL" VERSION="1" LANGU="S" DESCRIPT="Devuelve el contenido del spool en modo texto" EXPOSURE="2" STATE="1" EDITORDER="5 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_SPOOL" CMPNAME="GET_TXT_FROM_SPOOL" SCONAME="RQIDENT" VERSION="1" LANGU="S" DESCRIPT="SPOOL: Número de orden SPOOL" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_SPOOL" CMPNAME="GET_TXT_FROM_SPOOL" SCONAME="I_TEXTO" VERSION="1" LANGU="S" DESCRIPT="Línea de texto" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="TTTEXT255"/>
  <source>METHOD get_txt_from_spool.
  DATA l_rqident TYPE tsp01-rqident.

  l_rqident = rqident.

  CALL FUNCTION &apos;RSPO_RETURN_ABAP_SPOOLJOB&apos;
    EXPORTING
      rqident              = l_rqident
    TABLES
      buffer               = i_texto
    EXCEPTIONS
      no_such_job          = 1
      not_abap_list        = 2
      job_contains_no_data = 3
      selection_empty      = 4
      no_permission        = 5
      can_not_access       = 6
      read_error           = 7
      OTHERS               = 8.

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_SPOOL" CMPNAME="SAVE_PDF_FROM_SPOOL" VERSION="1" LANGU="S" DESCRIPT="Graba orden de spool en PDF" EXPOSURE="2" STATE="1" EDITORDER="7 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_SPOOL" CMPNAME="SAVE_PDF_FROM_SPOOL" SCONAME="RQIDENT" VERSION="1" LANGU="S" DESCRIPT="SPOOL: Número de orden SPOOL" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TSP01-RQIDENT"/>
  <parameter CLSNAME="ZCL_AP_SPOOL" CMPNAME="SAVE_PDF_FROM_SPOOL" SCONAME="FICHERO" VERSION="1" LANGU="S" DESCRIPT="Línea de texto" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>method SAVE_PDF_FROM_SPOOL.
  DATA: l_bytecount TYPE tst01-dsize,
        i_pdf TYPE TABLE OF tline.

  CALL FUNCTION &apos;CONVERT_ABAPSPOOLJOB_2_PDF&apos;
    EXPORTING
      src_spoolid              = rqident
      no_dialog                = &apos; &apos;
      dst_device               = &apos;LOCL&apos;
    IMPORTING
      pdf_bytecount            = l_bytecount
    TABLES
      pdf                      = i_pdf
    EXCEPTIONS
      err_no_abap_spooljob     = 1
      err_no_spooljob          = 2
      err_no_permission        = 3
      err_conv_not_possible    = 4
      err_bad_destdevice       = 5
      user_cancelled           = 6
      err_spoolerror           = 7
      err_temseerror           = 8
      err_btcjob_open_failed   = 9
      err_btcjob_submit_failed = 10
      err_btcjob_close_failed  = 11
      OTHERS                   = 12.

  IF sy-subrc = 0.
    CALL FUNCTION &apos;GUI_DOWNLOAD&apos;
      EXPORTING
        bin_filesize            = l_bytecount
        filename                = fichero
        filetype                = &apos;BIN&apos;
      TABLES
        data_tab                = i_pdf
      EXCEPTIONS
        file_write_error        = 1
        no_batch                = 2
        gui_refuse_filetransfer = 3
        invalid_type            = 4
        no_authority            = 5
        unknown_error           = 6
        header_not_allowed      = 7
        separator_not_allowed   = 8
        filesize_not_allowed    = 9
        header_too_long         = 10
        dp_error_create         = 11
        dp_error_send           = 12
        dp_error_write          = 13
        unknown_dp_error        = 14
        access_denied           = 15
        dp_out_of_memory        = 16
        disk_full               = 17
        dp_timeout              = 18
        file_not_found          = 19
        dataprovider_exception  = 20
        control_flush_error     = 21
        OTHERS                  = 22.
  ENDIF.

endmethod.</source>
 </method>
 <method CLSNAME="ZCL_AP_SPOOL" CMPNAME="VER_SPOOL" VERSION="1" LANGU="S" DESCRIPT="Visualizar orden de spool" EXPOSURE="2" STATE="1" EDITORDER="6 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_SPOOL" CMPNAME="VER_SPOOL" SCONAME="RQIDENT" VERSION="1" LANGU="S" DESCRIPT="SPOOL: Número de orden SPOOL" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <source>method VER_SPOOL.
data l_spool type COM_SEARCH_TV_LAST_SPOOL.

  l_spool = rqident.
  CALL FUNCTION &apos;COM_SE_SPOOL_DISPLAY&apos;
    EXPORTING
      iv_spool_no = l_Spool.

endmethod.</source>
 </method>
</CLAS>

<?xml version="1.0" encoding="utf-8"?>
<CLAS CLSNAME="ZCL_AP_DIRECCIONES" VERSION="1" LANGU="S" DESCRIPT="Gestión Direcciones" CATEGORY="00" EXPOSURE="2" STATE="1" RELEASE="0" CLSCCINCL="X" FIXPT="X" UNICODE="X" CLSBCCAT="00" DURATION_TYPE="0 " RISK_LEVEL="0 " ZSAPLINK_PLUGIN_MAJOR_VERSION="0 " ZSAPLINK_PLUGIN_MINOR_VERSION="1 " ZSAPLINK_PLUGIN_BUILD_VERSION="0 " ZSAPLINK_PLUGIN_INFO1="ZSAPLINK_CLASS is part of the main ZSAPLINK project --&gt; This plugin found there instead of ZSAPLINK_PLUGINS projects" ZSAPLINK_PLUGIN_INFO2="SAPLINK homepage: https://www.assembla.com/spaces/saplink/wiki" ZSAPLINK_PLUGIN_INFO3="Download from https://www.assembla.com/code/saplink/subversion/nodes" ZSAPLINK_PLUGIN_INFO4="and navigate to:  trunk -&gt; core -&gt; ZSAPLINK -&gt; CLAS -&gt; ZSAPLINK_CLASS.slnk">
 <localImplementation>*&quot;* local class implementation for public class
*&quot;* use this source file for the implementation part of
*&quot;* local helper classes</localImplementation>
 <localTypes>*&quot;* use this source file for any type declarations (class
*&quot;* definitions, interfaces or data types) you need for method
*&quot;* implementation or private method&apos;s signature
TYPE-POOLS: szadr.</localTypes>
 <localMacros>*&quot;* use this source file for any macro definitions you need
*&quot;* in the implementation part of the class</localMacros>
 <textPool>
  <language SPRAS="S">
   <textElement ID="I" KEY="APT" ENTRY="Apartado" LENGTH="18 "/>
   <textElement ID="I" KEY="AUT" ENTRY="No tiene autorización a emails" LENGTH="60 "/>
   <textElement ID="I" KEY="EAE" ENTRY="Error accediendo a email" LENGTH="48 "/>
   <textElement ID="I" KEY="EIN" ENTRY="Error interno" LENGTH="23 "/>
   <textElement ID="I" KEY="EPA" ENTRY="Error en parametros" LENGTH="29 "/>
   <textElement ID="I" KEY="POB" ENTRY="Post Office Box" LENGTH="25 "/>
  </language>
 </textPool>
 <typeUsage CLSNAME="ZCL_AP_DIRECCIONES" TYPEGROUP="ABAP" VERSION="1" TPUTYPE="0" IMPLICIT="X"/>
 <typeUsage CLSNAME="ZCL_AP_DIRECCIONES" TYPEGROUP="SZADR" VERSION="1" TPUTYPE="0" IMPLICIT="X"/>
 <forwardDeclaration>ABAP</forwardDeclaration>
 <forwardDeclaration>SZADR</forwardDeclaration>
 <method CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_ADDR1_COMPLETE" VERSION="1" LANGU="S" DESCRIPT="Devuelve contenido tabla direcciones" EXPOSURE="2" STATE="1" EDITORDER="4 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_ADDR1_COMPLETE" SCONAME="ADRNR" VERSION="1" LANGU="S" DESCRIPT="Dirección" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="KNA1-ADRNR" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_ADDR1_COMPLETE" SCONAME="HANDLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_ADDR1_COMPLETE" SCONAME="ADDR1_COMPLETE" VERSION="1" LANGU="S" DESCRIPT="Indicador: Estado actual de los datos de comunicación" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="SZADR_ADDR1_COMPLETE"/>
  <source>method GET_ADDR1_COMPLETE.
  DATA: l_address_selection TYPE addr1_sel,
        l_handle type ADDR1_SEL-ADDRHANDLE.

  clear addr1_complete.

  l_address_selection-addrnumber = adrnr.
  l_handle = handle.
  CALL FUNCTION &apos;ADDR_GET_COMPLETE&apos;
    EXPORTING
      addrnumber        = l_address_selection-addrnumber
      ADDRHANDLE        = l_handle
    IMPORTING
      addr1_complete    = addr1_complete
    EXCEPTIONS
      parameter_error   = 1
      address_not_exist = 2
      internal_error    = 3
      OTHERS            = 4.


endmethod.</source>
 </method>
 <method CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION" VERSION="1" LANGU="S" DESCRIPT="Devuelve la primera dirección postal" EXPOSURE="2" STATE="1" EDITORDER="5 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION" SCONAME="ADRNR" VERSION="1" LANGU="S" DESCRIPT="Dirección" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ADRNR" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION" SCONAME="WERKS" VERSION="1" LANGU="S" DESCRIPT="Centro" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="WERKS_D" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION" SCONAME="HANDLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION" SCONAME="LGORT" VERSION="1" LANGU="S" DESCRIPT="Almacén" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="LGORT_D" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION" SCONAME="DIRECCION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="SZADR_ADDR1_LINE"/>
  <source>METHOD get_direccion.
  DATA: addr1_complete TYPE szadr_addr1_complete.
  DATA: adsmtp_line TYPE szadr_adsmtp_line,
        addr1_line  TYPE szadr_addr1_line,
        l_adrnr TYPE adrnr.
  CLEAR direccion.

  l_adrnr = adrnr.
  IF adrnr IS INITIAL.
    IF NOT lgort IS INITIAL.
      SELECT SINGLE adrnr FROM twlad
        INTO l_adrnr
       WHERE werks = werks
         AND lgort = lgort.
    ELSEIF NOT werks IS INITIAL.
      SELECT SINGLE adrnr FROM t001w
        INTO l_adrnr
       WHERE werks = werks.
    ENDIF.
  ENDIF.

  CHECK NOT l_adrnr IS INITIAL OR NOT handle IS INITIAL.

  addr1_complete = get_addr1_complete( adrnr = l_adrnr handle = handle ).

  IF sy-subrc = 0.
    READ TABLE addr1_complete-addr1_tab INDEX 1 INTO addr1_line.
    IF sy-subrc = 0.
      direccion = addr1_line.
    ENDIF.
  ENDIF.

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION2" VERSION="1" LANGU="S" DESCRIPT="Devuelve la primera dirección postal" EXPOSURE="2" STATE="1" EDITORDER="8 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION2" SCONAME="ADRNR" VERSION="1" LANGU="S" DESCRIPT="Dirección" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ADRNR" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION2" SCONAME="WERKS" VERSION="1" LANGU="S" DESCRIPT="Centro" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="WERKS_D" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION2" SCONAME="HANDLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION2" SCONAME="LGORT" VERSION="1" LANGU="S" DESCRIPT="Almacén" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="LGORT_D" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION2" SCONAME="DIRECCION" VERSION="1" LANGU="S" DESCRIPT="Estructura de transferencia para dirección" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="ADDR1_DATA"/>
  <source>METHOD get_direccion2.
  DATA: addr1_line  TYPE szadr_addr1_line.

  addr1_line = zcl_ap_direcciones=&gt;get_direccion( adrnr     = adrnr
                                                  werks     = werks
                                                  handle    = handle
                                                  lgort     = lgort
                                                ).

  direccion = addr1_line-data.

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRING" VERSION="1" LANGU="S" DESCRIPT="Devuelve la dirección simple en un string" EXPOSURE="2" STATE="1" EDITORDER="7 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRING" SCONAME="ADDRESS_TYPE" VERSION="1" LANGU="S" DESCRIPT="Tipo direcc.(1=organiz., 2=persona, 3=persona contacto)" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SZAD_FIELD-ADDR_TYPE" PARVALUE="&apos;1&apos;"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRING" SCONAME="ADRNR" VERSION="1" LANGU="S" DESCRIPT="Nº dirección" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ADRC-ADDRNUMBER" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRING" SCONAME="DIRECCION" VERSION="1" LANGU="S" DESCRIPT="Forma abreviada en una línea de la dirección editada" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="SZAD_FIELD-ADDR_SHORT"/>
  <source>method GET_DIRECCION_STRING.

  CALL FUNCTION &apos;ADDRESS_INTO_PRINTFORM&apos;
    EXPORTING
*   ADRSWA_IN                            =
*   ADDRESS_1                            =
*   ADDRESS_2                            =
*   ADDRESS_3                            =
      ADDRESS_TYPE                         = address_type
      ADDRESS_NUMBER                       = adrnr
*   ADDRESS_HANDLE                       = &apos; &apos;
*   PERSON_NUMBER                        = &apos; &apos;
*   PERSON_HANDLE                        = &apos; &apos;
*   SENDER_COUNTRY                       = &apos; &apos;
*   RECEIVER_LANGUAGE                    = &apos; &apos;
*   NUMBER_OF_LINES                      = 10
*   STREET_HAS_PRIORITY                  = &apos; &apos;
*   LINE_PRIORITY                        = &apos; &apos;
*   COUNTRY_NAME_IN_RECEIVER_LANGU       = &apos; &apos;
*   LANGUAGE_FOR_COUNTRY_NAME            = &apos; &apos;
*   NO_UPPER_CASE_FOR_CITY               = &apos; &apos;
*   IV_NATION                            = &apos; &apos;
*   IV_NATION_SPACE                      = &apos; &apos;
*   IV_PERSON_ABOVE_ORGANIZATION         = &apos; &apos;
*   IS_BUPA_TIME_DEPENDENCY              = &apos; &apos;
*   IV_LANGU_CREA                        = &apos; &apos;
   IMPORTING
*   ADRSWA_OUT                           =
*   ADDRESS_PRINTFORM                    =
*   ADDRESS_SHORT_FORM                   =
*   ADDRESS_SHORT_FORM_S                 =
*   ADDRESS_DATA_CARRIER                 =
*   ADDRESS_DATA_CARRIER_0               =
*   NUMBER_OF_USED_LINES                 =
*   NAME_IS_EMPTY                        =
*   ADDRESS_NOT_FOUND                    =
*   ADDRESS_PRINTFORM_TABLE              =
      ADDRESS_SHORT_FORM_WO_NAME           = direccion
*   EV_NATION                            =
            .

endmethod.</source>
 </method>
 <method CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRINGF" VERSION="1" LANGU="S" DESCRIPT="Devuelve la primera dirección postal" EXPOSURE="2" STATE="1" EDITORDER="10 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRINGF" SCONAME="ADRNR" VERSION="1" LANGU="S" DESCRIPT="Dirección" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ADRNR" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRINGF" SCONAME="WERKS" VERSION="1" LANGU="S" DESCRIPT="Centro" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="WERKS_D" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRINGF" SCONAME="HANDLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRINGF" SCONAME="LGORT" VERSION="1" LANGU="S" DESCRIPT="Almacén" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="LGORT_D" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRINGF" SCONAME="SPRAS" VERSION="1" LANGU="S" DESCRIPT="Clave de idioma del entorno de texto actual" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-LANGU" PARVALUE="SY-LANGU"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRINGF" SCONAME="MOSTRAR_PAIS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRINGF" SCONAME="MOSTRAR_CP" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRINGF" SCONAME="NIF" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRINGF" SCONAME="TITULO_NIF" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;NIF&apos;"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRINGF" SCONAME="NIF_TRAS_NOMBRE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRINGF" SCONAME="CODIGO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRINGF" SCONAME="TITULO_CODIGO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="12 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRINGF" SCONAME="FORMATO_NOMBRE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="13 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_DIRECCION_STRINGF" SCONAME="STRING" VERSION="1" LANGU="S" DESCRIPT="Estructura de transferencia para dirección" CMPTYPE="1" MTDTYPE="0" EDITORDER="14 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD get_direccion_stringf.
  DATA: addr1_line TYPE szadr_addr1_line,
        l_string   TYPE string,
        l_string2  TYPE string,
        l_string3  TYPE string,
        l_string4  TYPE string,
        l_string5  TYPE string,
        aux2(2).


  addr1_line = zcl_ap_direcciones=&gt;get_direccion( adrnr     = adrnr
                                                  werks     = werks
                                                  handle    = handle
                                                  lgort     = lgort
                                                ).

  IF NOT addr1_line-data IS INITIAL.
    IF formato_nombre NE &apos;SIN_NOMBRE&apos;.
      CONCATENATE addr1_line-data-name1 addr1_line-data-name2 INTO string SEPARATED BY space.

      IF NOT formato_nombre IS INITIAL.
        CONCATENATE &apos;&lt;&apos; formato_nombre &apos;&gt;&apos; string &apos;&lt;/&apos; formato_nombre &apos;&gt;&apos; INTO string.
      ENDIF.
    ENDIF.

    IF nif_tras_nombre = &apos;X&apos; AND nif NE &apos;&apos;.
      CONCATENATE titulo_nif nif INTO l_string SEPARATED BY space.
      CONCATENATE string cl_abap_char_utilities=&gt;cr_lf l_string INTO string.
    ENDIF.

    IF NOT addr1_line-data-street IS INITIAL.
      CONCATENATE string cl_abap_char_utilities=&gt;cr_lf addr1_line-data-street ` ` addr1_line-data-house_num1 INTO string.
    ENDIF.
    IF mostrar_cp = &apos;X&apos;.
      IF NOT addr1_line-data-po_box IS INITIAL OR NOT addr1_line-data-post_code2 IS INITIAL.
        CASE spras.
          WHEN &apos;S&apos;.
            l_string = &apos;Apartado&apos;(apt).
          WHEN &apos;E&apos;.
            l_string = &apos;Post Office Box&apos;(pob).
        ENDCASE.
        CONCATENATE l_string addr1_line-data-po_box addr1_line-data-post_code2 addr1_line-data-pcode2_ext INTO l_string SEPARATED BY space.
        CONCATENATE string cl_abap_char_utilities=&gt;cr_lf l_string INTO string.
      ENDIF.
    ENDIF.
    IF NOT addr1_line-data-post_code1 IS INITIAL OR NOT addr1_line-data-city1 IS INITIAL OR NOT addr1_line-data-region IS INITIAL.
      IF addr1_line-data-post_code1 IS INITIAL.
        l_string = addr1_line-data-city1.
      ELSE.
        CONCATENATE addr1_line-data-post_code1 addr1_line-data-city1 INTO l_string SEPARATED BY space.
      ENDIF.
      IF NOT addr1_line-data-region IS INITIAL AND NOT addr1_line-data-country IS INITIAL.
        l_string2 = get_nombre_provincia( land1 = addr1_line-data-country regio = addr1_line-data-region ).
        l_string4 = l_string2.
        TRANSLATE l_string4 TO UPPER CASE.
        zcl_ap_string=&gt;quitar_caracteres_extranos( CHANGING string = l_string4 ).

        l_string5 = addr1_line-data-city1.
        TRANSLATE l_string5 TO UPPER CASE.
        zcl_ap_string=&gt;quitar_caracteres_extranos( CHANGING string = l_string5 ).
        IF l_string4 NE l_string5.
          CONCATENATE &apos;(&apos; l_string2 &apos;)&apos; INTO l_string2.
          IF NOT l_string CS l_string2.
            l_string3 = l_string2.
            TRANSLATE l_string3 TO UPPER CASE.
            IF NOT l_string CS l_string3.
              CONCATENATE l_string l_string2 INTO l_string SEPARATED BY space.
            ENDIF.
          ENDIF.
        ENDIF.
      ENDIF.
      CONCATENATE string cl_abap_char_utilities=&gt;cr_lf l_string INTO string.
    ENDIF.
    IF NOT addr1_line-data-country IS INITIAL AND mostrar_pais NE &apos;&apos;.
      l_string = get_nombre_pais( addr1_line-data-country ).
      IF mostrar_pais = &apos;M&apos;.
        TRANSLATE l_string TO UPPER CASE.
      ENDIF.
      CONCATENATE string cl_abap_char_utilities=&gt;cr_lf l_string INTO string.
    ENDIF.
  ENDIF.

  IF nif_tras_nombre = &apos;&apos; AND nif NE &apos;&apos;.
    CONCATENATE titulo_nif nif INTO l_string SEPARATED BY space.
    CONCATENATE string cl_abap_char_utilities=&gt;cr_lf l_string INTO string.
  ENDIF.


  IF codigo NE &apos;&apos;.
    __concat2 l_string titulo_codigo codigo.
    CONCATENATE string cl_abap_char_utilities=&gt;cr_lf l_string INTO string.
  ENDIF.

  aux2 = string.
  IF aux2 = cl_abap_char_utilities=&gt;cr_lf.
    string = string+2.
  ENDIF.


ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_EMAIL" VERSION="1" LANGU="S" DESCRIPT="Devuelve el email de una dirección" EXPOSURE="2" STATE="1" EDITORDER="1 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_EMAIL" SCONAME="ADRNR" VERSION="1" LANGU="S" DESCRIPT="Dirección" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ADRNR"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_EMAIL" SCONAME="REMARK" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_EMAIL" SCONAME="LISTA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_EMAIL" SCONAME="EMAIL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD get_email.
  DATA: emails  TYPE isu_adsmtp_tab,
        l_email TYPE adsmtp.

  CLEAR email.

  emails = get_emails( adrnr = adrnr remark = remark ).

  IF lista IS INITIAL.
    READ TABLE emails INTO l_email WITH KEY flgdefault = &apos;X&apos;.
    IF sy-subrc = 0.
      email = l_email-smtp_addr.
    ELSE.
      READ TABLE emails INTO l_email index 1.
      IF sy-subrc = 0.
        email = l_email-smtp_addr.
      ENDIF.
    ENDIF.
  ELSE.
    LOOP AT emails INTO l_email.
      __add_lista email l_email-smtp_addr.
    ENDLOOP.
  ENDIF.


ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_EMAILS" VERSION="1" LANGU="S" DESCRIPT="Devuelve el email de una dirección" EXPOSURE="2" STATE="1" EDITORDER="3 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_EMAILS" SCONAME="ADRNR" VERSION="1" LANGU="S" DESCRIPT="Dirección" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="KNA1-ADRNR"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_EMAILS" SCONAME="REMARK" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_EMAILS" SCONAME="EMAILS" VERSION="1" LANGU="S" DESCRIPT="Tabla estándar para la estructura ADSMTP" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="ISU_ADSMTP_TAB"/>
  <source>METHOD get_emails.
  DATA: addr1_complete TYPE szadr_addr1_complete.
  DATA: adsmtp_line TYPE szadr_adsmtp_line,
        addr1_line  TYPE szadr_addr1_line.

  CLEAR emails.

  addr1_complete = get_addr1_complete( adrnr ).

  IF sy-subrc = 0.
    LOOP AT addr1_complete-addr1_tab INTO addr1_line.
      LOOP AT addr1_complete-adsmtp_tab INTO adsmtp_line.
        IF remark IS INITIAL OR remark = adsmtp_line-adsmtp-remark.
          APPEND adsmtp_line-adsmtp TO emails.
        ENDIF.
      ENDLOOP.
    ENDLOOP.
  ENDIF.

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_NOMBRE_PAIS" VERSION="1" LANGU="S" DESCRIPT="Devuelve el nombre del país" EXPOSURE="2" STATE="1" EDITORDER="9 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_NOMBRE_PAIS" SCONAME="LAND1" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_NOMBRE_PAIS" SCONAME="SPRAS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-LANGU"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_NOMBRE_PAIS" SCONAME="LANDX" VERSION="1" LANGU="S" DESCRIPT="Denominación del país" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="T005T-LANDX"/>
  <source>method GET_NOMBRE_PAIS.

  SELECT single landx FROM  t005t
    into landx
   WHERE spras  = spras
     AND land1  = land1.

endmethod.</source>
 </method>
 <method CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_NOMBRE_PROVINCIA" VERSION="1" LANGU="S" DESCRIPT="Devuelve el nombre del país" EXPOSURE="2" STATE="1" EDITORDER="11 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_NOMBRE_PROVINCIA" SCONAME="LAND1" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_NOMBRE_PROVINCIA" SCONAME="REGIO" VERSION="1" LANGU="S" DESCRIPT='Región (Estado federal, &quot;land&quot;, provincia, condado)' CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_NOMBRE_PROVINCIA" SCONAME="SPRAS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="SY-LANGU"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="GET_NOMBRE_PROVINCIA" SCONAME="BEZEI" VERSION="1" LANGU="S" DESCRIPT="Denominación del país" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="T005U-BEZEI"/>
  <source>METHOD get_nombre_provincia.

  SELECT SINGLE bezei FROM  t005u
    INTO bezei
   WHERE spras  = spras
     AND land1  = land1
     AND bland  = regio.

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="POPUP_EMAILS" VERSION="1" LANGU="S" DESCRIPT="Popup email" EXPOSURE="2" STATE="1" EDITORDER="12 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="POPUP_EMAILS" SCONAME="ADRNR" VERSION="1" LANGU="S" DESCRIPT="Dirección" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ADRNR"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="POPUP_EMAILS" SCONAME="OPERACION" VERSION="1" LANGU="S" DESCRIPT="MAINTAIN/DISPLAY" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;MAINTAIN&apos;"/>
  <source>METHOD popup_emails.
    DATA: iv_timestamp     TYPE  ad_srctime,
          data_has_changed,
          dialog_mode      TYPE szad_field-maint_mode.

    dialog_mode = operacion.
    CONCATENATE sy-datum sy-uzeit INTO iv_timestamp.
    CALL FUNCTION &apos;ADDR_COMM_DIALOG_INTERNET&apos;
      EXPORTING
        address_number              = adrnr
        address_handle              = &apos;&apos;
        dialog_mode                 = dialog_mode
        address_object_type         = &apos;1&apos;
        iv_time_dependent_comm_data = &apos;&apos;
        iv_valid_from               = &apos;&apos;
        iv_valid_to                 = &apos;&apos;
        iv_timestamp                = iv_timestamp
        iv_suggested_valid_from     = &apos;&apos;
        iv_suggested_valid_to       = &apos;&apos;
      IMPORTING
        data_has_changed            = data_has_changed
      EXCEPTIONS
        parameter_error             = 01
        no_authority                = 02
        internal_error              = 03.
    IF sy-subrc NE 0.
      CASE sy-subrc.
        WHEN 1.
          MESSAGE &apos;Error en parametros&apos;(epa) TYPE &apos;E&apos;.
        WHEN 2.
          MESSAGE &apos;No tiene autorización a emails&apos;(aut) TYPE &apos;E&apos;.
        WHEN 3.
          MESSAGE &apos;Error interno&apos;(ein) TYPE &apos;E&apos;.
        WHEN 4.
          MESSAGE &apos;Error accediendo a email&apos;(eae) TYPE &apos;E&apos;.
      ENDCASE.
    ELSE.
      IF data_has_changed = &apos;X&apos;.
        CALL FUNCTION &apos;ADDR_MEMORY_SAVE&apos;
          EXPORTING
            execute_in_update_task = &apos;&apos;
          EXCEPTIONS
            address_number_missing = 1
            person_number_missing  = 2
            internal_error         = 3
            database_error         = 4
            reference_missing      = 5
            OTHERS                 = 6.
      ENDIF.
    ENDIF.

  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="SET_DIRECCION" VERSION="1" LANGU="S" DESCRIPT="Graba datos de direccion" EXPOSURE="2" STATE="1" EDITORDER="6 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="SET_DIRECCION" SCONAME="ADRNR" VERSION="1" LANGU="S" DESCRIPT="Dirección" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="KNA1-ADRNR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="SET_DIRECCION" SCONAME="DIRECCION" VERSION="1" LANGU="S" DESCRIPT="email" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ADDR1_DATA"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="SET_DIRECCION" SCONAME="HANDLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="SET_DIRECCION" SCONAME="COMMIT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="SET_DIRECCION" SCONAME="DATA_CHANGED" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="SET_DIRECCION" SCONAME="I_ERRORES" VERSION="1" LANGU="S" DESCRIPT="Tabla de errores" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="ADERRORTAB" PAROPTIONL="X"/>
  <source>method SET_DIRECCION.
  DATA: addr1_complete TYPE szadr_addr1_complete.
  DATA: addr1_line  TYPE szadr_addr1_line,
        l_adrnr TYPE adrnr,
        l_handle TYPE szad_field-handle.

  CHECK NOT adrnr IS INITIAL OR NOT handle IS INITIAL.

  l_handle = handle.
  CALL FUNCTION &apos;ADDR_UPDATE&apos;
       EXPORTING
            address_data        = direccion
            address_handle      = l_handle
            address_number      = adrnr
*         DATE_FROM           = &apos;00010101&apos;
*         LANGUAGE            = SY-LANGU
*          nation              = land1
*         CHECK_EMPTY_ADDRESS = &apos;X&apos;
*         CHECK_ADDRESS       = &apos;X&apos;
    IMPORTING
*         ADDRESS_DATA        =
*          returncode          =
          data_has_changed    = data_changed
    TABLES
         error_table         = i_errores
      EXCEPTIONS
           address_not_exist   = 1
           parameter_error     = 2
           version_not_exist   = 3
           internal_error      = 4
           OTHERS              = 5.


  IF data_changed = &apos;X&apos;.
    IF commit = &apos;X&apos;.
      READ TABLE i_errores TRANSPORTING NO FIELDS WITH KEY msg_type = &apos;E&apos;.
      IF sy-subrc NE 0.
        CALL FUNCTION &apos;ADDR_MEMORY_SAVE&apos;
*    EXPORTING
*         EXECUTE_IN_UPDATE_TASK = &apos; &apos;
            EXCEPTIONS
                 address_number_missing = 1
                 person_number_missing  = 2
                 internal_error         = 3
                 database_error         = 4
                 reference_missing      = 5
                 OTHERS                 = 6.
      ENDIF.
    ENDIF.
  ENDIF.

endmethod.</source>
 </method>
 <method CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="SET_EMAIL" VERSION="1" LANGU="S" DESCRIPT="Graba el email de una dirección" EXPOSURE="2" STATE="1" EDITORDER="2 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="SET_EMAIL" SCONAME="ADRNR" VERSION="1" LANGU="S" DESCRIPT="Dirección" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="KNA1-ADRNR"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="SET_EMAIL" SCONAME="EMAIL" VERSION="1" LANGU="S" DESCRIPT="email" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="SET_EMAIL" SCONAME="REMARK" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;#?#&apos;"/>
  <parameter CLSNAME="ZCL_AP_DIRECCIONES" CMPNAME="SET_EMAIL" SCONAME="MOD_EMAIL_SI_EXISTE_OTRO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <source>METHOD set_email.
  DATA: addr1_complete TYPE szadr_addr1_complete.
  DATA: adsmtp_line TYPE szadr_adsmtp_line,
        addr1_line  TYPE szadr_addr1_line.

  addr1_complete = get_addr1_complete( adrnr ).

**** EMAIL
  DATA: xadsmtp  TYPE TABLE OF adsmtp,
        l_adsmtp TYPE adsmtp.

  REFRESH xadsmtp.
  LOOP AT addr1_complete-adsmtp_tab INTO adsmtp_line.
    l_adsmtp = adsmtp_line-adsmtp.
    APPEND l_adsmtp TO xadsmtp.
  ENDLOOP.

  READ TABLE xadsmtp INTO l_adsmtp INDEX 1.
  IF sy-subrc NE 0.
    l_adsmtp-smtp_addr = email.
    l_adsmtp-flgdefault = &apos;X&apos;.
    l_adsmtp-updateflag = &apos;I&apos;.
    IF remark NE &apos;#?#&apos;.
      l_adsmtp-remark = remark.
    ENDIF.
    APPEND l_adsmtp TO xadsmtp.
  ELSE.
    READ TABLE xadsmtp INTO l_adsmtp WITH KEY smtp_addr = email.
    IF sy-subrc = 0.
      IF remark NE &apos;#?#&apos;.
        l_adsmtp-remark = remark.
      ENDIF.
      l_adsmtp-updateflag = &apos;U&apos;.
      MODIFY xadsmtp FROM l_adsmtp INDEX 1.
    ELSE.
      IF mod_email_si_existe_otro IS INITIAL.
        CLEAR l_adsmtp.
        l_adsmtp-smtp_addr = email.
        l_adsmtp-updateflag = &apos;I&apos;.
        IF remark NE &apos;#?#&apos;.
          l_adsmtp-remark = remark.
        ENDIF.
        APPEND l_adsmtp TO xadsmtp.
      ELSE.
        l_adsmtp-smtp_addr = email.
        IF remark NE &apos;#?#&apos;.
          l_adsmtp-remark = remark.
        ENDIF.
        l_adsmtp-updateflag = &apos;U&apos;.
        MODIFY xadsmtp FROM l_adsmtp INDEX 1.
      ENDIF.
    ENDIF.
  ENDIF.

  CALL FUNCTION &apos;ADDR_COMM_MAINTAIN&apos;
    EXPORTING
      address_handle           = addr1_complete-addrhandle
      address_number           = addr1_complete-addrnumber
      table_type               = &apos;ADSMTP&apos;
      substitute_all_comm_data = &apos;X&apos;
    TABLES
      comm_table               = xadsmtp
    EXCEPTIONS
      parameter_error          = 1
      address_not_exist        = 2
      internal_error           = 3
      OTHERS                   = 4.

  IF sy-subrc = 0.
    CALL FUNCTION &apos;ADDR_MEMORY_SAVE&apos;
*    EXPORTING
*         EXECUTE_IN_UPDATE_TASK = &apos; &apos;
      EXCEPTIONS
        address_number_missing = 1
        person_number_missing  = 2
        internal_error         = 3
        database_error         = 4
        reference_missing      = 5
        OTHERS                 = 6.

  ENDIF.


ENDMETHOD.</source>
 </method>
</CLAS>

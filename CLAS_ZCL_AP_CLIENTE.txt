CLASS zcl_ap_cliente DEFINITION
  PUBLIC
  CREATE PUBLIC.

  PUBLIC SECTION.
    CLASS-METHODS urls_gos_st
      IMPORTING kunnr        TYPE kunnr
      RETURNING VALUE(tabla) TYPE ztab_url_gos.

    CLASS-METHODS insertar_url_gos_st
      IMPORTING kunnr  TYPE kunnr
                url    TYPE string
                titulo TYPE string.

    CLASS-METHODS visualizar_cliente_st
      IMPORTING kunnr TYPE kunnr.

    CLASS-METHODS get_url_por_titulo_st
      IMPORTING kunnr      TYPE kunnr
                titulo     TYPE string
      RETURNING VALUE(url) TYPE string.

    CLASS-METHODS get_emails
      IMPORTING kunnr         TYPE kunnr
                remark        TYPE any DEFAULT ''
      RETURNING VALUE(emails) TYPE isu_adsmtp_tab.

    CLASS-METHODS get_email
      IMPORTING kunnr        TYPE kunnr
                lista        TYPE abap_bool DEFAULT ''
                remark       TYPE any       DEFAULT ''
                flgdefault   TYPE abap_bool DEFAULT ''
      RETURNING VALUE(email) TYPE ad_smtpadr.

    CLASS-METHODS get_nombre
      IMPORTING kunnr        TYPE kunnr
      RETURNING VALUE(name1) TYPE name1.

    CLASS-METHODS get_direccion
      IMPORTING kunnr            TYPE kunnr OPTIONAL
                adrnr            TYPE adrnr OPTIONAL
      RETURNING VALUE(direccion) TYPE addr1_data.

    METHODS get_kna1
      IMPORTING kunnr       TYPE kunnr
      RETURNING VALUE(kna1) TYPE kna1.

    METHODS get_nombre_kna1
      IMPORTING kunnr        TYPE kunnr
      RETURNING VALUE(name1) TYPE kna1-name1.

    CLASS-METHODS get_emails_lista
      IMPORTING kunnr        TYPE kunnr
                remark       TYPE any DEFAULT ''
      RETURNING VALUE(email) TYPE string.

    CLASS-METHODS get_texto_string
      IMPORTING kunnr         TYPE kunnr
                !id           TYPE stxh-tdid
                spras         TYPE spras DEFAULT sy-langu
      RETURNING VALUE(string) TYPE string.

    CLASS-METHODS set_texto_string
      IMPORTING
        !kunnr  TYPE kunnr
        !id     TYPE stxh-tdid
        !spras  TYPE spras DEFAULT ''
        !string TYPE string .


  PROTECTED SECTION.

  PRIVATE SECTION.
    DATA i_kna1 TYPE cif_kna1_tab.
endclass. "ZCL_AP_CLIENTE definition
class ZCL_AP_CLIENTE implementation.
  METHOD get_direccion.
    DATA l_adrnr TYPE adrnr.

    IF adrnr IS INITIAL.
      SELECT SINGLE adrnr FROM kna1
        INTO l_adrnr
       WHERE kunnr = kunnr.
    ELSE.
      l_adrnr = adrnr.
    ENDIF.

    direccion = zcl_ap_direcciones=>get_direccion2( l_adrnr ).
  ENDMETHOD.
  METHOD get_email.
    DATA l_adrnr TYPE lfa1-adrnr.

    SELECT SINGLE adrnr FROM kna1
      INTO l_adrnr
     WHERE kunnr = kunnr.
    IF sy-subrc = 0.
      IF flgdefault = 'X' AND remark IS INITIAL AND lista IS INITIAL.
        email = zcl_ap_direcciones=>get_email( adrnr = l_adrnr ).
      ELSE.
        email = zcl_ap_direcciones=>get_email( adrnr = l_adrnr remark = remark lista = lista ).
      ENDIF.
    ENDIF.
  ENDMETHOD.
  METHOD get_emails.
    DATA l_adrnr TYPE lfa1-adrnr.

    SELECT SINGLE adrnr FROM kna1
      INTO l_adrnr
     WHERE kunnr = kunnr.
    IF sy-subrc = 0.
      emails = zcl_ap_direcciones=>get_emails( adrnr = l_adrnr remark = remark ).
    ENDIF.
  ENDMETHOD.
  METHOD get_emails_lista.
    DATA: i_emails TYPE isu_adsmtp_tab,
          l_email  TYPE adsmtp.

    CLEAR email.
    i_emails = get_emails( kunnr = kunnr remark = remark ).

    LOOP AT i_emails INTO l_email.
      IF email IS INITIAL.
        email = l_email-smtp_addr.
      ELSE.
        CONCATENATE email ',' l_email-smtp_addr INTO email.
      ENDIF.
    ENDLOOP.
  ENDMETHOD.
  METHOD get_kna1.
    CLEAR kna1.

    READ TABLE i_kna1 INTO kna1 WITH KEY kunnr = kunnr BINARY SEARCH.
    IF sy-subrc <> 0.
      SELECT SINGLE * FROM kna1
        INTO kna1
       WHERE kunnr = kunnr.
      IF sy-subrc = 0.
        APPEND kna1 TO i_kna1.
        SORT i_kna1.
      ENDIF.
    ENDIF.
  ENDMETHOD.
  METHOD get_nombre.
    CLEAR name1.
    SELECT SINGLE name1 FROM kna1
      INTO name1
     WHERE kunnr = kunnr.
  ENDMETHOD.
  METHOD get_nombre_kna1.
    DATA kna1 TYPE kna1.

    kna1 = get_kna1( kunnr ).
    name1 = kna1-name1.
  ENDMETHOD.
  METHOD get_texto_string.
    string = zcl_ap_textos=>get_texto_string( id = id object = 'KNA1' name = kunnr spras = spras ).
  ENDMETHOD.
  METHOD get_url_por_titulo_st.
    DATA l_clave TYPE srgbtbrel-instid_a.

    l_clave = kunnr.
    url = zcl_ap_gos=>get_url_por_titulo_st( tipo   = 'KNA1'
                                          clave  = l_clave
                                          titulo = titulo ).
  ENDMETHOD.
  METHOD insertar_url_gos_st.
    DATA l_clave TYPE srgbtbrel-instid_a.

    l_clave = kunnr.
    zcl_ap_gos=>insertar_url_gos_st( tipo   = 'KNA1'
                                  clave  = l_clave
                                  titulo = titulo
                                  url    = url ).
  ENDMETHOD.
  METHOD set_texto_string.

    zcl_ap_textos=>save_texto_string( id = id object = 'KNA1' name = kunnr spras = spras string = string ).

  ENDMETHOD.
  METHOD urls_gos_st.
    DATA l_clave TYPE srgbtbrel-instid_a.

    l_clave = kunnr.
    tabla = zcl_ap_gos=>urls_gos_st( tipo = 'KNA1' clave = l_clave ).
  ENDMETHOD.
  METHOD visualizar_cliente_st.
    SET PARAMETER ID 'KUN' FIELD kunnr.
    CALL TRANSACTION 'XD03' AND SKIP FIRST SCREEN.
  ENDMETHOD.

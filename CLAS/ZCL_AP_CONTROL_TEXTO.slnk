<?xml version="1.0" encoding="utf-8"?>
<CLAS CLSNAME="ZCL_AP_CONTROL_TEXTO" VERSION="1" LANGU="S" DESCRIPT="Control de texto" CATEGORY="00" EXPOSURE="2" STATE="1" RELEASE="0" CLSFINAL="X" CLSCCINCL="X" FIXPT="X" UNICODE="X" CLSBCCAT="00" DURATION_TYPE="0 " RISK_LEVEL="0 ">
 <localImplementation>*&quot;* use this source file for the definition and implementation of
*&quot;* local helper classes, interface definitions and type
*&quot;* declarations</localImplementation>
 <localTypes>*&quot;* use this source file for any type declarations (class
*&quot;* definitions, interfaces or data types) you need for method
*&quot;* implementation or private method&apos;s signature

types: begin of control_tab,
         ctrl_name type SCRFNAME,
         parent    type i,
         ctrl      type ref  TO c_textedit_control,
         editor_container TYPE REF TO cl_gui_custom_container,
         ctrl_new  type ref to cl_gui_textedit,
      end of control_tab,
      t_control_tab type table of control_tab.</localTypes>
 <localMacros>*&quot;* use this source file for any macro definitions you need
*&quot;* in the implementation part of the class</localMacros>
 <typeUsage CLSNAME="ZCL_AP_CONTROL_TEXTO" TYPEGROUP="ABAP" VERSION="1" TPUTYPE="0" IMPLICIT="X"/>
 <forwardDeclaration>ABAP</forwardDeclaration>
 <attribute CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="CONTROLNAME" VERSION="1" LANGU="S" DESCRIPT="Name of a Screen Element" EXPOSURE="0" STATE="1" EDITORDER="1 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="SCRFNAME" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="CONTROL_TAB" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="4 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="CONTROL_TAB" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="I_CONTROL_TAB" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="2 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="T_CONTROL_TAB" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="MOSTRADO" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="3 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ABAP_BOOL" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="READ_ONLY" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="5 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ABAP_BOOL" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <method CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="CONSTRUCTOR" VERSION="1" LANGU="S" DESCRIPT="CONSTRUCTOR" EXPOSURE="2" STATE="1" EDITORDER="1 " DISPID="0 " MTDTYPE="2" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="CONSTRUCTOR" SCONAME="CONTROLNAME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SCRFNAME"/>
  <source>method CONSTRUCTOR.

  me-&gt;controlname = controlname.

endmethod.</source>
 </method>
 <method CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="DESTROY" VERSION="1" LANGU="S" DESCRIPT="Destruye editor" EXPOSURE="2" STATE="1" EDITORDER="4 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD destroy.
  DATA: local_parent  TYPE i,
        l_control_tab TYPE control_tab,
        l_tabix       TYPE i.


* Get actual parent window

  CALL FUNCTION &apos;GUI_GET_PARENT_DYNPRO&apos;
    IMPORTING
      parent = local_parent
    EXCEPTIONS
      OTHERS = 0.
* ist control schon da? Wenn nicht, dann erzeugen!
* Problem: andere REPID/DYNNR, dann relink?
  READ TABLE i_control_tab INTO l_control_tab WITH KEY ctrl_name = controlname
                                                       parent    = local_parent.
  IF sy-subrc NE 0.
    READ TABLE i_control_tab INTO l_control_tab
                           WITH KEY ctrl_name = controlname.
  ENDIF.

  IF NOT l_control_tab IS INITIAL.
    l_tabix = sy-tabix.

    CALL METHOD l_control_tab-ctrl_new-&gt;free
      EXCEPTIONS
        OTHERS = 1.

    CALL METHOD l_control_tab-editor_container-&gt;free
      EXCEPTIONS
        OTHERS = 1.

    DELETE i_control_tab INDEX l_tabix.

    CALL METHOD cl_gui_cfw=&gt;flush
      EXCEPTIONS
        OTHERS = 1.

    CLEAR mostrado.
  ENDIF.

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="ES_EDITABLE" VERSION="1" LANGU="S" DESCRIPT="Recupera estado editable del control" EXPOSURE="2" STATE="1" EDITORDER="7 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="ES_EDITABLE" SCONAME="EDIT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="ABAP_BOOL"/>
  <exception CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="ES_EDITABLE" SCONAME="INTERNAL_ERROR" VERSION="1" LANGU="S" MTDTYPE="0" EDITORDER="1 "/>
  <source>METHOD ES_EDITABLE.

  IF read_only IS INITIAL.
    edit = &apos;X&apos;.
  ELSE.
    CLEAR edit.
  ENDIF.

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="GET_CONTROL_TAB" VERSION="1" LANGU="S" DESCRIPT="Selecciona el control del texto" EXPOSURE="2" STATE="1" EDITORDER="6 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="GET_CONTROL_TAB" SCONAME="COL_WIDTH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="0"/>
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="GET_CONTROL_TAB" SCONAME="LINES" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE"/>
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="GET_CONTROL_TAB" SCONAME="CHANGED" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="C"/>
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="GET_CONTROL_TAB" SCONAME="STRING" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <exception CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="GET_CONTROL_TAB" SCONAME="INTERNAL_ERROR" VERSION="1" LANGU="S" MTDTYPE="0" EDITORDER="1 "/>
  <source>METHOD get_control_tab.
  DATA: local_parent TYPE i.

* Get actual parent window

  CALL FUNCTION &apos;GUI_GET_PARENT_DYNPRO&apos;
    IMPORTING
      parent = local_parent
    EXCEPTIONS
      OTHERS = 0.
* ist control schon da? Wenn nicht, dann erzeugen!
* Problem: andere REPID/DYNNR, dann relink?
  CLEAR control_tab.
  READ TABLE i_control_tab INTO control_tab
                         WITH KEY ctrl_name = controlname
                                  parent    = local_parent.
  IF sy-subrc NE 0.
    READ TABLE i_control_tab INTO control_tab
                           WITH KEY ctrl_name = controlname.
  ENDIF.

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="GET_EDITOR" VERSION="1" LANGU="S" DESCRIPT="Get datos" EXPOSURE="2" STATE="1" EDITORDER="3 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="GET_EDITOR" SCONAME="COL_WIDTH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="0"/>
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="GET_EDITOR" SCONAME="LINES" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE"/>
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="GET_EDITOR" SCONAME="CHANGED" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="C"/>
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="GET_EDITOR" SCONAME="STRING" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <exception CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="GET_EDITOR" SCONAME="INTERNAL_ERROR" VERSION="1" LANGU="S" MTDTYPE="0" EDITORDER="1 "/>
  <source>METHOD get_editor.

  DATA: local_stream  TYPE TABLE OF text255,
        local_itf     TYPE TABLE OF tline,
        local_ascii   TYPE TABLE OF tline,
        l_local_ascii TYPE tline,
        local_parent  TYPE i,
        local_modif   TYPE i,
        local_lnsize  TYPE itctk-tdlinesize,
        l_string      TYPE string.

  CLEAR: string, lines.
* Get actual parent window

  get_control_tab( ).
  IF NOT control_tab IS INITIAL.
    IF string IS REQUESTED.
      CALL METHOD control_tab-ctrl_new-&gt;get_textstream
        EXPORTING
          only_when_modified     = &apos;&apos;
        IMPORTING
          text                   = l_string
          is_modified            = local_modif
        EXCEPTIONS
          error_cntl_call_method = 1
          not_supported_by_gui   = 2
          OTHERS                 = 3.

*   Flush is required for working on the string content
      CALL METHOD cl_gui_cfw=&gt;flush
        EXCEPTIONS
          cntl_system_error = 1
          cntl_error        = 2
          OTHERS            = 3.

      string = l_string.
    ELSEIF lines IS REQUESTED.
      IF col_width = 0.
        CALL METHOD control_tab-ctrl_new-&gt;get_text_as_r3table
          IMPORTING
            is_modified = local_modif
            table       = lines[]
          EXCEPTIONS
            OTHERS      = 4.
      ELSE.
        CALL METHOD control_tab-ctrl_new-&gt;get_text_as_stream
          IMPORTING
            is_modified = local_modif
            text        = local_stream[]
          EXCEPTIONS
            OTHERS      = 4.
        CALL FUNCTION &apos;CONVERT_STREAM_TO_ITF_TEXT&apos;
          TABLES
            text_stream = local_stream
            itf_text    = local_itf.
        local_lnsize = col_width + 1.
        CALL FUNCTION &apos;CONVERT_TEXT&apos;
          EXPORTING
            direction   = &apos;EXPORT&apos;
            format_type = &apos;ASCII&apos;
            formatwidth = local_lnsize
          TABLES
            foreign     = local_ascii
            itf_lines   = local_itf.
        LOOP AT local_ascii INTO l_local_ascii.
          APPEND l_local_ascii TO lines.
        ENDLOOP.
      ENDIF.
    ELSE.
      CALL METHOD control_tab-ctrl_new-&gt;get_textmodified_status
        IMPORTING
          status = local_modif
        EXCEPTIONS
          OTHERS = 1.
    ENDIF.
*    IF sy-subrc &lt;&gt; 0.
*      RAISE internal_error.
*    ENDIF.
    IF local_modif = cl_gui_textedit=&gt;false.
      changed = space.
    ELSE.
      changed = &apos;X&apos;.
    ENDIF.

    CALL METHOD control_tab-ctrl_new-&gt;set_textmodified_status
      EXCEPTIONS
        OTHERS = 1.
  ELSE.
    CLEAR: string, lines.
  ENDIF.


ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="SET_EDITABLE" VERSION="1" LANGU="S" DESCRIPT="Fija control editable/no editable" EXPOSURE="2" STATE="1" EDITORDER="5 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="SET_EDITABLE" SCONAME="EDIT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL"/>
  <exception CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="SET_EDITABLE" SCONAME="INTERNAL_ERROR" VERSION="1" LANGU="S" MTDTYPE="0" EDITORDER="1 "/>
  <source>METHOD set_editable.
  DATA l_readonly TYPE i.

  get_control_tab( ).
  IF NOT control_tab IS INITIAL.
    IF edit IS INITIAL.
      l_readonly = cl_gui_textedit=&gt;true.
      read_only = &apos;X&apos;.
    ELSE.
      l_readonly = cl_gui_textedit=&gt;false.
      CLEAR read_only.
    ENDIF.

    CALL METHOD control_tab-ctrl_new-&gt;set_readonly_mode
      EXPORTING
        readonly_mode          = l_readonly
      EXCEPTIONS
        error_cntl_call_method = 1
        invalid_parameter      = 2
        OTHERS                 = 3.
    IF sy-subrc &lt;&gt; 0.
* Implement suitable error handling here
    ENDIF.

  ENDIF.

ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="SET_EDITOR" VERSION="1" LANGU="S" DESCRIPT="Set editor" EXPOSURE="2" STATE="1" EDITORDER="2 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="SET_EDITOR" SCONAME="MAX_COLS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="0" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="SET_EDITOR" SCONAME="SHOW_STATUS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="C" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="SET_EDITOR" SCONAME="STATUS_TEXT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SYTITLE" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="SET_EDITOR" SCONAME="SHOW_TOOL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="C" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="SET_EDITOR" SCONAME="DISPLAY_MODE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="C" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="SET_EDITOR" SCONAME="LINES" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="SET_EDITOR" SCONAME="STRING" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <exception CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="SET_EDITOR" SCONAME="CREATE_ERROR" VERSION="1" LANGU="S" MTDTYPE="0" EDITORDER="1 "/>
  <exception CLSNAME="ZCL_AP_CONTROL_TEXTO" CMPNAME="SET_EDITOR" SCONAME="INTERNAL_ERROR" VERSION="1" LANGU="S" MTDTYPE="0" EDITORDER="2 "/>
  <source>METHOD set_editor.
  DATA: local_parent TYPE i,
        local_wrapm  TYPE i,
        local_linbrk TYPE i.
  DATA: lv_max_cols LIKE max_cols,              &quot;Note 891627
        l_string    TYPE string.


  CLASS cl_gui_object DEFINITION LOAD.         &quot;Note 891627
  IF NOT cl_gui_object=&gt;www_active IS INITIAL.
    lv_max_cols = 0.
  ELSE.
    lv_max_cols = max_cols.
  ENDIF.

* Determine wrap mode
  IF lv_max_cols = 0.
    local_wrapm  = cl_gui_textedit=&gt;wordwrap_at_windowborder.
    local_linbrk = cl_gui_textedit=&gt;false.
  ELSE.
    local_wrapm  = cl_gui_textedit=&gt;wordwrap_at_fixed_position.
    local_linbrk = cl_gui_textedit=&gt;true.
  ENDIF.

  get_control_tab( ).
  IF NOT control_tab IS INITIAL.
    destroy( ). &quot;Si no no refresca!
  ENDIF.

  clear control_tab.
  control_tab-ctrl_name = controlname.
  control_tab-parent    = local_parent.

*   create control container
  CREATE OBJECT control_tab-editor_container
    EXPORTING
      container_name              = controlname
    EXCEPTIONS
      cntl_error                  = 1
      cntl_system_error           = 2
      create_error                = 3
      lifetime_error              = 4
      lifetime_dynpro_dynpro_link = 5.
  IF sy-subrc NE 0.
    RAISE create_error.
  ENDIF.

*   create control editor
  CREATE OBJECT control_tab-ctrl_new
    EXPORTING
      wordwrap_mode              = local_wrapm
      wordwrap_position          = lv_max_cols
      wordwrap_to_linebreak_mode = local_linbrk
      parent                     = control_tab-editor_container
    EXCEPTIONS
      error_cntl_create          = 1
      error_cntl_init            = 2
      error_cntl_link            = 3
      error_dp_create            = 4
      gui_type_not_supported     = 5
      OTHERS                     = 6.
  IF sy-subrc = 0.
    APPEND control_tab TO i_control_tab.
  ELSE.
    RAISE create_error.
  ENDIF.


* Set Tool-/statusbar
  IF NOT show_status IS INITIAL.
    CALL METHOD control_tab-ctrl_new-&gt;set_statusbar_mode
      EXPORTING
        statusbar_mode = 1
      EXCEPTIONS
        OTHERS         = 0.
    IF NOT status_text IS INITIAL.
      CALL METHOD control_tab-ctrl_new-&gt;set_status_text
        EXPORTING
          status_text = status_text
        EXCEPTIONS
          OTHERS      = 0.
    ENDIF.
  ELSE.
    CALL METHOD control_tab-ctrl_new-&gt;set_statusbar_mode
      EXPORTING
        statusbar_mode = 0
      EXCEPTIONS
        OTHERS         = 0.
  ENDIF.
  IF NOT show_tool IS INITIAL.
    CALL METHOD control_tab-ctrl_new-&gt;set_toolbar_mode
      EXPORTING
        toolbar_mode = 1
      EXCEPTIONS
        OTHERS       = 0.
  ELSE.
    CALL METHOD control_tab-ctrl_new-&gt;set_toolbar_mode
      EXPORTING
        toolbar_mode = 0
      EXCEPTIONS
        OTHERS       = 0.
  ENDIF.

  IF NOT display_mode IS INITIAL.
    read_only = &apos;X&apos;.
    CALL METHOD control_tab-ctrl_new-&gt;set_readonly_mode
      EXPORTING
        readonly_mode = 1
      EXCEPTIONS
        OTHERS        = 1.
  ELSE.
    read_only = &apos;&apos;.
    CALL METHOD control_tab-ctrl_new-&gt;set_readonly_mode
      EXPORTING
        readonly_mode = 0
      EXCEPTIONS
        OTHERS        = 1.
  ENDIF.

  IF string IS SUPPLIED.
    l_string = string.
    CALL METHOD control_tab-ctrl_new-&gt;set_textstream
      EXPORTING
        text                   = l_string
      EXCEPTIONS
        error_cntl_call_method = 1
        not_supported_by_gui   = 2
        OTHERS                 = 3.
    IF sy-subrc &lt;&gt; 0.
      RAISE internal_error.
    ENDIF.

  ELSEIF lines IS SUPPLIED.
    CALL METHOD control_tab-ctrl_new-&gt;set_text_as_r3table
      EXPORTING
        table           = lines[]
      EXCEPTIONS
        error_dp        = 1
        error_dp_create = 2.
    IF sy-subrc &lt;&gt; 0.
      RAISE internal_error.
    ENDIF.

  ENDIF.

  CALL METHOD cl_gui_cfw=&gt;flush
    EXCEPTIONS
      OTHERS = 1.

  mostrado = &apos;X&apos;.

ENDMETHOD.</source>
 </method>
</CLAS>

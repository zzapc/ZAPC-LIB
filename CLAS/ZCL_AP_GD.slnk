<?xml version="1.0" encoding="utf-8"?>
<CLAS CLSNAME="ZCL_AP_GD" VERSION="1" LANGU="S" DESCRIPT="Gestión documental" CATEGORY="00" EXPOSURE="2" STATE="1" RELEASE="0" CLSCCINCL="X" FIXPT="X" UNICODE="X" CLSBCCAT="00" DURATION_TYPE="0 " RISK_LEVEL="0 ">
 <types CLSNAME="ZCL_AP_GD" CMPNAME="T_CONTENIDO_XSTRING" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="1 " TYPTYPE="4" SRCROW1="7 " SRCCOLUMN1="6 " SRCROW2="12 " SRCCOLUMN2="31 " TYPESRC_LENG="189 " TYPESRC="BEGIN OF  t_contenido_xstring,
        filename TYPE string,
        docsize  TYPE int4,
        mimetype TYPE string,
        xstring  TYPE xstring,
      END OF t_contenido_xstring
"/>
 <types CLSNAME="ZCL_AP_GD" CMPNAME="TT_CONTENIDO_XSTRING" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="2 " TYPTYPE="4" SRCROW1="13 " SRCCOLUMN1="10 " SRCROW2="13 " SRCCOLUMN2="63 " TYPESRC_LENG="56 " TYPESRC="tt_contenido_xstring TYPE TABLE OF t_contenido_xstring
"/>
 <localImplementation>*&quot;* local class implementation for public class
*&quot;* use this source file for the implementation part of
*&quot;* local helper classes</localImplementation>
 <localTypes>*&quot;* use this source file for any type declarations (class
*&quot;* definitions, interfaces or data types) you need for method
*&quot;* implementation or private method&apos;s signature</localTypes>
 <localMacros>*&quot;* use this source file for any macro definitions you need
*&quot;* in the implementation part of the class</localMacros>
 <textPool>
  <language SPRAS="S">
   <textElement ID="I" KEY="ELF" ENTRY="Error al leer fichero" LENGTH="42 "/>
   <textElement ID="I" KEY="GPD" ENTRY="Guarde primero el documento" LENGTH="54 "/>
   <textElement ID="I" KEY="NDC" ENTRY="No se ha definido clasificación" LENGTH="62 "/>
   <textElement ID="I" KEY="NED" ENTRY="No existen documentos a actualizar" LENGTH="68 "/>
  </language>
 </textPool>
 <typeUsage CLSNAME="ZCL_AP_GD" TYPEGROUP="ABAP" VERSION="1" TPUTYPE="0" IMPLICIT="X"/>
 <forwardDeclaration>ABAP</forwardDeclaration>
 <attribute CLSNAME="ZCL_AP_GD" CMPNAME="CLAVE" VERSION="1" LANGU="S" DESCRIPT="DDS: clave documento del DVS" EXPOSURE="0" STATE="1" EDITORDER="1 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="CVDDOCKEY" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_GD" CMPNAME="C_OBJECTCLAS" VERSION="1" LANGU="S" DESCRIPT="Clase de objeto" EXPOSURE="2" STATE="1" EDITORDER="8 " ATTDECLTYP="2" ATTVALUE="&apos;DOKUMENT&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="CDHDR-OBJECTCLAS" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_GD" CMPNAME="DESCRIPCION" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="4 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_GD" CMPNAME="DRAW" VERSION="1" LANGU="S" DESCRIPT="Registro info de documento" EXPOSURE="2" STATE="1" EDITORDER="2 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="DRAW" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_GD" CMPNAME="I_DOCUMENTOS" VERSION="1" LANGU="S" DESCRIPT="Anexos ampliados (fichero externo) información cabecera" EXPOSURE="2" STATE="1" EDITORDER="6 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="DMS_TBL_DRAZ" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_GD" CMPNAME="I_DOC_DOCS" VERSION="1" LANGU="S" DESCRIPT="Tipo tabla para DRAD" EXPOSURE="2" STATE="1" EDITORDER="7 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="DMS_TBL_DRAD" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_GD" CMPNAME="I_STATUS" VERSION="1" LANGU="S" DESCRIPT="Tipo tabla para DRAP" EXPOSURE="2" STATE="1" EDITORDER="5 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="DMS_TBL_DRAP" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_GD" CMPNAME="O_CLASS" VERSION="1" LANGU="S" DESCRIPT="Clasificación" EXPOSURE="2" STATE="1" EDITORDER="1 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="3" TYPE="ZCL_AP_CLASIFICACION" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_GD" CMPNAME="STATUS" VERSION="1" LANGU="S" DESCRIPT="Status del documento" EXPOSURE="2" STATE="1" EDITORDER="3 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="ADD_ADJUNTO" VERSION="1" LANGU="S" DESCRIPT="Añade un fichero adjunto como xstring o fichero serv" EXPOSURE="2" STATE="1" EDITORDER="21 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ADD_ADJUNTO" SCONAME="FICHERO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ADD_ADJUNTO" SCONAME="CONTENIDO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="XSTRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ADD_ADJUNTO" SCONAME="DAPPL" VERSION="1" LANGU="S" DESCRIPT="Aplicación" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DAPPL"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ADD_ADJUNTO" SCONAME="STORAGE_CAT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ADD_ADJUNTO" SCONAME="DESCRIPCION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ADD_ADJUNTO" SCONAME="PATH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ADD_ADJUNTO" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ADD_ADJUNTO" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ADD_ADJUNTO" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PARVALUE="&apos;000&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ADD_ADJUNTO" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ADD_ADJUNTO" SCONAME="NO_SI_EXISTE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ADD_ADJUNTO" SCONAME="TIPO_BUSQUEDA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="12 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;*&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ADD_ADJUNTO" SCONAME="MESSAGE" VERSION="1" LANGU="S" DESCRIPT="Línea de mensaje para interfase de diálogo CAD" CMPTYPE="1" MTDTYPE="0" EDITORDER="13 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="MESSAGE"/>
  <source>METHOD add_adjunto.
    DATA: l_file            TYPE cvapi_doc_file,
          l_document        TYPE bapi_doc_files2,
          pt_files_x        TYPE TABLE OF cvapi_doc_file,
          l_ftpdest         TYPE rfcdes-rfcdest VALUE &apos;SAPFTPA&apos;,
          l_content_provide TYPE mcdok-content_provide,
          pfx_file_size     TYPE i,
          pt_content        TYPE TABLE OF drao,
          i_bin             TYPE TABLE OF drao-orblk,
          l_drao            TYPE drao,
          psx_message       TYPE messages.

    FIELD-SYMBOLS: &lt;bin&gt;  TYPE drao-orblk,
                   &lt;drao&gt; TYPE drao.

    l_file-appnr    = &apos;1&apos;.
    l_file-filename = fichero.
    l_file-pathname = path.

    IF path = fichero.
      l_file-filename = zcl_ap_ficheros=&gt;get_nombre_fichero( fichero       = fichero
                                                             con_extension = &apos;X&apos; ).
      l_file-pathname = zcl_ap_ficheros=&gt;get_directorio_fichero( fichero = fichero ).
    ENDIF.

    l_file-dappl          = dappl.
    l_file-storage_cat    = storage_cat.
    l_file-description    = descripcion.
    l_file-checked_in     = &apos;X&apos;.
    l_file-active_version = &apos;X&apos;.

    l_document = get_adjunto( dokar         = dokar
                              doknr         = doknr
                              doktl         = doktl
                              dokvr         = dokvr
                              fichero       = fichero
                              tipo_busqueda = tipo_busqueda ).

    IF l_document IS INITIAL.
      l_file-updateflag = &apos;I&apos;.
    ELSE.
      l_file-updateflag = &apos;U&apos;.
      l_file-lo_objid   = l_document-application_id.
      l_file-ph_objid   = l_document-file_id.
      IF no_si_existe = &apos;X&apos;.
        EXIT.
      ENDIF.
    ENDIF.

    APPEND l_file TO pt_files_x.

    IF contenido IS INITIAL.
      IF l_file-pathname CS &apos;:&apos;.
        l_ftpdest = &apos;SAPFTP&apos;.
        l_content_provide = &apos;CLNT&apos;.
      ELSE.
        l_content_provide = &apos;SRV&apos;.
        CALL FUNCTION &apos;CV120_READ_FILE2TABLE&apos;
          EXPORTING  pf_file       = l_file-pathname
          IMPORTING  pfx_file_size = pfx_file_size
          TABLES     ptx_data      = pt_content
          EXCEPTIONS read_error    = 1.
        IF sy-subrc &lt;&gt; 0.
          CONCATENATE &apos;Error al leer fichero&apos;(ELF) l_file-pathname INTO message SEPARATED BY space.
        ENDIF.
      ENDIF.
    ELSE.
      CALL FUNCTION &apos;SCMS_XSTRING_TO_BINARY&apos;
        EXPORTING buffer        = contenido
*                  APPEND_TO_TABLE = &apos; &apos;
        IMPORTING output_length = pfx_file_size
        TABLES    binary_tab    = i_bin.
      LOOP AT i_bin ASSIGNING &lt;bin&gt;.
        CLEAR l_drao.
        l_drao-orblk = &lt;bin&gt;.
        APPEND l_drao TO pt_content.
      ENDLOOP.
    ENDIF.

    IF NOT pt_content IS INITIAL.
      l_content_provide = &apos;TBL&apos;.

      LOOP AT pt_content ASSIGNING &lt;drao&gt;.
        &lt;drao&gt;-dokar = dokar.
        &lt;drao&gt;-doknr = doknr.
        &lt;drao&gt;-dokvr = dokvr.
        &lt;drao&gt;-doktl = doktl.
        &lt;drao&gt;-appnr = &apos;1&apos;.
        &lt;drao&gt;-orln  = pfx_file_size.
      ENDLOOP.
    ENDIF.

    CALL FUNCTION &apos;CVAPI_DOC_CHECKIN&apos;
      EXPORTING pf_dokar           = dokar
                pf_doknr           = doknr
                pf_dokvr           = dokvr
                pf_doktl           = doktl
                pf_ftp_dest        = l_ftpdest
                pf_http_dest       = &apos;SAPHTTPA&apos;
                pf_replace         = &apos;X&apos;
                pf_content_provide = l_content_provide
      IMPORTING psx_message        = psx_message
      TABLES    pt_files_x         = pt_files_x
                pt_content         = pt_content.

    IF psx_message-msg_type = &apos;E&apos;.
      message = psx_message-msg_txt.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="ANYADIR_ENLACE" VERSION="1" LANGU="S" DESCRIPT="Añadir enlace a documento" EXPOSURE="2" STATE="1" EDITORDER="10 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ANYADIR_ENLACE" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ANYADIR_ENLACE" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ANYADIR_ENLACE" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ANYADIR_ENLACE" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ANYADIR_ENLACE" SCONAME="OBJECTTYPE" VERSION="1" LANGU="S" DESCRIPT="Objeto SAP enlazado" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKOB"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ANYADIR_ENLACE" SCONAME="OBJECTKEY" VERSION="1" LANGU="S" DESCRIPT="Clave objeto p.gestión documentos" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ANYADIR_ENLACE" SCONAME="BORRAR" VERSION="1" LANGU="S" DESCRIPT="Indicador de borrado" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="LKENZ" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ANYADIR_ENLACE" SCONAME="RETURN" VERSION="1" LANGU="S" DESCRIPT="Parámetro de retorno" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="BAPIRET2"/>
  <source>METHOD anyadir_enlace.
    DATA: l_drad        TYPE bapi_doc_drad,
          i_drad        TYPE TABLE OF bapi_doc_drad,
          documentdata  TYPE bapi_doc_draw2,
          documentdatax TYPE bapi_doc_drawx2.

    l_drad-objecttype  = objecttype.
    l_drad-objectkey   = objectkey.

    l_drad-deletevalue = borrar.
    APPEND l_drad TO i_drad.

    CALL FUNCTION &apos;BAPI_DOCUMENT_CHANGE2&apos;
      EXPORTING documenttype    = dokar
                documentnumber  = doknr
                documentpart    = doktl
                documentversion = dokvr
                documentdata    = documentdata
                documentdatax   = documentdatax
*                HOSTNAME        =
*                DOCBOMCHANGENUMBER =
*                DOCBOMVALIDFROM =
*                DOCBOMREVISIONLEVEL =
*                SENDCOMPLETEBOM = &apos; &apos;
*                PF_FTP_DEST     = &apos; &apos;
*                PF_HTTP_DEST    = &apos; &apos;
*                CAD_MODE        = &apos; &apos;
*                ACCEPT_EMPTY_BOM = &apos; &apos;
      IMPORTING return          = return
      TABLES
*                CHARACTERISTICVALUES =
*                CLASSALLOCATIONS =
*                DOCUMENTDESCRIPTIONS =
                objectlinks     = i_drad
*                DOCUMENTSTRUCTURE =
*                DOCUMENTFILES   =
*                LONGTEXTS       =
*                COMPONENTS      =
              .

    IF return-type &lt;&gt; &apos;E&apos;.
      CALL FUNCTION &apos;BAPI_TRANSACTION_COMMIT&apos;
        EXPORTING wait = &apos;X&apos;.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="BORRAR_ADJUNTO" VERSION="1" LANGU="S" DESCRIPT="Borra fichero adjunto" EXPOSURE="2" STATE="1" EDITORDER="33 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="BORRAR_ADJUNTO" SCONAME="FICHERO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="BORRAR_ADJUNTO" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="BORRAR_ADJUNTO" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="BORRAR_ADJUNTO" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PARVALUE="&apos;000&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="BORRAR_ADJUNTO" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="BORRAR_ADJUNTO" SCONAME="MESSAGE" VERSION="1" LANGU="S" DESCRIPT="Línea de mensaje para interfase de diálogo CAD" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="BAPI_MSG"/>
  <source>METHOD borrar_adjunto.
    DATA: l_file        TYPE string,
          documentdata  TYPE bapi_doc_draw2,
          documentdatax TYPE bapi_doc_drawx2,
          return        TYPE bapiret2.

    CLEAR message.
    DATA(i_docs) = zcl_ap_gd=&gt;get_anexos_st( dokar = dokar
                                             doknr = doknr
                                             doktl = doktl
                                             dokvr = dokvr ).
    LOOP AT i_docs ASSIGNING FIELD-SYMBOL(&lt;doc&gt;) WHERE docfile = fichero.
      &lt;doc&gt;-deletevalue = &apos;X&apos;.
    ENDLOOP.
    IF sy-subrc &lt;&gt; 0.
      l_file = fichero.
      l_file = to_upper( l_file ).
      LOOP AT i_docs ASSIGNING &lt;doc&gt;.
        &lt;doc&gt;-docfile = to_upper( &lt;doc&gt;-docfile ).
        IF &lt;doc&gt;-docfile CS l_file.
          &lt;doc&gt;-deletevalue = &apos;X&apos;.
        ENDIF.
      ENDLOOP.
    ENDIF.
    IF sy-subrc &lt;&gt; 0.
      message = |No existe el fichero { fichero }|.
      RETURN.
    ENDIF.

    CALL FUNCTION &apos;BAPI_DOCUMENT_CHANGE2&apos;
      EXPORTING documenttype    = dokar
                documentnumber  = doknr
                documentpart    = doktl
                documentversion = dokvr
                documentdata    = documentdata
                documentdatax   = documentdatax
*                HOSTNAME        =
*                DOCBOMCHANGENUMBER =
*                DOCBOMVALIDFROM =
*                DOCBOMREVISIONLEVEL =
*                SENDCOMPLETEBOM = &apos; &apos;
*                PF_FTP_DEST     = &apos; &apos;
*                PF_HTTP_DEST    = &apos; &apos;
*                CAD_MODE        = &apos; &apos;
*                ACCEPT_EMPTY_BOM = &apos; &apos;
      IMPORTING return          = return
      TABLES
*                CHARACTERISTICVALUES =
*                CLASSALLOCATIONS =
*                DOCUMENTDESCRIPTIONS =
*                objectlinks     =
*                DOCUMENTSTRUCTURE =
                documentfiles   = i_docs
*                LONGTEXTS       =
*                COMPONENTS      =
      .

    zcl_ap_dev=&gt;commit( ).

    IF zcl_ap_gd=&gt;existe_adjunto( dokar   = dokar
                                  doknr   = doknr
                                  doktl   = doktl
                                  dokvr   = dokvr
                                  fichero = fichero ) = &apos;X&apos;.
      message = return-message.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="CHECK_IN_DOC" VERSION="1" LANGU="S" DESCRIPT="Actualiza un documento y lo archiva" EXPOSURE="2" STATE="1" EDITORDER="12 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="CHECK_IN_DOC" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="CHECK_IN_DOC" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="CHECK_IN_DOC" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PARVALUE="&apos;000&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="CHECK_IN_DOC" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="CHECK_IN_DOC" SCONAME="DAPPL" VERSION="1" LANGU="S" DESCRIPT="Aplicación" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DAPPL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="CHECK_IN_DOC" SCONAME="NUEVO_FICHERO" VERSION="1" LANGU="S" DESCRIPT="Nuevo fichero a actualizar" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="CHECK_IN_DOC" SCONAME="RETURN" VERSION="1" LANGU="S" DESCRIPT="Parámetro de retorno" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="BAPIRET2"/>
  <source>METHOD check_in_doc.
    DATA i_documents TYPE TABLE OF bapi_doc_files2.

    FIELD-SYMBOLS &lt;doc&gt; TYPE bapi_doc_files2.

    i_documents[] = get_anexos_st( dokar = dokar
                                   doknr = doknr
                                   doktl = doktl
                                   dokvr = dokvr ).

    LOOP AT i_documents ASSIGNING &lt;doc&gt; WHERE     storagecategory &lt;&gt; &apos;&apos;
                                              AND wsapplication    = dappl.
      &lt;doc&gt;-docfile = nuevo_fichero.
    ENDLOOP.
    IF sy-subrc = 0.
      CALL FUNCTION &apos;BAPI_DOCUMENT_CHECKIN_REPLACE2&apos;
        EXPORTING documenttype    = dokar
                  documentnumber  = doknr
                  documentpart    = doktl
                  documentversion = dokvr
*                  HOSTNAME        = &apos; &apos;
*                  STATUSINTERN    = &apos; &apos;
*                  STATUSEXTERN    = &apos; &apos;
*                  STATUSLOG       = &apos; &apos;
*                  REVLEVEL        = &apos; &apos;
*                  AENNR           = &apos; &apos;
*                  PF_HTTP_DEST    = &apos; &apos;
*                  PF_FTP_DEST     = &apos; &apos;
        IMPORTING return          = return
        TABLES    documentfiles   = i_documents
*                  COMPONENTS      =
*                  DOCUMENTSTRUCTURE =
                .
      IF return-type &lt;&gt; &apos;E&apos;.
        COMMIT WORK AND WAIT.
      ENDIF.
    ELSE.
      return-type    = &apos;E&apos;.
      return-message = &apos;No existen documentos a actualizar&apos;(NED).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="CONSTRUCTOR" VERSION="1" LANGU="S" DESCRIPT="CONSTRUCTOR" EXPOSURE="2" STATE="1" EDITORDER="1 " DISPID="0 " MTDTYPE="2" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="CONSTRUCTOR" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="2" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="CONSTRUCTOR" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="2" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="CONSTRUCTOR" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="2" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PARVALUE="&apos;000&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="CONSTRUCTOR" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="2" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="CONSTRUCTOR" SCONAME="CLASSNUM" VERSION="1" LANGU="S" DESCRIPT="N° de clase" CMPTYPE="1" MTDTYPE="2" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="CONSTRUCTOR" SCONAME="VALIDAR_GRABADO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="CONSTRUCTOR" SCONAME="DRAW" VERSION="1" LANGU="S" DESCRIPT="Registro info de documento" CMPTYPE="1" MTDTYPE="2" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DRAW" PAROPTIONL="X"/>
  <source>METHOD constructor.
    DATA l_tdwa TYPE tdwa.

    IF draw IS INITIAL.
      SELECT SINGLE * FROM draw
        INTO me-&gt;draw
        WHERE dokar = dokar
          AND doknr = doknr
          AND dokvr = dokvr
          AND doktl = doktl.
    ELSE.
      me-&gt;draw = draw.
    ENDIF.

    IF me-&gt;draw IS INITIAL.
      IF NOT doknr IS INITIAL.
        IF validar_grabado = &apos;X&apos;.
          MESSAGE &apos;Guarde primero el documento&apos;(gpd) TYPE &apos;E&apos;.
        ELSE.
          me-&gt;draw-dokar = dokar.
          me-&gt;draw-doknr = doknr.
          me-&gt;draw-dokvr = dokvr.
          me-&gt;draw-doktl = doktl.
          CLEAR sy-subrc.
        ENDIF.
      ELSEIF NOT dokar IS INITIAL.
        SELECT SINGLE * FROM tdwa
          INTO l_tdwa
          WHERE dokar = dokar.
        IF sy-subrc = 0.
          o_class = NEW #( objecttable = &apos;DRAW&apos;
                           classnum    = classnum
                           classtype   = l_tdwa-klassenart ).
        ENDIF.
      ENDIF.
    ENDIF.

    IF sy-subrc &lt;&gt; 0.
      RETURN.
    ENDIF.

    SELECT SINGLE dostx FROM tdwst
      INTO status
      WHERE cvlang = sy-langu
        AND dokst  = me-&gt;draw-dokst.

    SELECT dktxt FROM drat
      INTO descripcion
      UP TO 1 ROWS
      WHERE dokar = me-&gt;draw-dokar
        AND doknr = me-&gt;draw-doknr
        AND dokvr = me-&gt;draw-dokvr
        AND doktl = me-&gt;draw-doktl
      ORDER BY PRIMARY KEY.
    ENDSELECT.

    SELECT * FROM drap
      INTO TABLE i_status
      WHERE dokar = me-&gt;draw-dokar
        AND doknr = me-&gt;draw-doknr
        AND dokvr = me-&gt;draw-dokvr
        AND doktl = me-&gt;draw-doktl.

    SELECT SINGLE * FROM tdwa
      INTO l_tdwa
      WHERE dokar = me-&gt;draw-dokar.
    IF sy-subrc = 0.
      IF classnum IS NOT INITIAL.
        l_tdwa-klasse = classnum.
      ENDIF.
      o_class = NEW #( objecttable = &apos;DRAW&apos;
                       classnum    = l_tdwa-klasse
                       classtype   = l_tdwa-klassenart ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="EDITAR" VERSION="1" LANGU="S" DESCRIPT="Editar" EXPOSURE="2" STATE="1" EDITORDER="27 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="EDITAR" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="EDITAR" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="EDITAR" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PARVALUE="&apos;000&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="EDITAR" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PARVALUE="&apos;00&apos;"/>
  <source>METHOD editar.
    SET PARAMETER ID &apos;CV1&apos; FIELD doknr.
    SET PARAMETER ID &apos;CV2&apos; FIELD dokar.
    SET PARAMETER ID &apos;CV3&apos; FIELD dokvr.
    SET PARAMETER ID &apos;CV4&apos; FIELD doktl.
    CALL TRANSACTION &apos;CV02N&apos; AND SKIP FIRST SCREEN.        &quot;#EC CI_CALLTA
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="ES_ULTIMA_VERSION_ST" VERSION="1" LANGU="S" DESCRIPT="¿Es la última versión del documento?" EXPOSURE="2" STATE="1" EDITORDER="9 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ES_ULTIMA_VERSION_ST" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ES_ULTIMA_VERSION_ST" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ES_ULTIMA_VERSION_ST" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PARVALUE="&apos;000&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ES_ULTIMA_VERSION_ST" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="ES_ULTIMA_VERSION_ST" SCONAME="ULTIMA_VERSION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="ABAP_BOOL"/>
  <source>METHOD es_ultima_version_st.
    DATA l_draw TYPE draw.

    CLEAR ultima_version.
    CALL FUNCTION &apos;DOCUMENT_ACTUAL_VERSION&apos;
      EXPORTING
*                 DATUM               = SY-DATUM
                 dokar               = dokar
                 doknr               = doknr
                 teildok             = doktl
*                 DOKOB               = &apos; &apos;
*                 OBJKY               = &apos; &apos;
*                 PFX_CV140_CALL      =
      IMPORTING  dokar               = l_draw-dokar
                 doknr               = l_draw-doknr
                 dokst               = l_draw-dokst
                 dokvr               = l_draw-dokvr
*                 FRKNZ               = ¿Queremos los liberados?
*                 TEILDOK             =
      EXCEPTIONS no_document         = 1
                 no_version_for_time = 2
                 OTHERS              = 3.
    IF dokvr = l_draw-dokvr.
      ultima_version = &apos;X&apos;.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="EXISTE_ADJUNTO" VERSION="1" LANGU="S" DESCRIPT="Existe el fichero adjunto" EXPOSURE="2" STATE="1" EDITORDER="22 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="EXISTE_ADJUNTO" SCONAME="FICHERO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="EXISTE_ADJUNTO" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="EXISTE_ADJUNTO" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="EXISTE_ADJUNTO" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PARVALUE="&apos;000&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="EXISTE_ADJUNTO" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="EXISTE_ADJUNTO" SCONAME="TIPO_BUSQUEDA" VERSION="1" LANGU="S" DESCRIPT="&apos;&apos; Exacta, &apos;*&apos; que contenga el nombre del fichero" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;*&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="EXISTE_ADJUNTO" SCONAME="EXISTE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="ABAP_BOOL"/>
  <source>METHOD existe_adjunto.
    DATA l_document TYPE bapi_doc_files2.

    l_document = get_adjunto( fichero       = fichero
                              doknr         = doknr
                              dokar         = dokar
                              doktl         = doktl
                              dokvr         = dokvr
                              tipo_busqueda = tipo_busqueda ).

    IF NOT l_document IS INITIAL.
      existe = &apos;X&apos;.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="FREE" VERSION="1" LANGU="S" DESCRIPT="Libera memoria del objeto" EXPOSURE="2" STATE="1" EDITORDER="6 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD free.
    IF NOT o_class IS INITIAL.
      o_class-&gt;free( ).
      CLEAR o_class.
    ENDIF.

    CLEAR: i_status,
           i_documentos,
           i_doc_docs.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_ADJUNTO" VERSION="1" LANGU="S" DESCRIPT="Devuelve el adjunto" EXPOSURE="2" STATE="1" EDITORDER="29 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ADJUNTO" SCONAME="FICHERO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ADJUNTO" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ADJUNTO" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ADJUNTO" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PARVALUE="&apos;000&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ADJUNTO" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ADJUNTO" SCONAME="TIPO_BUSQUEDA" VERSION="1" LANGU="S" DESCRIPT="&apos;&apos; Exacta, &apos;*&apos; que contenga el nombre del fichero" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;*&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ADJUNTO" SCONAME="DOCUMENT" VERSION="1" LANGU="S" DESCRIPT="BAPIS SGD: Originales documentos" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="BAPI_DOC_FILES2"/>
  <source>METHOD get_adjunto.
    DATA: i_documents TYPE TABLE OF bapi_doc_files2,
          l_file      TYPE string,
          l_document  TYPE bapi_doc_files2.

    CLEAR document.

    i_documents[] = get_anexos_st( dokar = dokar
                                   doknr = doknr
                                   doktl = doktl
                                   dokvr = dokvr ).

    l_file = fichero.
    l_file = to_upper( l_file ).

    LOOP AT i_documents INTO l_document.
      l_document-docfile = to_upper( l_document-docfile ).
      IF tipo_busqueda = &apos;*&apos;.
        IF l_document-docfile CS l_file.
          document = l_document.
          EXIT.
        ENDIF.
      ELSEIF tipo_busqueda = &apos;*&apos;.
        IF l_document-docfile CS l_file.
          document = l_document.
          EXIT.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_CONTENIDO" VERSION="1" LANGU="S" DESCRIPT="Devuelve lista de anexos con tabla de contenidos" EXPOSURE="2" STATE="1" EDITORDER="17 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_CONTENIDO" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_CONTENIDO" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_CONTENIDO" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PARVALUE="&apos;000&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_CONTENIDO" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_CONTENIDO" SCONAME="KPRO_USE" VERSION="1" LANGU="S" DESCRIPT="Obtiene versión local ficheros KPRO" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_CONTENIDO" SCONAME="DAPPL" VERSION="1" LANGU="S" DESCRIPT="Aplicación" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DAPPL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_CONTENIDO" SCONAME="FICHERO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_CONTENIDO" SCONAME="FILE_IDX" VERSION="1" LANGU="S" DESCRIPT="Contador p.documentos" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DMS_DOC_INDEX" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_CONTENIDO" SCONAME="S_ADATUM" VERSION="1" LANGU="S" DESCRIPT="Tabla range para fecha" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DATUM_RANGE_TAB" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_CONTENIDO" SCONAME="I_CONTENIDO" VERSION="1" LANGU="S" DESCRIPT="Tabla transferencia contenidos correo entr." CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="RMPS_T_POST_CONTENT"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_CONTENIDO" SCONAME="I_DOCUMENTS" VERSION="1" LANGU="S" DESCRIPT="Originales para BAPIs" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="T_BAPI_DOC_FILES2"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_CONTENIDO" SCONAME="I_CONTENIDO_XSTRING" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="12 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="TT_CONTENIDO_XSTRING"/>
  <source>METHOD get_anexos_contenido.
    &quot; TODO: parameter S_ADATUM is never used (ABAP cleaner)

    DATA: l_tabla             TYPE tabname,
          l_draw              TYPE draw,
          l_created_at        TYPE sdok_chtst,
          l_doc_file          TYPE dms_doc_file,
          l_count_def         TYPE dms_checkout_def,
          l_phio              TYPE dms_phio,
          l_frontend          TYPE dms_frontend_data,
          &quot; TODO: variable is assigned but never used (ABAP cleaner)
          l_file              TYPE draw-filep,
          &quot; TODO: variable is assigned but never used (ABAP cleaner)
          l_url               TYPE mcdok-url,
          i_content           TYPE TABLE OF drao,
          l_contenido         TYPE rmps_post_content,
          l_content           TYPE drao,
          l_index             TYPE i,
          l_solix             TYPE lxe_x255,
          l_contenido_xstring TYPE t_contenido_xstring.
    DATA: l_uri    TYPE string,
          l_http   TYPE REF TO if_http_client,
          i_header TYPE tihttpnvp,
          l_data   TYPE xstring,
          l_header TYPE ihttpnvp.

    FIELD-SYMBOLS &lt;doc&gt; TYPE bapi_doc_files2.

    FIELD-SYMBOLS: &lt;hexa&gt; TYPE solix,
                   &lt;dest&gt; TYPE x.

    CLEAR: i_contenido,
           i_documents,
           i_contenido_xstring.

    l_tabla = &apos;DRAW&apos;.
    SELECT SINGLE *
      FROM (l_tabla)
      INTO l_draw
      WHERE dokar = dokar
        AND doknr = doknr
        AND dokvr = dokvr
        AND doktl = doktl.

    CALL FUNCTION &apos;BAPI_DOCUMENT_GETDETAIL2&apos;
      EXPORTING documenttype       = dokar
                documentnumber     = doknr
                documentpart       = doktl
                documentversion    = dokvr
                getactivefiles     = &apos;X&apos;
                getdocdescriptions = &apos;X&apos;
                getdocfiles        = &apos;X&apos;
      TABLES    documentfiles      = i_documents.

* Debido a las exits de al pasar por gestión documental,
* me devuelve documentos &quot;fantasmas&quot;.
    CONCATENATE sy-datum &apos;000000&apos; INTO l_created_at.
    DELETE i_documents WHERE     created_by  = sy-uname
                             AND changed_by  = &apos;&apos;
                             AND checkedin   = &apos;&apos;
                             AND file_id     = &apos;&apos;
                             AND created_at &gt;= l_created_at.

    IF NOT dappl IS INITIAL.
      DELETE i_documents WHERE wsapplication &lt;&gt; dappl.
    ENDIF.

* Sí sólo queremos recuperar el contenido de un fichero específico, borramos el resto!
    IF NOT fichero IS INITIAL.
      DELETE i_documents WHERE NOT docfile CS fichero.
    ENDIF.

    IF file_idx IS NOT INITIAL.
      DELETE i_documents WHERE originaltype &lt;&gt; file_idx.
    ENDIF.

    IF kpro_use &lt;&gt; &apos;X&apos;.
      RETURN.
    ENDIF.

    LOOP AT i_documents ASSIGNING &lt;doc&gt; WHERE storagecategory &lt;&gt; &apos;&apos; AND checkedin = &apos;X&apos;.
      MOVE-CORRESPONDING &lt;doc&gt; TO l_doc_file.
      l_doc_file-langu = &apos;S&apos;.
      l_doc_file-dappl = &lt;doc&gt;-wsapplication.

      l_count_def-kpro_use = &apos;X&apos;.
      l_count_def-comp_get = &apos;X&apos;.

      l_phio-lo_index       = sy-tabix.
      l_phio-ph_index       = sy-tabix.
      l_phio-langu          = &apos;S&apos;.
      l_phio-lo_objid       = &lt;doc&gt;-application_id.
      l_phio-ph_objid       = &lt;doc&gt;-file_id.
      l_phio-file_id        = &lt;doc&gt;-file_id.
      l_phio-storage_cat    = &lt;doc&gt;-storagecategory.
      l_phio-filename       = &lt;doc&gt;-docfile.
      l_phio-active_version = &apos;X&apos;.
      l_phio-delete_flag    = &apos;X&apos;.
      l_phio-protected      = &apos;X&apos;.
      l_phio-default_langu  = &apos;X&apos;.

      l_count_def-batchmode       = &apos;X&apos;.
      l_count_def-content_provide = &apos;TBL&apos;.

      CALL FUNCTION &apos;CV120_DOC_CHECKOUT_VIEW&apos;
        EXPORTING  ps_cout_def = l_count_def
                   pf_tcode    = &apos;CV03&apos;
                   ps_doc_file = l_doc_file
                   ps_draw     = l_draw
                   ps_phio     = l_phio
                   ps_frontend = l_frontend
*                   PF_STD_URL  = &apos;X&apos;
        IMPORTING  pfx_file    = l_file
                   pfx_url     = l_url
*                   PFX_USE_LAST =
        TABLES
*                   PT_COMPONENTS =
*                   PT_DRAZ     =
                   ptx_content = i_content
        EXCEPTIONS error       = 1
                   OTHERS      = 2.
      IF sy-subrc = 0.
        CLEAR l_contenido.
        l_contenido-filename = l_phio-filename.

        LOOP AT i_content INTO l_content.
          CLEAR l_index.
          DO 10 TIMES.
            l_solix = l_content-orblk+l_index(255)
              .
            APPEND INITIAL LINE TO l_contenido-cont_hex ASSIGNING &lt;hexa&gt;.
            ASSIGN &lt;hexa&gt;-line TO &lt;dest&gt;.
            &lt;dest&gt; = l_solix.
            l_index = l_index + 255.
          ENDDO.
        ENDLOOP.
        l_contenido-docsize = l_content-orln.

        APPEND l_contenido TO i_contenido.

        CLEAR l_contenido_xstring.
        MOVE-CORRESPONDING l_contenido TO l_contenido_xstring.
        CALL FUNCTION &apos;SCMS_BINARY_TO_XSTRING&apos;
          EXPORTING  input_length = 999999999
*                     FIRST_LINE   = 0
*                     LAST_LINE    = 0
          IMPORTING  buffer       = l_contenido_xstring-xstring
          TABLES     binary_tab   = l_contenido-cont_hex
          EXCEPTIONS failed       = 1
                     OTHERS       = 2.
        APPEND l_contenido_xstring TO i_contenido_xstring.
      ENDIF.
    ENDLOOP.

    LOOP AT i_documents ASSIGNING &lt;doc&gt; WHERE checkedin = &apos;&apos; AND ( docfile(4) = &apos;http&apos; OR docfile(4) = &apos;HTTP&apos; ).
      l_uri = &lt;doc&gt;-docfile.

      TRY.
          cl_http_client=&gt;create_by_url( EXPORTING url    = l_uri
                                         IMPORTING client = l_http ).
          l_http-&gt;send( ).
          l_http-&gt;receive( EXCEPTIONS OTHERS = 1 ).
          l_http-&gt;response-&gt;get_header_fields( CHANGING fields = i_header ).
          l_data = l_http-&gt;response-&gt;get_data( ).
          l_http-&gt;close( ).
        CATCH cx_root.
          CONTINUE.
      ENDTRY.

      CLEAR l_contenido_xstring.
      LOOP AT i_header INTO l_header.
        IF l_header-name = &apos;content-disposition&apos;.
          &quot; TODO: variable is assigned but never used (ABAP cleaner)
          SPLIT l_header-value AT &apos;filename=&apos; INTO DATA(aux) l_contenido_xstring-filename.
        ENDIF.
        IF l_header-name = &apos;content-type&apos;.
          l_contenido_xstring-mimetype = l_header-value.
        ENDIF.
        IF l_header-name = &apos;content-length&apos;.
          l_contenido_xstring-docsize = l_header-value.
        ENDIF.

      ENDLOOP.

      l_contenido_xstring-xstring = l_data.
      APPEND l_contenido_xstring TO i_contenido_xstring.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_ST" VERSION="1" LANGU="S" DESCRIPT="Devuelve lista de anexos" EXPOSURE="2" STATE="1" EDITORDER="8 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_ST" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_ST" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_ST" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PARVALUE="&apos;000&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_ST" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_ST" SCONAME="KPRO_USE" VERSION="1" LANGU="S" DESCRIPT="Obtiene versión local ficheros KPRO" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_ST" SCONAME="DAPPL" VERSION="1" LANGU="S" DESCRIPT="Aplicación" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DAPPL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_ST" SCONAME="SERVIDOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_ST" SCONAME="TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ANEXOS_ST" SCONAME="I_DOCUMENTS" VERSION="1" LANGU="S" DESCRIPT="Originales para BAPIs" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="T_BAPI_DOC_FILES2"/>
  <source>METHOD get_anexos_st.
    DATA: l_tabla      TYPE tabname,
          l_draw       TYPE draw,
          l_created_at TYPE sdok_chtst,
          l_doc_file   TYPE dms_doc_file,
          l_count_def  TYPE dms_checkout_def,
          l_phio       TYPE dms_phio,
          l_frontend   TYPE dms_frontend_data,
          l_file       TYPE draw-filep,
          &quot; TODO: variable is assigned but never used (ABAP cleaner)
          l_url        TYPE mcdok-url,
          i_content    TYPE TABLE OF drao.

    FIELD-SYMBOLS &lt;doc&gt; TYPE bapi_doc_files2.

    l_tabla = &apos;DRAW&apos;.
    SELECT SINGLE *
      FROM (l_tabla)
      INTO l_draw
      WHERE dokar = dokar
        AND doknr = doknr
        AND dokvr = dokvr
        AND doktl = doktl.

    CALL FUNCTION &apos;BAPI_DOCUMENT_GETDETAIL2&apos;
      EXPORTING documenttype       = dokar
                documentnumber     = doknr
                documentpart       = doktl
                documentversion    = dokvr
                getactivefiles     = &apos;X&apos;
                getdocdescriptions = &apos;X&apos;
                getdocfiles        = &apos;X&apos;
      TABLES    documentfiles      = i_documents.

* Debido a las exits de al pasar por gestión documental,
* me devuelve documentos &quot;fantasmas&quot;.
    CONCATENATE sy-datum &apos;000000&apos; INTO l_created_at.
    DELETE i_documents WHERE     created_by  = sy-uname
                             AND changed_by  = &apos;&apos;
                             AND checkedin   = &apos;&apos;
                             AND file_id     = &apos;&apos;
                             AND created_at &gt;= l_created_at.

    IF NOT dappl IS INITIAL.
      DELETE i_documents WHERE wsapplication &lt;&gt; dappl.
    ENDIF.

    IF kpro_use &lt;&gt; &apos;X&apos;.
      RETURN.
    ENDIF.

    LOOP AT i_documents ASSIGNING &lt;doc&gt; WHERE storagecategory &lt;&gt; &apos;&apos;.
      MOVE-CORRESPONDING &lt;doc&gt; TO l_doc_file.
      l_doc_file-langu = &apos;S&apos;.
      l_doc_file-dappl = &lt;doc&gt;-wsapplication.

      l_count_def-kpro_use = &apos;X&apos;.
      l_count_def-comp_get = &apos;X&apos;.

      l_phio-lo_index       = sy-tabix.
      l_phio-ph_index       = sy-tabix.
      l_phio-langu          = &apos;S&apos;.
      l_phio-lo_objid       = &lt;doc&gt;-application_id.
      l_phio-ph_objid       = &lt;doc&gt;-file_id.
      l_phio-file_id        = &lt;doc&gt;-file_id.
      l_phio-storage_cat    = &lt;doc&gt;-storagecategory.
      l_phio-filename       = &lt;doc&gt;-docfile.
      l_phio-active_version = &apos;X&apos;.
      l_phio-delete_flag    = &apos;X&apos;.
      l_phio-protected      = &apos;X&apos;.
      l_phio-default_langu  = &apos;X&apos;.

      IF servidor IS INITIAL AND tabla IS INITIAL.
        l_frontend-frontend_type = &apos;SL&apos;.
        l_frontend-hostname      = &apos;DEFAULT&apos;.
        l_frontend-winsys        = &apos;WN32&apos;.
        l_frontend-platform      = 0.
      ELSEIF servidor = &apos;X&apos;.
        l_count_def-batchmode       = &apos;X&apos;.
        l_count_def-content_provide = &apos;SRV&apos;.
      ELSEIF tabla = &apos;X&apos;.
        l_count_def-batchmode       = &apos;X&apos;.
        l_count_def-content_provide = &apos;TBL&apos;.
      ENDIF.

      CALL FUNCTION &apos;CV120_DOC_CHECKOUT_VIEW&apos;
        EXPORTING  ps_cout_def = l_count_def
                   pf_tcode    = &apos;CV03&apos;
                   ps_doc_file = l_doc_file
                   ps_draw     = l_draw
                   ps_phio     = l_phio
                   ps_frontend = l_frontend
*                   PF_STD_URL  = &apos;X&apos;
        IMPORTING  pfx_file    = l_file
                   pfx_url     = l_url
*                   PFX_USE_LAST =
        TABLES
*                   PT_COMPONENTS =
*                   PT_DRAZ     =
                   ptx_content = i_content
        EXCEPTIONS error       = 1
                   OTHERS      = 2.
      IF sy-subrc = 0.
        &lt;doc&gt;-docfile = l_file.
      ENDIF.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_CLASIFICACION" VERSION="1" LANGU="S" DESCRIPT="Recupera datos de clasificacion" EXPOSURE="2" STATE="1" EDITORDER="2 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_CLASIFICACION" SCONAME="LANGUAGE" VERSION="1" LANGU="S" DESCRIPT="Clave de idioma" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SPRAS" PARVALUE="SY-LANGU"/>
  <source>METHOD get_clasificacion.
    DATA l_object TYPE bapi1003_key-object.

    IF o_class IS INITIAL.
      MESSAGE &apos;No se ha definido clasificación&apos;(NDC) TYPE &apos;E&apos;.
    ENDIF.

    l_object = draw+3(33).
    o_class-&gt;get_datos( objectkey = l_object
                        language  = language ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_CONEXIONES_ARCHIV" VERSION="1" LANGU="S" DESCRIPT="Recuper Binario buscando conexiones objeto" EXPOSURE="2" STATE="1" EDITORDER="31 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_CONEXIONES_ARCHIV" SCONAME="SAP_OBJECT" VERSION="1" LANGU="S" DESCRIPT="SAP ArchiveLink: Tipo de objeto del business object" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TOAV0-SAP_OBJECT"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_CONEXIONES_ARCHIV" SCONAME="OBJECT_ID" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_CONEXIONES_ARCHIV" SCONAME="AR_OBJECT" VERSION="1" LANGU="S" DESCRIPT="Clase documentos" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TOAV0-AR_OBJECT" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_CONEXIONES_ARCHIV" SCONAME="I_CONEXIONES" VERSION="1" LANGU="S" DESCRIPT="SAP ArchiveLink: Tabla de enlace" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="TOAV0_T"/>
  <source>METHOD get_conexiones_archiv.
    DATA l_object_id TYPE toav0-object_id.

    CLEAR i_conexiones.
    l_object_id = object_id.
    CALL FUNCTION &apos;ARCHIV_GET_CONNECTIONS&apos;
      EXPORTING  objecttype    = sap_object
                 object_id     = l_object_id
                 documenttype  = ar_object
                 until_ar_date = sy-datum
      TABLES     connections   = i_conexiones
      EXCEPTIONS nothing_found = 1
                 OTHERS        = 2.

    SORT i_conexiones BY ar_date ASCENDING.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_DESCRIPCION" VERSION="1" LANGU="S" DESCRIPT="Recupera la descripción" EXPOSURE="2" STATE="1" EDITORDER="3 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_DESCRIPCION" SCONAME="SPRAS" VERSION="1" LANGU="S" DESCRIPT="Clave de idioma del entorno de texto actual" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-LANGU" PARVALUE="SY-LANGU"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_DESCRIPCION" SCONAME="DESCRIPCION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD get_descripcion.
    DATA: drat     TYPE drat,
          l_tdname TYPE thead-tdname,
          i_lineas TYPE TABLE OF tline,
          l_linea  TYPE tline.

    SELECT SINGLE * FROM drat
      INTO drat
      WHERE dokar = draw-dokar
        AND doknr = draw-doknr
        AND dokvr = draw-dokvr
        AND doktl = draw-doktl
        AND langu = spras.
    IF sy-subrc &lt;&gt; 0.
      RETURN.
    ENDIF.

    IF drat-ltxin = space.
      descripcion = drat-dktxt.
    ELSE.
      CLEAR l_tdname.
      l_tdname = sy-mandt.
      l_tdname+3(25) = drat-dokar.
      l_tdname+6(25) = drat-doknr.
      l_tdname+31(2) = drat-dokvr.
      l_tdname+33(3) = drat-doktl.
      REFRESH i_lineas.
      CALL FUNCTION &apos;READ_TEXT&apos;
        EXPORTING  client                  = sy-mandt
                   id                      = &apos;LTXT&apos;
                   language                = spras
                   name                    = l_tdname
                   object                  = &apos;DRAT&apos;
        TABLES     lines                   = i_lineas
        EXCEPTIONS id                      = 1
                   language                = 2
                   name                    = 3
                   not_found               = 4
                   object                  = 5
                   reference_check         = 6
                   wrong_access_to_archive = 7
                   OTHERS                  = 8.

      CLEAR descripcion.
      LOOP AT i_lineas INTO l_linea.
        IF NOT l_linea-tdline IS INITIAL.
          IF descripcion IS INITIAL.
            descripcion = l_linea-tdline.
          ELSE.
            CONCATENATE descripcion l_linea-tdline INTO descripcion
                        SEPARATED BY space.
          ENDIF.
        ENDIF.
      ENDLOOP.
      IF sy-subrc &lt;&gt; 0.
        descripcion = drat-dktxt.
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_DOCUMENTOS" VERSION="1" LANGU="S" DESCRIPT="Recupera los documentos fisicos" EXPOSURE="2" STATE="1" EDITORDER="4 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD get_documentos.
    DATA l_doc TYPE draz.

    CLEAR i_documentos.
    SELECT dappl filename FROM dms_doc_files
      INTO ( l_doc-dttrg, l_doc-filep )
      WHERE dokar = draw-dokar
        AND doknr = draw-doknr
        AND dokvr = draw-dokvr
        AND doktl = draw-doktl.
      APPEND l_doc TO i_documentos.
    ENDSELECT.
    IF sy-subrc &lt;&gt; 0.
      IF NOT draw-filep IS INITIAL.
        l_doc-filep = draw-filep.
        l_doc-dttrg = draw-dappl.
        APPEND l_doc TO i_documentos.
      ENDIF.

      IF NOT draw-filep1 IS INITIAL.
        l_doc-filep = draw-filep1.
        l_doc-dttrg = draw-dappl1.
        APPEND l_doc TO i_documentos.
      ENDIF.
    ENDIF.

    LOOP AT i_documentos INTO l_doc.
      SELECT SINGLE cvtext FROM tdwp
        INTO l_doc-frmtx
        WHERE dappl = l_doc-dttrg.
      MODIFY i_documentos FROM l_doc.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_DOC_DOCS" VERSION="1" LANGU="S" DESCRIPT="Recupera los documentos" EXPOSURE="2" STATE="1" EDITORDER="5 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD get_doc_docs.
* Documentos de modificacion
    SELECT * FROM drad
      INTO TABLE i_doc_docs
      WHERE dokar = draw-dokar
        AND doknr = draw-doknr
        AND dokvr = draw-dokvr
        AND doktl = draw-doktl
        AND dokob = &apos;DRAW&apos;.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_DRAD" VERSION="1" LANGU="S" DESCRIPT="Recupera versión tabla DRAD corregida" EXPOSURE="2" STATE="1" EDITORDER="20 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_DRAD" SCONAME="DRAD" VERSION="1" LANGU="S" DESCRIPT="Tipo tabla para DRAD" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DMS_TBL_DRAD" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_DRAD" SCONAME="DRAW" VERSION="1" LANGU="S" DESCRIPT="Registro info de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DRAW"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_DRAD" SCONAME="DRAD_OK" VERSION="1" LANGU="S" DESCRIPT="Tipo tabla para DRAD" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="DMS_TBL_DRAD"/>
  <source>METHOD get_drad.
    DATA: i_drad     TYPE TABLE OF drad,
          i_drad_db  TYPE TABLE OF drad,
          i_drad_old TYPE TABLE OF drad.

    FIELD-SYMBOLS &lt;drad&gt; TYPE drad.

    IF drad IS INITIAL.
*    CALL FUNCTION &apos;CV110_DOC_DATA_GET&apos;
*      EXPORTING
*        pf_read_drad = &apos;X&apos;
*      TABLES
*        ptx_drad     = i_drad.
    ELSE.
      i_drad = drad.
    ENDIF.

    CALL FUNCTION &apos;CV200_DB_DRAD_SELECT&apos;
      EXPORTING  pf_dokar  = draw-dokar
                 pf_doknr  = draw-doknr
                 pf_doktl  = draw-doktl
                 pf_dokvr  = draw-dokvr
      TABLES     ptx_drad  = i_drad_db
      EXCEPTIONS not_found = 1
                 OTHERS    = 2.

    i_drad_old = get_drad_old( ).

    LOOP AT i_drad ASSIGNING &lt;drad&gt;.
      READ TABLE i_drad_db TRANSPORTING NO FIELDS WITH KEY dokob = &lt;drad&gt;-dokob
                                                           obzae = &lt;drad&gt;-obzae
                                                           objky = &lt;drad&gt;-objky.
      IF sy-subrc = 0.
        DELETE i_drad_db INDEX sy-tabix.
      ENDIF.
      APPEND &lt;drad&gt; TO drad_ok.
    ENDLOOP.

    LOOP AT i_drad_db ASSIGNING &lt;drad&gt;.
      IF line_exists( i_drad_old[ dokob = &lt;drad&gt;-dokob
                                  obzae = &lt;drad&gt;-obzae
                                  objky = &lt;drad&gt;-objky ] ).
        &lt;drad&gt;-delflag = &apos;X&apos;.
      ENDIF.
      APPEND &lt;drad&gt; TO drad_ok.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_DRAD_OLD" VERSION="1" LANGU="S" DESCRIPT="Devuelve enlaces a documentos borrados" EXPOSURE="2" STATE="1" EDITORDER="19 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_DRAD_OLD" SCONAME="I_DRAD_OLD" VERSION="1" LANGU="S" DESCRIPT="Tipo tabla para DRAD" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="DMS_TBL_DRAD"/>
  <source>METHOD get_drad_old.
    TYPES: BEGIN OF intdrad.
             INCLUDE TYPE drad.        &quot; LOOP-Dynpro Verarbeitung
    TYPES    set_type           TYPE i.          &quot; CONTROL
    TYPES    set_text           TYPE c LENGTH 1. &quot; text
    TYPES    set_class          TYPE c LENGTH 1. &quot; class
    TYPES    set_auth           TYPE c LENGTH 4. &quot; auth
    TYPES    tab_mark           TYPE c LENGTH 1. &quot; marked line
    TYPES    set_enqueue_record TYPE c LENGTH 1. &quot; Note 941311
    TYPES: END OF intdrad,
           tt_intdrad TYPE TABLE OF intdrad.

    DATA: l_intdrad TYPE intdrad,
          l_drad    TYPE drad.

    FIELD-SYMBOLS &lt;i_drad&gt; TYPE table.

    ASSIGN (&apos;(SAPLCV110)GT_DRAD_OLD[]&apos;) TO &lt;i_drad&gt;.
    LOOP AT &lt;i_drad&gt; INTO l_intdrad.
      CLEAR l_drad.
      MOVE-CORRESPONDING l_intdrad TO l_drad.
      APPEND l_drad TO i_drad_old.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_FECHA_CAMBIO_VALOR_CARACT" VERSION="1" LANGU="S" DESCRIPT="Devuelve fecha en que característica obtuvo valor" EXPOSURE="2" STATE="1" EDITORDER="26 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_FECHA_CAMBIO_VALOR_CARACT" SCONAME="CARACT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_FECHA_CAMBIO_VALOR_CARACT" SCONAME="KLART" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_FECHA_CAMBIO_VALOR_CARACT" SCONAME="DRAW" VERSION="1" LANGU="S" DESCRIPT="Registro info de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DRAW" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_FECHA_CAMBIO_VALOR_CARACT" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_FECHA_CAMBIO_VALOR_CARACT" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_FECHA_CAMBIO_VALOR_CARACT" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_FECHA_CAMBIO_VALOR_CARACT" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_FECHA_CAMBIO_VALOR_CARACT" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;ATWRT&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_FECHA_CAMBIO_VALOR_CARACT" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_FECHA_CAMBIO_VALOR_CARACT" SCONAME="FECHA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="DATS"/>
  <source>METHOD get_fecha_cambio_valor_caract.
    &quot; TODO: parameter CAMPO is never used (ABAP cleaner)

    DATA: l_draw TYPE draw,
          l_inob TYPE inob.

    IF NOT draw IS INITIAL.
      l_draw = draw.
    ELSE.
      l_draw-dokar = dokar.
      l_draw-doknr = doknr.
      l_draw-dokvr = dokvr.
      l_draw-doktl = doktl.
    ENDIF.

    SELECT cuobj FROM inob
      INTO l_inob-cuobj
      UP TO 1 ROWS
      WHERE klart = klart
        AND objek = l_draw+3(33)
        AND obtab = &apos;DRAW&apos;
      ORDER BY PRIMARY KEY.
    ENDSELECT.
    IF sy-subrc = 0.
      fecha = zcl_ap_clasificacion=&gt;get_fecha_cambio_valor( objectid = l_inob-cuobj
                                                            caract   = caract
                                                            valor    = valor ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_FICHERO_DMS" VERSION="1" LANGU="S" DESCRIPT="Recupera ruta al fichero DMS" EXPOSURE="2" STATE="1" EDITORDER="15 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_FICHERO_DMS" SCONAME="DAPPL" VERSION="1" LANGU="S" DESCRIPT="Aplicación" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DAPPL" PARVALUE="&apos;ZWR&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_FICHERO_DMS" SCONAME="FICHERO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD get_fichero_dms.
    DATA: i_documents TYPE TABLE OF bapi_doc_files2,
          l_documento TYPE bapi_doc_files2.

    CLEAR fichero.

* Buscamos si tiene algún documento anexo en OpenText.
    i_documents[] = get_anexos_st( dokar    = draw-dokar
                                   doknr    = draw-doknr
                                   doktl    = draw-doktl
                                   dokvr    = draw-dokvr
                                   kpro_use = &apos;X&apos; ).

    LOOP AT i_documents INTO l_documento WHERE     wsapplication    = dappl
                                               AND storagecategory &lt;&gt; &apos;&apos;.
      fichero = l_documento-docfile.
      EXIT.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_KEY" VERSION="1" LANGU="S" DESCRIPT="Devuelve la clave" EXPOSURE="2" STATE="1" EDITORDER="24 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_KEY" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_KEY" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_KEY" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PARVALUE="&apos;000&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_KEY" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_KEY" SCONAME="DRAW" VERSION="1" LANGU="S" DESCRIPT="Registro info de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DRAW" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_KEY" SCONAME="KEY" VERSION="1" LANGU="S" DESCRIPT="SGD: Clave documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="DMS_DOC_KEY"/>
  <source>METHOD get_key.
    CLEAR key.
    IF NOT draw IS INITIAL.
      MOVE-CORRESPONDING draw TO key.
    ELSE.
      key-dokar = dokar.
      key-doknr = doknr.
      key-doktl = doktl.
      key-dokvr = dokvr.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_NUM_ADJ_GOS" VERSION="1" LANGU="S" DESCRIPT="Devuelve nº de adjuntos en GOS" EXPOSURE="2" STATE="1" EDITORDER="28 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_NUM_ADJ_GOS" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_NUM_ADJ_GOS" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_NUM_ADJ_GOS" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PARVALUE="&apos;000&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_NUM_ADJ_GOS" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_NUM_ADJ_GOS" SCONAME="DRAW" VERSION="1" LANGU="S" DESCRIPT="Registro info de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DRAW" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_NUM_ADJ_GOS" SCONAME="AR_OBJECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_NUM_ADJ_GOS" SCONAME="NUM_ADJ" VERSION="1" LANGU="S" DESCRIPT="Campo entero de longitud 3" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="INT4"/>
  <source>METHOD get_num_adj_gos.
    DATA l_key TYPE dms_doc_key.

    l_key = get_key( draw  = draw
                     dokar = dokar
                     doknr = doknr
                     doktl = doktl
                     dokvr = dokvr ).

    IF ar_object IS INITIAL.
      SELECT COUNT( * ) FROM toa01
        INTO num_adj
        WHERE sap_object = &apos;DRAW&apos;
          AND object_id  = l_key.
    ELSE.
      SELECT COUNT( * ) FROM toa01
        INTO num_adj
        WHERE sap_object = &apos;DRAW&apos;
          AND object_id  = l_key
          AND ar_object  = ar_object.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_REG_CARACT_VALOR" VERSION="1" LANGU="S" DESCRIPT="Recupera documentos que contienen un valor de caract" EXPOSURE="2" STATE="1" EDITORDER="14 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_REG_CARACT_VALOR" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_REG_CARACT_VALOR" SCONAME="CARACT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_REG_CARACT_VALOR" SCONAME="KLART" VERSION="1" LANGU="S" DESCRIPT="Categoría de la clase" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="AUSP-KLART" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_REG_CARACT_VALOR" SCONAME="VALOR" VERSION="1" LANGU="S" DESCRIPT="Valor de la característica" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_REG_CARACT_VALOR" SCONAME="I_DRAW" VERSION="1" LANGU="S" DESCRIPT="Registro info de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="DMS_TBL_DRAW"/>
  <source>METHOD get_reg_caract_valor.
    DATA: l_atinn TYPE atinn,
          l_objek TYPE ausp-objek,
          i_ausp  TYPE TABLE OF ausp,
          l_draw  TYPE draw,
          l_inob  TYPE inob.

    FIELD-SYMBOLS &lt;ausp&gt; TYPE ausp.

    CLEAR i_draw.
    l_atinn = zcl_ap_clasificacion=&gt;get_caract_interno( caract ).

    IF l_atinn IS INITIAL.
      RETURN.
    ENDIF.

    CONCATENATE dokar &apos;%&apos; INTO l_objek.

    IF klart IS INITIAL.
      SELECT klart objek FROM ausp                        &quot;#EC CI_NOFIRST
        INTO CORRESPONDING FIELDS OF TABLE i_ausp
        WHERE atinn = l_atinn
          AND mafid = &apos;O&apos;
          AND atwrt = valor.
    ELSE.
      SELECT klart objek FROM ausp                        &quot;#EC CI_NOFIRST
        INTO CORRESPONDING FIELDS OF TABLE i_ausp
        WHERE atinn = l_atinn
          AND mafid = &apos;O&apos;
          AND klart = klart
          AND atwrt = valor.
    ENDIF.

* lrr17/01/13 En función de la categoría de clase, guarda el objeto
* propietario del valor de la característica en AUSP o en INOB:
    LOOP AT i_ausp ASSIGNING &lt;ausp&gt;.
      IF &lt;ausp&gt;-klart = &apos;017&apos;.
        IF &lt;ausp&gt;-objek(3) = dokar.
          CLEAR l_draw.
          l_draw+3(33) = &lt;ausp&gt;-objek(33).
          APPEND l_draw TO i_draw.
        ENDIF.
      ELSEIF &lt;ausp&gt;-klart = &apos;Z17&apos;.
        SELECT SINGLE objek FROM inob
          INTO l_inob-objek
          WHERE cuobj    = &lt;ausp&gt;-objek
            AND klart    = &lt;ausp&gt;-klart
            AND objek LIKE l_objek.
        IF sy-subrc = 0.
          CLEAR l_draw.
          l_draw+3(33) = l_inob-objek(33).
          APPEND l_draw TO i_draw.
        ENDIF.
      ENDIF.
    ENDLOOP.

    SORT i_draw.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_SHORT_TEXT" VERSION="1" LANGU="S" DESCRIPT="Devuelve texto corto" EXPOSURE="2" STATE="1" EDITORDER="11 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_SHORT_TEXT" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_SHORT_TEXT" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_SHORT_TEXT" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PARVALUE="&apos;000&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_SHORT_TEXT" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_SHORT_TEXT" SCONAME="LANGU" VERSION="1" LANGU="S" DESCRIPT="Clave de idioma del entorno de texto actual" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-LANGU" PARVALUE="SY-LANGU"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_SHORT_TEXT" SCONAME="DKTXT" VERSION="1" LANGU="S" DESCRIPT="Descripción de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="DKTXT"/>
  <source>METHOD get_short_text.
    CLEAR dktxt.
    SELECT SINGLE dktxt FROM drat
      INTO dktxt
      WHERE dokar = dokar
        AND doknr = doknr
        AND dokvr = dokvr
        AND doktl = doktl
        AND langu = langu.
    IF sy-subrc = 0.
      RETURN.
    ENDIF.

    SELECT SINGLE dktxt FROM drat
      INTO dktxt
      WHERE dokar = dokar
        AND doknr = doknr
        AND dokvr = dokvr
        AND doktl = doktl.
    IF sy-subrc &lt;&gt; 0.
      SELECT dktxt FROM drat
        INTO dktxt
        UP TO 1 ROWS
        WHERE dokar = dokar
          AND doknr = doknr
          AND dokvr = dokvr
          AND langu = langu
        ORDER BY PRIMARY KEY.
      ENDSELECT.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_ULTIMO_STATUS_LOG" VERSION="1" LANGU="S" DESCRIPT="Devuelve el último estatus que ha tenido desde el log" EXPOSURE="2" STATE="1" EDITORDER="23 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ULTIMO_STATUS_LOG" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ULTIMO_STATUS_LOG" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ULTIMO_STATUS_LOG" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ULTIMO_STATUS_LOG" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ULTIMO_STATUS_LOG" SCONAME="DRAW" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DRAW" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ULTIMO_STATUS_LOG" SCONAME="DOKST" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_ULTIMO_STATUS_LOG" SCONAME="DRAP" VERSION="1" LANGU="S" DESCRIPT="Fichero log p.documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="DRAP"/>
  <source>METHOD get_ultimo_status_log.
    &quot; TODO: variable is assigned but never used (ABAP cleaner)
    DATA l_key TYPE dms_doc_key.

    l_key = get_key( draw  = draw
                     dokar = dokar
                     doknr = doknr
                     doktl = doktl
                     dokvr = dokvr ).

    CLEAR drap.
    SELECT * FROM drap
      INTO drap
      WHERE dokar = dokar
        AND doknr = doknr
        AND doktl = doktl
        AND dokvr = dokvr
        AND dokst = dokst.
    ENDSELECT.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT" VERSION="1" LANGU="S" DESCRIPT="Devuelve el valor de la característica" EXPOSURE="2" STATE="1" EDITORDER="16 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT" SCONAME="CARACT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT" SCONAME="KLART" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT" SCONAME="DRAW" VERSION="1" LANGU="S" DESCRIPT="Registro info de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DRAW" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT" SCONAME="VALOR_BUSCADO" VERSION="1" LANGU="S" DESCRIPT="Si informamos este campo, sólo devolvemos el valor que haya" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ATWRT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT" SCONAME="TIPO_FECHA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT" SCONAME="IMPORTE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT" SCONAME="ATWRT" VERSION="1" LANGU="S" DESCRIPT="Valor de la característica" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="AUSP-ATWRT"/>
  <source>METHOD get_valor_caract.
    DATA: l_ausp TYPE ausp,
          l_num  TYPE i.

    l_ausp = get_valor_caract_tabla( caract        = caract
                                     klart         = klart
                                     draw          = draw
                                     dokar         = dokar
                                     doknr         = doknr
                                     doktl         = doktl
                                     dokvr         = dokvr
                                     valor_buscado = valor_buscado ).
    IF importe = &apos;X&apos;.
      atwrt = l_ausp-atflv.
    ELSEIF tipo_fecha = &apos;X&apos;.
      l_num = l_ausp-atflv.
      IF l_num &lt;&gt; 0.
        atwrt = l_num.
        CONDENSE atwrt NO-GAPS.
      ENDIF.
    ELSE.
      atwrt = l_ausp-atwrt.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT_TABLA" VERSION="1" LANGU="S" DESCRIPT="Lee el valor de una caracteristica directamente en tabla" EXPOSURE="2" STATE="1" EDITORDER="13 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT_TABLA" SCONAME="CARACT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT_TABLA" SCONAME="KLART" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT_TABLA" SCONAME="DRAW" VERSION="1" LANGU="S" DESCRIPT="Registro info de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DRAW" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT_TABLA" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT_TABLA" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT_TABLA" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT_TABLA" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT_TABLA" SCONAME="VALOR_BUSCADO" VERSION="1" LANGU="S" DESCRIPT="Si informamos este campo, sólo devolvemos el valor que haya" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ATWRT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_VALOR_CARACT_TABLA" SCONAME="AUSP" VERSION="1" LANGU="S" DESCRIPT="Valores prop. de las características" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="AUSP"/>
  <source>METHOD get_valor_caract_tabla.
    DATA: l_draw  TYPE draw,
          &quot; TODO: variable is assigned but never used (ABAP cleaner)
          l_ausp  TYPE ausp,
          l_atinn TYPE atinn,
          l_inob  TYPE inob.

    IF NOT draw IS INITIAL.
      l_draw = draw.
    ELSE.
      l_draw-dokar = dokar.
      l_draw-doknr = doknr.
      l_draw-dokvr = dokvr.
      l_draw-doktl = doktl.
    ENDIF.

    CLEAR l_ausp.
    l_atinn = zcl_ap_clasificacion=&gt;get_caract_interno( caract ).
    SELECT SINGLE * FROM ausp
      INTO ausp
      WHERE objek = l_draw+3(33)
        AND mafid = &apos;O&apos;
        AND klart = klart
        AND atinn = l_atinn.
    IF sy-subrc = 0.
      RETURN.
    ENDIF.

    SELECT cuobj FROM inob
      INTO l_inob-cuobj
      UP TO 1 ROWS
      WHERE klart = klart
        AND objek = l_draw+3(33)
        AND obtab = &apos;DRAW&apos;
      ORDER BY PRIMARY KEY.
    ENDSELECT.
    IF sy-subrc = 0.
      IF valor_buscado IS INITIAL.
        SELECT * FROM ausp
          INTO ausp
          UP TO 1 ROWS
          WHERE objek = l_inob-cuobj
            AND mafid = &apos;O&apos;
            AND klart = klart
            AND atinn = l_atinn
          ORDER BY PRIMARY KEY.
        ENDSELECT.
      ELSE.
        SELECT * FROM ausp
          INTO ausp
          UP TO 1 ROWS
          WHERE objek = l_inob-cuobj
            AND mafid = &apos;O&apos;
            AND klart = klart
            AND atinn = l_atinn
            AND atwrt = valor_buscado
          ORDER BY PRIMARY KEY.
        ENDSELECT.
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ALINK" VERSION="1" LANGU="S" DESCRIPT="Recupera Binario ALINK" EXPOSURE="2" STATE="1" EDITORDER="30 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ALINK" SCONAME="DOC_ID" VERSION="1" LANGU="S" DESCRIPT="SAP ArchiveLink: ID del documento de archivo" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SAEARDOID"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ALINK" SCONAME="ARCHIVE" VERSION="1" LANGU="S" DESCRIPT="Identificación Repository contenidos" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SAEARCHIVI"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ALINK" SCONAME="VER" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ALINK" SCONAME="EXTENSION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;pdf&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ALINK" SCONAME="MESSAGE" VERSION="1" LANGU="S" DESCRIPT="Texto de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="BAPI_MSG"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ALINK" SCONAME="FILENAME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="TOAAT-FILENAME"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ALINK" SCONAME="XSTRING" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="XSTRING"/>
  <source>METHOD get_xstring_alink.
    DATA ex_length   TYPE int4.
    DATA ex_message  TYPE bapiret2.
    DATA ex_document TYPE STANDARD TABLE OF tbl1024.

    CLEAR: xstring,
           message.
    CALL FUNCTION &apos;ALINK_RFC_TABLE_GET&apos;
      EXPORTING im_docid    = doc_id
                im_crepid   = archive
*                IM_COMPID   = IM_COMPID
      IMPORTING ex_length   = ex_length
                ex_message  = ex_message
      TABLES    ex_document = ex_document.

    IF ex_document IS INITIAL.
      message = ex_message-message.
      RETURN.
    ENDIF.

    CALL FUNCTION &apos;SCMS_BINARY_TO_XSTRING&apos;
      EXPORTING  input_length = ex_length
*                 FIRST_LINE   = 0
*                 LAST_LINE    = 0
      IMPORTING  buffer       = xstring
      TABLES     binary_tab   = ex_document
      EXCEPTIONS failed       = 1
                 OTHERS       = 2.

    IF xstring IS INITIAL.
      message = &apos;Error convirtiendo binario&apos;.
      RETURN.
    ENDIF.
    SELECT SINGLE filename FROM toaat
      INTO filename
      WHERE arc_doc_id = doc_id.

    IF ver = &apos;X&apos;.
      DATA(l_filename) = filename.
      IF l_filename IS INITIAL.
        l_filename = &apos;documento.&apos; &amp;&amp; extension.
      ENDIF.

      zcl_ap_ficheros=&gt;visualizar( fichero = l_filename
                                   xstring = xstring ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ARCHIV" VERSION="1" LANGU="S" DESCRIPT="Recuper Binario buscando conexiones objeto" EXPOSURE="2" STATE="1" EDITORDER="32 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ARCHIV" SCONAME="SAP_OBJECT" VERSION="1" LANGU="S" DESCRIPT="SAP ArchiveLink: Tipo de objeto del business object" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TOAV0-SAP_OBJECT"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ARCHIV" SCONAME="OBJECT_ID" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ARCHIV" SCONAME="AR_OBJECT" VERSION="1" LANGU="S" DESCRIPT="Clase documentos" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TOAV0-AR_OBJECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ARCHIV" SCONAME="VER" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ARCHIV" SCONAME="MESSAGE" VERSION="1" LANGU="S" DESCRIPT="Texto de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="BAPI_MSG"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ARCHIV" SCONAME="FILENAME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="TOAAT-FILENAME"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ARCHIV" SCONAME="EXTENSION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="GET_XSTRING_ARCHIV" SCONAME="XSTRING" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="XSTRING"/>
  <source>METHOD get_xstring_archiv.
    DATA(i_conexiones) = get_conexiones_archiv( sap_object = sap_object
                                                object_id  = object_id
                                                ar_object  = ar_object ).

    IF i_conexiones IS INITIAL.
      message = &apos;No hay documentos&apos;.
      RETURN.
    ENDIF.

    SORT i_conexiones BY ar_date DESCENDING. &quot; Seleccionamos el más actual
    ASSIGN i_conexiones[ 1 ] TO FIELD-SYMBOL(&lt;conexion&gt;).

    extension = &lt;conexion&gt;-reserve.

    xstring = get_xstring_alink( EXPORTING doc_id    = &lt;conexion&gt;-arc_doc_id
                                           archive   = &lt;conexion&gt;-archiv_id
                                           extension = &lt;conexion&gt;-reserve
                                 IMPORTING message   = message
                                           filename  = filename ).

    IF filename IS INITIAL.
      SELECT SINGLE objecttext FROM toasp
        INTO filename
        WHERE ar_object = &lt;conexion&gt;-ar_object
          AND language  = sy-langu.
      IF sy-subrc = 0.
        filename = filename &amp;&amp; &apos;.&apos; &amp;&amp; extension.
      ELSE.
        filename = &apos;documento&apos; &amp;&amp; &apos;.&apos; &amp;&amp; extension.
      ENDIF.
    ENDIF.

    IF ver = &apos;X&apos; AND NOT xstring IS INITIAL.
      zcl_ap_ficheros=&gt;visualizar( fichero = filename
                                   xstring = xstring ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="HA_CONTENIDO_STATUS" VERSION="1" LANGU="S" DESCRIPT="¿Ha contenido el status?" EXPOSURE="2" STATE="1" EDITORDER="25 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="HA_CONTENIDO_STATUS" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="HA_CONTENIDO_STATUS" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="HA_CONTENIDO_STATUS" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="HA_CONTENIDO_STATUS" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="HA_CONTENIDO_STATUS" SCONAME="DRAW" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DRAW" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="HA_CONTENIDO_STATUS" SCONAME="DOKST" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="HA_CONTENIDO_STATUS" SCONAME="SI" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="ABAP_BOOL"/>
  <source>METHOD ha_contenido_status.
    DATA: l_key  TYPE dms_doc_key,
          &quot; TODO: variable is assigned but never used (ABAP cleaner)
          l_drap TYPE drap.

    l_key = get_key( draw  = draw
                     dokar = dokar
                     doknr = doknr
                     doktl = doktl
                     dokvr = dokvr ).

    CLEAR si.
    SELECT SINGLE dokar FROM drap
      INTO l_drap-dokar
      WHERE dokar = l_key-dokar
        AND doknr = l_key-doknr
        AND doktl = l_key-doktl
        AND dokvr = l_key-dokvr
        AND dokst = dokst.
    IF sy-subrc = 0.
      si = &apos;X&apos;.
    ELSE.
      SELECT SINGLE dokar FROM draw
        INTO l_drap-dokar
        WHERE dokar = l_key-dokar
          AND doknr = l_key-doknr
          AND doktl = l_key-doktl
          AND dokvr = l_key-dokvr
          AND dokst = dokst.
      IF sy-subrc = 0.
        si = &apos;X&apos;.
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="SET_STATUS" VERSION="1" LANGU="S" DESCRIPT="Set status" EXPOSURE="2" STATE="1" EDITORDER="18 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="SET_STATUS" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="SET_STATUS" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="SET_STATUS" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PARVALUE="&apos;000&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="SET_STATUS" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PARVALUE="&apos;00&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="SET_STATUS" SCONAME="STATUS" VERSION="1" LANGU="S" DESCRIPT="Status del documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKST"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="SET_STATUS" SCONAME="COMMIT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="SET_STATUS" SCONAME="RETURN" VERSION="1" LANGU="S" DESCRIPT="Parámetro de retorno" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="BAPIRET2"/>
  <source>METHOD set_status.
    CALL FUNCTION &apos;BAPI_DOCUMENT_SETSTATUS&apos;
      EXPORTING documenttype    = dokar
                documentnumber  = doknr
                documentpart    = doktl
                documentversion = dokvr
*                STATUSEXTERN    = &apos; &apos;
                statusintern    = status
*                STATUSLOG       = &apos; &apos;
      IMPORTING return          = return.

    IF commit = &apos;X&apos;.
      zcl_ap_dev=&gt;commit( ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_GD" CMPNAME="VISUALIZAR" VERSION="1" LANGU="S" DESCRIPT="Visualizar" EXPOSURE="2" STATE="1" EDITORDER="7 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="VISUALIZAR" SCONAME="DOKNR" VERSION="1" LANGU="S" DESCRIPT="Número de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKNR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="VISUALIZAR" SCONAME="DOKAR" VERSION="1" LANGU="S" DESCRIPT="Clase de documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKAR"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="VISUALIZAR" SCONAME="DOKTL" VERSION="1" LANGU="S" DESCRIPT="Documento parcial" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKTL_D" PARVALUE="&apos;000&apos;"/>
  <parameter CLSNAME="ZCL_AP_GD" CMPNAME="VISUALIZAR" SCONAME="DOKVR" VERSION="1" LANGU="S" DESCRIPT="Versión documento" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DOKVR" PARVALUE="&apos;00&apos;"/>
  <source>METHOD visualizar.
    SET PARAMETER ID &apos;CV1&apos; FIELD doknr.
    SET PARAMETER ID &apos;CV2&apos; FIELD dokar.
    SET PARAMETER ID &apos;CV3&apos; FIELD dokvr.
    SET PARAMETER ID &apos;CV4&apos; FIELD doktl.
    CALL TRANSACTION &apos;CV03N&apos; AND SKIP FIRST SCREEN.        &quot;#EC CI_CALLTA
  ENDMETHOD.</source>
 </method>
</CLAS>

<?xml version="1.0" encoding="utf-8"?>
<CLAS CLSNAME="ZCL_AP_ALV_GRID" VERSION="1" LANGU="S" DESCRIPT="ALV Grid" CATEGORY="00" EXPOSURE="2" STATE="1" RELEASE="0" CLSCCINCL="X" FIXPT="X" UNICODE="X" CLSBCCAT="00" DURATION_TYPE="0 " RISK_LEVEL="0 ">
 <types CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="T_CAMPOS_DESC" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="1 " TYPTYPE="4" SRCROW1="5 " SRCCOLUMN1="6 " SRCROW2="15 " SRCCOLUMN2="25 " TYPESRC_LENG="359 " TYPESRC="BEGIN OF t_campos_desc,
        campo       TYPE string,
        dominio     TYPE string,
        caract      TYPE string,
        tabla       TYPE string,
        where       TYPE string,
        campo_desc  TYPE string,
        campo_clave TYPE string,
        valores     TYPE string,
        add_clave   TYPE string,
      END OF t_campos_desc
"/>
 <types CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="TT_CAMPOS_DESC" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="2 " TYPTYPE="4" SRCROW1="16 " SRCCOLUMN1="10 " SRCROW2="16 " SRCCOLUMN2="51 " TYPESRC_LENG="44 " TYPESRC="tt_campos_desc TYPE TABLE OF t_campos_desc
"/>
 <types CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="T_ALLOWED_BUT" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="3 " TYPTYPE="4" SRCROW1="18 " SRCCOLUMN1="6 " SRCROW2="20 " SRCCOLUMN2="25 " TYPESRC_LENG="86 " TYPESRC="BEGIN OF t_allowed_but,
        function TYPE sy-ucomm,
      END OF t_allowed_but
"/>
 <types CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="TT_EXCLUDED_BUT" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="4 " TYPTYPE="4" SRCROW1="21 " SRCCOLUMN1="10 " SRCROW2="21 " SRCCOLUMN2="56 " TYPESRC_LENG="49 " TYPESRC="tt_excluded_but TYPE STANDARD TABLE OF sy-ucomm
"/>
 <types CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="TT_ALLOWED_BUT" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="5 " TYPTYPE="4" SRCROW1="22 " SRCCOLUMN1="10 " SRCROW2="22 " SRCCOLUMN2="61 " TYPESRC_LENG="54 " TYPESRC="tt_allowed_but  TYPE STANDARD TABLE OF t_allowed_but
"/>
 <types CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="T_BOTON" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="1 " TYPTYPE="4" SRCROW1="7 " SRCCOLUMN1="11 " SRCROW2="11 " SRCCOLUMN2="24 " TYPESRC_LENG="158 " TYPESRC="BEGIN OF t_boton,
             boton TYPE c LENGTH 10.
             INCLUDE TYPE smp_dyntxt.
    TYPES:   ucomm TYPE sy-ucomm,
           END OF t_boton
"/>
 <types CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="T_BOTONES" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="2 " TYPTYPE="4" SRCROW1="12 " SRCCOLUMN1="10 " SRCROW2="12 " SRCCOLUMN2="40 " TYPESRC_LENG="33 " TYPESRC="t_botones TYPE TABLE OF t_boton
"/>
 <types CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="T_BUTTONS" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="3 " TYPTYPE="4" SRCROW1="13 " SRCCOLUMN1="10 " SRCROW2="59 " SRCCOLUMN2="21 " TYPESRC_LENG="1395 " TYPESRC="BEGIN OF t_buttons,
        f01 TYPE rsfunc_txt,
        f02 TYPE rsfunc_txt,
        f03 TYPE rsfunc_txt,
        f04 TYPE rsfunc_txt,
        f05 TYPE rsfunc_txt,
        f06 TYPE rsfunc_txt,
        f07 TYPE rsfunc_txt,
        f08 TYPE rsfunc_txt,
        f09 TYPE rsfunc_txt,
        f10 TYPE rsfunc_txt,
        f11 TYPE rsfunc_txt,
        f12 TYPE rsfunc_txt,
        f13 TYPE rsfunc_txt,
        f14 TYPE rsfunc_txt,
        f15 TYPE rsfunc_txt,
        f16 TYPE rsfunc_txt,
        f17 TYPE rsfunc_txt,
        f18 TYPE rsfunc_txt,
        f19 TYPE rsfunc_txt,
        f20 TYPE rsfunc_txt,
        f21 TYPE rsfunc_txt,
        f22 TYPE rsfunc_txt,
        f23 TYPE rsfunc_txt,
        f24 TYPE rsfunc_txt,
        f25 TYPE rsfunc_txt,
        f26 TYPE rsfunc_txt,
        f27 TYPE rsfunc_txt,
        f28 TYPE rsfunc_txt,
        f29 TYPE rsfunc_txt,
        f30 TYPE rsfunc_txt,
        f31 TYPE rsfunc_txt,
        f32 TYPE rsfunc_txt,
        f33 TYPE rsfunc_txt,
        f34 TYPE rsfunc_txt,
        f35 TYPE rsfunc_txt,
        m01 TYPE rsfunc_txt,
        m02 TYPE rsfunc_txt,
        m03 TYPE rsfunc_txt,
        m04 TYPE rsfunc_txt,
        m05 TYPE rsfunc_txt,
        m06 TYPE rsfunc_txt,
        m07 TYPE rsfunc_txt,
        m08 TYPE rsfunc_txt,
        m09 TYPE rsfunc_txt,
        m10 TYPE rsfunc_txt,
      END OF t_buttons
"/>
 <friends CLSNAME="ZCL_AP_ALV_GRID" REFCLSNAME="CL_GUI_ALV_GRID" FRIENDTYPE="0" VERSION="1" STATE="1"/>
 <localImplementation>*&quot;* local class implementation for public class
*&quot;* use this source file for the implementation part of
*&quot;* local helper classes

CLASS lcl_alv_private DEFINITION
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_alv_rm_grid_friend .

    METHODS constructor
      IMPORTING
        !io_grid TYPE REF TO cl_gui_alv_grid .
    METHODS create_ex_result
      RETURNING
        VALUE(rv_results) TYPE REF TO cl_salv_ex_result_data_table .

  PROTECTED SECTION.
  PRIVATE SECTION.

    DATA grid TYPE REF TO cl_gui_alv_grid .

ENDCLASS.


CLASS lcl_alv_private IMPLEMENTATION.

  METHOD constructor.
    grid = io_grid.
  ENDMETHOD.

  METHOD create_ex_result.
    DATA: tab      TYPE abap_parmbind,
          ptab     TYPE abap_parmbind_tab,
          o_result TYPE REF TO cl_salv_ex_result_data_table.


    tab-name  = &apos;ER_RESULT_TABLE&apos;.
    tab-kind  = cl_abap_objectdescr=&gt;returning.
    tab-value = REF #( o_result ).
    INSERT tab INTO TABLE ptab.

    TRY.
        CALL METHOD me-&gt;grid-&gt;(&apos;CREATE_EX_RESULT&apos;) PARAMETER-TABLE ptab.
        READ TABLE ptab INTO tab WITH KEY name = &apos;ER_RESULT_TABLE&apos;.
        IF sy-subrc = 0.
          rv_results = o_result.
        ENDIF.
        IF rv_results IS INITIAL.
          MESSAGE &apos;Error convirtiendo los datos a XLSX&apos; TYPE &apos;E&apos;.
        ENDIF.
      CATCH cx_root.
        MESSAGE &apos;No es posible convertir los datos a XLSX&apos; TYPE &apos;E&apos;.
    ENDTRY.

*    rv_results =  me-&gt;grid=-&gt;create_ex_result( ).
  ENDMETHOD.

ENDCLASS.</localImplementation>
 <localTypes>*&quot;* use this source file for any type declarations (class
*&quot;* definitions, interfaces or data types) you need for method
*&quot;* implementation or private method&apos;s signature</localTypes>
 <localMacros>*&quot;* use this source file for any macro definitions you need
*&quot;* in the implementation part of the class</localMacros>
 <textPool>
  <language SPRAS="S">
   <textElement ID="I" KEY="C10" ENTRY="Sólo es posible mostrar 10 columnas" LENGTH="70 "/>
   <textElement ID="I" KEY="CAM" ENTRY="Campo" LENGTH="15 "/>
   <textElement ID="I" KEY="ERL" ENTRY="Error recuperando layout" LENGTH="48 "/>
   <textElement ID="I" KEY="NEX" ENTRY="no existe" LENGTH="19 "/>
   <textElement ID="I" KEY="NOD" ENTRY="no definida" LENGTH="21 "/>
   <textElement ID="I" KEY="NOE" ENTRY="no existe" LENGTH="19 "/>
   <textElement ID="I" KEY="NRC" ENTRY="No se han recuperado campos" LENGTH="54 "/>
   <textElement ID="I" KEY="NTI" ENTRY="No se ha podido identificar campos de tabla interna" LENGTH="102 "/>
   <textElement ID="I" KEY="SAF" ENTRY="Seleccione alguna fila" LENGTH="22 "/>
   <textElement ID="I" KEY="SFO" ENTRY="Error en SET_FIELD OP=" LENGTH="44 "/>
   <textElement ID="I" KEY="TAB" ENTRY="La tabla" LENGTH="18 "/>
  </language>
 </textPool>
 <typeUsage CLSNAME="ZCL_AP_ALV_GRID" TYPEGROUP="ABAP" VERSION="1" TPUTYPE="0" IMPLICIT="X"/>
 <forwardDeclaration>ABAP</forwardDeclaration>
 <typeClasDef CLSNAME="ZCL_AP_ALV_GRID" TYPEGROUP="ZCL_AP_ALV" VERSION="1" TPUTYPE="1" IMPLICIT="X"/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ALLOWED_BUTTONS" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="20 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="TT_ALLOWED_BUT" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="BUTTONS" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="32 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="T_BUTTONS" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="BUTTONS_V0" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="37 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="T_BUTTONS" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMPO" VERSION="1" LANGU="S" DESCRIPT="Nombre campo" EXPOSURE="2" STATE="1" EDITORDER="31 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="FIELDNAME" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMPO_CHECK" VERSION="1" LANGU="S" DESCRIPT="&apos;CHECK&apos;" EXPOSURE="2" STATE="1" EDITORDER="39 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMPO_COLOR" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="21 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CONSISTENCY_CHECK" VERSION="1" LANGU="S" DESCRIPT="Indicador de una posición" EXPOSURE="0" STATE="1" EDITORDER="5 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="CHAR1" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CONTENEDOR" VERSION="1" LANGU="S" DESCRIPT="Contenedor" EXPOSURE="0" STATE="1" EDITORDER="6 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="SCRFNAME" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CPROG" VERSION="1" LANGU="S" DESCRIPT="Programa de llamada" EXPOSURE="2" STATE="1" EDITORDER="22 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="SY-CPROG" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="C_COLOR_AMARILLO" VERSION="1" LANGU="S" DESCRIPT="Color Amarillo" EXPOSURE="2" STATE="1" EDITORDER="12 " ATTDECLTYP="2" ATTVALUE="3" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="C_COLOR_AMARILLO_OSC" VERSION="1" LANGU="S" DESCRIPT="Color Amarillo Oscuro (ERROR)" EXPOSURE="2" STATE="1" EDITORDER="26 " ATTDECLTYP="2" ATTVALUE="4" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="C_COLOR_AZUL" VERSION="1" LANGU="S" DESCRIPT="Color Azul" EXPOSURE="2" STATE="1" EDITORDER="13 " ATTDECLTYP="2" ATTVALUE="1" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="C_COLOR_AZUL_OSC" VERSION="1" LANGU="S" DESCRIPT="Color Azul Oscuro" EXPOSURE="2" STATE="1" EDITORDER="17 " ATTDECLTYP="2" ATTVALUE="4" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="C_COLOR_BLANCO" VERSION="1" LANGU="S" DESCRIPT="Color blanco" EXPOSURE="2" STATE="1" EDITORDER="27 " ATTDECLTYP="2" ATTVALUE="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="C_COLOR_GRIS" VERSION="1" LANGU="S" DESCRIPT="Color Gris" EXPOSURE="2" STATE="1" EDITORDER="16 " ATTDECLTYP="2" ATTVALUE="2" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="C_COLOR_NARANJA" VERSION="1" LANGU="S" DESCRIPT="Color Naranja" EXPOSURE="2" STATE="1" EDITORDER="14 " ATTDECLTYP="2" ATTVALUE="7" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="C_COLOR_ROJO" VERSION="1" LANGU="S" DESCRIPT="Color Rojo" EXPOSURE="2" STATE="1" EDITORDER="11 " ATTDECLTYP="2" ATTVALUE="6" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="C_COLOR_VERDE" VERSION="1" LANGU="S" DESCRIPT="Color Azul claro" EXPOSURE="2" STATE="1" EDITORDER="15 " ATTDECLTYP="2" ATTVALUE="5" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="C_SEM_AMBAR" VERSION="1" LANGU="S" DESCRIPT="Semáforo ambar" EXPOSURE="2" STATE="1" EDITORDER="10 " ATTDECLTYP="2" ATTVALUE="2" ATTEXPVIRT="0" TYPTYPE="1" TYPE="NUM1" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="C_SEM_ROJO" VERSION="1" LANGU="S" DESCRIPT="Semáforo  rojo" EXPOSURE="2" STATE="1" EDITORDER="9 " ATTDECLTYP="2" ATTVALUE="1" ATTEXPVIRT="0" TYPTYPE="1" TYPE="NUM1" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="C_SEM_VERDE" VERSION="1" LANGU="S" DESCRIPT="Semáforo verde" EXPOSURE="2" STATE="1" EDITORDER="8 " ATTDECLTYP="2" ATTVALUE="3" ATTEXPVIRT="0" TYPTYPE="1" TYPE="NUM1" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="DEFAULT_LAYOUT" VERSION="1" LANGU="S" DESCRIPT="Permite iniciar con layout por defecto" EXPOSURE="0" STATE="1" EDITORDER="17 " ATTDECLTYP="0" ATTVALUE="&apos;X&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ABAP_BOOL" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ESTRUCTURA" VERSION="1" LANGU="S" DESCRIPT="Nombre de tabla" EXPOSURE="0" STATE="1" EDITORDER="7 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="DD02L-TABNAME" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="EXCLUDED_BUTTONS" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="19 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="TT_EXCLUDED_BUT" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="FILA" VERSION="1" LANGU="S" DESCRIPT="Asignación de núm.línea a ID línea" EXPOSURE="2" STATE="1" EDITORDER="7 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="LVC_S_ROW" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GS_F4" VERSION="1" LANGU="S" DESCRIPT="Control LVA: Inscripción campos F4" EXPOSURE="0" STATE="1" EDITORDER="12 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="LVC_S_F4" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GT_F4" VERSION="1" LANGU="S" DESCRIPT="Control LVA: Tabla de campos registrados p.tratamiento F4" EXPOSURE="0" STATE="1" EDITORDER="13 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="LVC_T_F4" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="HYPE" VERSION="1" LANGU="S" DESCRIPT="Control LVA: Hiperenlaces" EXPOSURE="0" STATE="1" EDITORDER="2 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="LVC_T_HYPE" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="INICIO" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="25 " ATTDECLTYP="0" ATTVALUE="&apos;&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ABAP_BOOL" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="INPUT" VERSION="1" LANGU="S" DESCRIPT="Input" EXPOSURE="0" STATE="1" EDITORDER="8 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="CHAR1" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="I_BOTONES" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="33 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="T_BOTONES" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="I_BOTONES_V0" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="38 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="T_BOTONES" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="I_CAMPOS_DESC" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="18 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="TT_CAMPOS_DESC" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="I_COLUMNAS" VERSION="1" LANGU="S" DESCRIPT="Tipo tabla ZAP_ALV_COLUMNAS3" EXPOSURE="2" STATE="1" EDITORDER="29 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ZAP_ALV_COLUMNAS_T" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="I_COLUMNAS3" VERSION="1" LANGU="S" DESCRIPT="Tipo tabla ZAP_ALV_COLUMNAS3" EXPOSURE="2" STATE="1" EDITORDER="19 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ZAP_ALV_COLUMNAS3_T" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="I_FCAT_INI" VERSION="1" LANGU="S" DESCRIPT="Catálogo campos p.ListViewerControl" EXPOSURE="2" STATE="1" EDITORDER="28 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="LVC_T_FCAT" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="I_FILAS_SEL" VERSION="1" LANGU="S" DESCRIPT="Control LVA: Entradas en tabla" EXPOSURE="2" STATE="1" EDITORDER="6 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="LVC_T_ROW" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="I_FILAS_SEL2" VERSION="1" LANGU="S" DESCRIPT="Asignación de núm.línea a ID línea" EXPOSURE="0" STATE="1" EDITORDER="11 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="LVC_T_ROID" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="I_FILTER" VERSION="1" LANGU="S" DESCRIPT="Control LVA: Estructura de filtro" EXPOSURE="2" STATE="1" EDITORDER="23 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="LVC_T_FILT" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="I_HOTSPOT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="34 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ZCL_AP_ALV=&gt;TT_HOTSPOT" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="KEY_LAYOUT" VERSION="1" LANGU="S" DESCRIPT="Layout clave" EXPOSURE="2" STATE="1" EDITORDER="18 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="SALV_S_LAYOUT_KEY" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="LAYOUT" VERSION="1" LANGU="S" DESCRIPT="Control LVA: Estructura de disposición" EXPOSURE="2" STATE="1" EDITORDER="3 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="LVC_S_LAYO" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="MAX_COLS" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="30 " ATTDECLTYP="0" ATTVALUE="10" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="NOMBRE_TABLA" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="21 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="OPT_COLS" VERSION="1" LANGU="S" DESCRIPT="Optimizar columnas" EXPOSURE="0" STATE="1" EDITORDER="15 " ATTDECLTYP="0" ATTVALUE="&apos;X&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ABAP_BOOL" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="O_ALV_HELPER" VERSION="1" LANGU="S" DESCRIPT="ALV" EXPOSURE="2" STATE="1" EDITORDER="35 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="3" TYPE="ZCL_AP_ALV" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="O_CUSTOM_CONTAINER" VERSION="1" LANGU="S" DESCRIPT="Container for Custom Controls in the Screen Area" EXPOSURE="2" STATE="1" EDITORDER="5 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="3" TYPE="CL_GUI_CUSTOM_CONTAINER" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="O_DRAGDROP" VERSION="1" LANGU="S" DESCRIPT="Behavior for Drag and Drop" EXPOSURE="2" STATE="1" EDITORDER="20 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="3" TYPE="CL_DRAGDROP" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="O_EVENT" VERSION="1" LANGU="S" DESCRIPT="Eventos tratamiento ALV GRID" EXPOSURE="0" STATE="1" EDITORDER="9 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="3" TYPE="ZCL_AP_ALV_GRID_EVENTOS" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="O_GRID" VERSION="1" LANGU="S" DESCRIPT="ALV List Viewer" EXPOSURE="2" STATE="1" EDITORDER="1 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="3" TYPE="CL_GUI_ALV_GRID" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="PRNT" VERSION="1" LANGU="S" DESCRIPT="Parámetros impresión para LVC" EXPOSURE="0" STATE="1" EDITORDER="1 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="LVC_S_PRNT" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="RESTRICCION_LAYOUT" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="14 " ATTDECLTYP="0" ATTVALUE="&apos;A&apos;" ATTEXPVIRT="0" TYPTYPE="4" SRCROW1="37 " SRCCOLUMN1="9 " SRCROW2="37 " SRCCOLUMN2="42 " TYPESRC_LENG="36 " TYPESRC="restriccion_layout TYPE c LENGTH 1
"/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SIN_BUFFER" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="24 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ABAP_BOOL" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="TABLE_REF" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="36 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="3" TYPE="DATA" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="T_DROPDOWN" VERSION="1" LANGU="S" DESCRIPT="Control LVA: Listas desplegables" EXPOSURE="0" STATE="1" EDITORDER="10 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="LVC_T_DROP" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="T_FCAT" VERSION="1" LANGU="S" DESCRIPT="Catálogo campos p.ListViewerControl" EXPOSURE="2" STATE="1" EDITORDER="2 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="LVC_T_FCAT" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="T_SORT" VERSION="1" LANGU="S" DESCRIPT="Control LVA: Tabla de criterios de clasificación" EXPOSURE="0" STATE="1" EDITORDER="4 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="LVC_T_SORT" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="T_TOOL" VERSION="1" LANGU="S" DESCRIPT="Tabla de teclas de función" EXPOSURE="0" STATE="1" EDITORDER="3 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="UI_FUNCTIONS" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="VARIANT" VERSION="1" LANGU="S" DESCRIPT="Variante visual.(uso externo)" EXPOSURE="2" STATE="1" EDITORDER="4 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="DISVARIANT" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="V_USAR_DRAGDROP" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="16 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="ABAP_BOOL" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ACTUALIZA_CAMPOS_GRID" VERSION="1" LANGU="S" DESCRIPT="Actualiza visualización algunos campos del grid" EXPOSURE="2" STATE="1" EDITORDER="42 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ACTUALIZA_CAMPOS_GRID" SCONAME="CAMPOS_BORRAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="0" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ACTUALIZA_CAMPOS_GRID" SCONAME="REFRESCAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ACTUALIZA_CAMPOS_GRID" SCONAME="GET_FCAT_INICIAL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ACTUALIZA_CAMPOS_GRID" SCONAME="I_COLUMNAS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ZAP_ALV_COLUMNAS_T" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ACTUALIZA_CAMPOS_GRID" SCONAME="CAMPOS_INPUT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ACTUALIZA_CAMPOS_GRID" SCONAME="CAMPOS_NO_OUT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ACTUALIZA_CAMPOS_GRID" SCONAME="FIX_COL_NOOUT_92" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ACTUALIZA_CAMPOS_GRID" SCONAME="CAMPOS_NO_INPUT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ACTUALIZA_CAMPOS_GRID" SCONAME="SOFT_REFRESH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ACTUALIZA_CAMPOS_GRID" SCONAME="CAMPOS_OPT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ACTUALIZA_CAMPOS_GRID" SCONAME="CAMPOS_OUT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ACTUALIZA_CAMPOS_GRID" SCONAME="CAMPOS_NO_OPT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="12 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <source>METHOD actualiza_campos_grid.
    DATA: i_fcat   TYPE lvc_t_fcat,
          i_campos TYPE TABLE OF string,
          l_campo  TYPE string.

    FIELD-SYMBOLS: &lt;col&gt;  TYPE zap_alv_columnas,
                   &lt;fcat&gt; TYPE lvc_s_fcat.

    IF get_fcat_inicial = &apos;X&apos;.
      i_fcat = get_fcat_inicial( ).
    ELSE.
      o_grid-&gt;get_frontend_fieldcatalog( IMPORTING et_fieldcatalog = i_fcat ).
    ENDIF.

    IF NOT campos_borrar IS INITIAL.
      SPLIT campos_borrar AT &apos;,&apos; INTO TABLE i_campos.
      LOOP AT i_campos INTO l_campo.
        CONDENSE l_campo NO-GAPS.
        l_campo = to_upper( l_campo ).
        DELETE i_fcat WHERE fieldname = l_campo.
      ENDLOOP.
    ENDIF.
    IF NOT i_columnas IS INITIAL.
      LOOP AT i_columnas ASSIGNING &lt;col&gt; WHERE borrar = &apos;X&apos;.
        DELETE i_fcat WHERE fieldname = &lt;col&gt;-campo.
      ENDLOOP.
    ENDIF.

    IF NOT campos_input IS INITIAL.
      SPLIT campos_input AT &apos;,&apos; INTO TABLE i_campos.
      LOOP AT i_campos INTO l_campo.
        CONDENSE l_campo NO-GAPS.
        l_campo = to_upper( l_campo ).
        ASSIGN i_fcat[ fieldname = l_campo ] TO &lt;fcat&gt;.
        IF sy-subrc = 0.
          &lt;fcat&gt;-edit = &apos;X&apos;.
        ENDIF.
      ENDLOOP.
    ENDIF.

    IF NOT campos_no_input IS INITIAL.
      SPLIT campos_no_input AT &apos;,&apos; INTO TABLE i_campos.
      LOOP AT i_campos INTO l_campo.
        CONDENSE l_campo NO-GAPS.
        l_campo = to_upper( l_campo ).
        ASSIGN i_fcat[ fieldname = l_campo ] TO &lt;fcat&gt;.
        IF sy-subrc = 0.
          &lt;fcat&gt;-edit = &apos;&apos;.
        ENDIF.
      ENDLOOP.
    ENDIF.

    IF NOT campos_no_out IS INITIAL.
      SPLIT campos_no_out AT &apos;,&apos; INTO TABLE i_campos.
      LOOP AT i_campos INTO l_campo.
        CONDENSE l_campo NO-GAPS.
        l_campo = to_upper( l_campo ).
        ASSIGN i_fcat[ fieldname = l_campo ] TO &lt;fcat&gt;.
        IF sy-subrc = 0.
          &lt;fcat&gt;-no_out = &apos;X&apos;.
        ENDIF.
      ENDLOOP.
    ENDIF.

    IF NOT campos_out IS INITIAL.
      SPLIT campos_out AT &apos;,&apos; INTO TABLE i_campos.
      LOOP AT i_campos INTO l_campo.
        CONDENSE l_campo NO-GAPS.
        l_campo = to_upper( l_campo ).
        ASSIGN i_fcat[ fieldname = l_campo ] TO &lt;fcat&gt;.
        IF sy-subrc = 0.
          CLEAR &lt;fcat&gt;-no_out.
        ENDIF.
      ENDLOOP.
    ENDIF.

    IF fix_col_noout_92 = &apos;X&apos;.
      LOOP AT i_fcat ASSIGNING &lt;fcat&gt; WHERE     col_pos &gt; &apos;92&apos;
                                            AND no_out  = &apos;X&apos;.
        IF i_columnas IS INITIAL.
          CLEAR &lt;fcat&gt;-no_out.
        ELSE.
          ASSIGN i_columnas[ campo = &lt;fcat&gt;-fieldname ] TO &lt;col&gt;.
          IF sy-subrc = 0.
            IF &lt;col&gt;-noout = &apos;&apos;.
              CLEAR &lt;fcat&gt;-no_out.
            ENDIF.
          ENDIF.
        ENDIF.
      ENDLOOP.
    ENDIF.

    IF NOT campos_opt IS INITIAL.
      SPLIT campos_opt AT &apos;,&apos; INTO TABLE i_campos.
      LOOP AT i_campos INTO l_campo.
        CONDENSE l_campo NO-GAPS.
        l_campo = to_upper( l_campo ).
        ASSIGN i_fcat[ fieldname = l_campo ] TO &lt;fcat&gt;.
        IF sy-subrc = 0.
          &lt;fcat&gt;-col_opt = &apos;X&apos;.
        ENDIF.
      ENDLOOP.
    ELSEIF NOT campos_no_opt IS INITIAL.
      LOOP AT i_fcat ASSIGNING &lt;fcat&gt;.
        &lt;fcat&gt;-col_opt = &apos;X&apos;.
      ENDLOOP.

      SPLIT campos_no_opt AT &apos;,&apos; INTO TABLE i_campos.
      LOOP AT i_campos INTO l_campo.
        CONDENSE l_campo NO-GAPS.
        l_campo = to_upper( l_campo ).
        ASSIGN i_fcat[ fieldname = l_campo ] TO &lt;fcat&gt;.
        IF sy-subrc = 0.
          &lt;fcat&gt;-col_opt = &apos;&apos;.
        ENDIF.
      ENDLOOP.
    ENDIF.

    o_grid-&gt;set_frontend_fieldcatalog( it_fieldcatalog = i_fcat ).

    IF refrescar = &apos;X&apos;.
      refrescar_grid( soft_refresh = soft_refresh ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ADD_BUTTON" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="52 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ADD_BUTTON" SCONAME="BUTTON" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-UCOMM"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ADD_BUTTON" SCONAME="TEXT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SMP_DYNTXT-TEXT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ADD_BUTTON" SCONAME="ICON" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SMP_DYNTXT-ICON_ID" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ADD_BUTTON" SCONAME="QINFO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SMP_DYNTXT-QUICKINFO" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ADD_BUTTON" SCONAME="ALLOWED" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="ABAP_TRUE"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ADD_BUTTON" SCONAME="FORZAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ADD_BUTTON" SCONAME="UCOMM" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-UCOMM" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ADD_BUTTON" SCONAME="BORRAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ADD_BUTTON" SCONAME="STATUS2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <source>METHOD add_button.
    DATA: but     TYPE smp_dyntxt,
          l_boton TYPE t_boton.

    FIELD-SYMBOLS &lt;bt&gt; TYPE any.

    CHECK button IS NOT INITIAL.

    IF text IS INITIAL AND icon IS INITIAL AND borrar IS INITIAL.
      RETURN.
    ENDIF.

    IF borrar IS INITIAL.
      but-icon_id   = icon.
      but-icon_text = text.
      but-text      = text.
      but-quickinfo = qinfo.
    ELSE.
      CLEAR but.
    ENDIF.

    MOVE-CORRESPONDING but TO l_boton.
    DELETE i_botones WHERE boton = button.

    l_boton-boton = button.
    l_boton-ucomm = ucomm.
    APPEND l_boton TO i_botones.

    ASSIGN COMPONENT button OF STRUCTURE buttons TO &lt;bt&gt;.
    IF &lt;bt&gt; IS ASSIGNED.
      IF &lt;bt&gt; IS INITIAL OR forzar = &apos;X&apos; OR borrar = &apos;X&apos;.
        &lt;bt&gt; = but.
        IF status2 = &apos;X&apos;.
          PERFORM set_boton IN PROGRAM zap_status2 USING buttons.
        ELSE.
          PERFORM set_boton IN PROGRAM zap_status USING buttons.
        ENDIF.
        IF allowed = abap_true.
          show_button( button = button ).
        ENDIF.
*      ELSE.
*        RAISE button_already_filled.
      ENDIF.
    ELSE.
*      RAISE button_does_not_exists.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ADD_FILTRO" VERSION="1" LANGU="S" DESCRIPT="Añade filtro" EXPOSURE="2" STATE="1" EDITORDER="37 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ADD_FILTRO" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ADD_FILTRO" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ADD_FILTRO" SCONAME="SIGN" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;I&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="ADD_FILTRO" SCONAME="OPTION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;EQ&apos;"/>
  <source>METHOD add_filtro.
    DATA l_filter TYPE lvc_s_filt.

    l_filter-fieldname = campo.
    l_filter-low       = valor.
    l_filter-sign      = sign.
    l_filter-option    = option.
    APPEND l_filter TO i_filter.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_COLOR" VERSION="1" LANGU="S" DESCRIPT="Append tabla color" EXPOSURE="2" STATE="1" EDITORDER="18 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_COLOR" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_COLOR" SCONAME="COLOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="INT4" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_COLOR" SCONAME="COLORC" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_COLOR" SCONAME="INT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="INT1" PARVALUE="0"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_COLOR" SCONAME="INV" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="INT4" PARVALUE="0"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_COLOR" SCONAME="SOLO_SI_NO_COLOR_PREVIO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_COLOR" SCONAME="TABLA_COLOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="LVC_T_SCOL"/>
  <source>METHOD append_color.
    DATA: ls_color TYPE lvc_s_scol,
          i_column TYPE TABLE OF lvc_fname,
          l_column TYPE lvc_fname.

    IF campo IS INITIAL.
      IF solo_si_no_color_previo = &apos;X&apos;.
        IF line_exists( tabla_color[ fname = campo ] ).
          RETURN.
        ENDIF.
      ENDIF.
      DELETE tabla_color WHERE fname = campo.
      CLEAR ls_color.
      ls_color-fname = campo.
      ls_color-color-int = int.
      ls_color-color-inv = inv.
      IF NOT color IS INITIAL.
        ls_color-color-col = color.
      ELSEIF colorc(1) = &apos;C&apos; AND strlen( colorc ) = 4.
        ls_color-color-col = colorc+1(1).
        ls_color-color-int = colorc+2(1).
        ls_color-color-inv = colorc+3(1).
      ELSE.
        ls_color-color-col = traduce_color( colorc ).
      ENDIF.
      APPEND ls_color TO tabla_color.
    ELSE.
      SPLIT campo AT &apos;,&apos; INTO TABLE i_column.
      LOOP AT i_column INTO l_column.
        TRANSLATE l_column TO UPPER CASE.
        IF solo_si_no_color_previo = &apos;X&apos;.
          IF line_exists( tabla_color[ fname = l_column ] ).
            CONTINUE.
          ENDIF.
        ENDIF.
        DELETE tabla_color WHERE fname = l_column.
        CLEAR ls_color.
        ls_color-fname = l_column.
        ls_color-color-int = int.
        ls_color-color-inv = inv.
        IF NOT color IS INITIAL.
          ls_color-color-col = color.
        ELSEIF colorc(1) = &apos;C&apos; AND strlen( colorc ) = 4.
          ls_color-color-col = colorc+1(1).
          ls_color-color-int = colorc+2(1).
          ls_color-color-inv = colorc+3(1).
        ELSE.
          ls_color-color-col = traduce_color( colorc ).
        ENDIF.
        APPEND ls_color TO tabla_color.
      ENDLOOP.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_STYLE" VERSION="1" LANGU="S" DESCRIPT="Append tabla STYLE" EXPOSURE="2" STATE="1" EDITORDER="27 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_STYLE" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_STYLE" SCONAME="STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="LVC_STYLE"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_STYLE" SCONAME="TABLA_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="LVC_T_STYL"/>
  <source>METHOD append_style.
    DATA: ls_style TYPE lvc_s_styl,
          i_column TYPE TABLE OF lvc_fname,
          l_column TYPE lvc_fname.

    IF campo IS INITIAL.
      CLEAR ls_style.
      ls_style-fieldname = campo.
      ls_style-style     = style.
      INSERT ls_style INTO TABLE tabla_style.
    ELSE.
      SPLIT campo AT &apos;,&apos; INTO TABLE i_column.
      SORT i_column.
      LOOP AT i_column INTO l_column.
        TRANSLATE l_column TO UPPER CASE.
        DELETE tabla_style WHERE fieldname = l_column.

        CLEAR ls_style.
        ls_style-fieldname = l_column.
        ls_style-style     = style.
        INSERT ls_style INTO TABLE tabla_style.
      ENDLOOP.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_STYLE_EDIT" VERSION="1" LANGU="S" DESCRIPT="Append tabla STYLE No edicion" EXPOSURE="2" STATE="1" EDITORDER="35 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_STYLE_EDIT" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_STYLE_EDIT" SCONAME="TABLA_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="LVC_T_STYL"/>
  <source>METHOD append_style_edit.
    append_style( EXPORTING campo       = campo
                            style       = cl_gui_alv_grid=&gt;mc_style_enabled
                  CHANGING  tabla_style = tabla_style ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_STYLE_NO_EDIT" VERSION="1" LANGU="S" DESCRIPT="Append tabla STYLE No edicion" EXPOSURE="2" STATE="1" EDITORDER="28 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_STYLE_NO_EDIT" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="APPEND_STYLE_NO_EDIT" SCONAME="TABLA_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="LVC_T_STYL"/>
  <source>METHOD append_style_no_edit.
    append_style( EXPORTING campo       = campo
                            style       = cl_gui_alv_grid=&gt;mc_style_disabled
                  CHANGING  tabla_style = tabla_style ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="BARRA_BOTONES_MINIMA_EDIT" VERSION="1" LANGU="S" DESCRIPT="Deja barra de botones mínima" EXPOSURE="2" STATE="1" EDITORDER="10 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD barra_botones_minima_edit.
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_data_save ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_variant_admin ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_copy ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_cut ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_paste ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_paste_new_row ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_undo ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_info ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_average ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_refresh ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_graph ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_check ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_view_crystal ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_view_excel ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_view_lotus ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_url_copy_to_clipboard ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_expcrdata ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_expcrdesig ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_expcrtempl ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_call_report ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_maintain_variant ).
*FPG04/05/2011 - Se muestra el botón de filtro.
* quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_filter  ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_subtot  ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_mb_export  ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMBIAR_VARIANT" VERSION="1" LANGU="S" DESCRIPT="Cambia el tipo de layouts que puede seleccionar el grid" EXPOSURE="2" STATE="1" EDITORDER="43 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMBIAR_VARIANT" SCONAME="HANDLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SLIS_HANDL" PARVALUE="&apos;?&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMBIAR_VARIANT" SCONAME="VARIANT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SLIS_VARI" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMBIAR_VARIANT" SCONAME="GET_DEFAULT_VARIANT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMBIAR_VARIANT" SCONAME="GET_FCAT_INICIAL_SI_NO_VARIANT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <source>METHOD cambiar_variant.
    DATA: lv_user_specific TYPE c LENGTH 1,
          lt_fieldcat      TYPE lvc_t_fcat,
          lt_sort          TYPE lvc_t_sort,
          lt_filter        TYPE lvc_t_filt,
          ls_stable        TYPE lvc_s_stbl.

    IF handle &lt;&gt; &apos;?&apos;.
      me-&gt;variant-handle = handle.
    ENDIF.

    IF NOT variant IS INITIAL.
      me-&gt;variant-variant = variant.
    ENDIF.

    IF get_default_variant = &apos;X&apos;.
      key_layout-report = me-&gt;variant-report.
      key_layout-handle = me-&gt;variant-handle.
      me-&gt;variant-variant = get_default_layout( ).

      IF me-&gt;variant-variant &lt;&gt; &apos;&apos;.
        IF me-&gt;variant-variant(1) &lt;&gt; &apos;/&apos;.
          me-&gt;variant-username = sy-uname.
          lv_user_specific = &apos;X&apos;.
        ENDIF.
      ENDIF.
    ENDIF.

    IF me-&gt;variant-variant IS INITIAL.
      IF NOT i_fcat_ini IS INITIAL AND get_fcat_inicial_si_no_variant = &apos;X&apos;.
        lt_fieldcat = i_fcat_ini.
      ENDIF.
    ENDIF.

    IF lt_fieldcat IS INITIAL.
      o_grid-&gt;get_frontend_fieldcatalog( IMPORTING et_fieldcatalog = lt_fieldcat ).
    ENDIF.

    IF NOT me-&gt;variant-variant IS INITIAL.
      CALL FUNCTION &apos;LVC_VARIANT_SELECT&apos;
        EXPORTING  i_dialog            = space
                   i_user_specific     = lv_user_specific
                   it_default_fieldcat = lt_fieldcat
        IMPORTING  et_fieldcat         = lt_fieldcat
                   et_sort             = lt_sort
                   et_filter           = lt_filter
        CHANGING   cs_variant          = me-&gt;variant
        EXCEPTIONS wrong_input         = 1
                   fc_not_complete     = 2
                   not_found           = 3
                   program_error       = 4
                   data_missing        = 5
                   OTHERS              = 6.
      IF sy-subrc &lt;&gt; 0.
        MESSAGE &apos;Error recuperando layout&apos;(erl) TYPE &apos;S&apos;.
      ENDIF.

    ENDIF.

    o_grid-&gt;set_variant( me-&gt;variant ).
    o_grid-&gt;set_frontend_fieldcatalog( lt_fieldcat ).
    o_grid-&gt;set_filter_criteria( lt_filter ).
    o_grid-&gt;set_sort_criteria( lt_sort ).
    ls_stable = &apos;XX&apos;.
    o_grid-&gt;refresh_table_display( is_stable      = ls_stable
                                   i_soft_refresh = space ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMBIA_ATRIBUTO_COLUMNA" VERSION="1" LANGU="S" DESCRIPT="Cambia atributo columna" EXPOSURE="2" STATE="1" EDITORDER="56 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMBIA_ATRIBUTO_COLUMNA" SCONAME="REFRESCAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMBIA_ATRIBUTO_COLUMNA" SCONAME="GET_FCAT_INICIAL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMBIA_ATRIBUTO_COLUMNA" SCONAME="I_COLUMNAS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ZAP_ALV_COLUMNAS_T" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMBIA_ATRIBUTO_COLUMNA" SCONAME="CAMPOS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMBIA_ATRIBUTO_COLUMNA" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMBIA_ATRIBUTO_COLUMNA" SCONAME="ATRIBUTO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMBIA_ATRIBUTO_COLUMNA" SCONAME="SOFT_REFRESH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <source>METHOD cambia_atributo_columna.
    DATA: i_fcat   TYPE lvc_t_fcat,
          i_campos TYPE TABLE OF string,
          l_campo  TYPE string,
          l_atrib  TYPE string.

    &quot; TODO: variable is assigned but never used (ABAP cleaner)
    FIELD-SYMBOLS: &lt;fcat&gt; TYPE lvc_s_fcat,
                   &lt;fs&gt;   TYPE any.

    IF get_fcat_inicial = &apos;X&apos;.
      i_fcat = get_fcat_inicial( ).
    ELSE.
      o_grid-&gt;get_frontend_fieldcatalog( IMPORTING et_fieldcatalog = i_fcat ).
    ENDIF.

    IF NOT campos IS INITIAL.
      SPLIT campos AT &apos;,&apos; INTO TABLE i_campos.
      LOOP AT i_campos INTO l_campo.
        CONDENSE l_campo NO-GAPS.
        l_campo = to_upper( l_campo ).
        ASSIGN i_fcat[ fieldname = l_campo ] TO &lt;fcat&gt;.
        IF sy-subrc = 0.
          CONCATENATE &apos;&lt;FCAT&gt;-&apos; atributo INTO l_atrib.
          ASSIGN (l_atrib) TO &lt;fs&gt;.
          IF sy-subrc = 0.
            &lt;fs&gt; = valor.
          ENDIF.
        ENDIF.
      ENDLOOP.
    ENDIF.

    o_grid-&gt;set_frontend_fieldcatalog( it_fieldcatalog = i_fcat ).

    IF refrescar = &apos;X&apos;.
      refrescar_grid( soft_refresh = soft_refresh ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMBIA_LAYOUT" VERSION="1" LANGU="S" DESCRIPT="Cambia valor layout" EXPOSURE="2" STATE="1" EDITORDER="55 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMBIA_LAYOUT" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CAMBIA_LAYOUT" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <source>METHOD cambia_layout.
    DATA : e_layo  TYPE lvc_s_layo,
           l_campo TYPE string.

    FIELD-SYMBOLS &lt;fs&gt; TYPE any.

    o_grid-&gt;get_frontend_layout( IMPORTING es_layout = e_layo ).

    CONCATENATE &apos;E_LAYO-&apos; campo INTO l_campo.
    ASSIGN (l_campo) TO &lt;fs&gt;.
    IF sy-subrc = 0.
      IF &lt;fs&gt; &lt;&gt; valor.
        &lt;fs&gt; = valor.
        o_grid-&gt;set_frontend_layout( is_layout = e_layo ).
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="COMPLETAR_COLUMNAS" VERSION="1" LANGU="S" DESCRIPT="Completar columnas" EXPOSURE="2" STATE="1" EDITORDER="45 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="COMPLETAR_COLUMNAS" SCONAME="MAX_COLS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="10"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="COMPLETAR_COLUMNAS" SCONAME="MOSTRAR_AVISO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="COMPLETAR_COLUMNAS" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="COMPLETAR_COLUMNAS" SCONAME="BORRAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="COMPLETAR_COLUMNAS" SCONAME="I_COLUMNAS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="ZAP_ALV_COLUMNAS_T"/>
  <source>METHOD completar_columnas.
    DATA: l_lineas TYPE i,
          l_cont   TYPE i,
          l_col    TYPE zap_alv_columnas.

    l_lineas = lines( i_columnas ).
    IF l_lineas &gt; max_cols.
      IF mostrar_aviso = &apos;X&apos;.
        MESSAGE &apos;Solo es posible mostrar 10 columnas&apos;(c10) TYPE &apos;I&apos;.
      ENDIF.

      DELETE i_columnas FROM max_cols.
    ELSE.
      l_cont = l_lineas + 1.
      WHILE l_cont &lt;= max_cols.
        CLEAR l_col.
        l_col-colum = l_cont.
        CONCATENATE campo l_col-colum INTO l_col-campo.
        l_col-noout  = &apos;X&apos;.
        l_col-borrar = borrar.
        APPEND l_col TO i_columnas.
        l_cont = l_cont + 1.
      ENDWHILE.
    ENDIF.

    me-&gt;max_cols = max_cols.
    me-&gt;campo    = campo.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="COMPROBAR_CAMBIOS" VERSION="1" LANGU="S" DESCRIPT="Comprueba cambios en el GRID" EXPOSURE="2" STATE="1" EDITORDER="6 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="COMPROBAR_CAMBIOS" SCONAME="FORZAR_VALIDACIONES" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;" PARPREFERD="X"/>
  <source>METHOD comprobar_cambios.
    &quot; TODO: variable is assigned but never used (ABAP cleaner)
    DATA l_valid TYPE c LENGTH 1.

    CHECK o_grid IS BOUND.

* http://scn.sap.com/community/abap/blog/2013/08/13/trigger-alv-datachange-event-manual?campaigncode=CRM-XM13-SOC-TW_SCNB
    IF forzar_validaciones = &apos;X&apos;.
      o_grid-&gt;activate_display_protocol( i_dialog = &apos;X&apos; ).

      o_grid-&gt;if_cached_prop~set_prop( propname = &apos;GridModified&apos; propvalue = &apos;1&apos; ).
    ENDIF.

    o_grid-&gt;check_changed_data( IMPORTING e_valid = l_valid ).

    IF forzar_validaciones = &apos;X&apos;.
      o_grid-&gt;activate_display_protocol( i_dialog = &apos;&apos; ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CONSTRUCTOR" VERSION="1" LANGU="S" DESCRIPT="CONSTRUCTOR" EXPOSURE="2" STATE="1" EDITORDER="1 " DISPID="0 " MTDTYPE="2" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CONSTRUCTOR" SCONAME="OBJ_CONTENEDOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SCRFNAME" PARVALUE="&apos;GRID&apos;" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CONSTRUCTOR" SCONAME="ESTRUCTURA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="DD02L-TABNAME" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CONSTRUCTOR" SCONAME="O_EVENT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="3" TYPE="ZCL_AP_ALV_GRID_EVENTOS" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CONSTRUCTOR" SCONAME="RESTRICCION_LAYOUT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="C" PARVALUE="&apos;A&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CONSTRUCTOR" SCONAME="O_CONTAINER" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="3" TYPE="CL_GUI_CONTAINER" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CONSTRUCTOR" SCONAME="DEFAULT_LAYOUT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="C" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CONSTRUCTOR" SCONAME="NOMBRE_TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;I_LISTADO&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CONSTRUCTOR" SCONAME="CPROG" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-CPROG" PARVALUE="SY-CPROG"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CONSTRUCTOR" SCONAME="SIN_BUFFER" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CONSTRUCTOR" SCONAME="NOMBRE_LAYOUT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CONSTRUCTOR" SCONAME="HANDLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="11 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SLIS_HANDL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CONSTRUCTOR" SCONAME="DRAGDROP" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="12 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <source>METHOD constructor.
*  IF cl_gui_alv_grid=&gt;offline( ) = 1.
*    MESSAGE &apos;No es posible crear el ALV GRID&apos; TYPE &apos;W&apos;.
*    EXIT.
*  ENDIF.

    DATA l_event TYPE cntl_simple_event.

* Si no se había creado el objeto...
    IF o_custom_container IS NOT INITIAL.
      RETURN.
    ENDIF.

* Creamos el objeto y lo asignamos al dynpro
    IF o_container IS INITIAL.
      o_custom_container = NEW #( container_name = obj_contenedor ).

      o_grid = NEW #( i_parent = o_custom_container ).
    ELSE.
      o_grid = NEW #( i_parent = o_container ).
    ENDIF.

    IF o_event IS SUPPLIED AND NOT o_event IS INITIAL.
      o_event-&gt;o_alv = me.
      me-&gt;o_event = o_event.
      IF o_event-&gt;v_double_click IS INITIAL.
        SET HANDLER o_event-&gt;double_click FOR o_grid.
      ENDIF.
      IF o_event-&gt;v_data_changed IS INITIAL.
        SET HANDLER o_event-&gt;data_changed FOR o_grid.
      ENDIF.
      IF o_event-&gt;v_data_changed_finished IS INITIAL.
        SET HANDLER o_event-&gt;data_changed_finished FOR o_grid.
      ENDIF.
      IF o_event-&gt;v_user_command IS INITIAL.
        SET HANDLER o_event-&gt;user_command FOR o_grid.
      ENDIF.
      IF o_event-&gt;v_after_refresh IS INITIAL.
        SET HANDLER o_event-&gt;after_refresh FOR o_grid.
      ENDIF.
      IF o_event-&gt;v_print_top_of_page IS INITIAL.
        SET HANDLER o_event-&gt;print_top_of_page FOR o_grid.
      ENDIF.
      IF o_event-&gt;v_top_of_page IS INITIAL.
        SET HANDLER o_event-&gt;top_of_page FOR o_grid.
      ENDIF.
      IF o_event-&gt;v_toolbar IS INITIAL.
        SET HANDLER o_event-&gt;toolbar FOR o_grid.
      ENDIF.
      IF o_event-&gt;v_onf4 IS INITIAL.
        SET HANDLER o_event-&gt;onf4 FOR o_grid.
      ENDIF.
      IF o_event-&gt;v_button_click IS INITIAL.
        SET HANDLER o_event-&gt;button_click FOR o_grid.
      ENDIF.
      IF o_event-&gt;v_hotspot_click IS INITIAL.
        SET HANDLER o_event-&gt;hotspot_click FOR o_grid.
      ENDIF.
      IF o_event-&gt;v_ondrag IS INITIAL.
        v_usar_dragdrop = dragdrop.
        SET HANDLER o_event-&gt;ondrag FOR o_grid.
      ENDIF.
      IF o_event-&gt;v_ondrop IS INITIAL.
        v_usar_dragdrop = dragdrop.
        SET HANDLER o_event-&gt;ondrop FOR o_grid.
      ENDIF.
      IF o_event-&gt;v_after_user_command IS INITIAL.
        SET HANDLER o_event-&gt;after_user_command FOR o_grid.
      ENDIF.
      IF o_event-&gt;v_delayed_changed_sel IS INITIAL.
        l_event-eventid = cl_gui_alv_grid=&gt;mc_evt_delayed_change_select.
        o_grid-&gt;register_delayed_event( EXPORTING  i_event_id = l_event-eventid
                                        EXCEPTIONS OTHERS     = 1 ).

        SET HANDLER o_event-&gt;delayed_changed_sel_callback FOR o_grid.
      ENDIF.
    ENDIF.

    fijar_layout_inicial( ).

    me-&gt;nombre_tabla       = nombre_tabla.
    me-&gt;cprog              = cprog.
    me-&gt;estructura         = estructura.
    me-&gt;restriccion_layout = restriccion_layout.
    me-&gt;default_layout     = default_layout.
    me-&gt;sin_buffer         = sin_buffer.
    IF NOT estructura IS INITIAL.
      get_catalogo_campos( ).
    ENDIF.

    IF nombre_layout = &apos;¡No!&apos;.
      CONCATENATE sy-cprog(30) &apos;-&apos; estructura INTO variant-report.
    ELSEIF nombre_layout IS INITIAL.
      IF estructura IS INITIAL.
        CONCATENATE sy-cprog(30) &apos;-&apos; nombre_tabla INTO variant-report.
      ELSE.
        CONCATENATE sy-cprog(30) &apos;-&apos; estructura INTO variant-report.
      ENDIF.
    ELSE.
      variant-report = nombre_layout.
    ENDIF.

    key_layout-report = variant-report.
    variant-handle = handle.
    key_layout-handle = handle.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CORREGUIR_VARIANTES" VERSION="1" LANGU="S" DESCRIPT="Corrige las variantes de aquellos para no considerar c.no mo" EXPOSURE="2" STATE="1" EDITORDER="31 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CORREGUIR_VARIANTES" SCONAME="I_COLUMNAS3" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ZAP_ALV_COLUMNAS3_T" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CORREGUIR_VARIANTES" SCONAME="I_COLUMNAS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ZAP_ALV_COLUMNAS_T" PAROPTIONL="X"/>
  <source>METHOD correguir_variantes.
    DATA: l_report      TYPE salv_s_layout_key-report,
          i_ltdx        TYPE TABLE OF ltdx,
          rs_varkey     TYPE ltdxkey,
          rt_dbfieldcat TYPE TABLE OF ltdxdata.

    FIELD-SYMBOLS: &lt;ltdx&gt;  TYPE ltdx,
                   &lt;col&gt;   TYPE zap_alv_columnas,
                   &lt;campo&gt; TYPE ltdxdata,
                   &lt;col3&gt;  TYPE zap_alv_columnas3.

    l_report = key_layout-report.
    SELECT relid report handle log_group username variant type FROM ltdx
      INTO CORRESPONDING FIELDS OF TABLE i_ltdx
     WHERE relid  = &apos;LT&apos;
       AND report = l_report
       AND type   = &apos;F&apos;.

    SORT i_ltdx.
    DELETE ADJACENT DUPLICATES FROM i_ltdx.

    LOOP AT i_ltdx ASSIGNING &lt;ltdx&gt;.
      MOVE-CORRESPONDING &lt;ltdx&gt; TO rs_varkey.

      IMPORT lt_dbfieldcat TO rt_dbfieldcat
             FROM DATABASE ltdx(lt)
             CLIENT sy-mandt
             ID rs_varkey.

      LOOP AT i_columnas ASSIGNING &lt;col&gt; WHERE no_variante = &apos;X&apos;.
        LOOP AT rt_dbfieldcat ASSIGNING &lt;campo&gt; WHERE     key1  = &lt;col&gt;-campo
                                                      AND param = &apos;NO_OUT&apos;.
          IF &lt;campo&gt;-value &lt;&gt; &lt;col&gt;-noout.
            sin_buffer = &apos;X&apos;.
          ENDIF.
          &lt;campo&gt;-value = &lt;col&gt;-noout.
        ENDLOOP.

        LOOP AT rt_dbfieldcat ASSIGNING &lt;campo&gt; WHERE     key1  = &lt;col&gt;-campo
                                                      AND param = &apos;TECH&apos;.
          IF &lt;campo&gt;-value &lt;&gt; &lt;col&gt;-borrar.
            sin_buffer = &apos;X&apos;.
          ENDIF.
          &lt;campo&gt;-value = &lt;col&gt;-borrar.
        ENDLOOP.
      ENDLOOP.

      LOOP AT i_columnas3 ASSIGNING &lt;col3&gt; WHERE no_variante = &apos;X&apos;.
        LOOP AT rt_dbfieldcat ASSIGNING &lt;campo&gt; WHERE     key1  = &lt;col3&gt;-campo
                                                      AND param = &apos;NO_OUT&apos;.
          IF &lt;campo&gt;-value &lt;&gt; &lt;col3&gt;-noout.
            sin_buffer = &apos;X&apos;.
          ENDIF.

          &lt;campo&gt;-value = &lt;col3&gt;-noout.
        ENDLOOP.

        LOOP AT rt_dbfieldcat ASSIGNING &lt;campo&gt; WHERE     key1  = &lt;col3&gt;-campo
                                                      AND param = &apos;TECH&apos;.
          IF &lt;campo&gt;-value &lt;&gt; &lt;col3&gt;-borrar.
            sin_buffer = &apos;X&apos;.
          ENDIF.

          &lt;campo&gt;-value = &lt;col3&gt;-borrar.
        ENDLOOP.
      ENDLOOP.

      EXPORT lt_dbfieldcat FROM rt_dbfieldcat
             TO DATABASE ltdx(lt)
             ID rs_varkey.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CREATE_EX_RESULT" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="2 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="CREATE_EX_RESULT" SCONAME="ER_RESULT_TABLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="3" TYPE="CL_SALV_EX_RESULT_DATA_TABLE"/>
  <source>METHOD create_ex_result.
    DATA o_grid_p TYPE REF TO lcl_alv_private.

    o_grid_p = NEW #( io_grid = o_grid ).

    er_result_table = o_grid_p-&gt;create_ex_result( ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="EXPORTAR_EXCEL" VERSION="1" LANGU="S" DESCRIPT="Exportar Excel" EXPOSURE="2" STATE="1" EDITORDER="21 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="EXPORTAR_EXCEL" SCONAME="FICHERO_SALIDA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="EXPORTAR_EXCEL" SCONAME="CERRAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="EXPORTAR_EXCEL" SCONAME="AUTOFILTRO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="EXPORTAR_EXCEL" SCONAME="T_TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE" PAROPTIONL="X"/>
  <source>METHOD exportar_excel.
    DATA: o_excel      TYPE REF TO zcl_ap_excel_ole,
          l_titulo     TYPE scrtext_l,
          i_titulos    TYPE TABLE OF scrtext_l,
          l_tabla      TYPE string,
          l_error      TYPE string,
          i_campos     TYPE abap_component_tab,
          i_campos_sel TYPE abap_component_tab.

    FIELD-SYMBOLS: &lt;fcat&gt;   TYPE lvc_s_fcat,
                   &lt;campos&gt; TYPE abap_componentdescr.

    FIELD-SYMBOLS &lt;tabla&gt; TYPE table.

    o_grid-&gt;get_frontend_fieldcatalog( IMPORTING et_fieldcatalog = t_fcat ).

    o_excel = NEW #( visible = 0 ).

    o_excel-&gt;crear_documento( ).

    LOOP AT t_fcat ASSIGNING &lt;fcat&gt;.
      IF &lt;fcat&gt;-no_out = &apos;X&apos;.
        l_titulo = &apos;#INVISIBLE#&apos;.
      ELSE.
        l_titulo = &lt;fcat&gt;-scrtext_l.
        IF l_titulo IS INITIAL.
          l_titulo = &lt;fcat&gt;-fieldname.
        ENDIF.
      ENDIF.
      APPEND l_titulo TO i_titulos.
    ENDLOOP.

    IF t_tabla IS INITIAL.
      CONCATENATE &apos;(&apos; cprog &apos;)&apos; nombre_tabla &apos;[]&apos; INTO l_tabla.
      ASSIGN (l_tabla) TO &lt;tabla&gt;.
      IF sy-subrc &lt;&gt; 0.
        CONCATENATE &apos;(&apos; cprog &apos;)O_PROG-&gt;&apos; nombre_tabla &apos;[]&apos; INTO l_tabla.
        ASSIGN (l_tabla) TO &lt;tabla&gt;.
      ENDIF.
      IF &lt;tabla&gt; IS NOT ASSIGNED.
        CONCATENATE &apos;La tabla&apos;(tab) l_tabla &apos;no existe&apos;(nex)
                    INTO l_error SEPARATED BY space.
        MESSAGE l_error TYPE &apos;I&apos;
                DISPLAY LIKE &apos;E&apos;.
      ELSE.
        IF NOT &lt;tabla&gt; IS INITIAL.

          IF NOT t_fcat IS INITIAL.
            i_campos = zcl_ap_dev=&gt;get_fieldcatalog( &lt;tabla&gt; ).

            LOOP AT t_fcat ASSIGNING &lt;fcat&gt;.
              ASSIGN i_campos[ name = &lt;fcat&gt;-fieldname ] TO &lt;campos&gt;.
              IF sy-subrc = 0.
                APPEND &lt;campos&gt; TO i_campos_sel.
              ENDIF.
            ENDLOOP.
          ENDIF.

          o_excel-&gt;pegar_tabla( cabecera     = &apos;X&apos;
                                i_tabla      = &lt;tabla&gt;
                                autofiltro   = autofiltro
                                i_titulos    = i_titulos
                                i_columnas3  = i_columnas3
                                i_campos_sel = i_campos_sel
                                replacement  = 32  ).
        ENDIF.
      ENDIF.
    ELSE.
      o_excel-&gt;pegar_tabla( cabecera = &apos;X&apos; i_tabla = t_tabla autofiltro = autofiltro i_titulos = i_titulos i_columnas3 = i_columnas3 replacement = 32 ).
    ENDIF.

    IF NOT fichero_salida IS INITIAL.
      o_excel-&gt;grabar_documento( fichero = fichero_salida
                                 cerrar  = cerrar ).
    ENDIF.

    IF cerrar IS INITIAL.
      o_excel-&gt;fijar_visible( ).
    ENDIF.

    o_excel-&gt;free( ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="EXPORTAR_XLSX" VERSION="1" LANGU="S" DESCRIPT="Exportar contenido a XLSX" EXPOSURE="2" STATE="1" EDITORDER="60 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="EXPORTAR_XLSX" SCONAME="FICHERO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="EXPORTAR_XLSX" SCONAME="DIALOGO_GRABAR_FICHERO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="EXPORTAR_XLSX" SCONAME="ABRIR_EXCEL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="EXPORTAR_XLSX" SCONAME="DIR_TEMP" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="EXPORTAR_XLSX" SCONAME="XSTRING" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="XSTRING"/>
  <source>METHOD exportar_xlsx.
    DATA result_data     TYPE REF TO cl_salv_ex_result_data_table.
    DATA version         TYPE string.
    DATA salv_intf_descr TYPE REF TO cl_abap_objectdescr.
    DATA file_type       TYPE salv_bs_constant.
    DATA: l_dir     TYPE string,
          l_fichero TYPE string,
          l_mensaje TYPE bapi_msg.

    IF    cl_salv_bs_a_xml_base=&gt;get_version( ) = if_salv_bs_xml=&gt;version_25
       OR cl_salv_bs_a_xml_base=&gt;get_version( ) = if_salv_bs_xml=&gt;version_26.

      result_data = create_ex_result( ).

      CASE cl_salv_bs_a_xml_base=&gt;get_version( ).
        WHEN if_salv_bs_xml=&gt;version_25.
          version = if_salv_bs_xml=&gt;version_25.
        WHEN if_salv_bs_xml=&gt;version_26.
          version = if_salv_bs_xml=&gt;version_26.
      ENDCASE.

      &quot; if XLSX is possible then we create it,  if not then MHTML excel file
      salv_intf_descr ?= cl_abap_intfdescr=&gt;describe_by_name( p_name = &apos;IF_SALV_BS_XML&apos; ).
      IF salv_intf_descr IS NOT INITIAL AND line_exists( salv_intf_descr-&gt;attributes[ name = &apos;C_TYPE_XLSX&apos;  ] ).
        file_type = 10.
      ELSE.
        file_type = 02.
      ENDIF.

      &quot; transformation of data to excel
      cl_salv_bs_tt_util=&gt;if_salv_bs_tt_util~transform(
        EXPORTING xml_type      = file_type
                  xml_version   = version
                  r_result_data = result_data
                  xml_flavour   = if_salv_bs_c_tt=&gt;c_tt_xml_flavour_export
                  gui_type      = if_salv_bs_xml=&gt;c_gui_type_gui
        IMPORTING xml           = xstring ).
    ENDIF.

    IF xstring IS INITIAL.
      RETURN.
    ENDIF.

    IF NOT fichero IS INITIAL OR NOT dialogo_grabar_fichero IS INITIAL.
      IF dir_temp = &apos;X&apos;.
        l_dir = zcl_ap_documentos=&gt;get_directorio_temporal( ).
        l_fichero = zcl_ap_ficheros=&gt;concat_ruta( fichero = fichero directorio = l_dir ).
      ELSE.
        l_fichero = fichero.
      ENDIF.
      IF NOT l_fichero CS &apos;.&apos;.
        CONCATENATE l_fichero &apos;.XLSX&apos; INTO l_fichero.
      ENDIF.
      zcl_ap_ficheros=&gt;grabar_xstring( EXPORTING fichero       = l_fichero
                                                 xstring       = xstring
                                                 dialogo       = dialogo_grabar_fichero
                                       IMPORTING fichero_final = l_fichero
                                                 mensaje       = l_mensaje ).
      IF NOT l_mensaje IS INITIAL.
        __concat2 l_mensaje &apos;Error guardando XLSX&apos;(egx) l_mensaje.
        MESSAGE l_mensaje TYPE &apos;I&apos;.
      ELSE.
        IF abrir_excel = &apos;X&apos; AND NOT l_fichero IS INITIAL.
          zcl_ap_gos=&gt;visualizar_fichero_st( l_fichero ).
        ENDIF.
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="EXPORT_TO_SPREAD_SHEET" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="57 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD export_to_spread_sheet.
*    data: lr_result_data type ref to cl_salv_ex_result_data_table,
*          ls_error type cl_salv_bs_lex_support=&gt;ys_export_error,
*          lt_errors type cl_salv_bs_lex_support=&gt;yt_export_error,
*          ls_mask type string,
*          ls_def_filename type string,
*          ls_application type string.
*
*    lr_result_data  = o_grid-&gt;CREATE_EX_RESULT( ).
*

**DATA I_REPORT          TYPE SY-REPID.
**DATA IT_FIELDCAT       TYPE LVC_T_FCAT.
**DATA IT_FIELDCAT_KKBLO TYPE KKBLO_T_FIELDCAT.
**DATA E_EXIT            TYPE CHAR1.
**DATA IT_DATA           TYPE TABLE.
*
*CALL FUNCTION &apos;ALV_DATA_EXPORT&apos;
*  EXPORTING
*    i_report                = i_report
**   IT_FIELDCAT             = IT_FIELDCAT
**   IT_FIELDCAT_KKBLO       = IT_FIELDCAT_KKBLO
** IMPORTING
**   E_EXIT                  = E_EXIT
*  TABLES
*    it_data                 = it_data
*          .
*
**...choose Transformation  Y7AK044553
*  data: ls_xml_choice type if_salv_bs_xml=&gt;s_type_xml_choice.
*  data: lt_xml_choice type if_salv_bs_xml=&gt;t_type_xml_choice.
*  data: xml           type xstring.
*
*  data: l_gui_type type i.
*  O_GRID-&gt;export_to_xml(&apos;&amp;XXL&apos;).
*
*  call method O_GRID-&gt;get_gui_type
*    receiving
*      gui_type = l_gui_type.
*
**  if l_gui_type eq m_gui_type_java
**  or l_gui_type eq m_gui_type_html.
**    me-&gt;export_to_xml(&apos;&amp;XXL&apos;).
**    exit.
**  endif.
*
*  data:
*    l_xml type xstring,
*    l_filename type string,
*    l_file_extension type string,
*    l_mimetype type string,
*    l_enable_lean_export type abap_bool,
*    l_lean_export_format type if_salv_bs_lex_format=&gt;ys_format.
*
*
*  l_enable_lean_export = cl_alv_z_params=&gt;get_parameter(
*                             cl_alv_z_params=&gt;c_flag-use_lean_export ).
*  &quot; ALV Lean Export
*  if l_enable_lean_export eq abap_true.
*    l_lean_export_format = cl_alv_z_params=&gt;get_parameter(
*                             cl_alv_z_params=&gt;c_lean_export_format_switch-name ).
*
*    data: lr_result_data type ref to cl_salv_ex_result_data_table,
*          ls_error type cl_salv_bs_lex_support=&gt;ys_export_error,
*          lt_errors type cl_salv_bs_lex_support=&gt;yt_export_error,
*          ls_mask type string,
*          ls_def_filename type string,
*          ls_application type string.
*
*    lr_result_data  = me-&gt;CREATE_EX_RESULT( ).
*
*    cl_salv_bs_lex=&gt;export_from_result_data_table(
*      exporting
*        is_format            = l_lean_export_format
*        ir_result_data_table = lr_result_data
*      importing
*        er_result_file       = l_xml
*        et_export_errors     = lt_errors
*        es_filename          = l_filename
*        es_file_extension   = l_file_extension
**        es_mimetype          = l_mimetype
*        ).
*
*    ls_application = &apos;&apos;.
*
*    &quot; if we have MHTML format, we need to set application
*    &quot; otherwise the MHTML file would open in Browser
*    if l_lean_export_format eq if_salv_bs_lex_format=&gt;mc_format_mhtml.
*      &quot;... determine PC appl.: only possible in Windows GUI due to REGEX calls
*      if l_gui_type eq cl_salv_export_xml_dialog=&gt;c_gui_type_windows.
*
*        ls_application = cl_salv_bs_xml_utils=&gt;get_pc_application( cl_alv_bds=&gt;mc_mhtml_frontend ).
*      else.
*        &quot; If we cannot specify the application, we just rename the file extension.
*        &quot; Then the file also opens up in Excel - but there might be a warning message
*        &quot; from Excel that the content does not match the extension.
*        l_file_extension = &apos;xls&apos;.
*      endif.
*    endif.
*
*    ls_def_filename = &apos;export.&apos; &amp;&amp; l_file_extension.
*    ls_mask = l_file_extension &amp;&amp; &apos; file (*.&apos; &amp;&amp; l_file_extension &amp;&amp; &apos;)|*.&apos; &amp;&amp; l_file_extension.
*
**... call Filedownload Dialog and download file
*    call function &apos;XML_EXPORT_DIALOG&apos;
*      exporting
*        i_xml                      = l_xml
*        i_default_extension        = l_file_extension
*        i_initial_directory        = &apos;&apos;
*        i_default_file_name        = ls_def_filename
*        i_mask                     = ls_mask
*        i_application              = ls_application
*      exceptions
*        application_not_executable = 1
*        others                     = 2.
*
*    return.
*  endif.
*
*  data: l_display_mode type i.
*  if m_eventid eq evt_context_menu_selected.
*    l_display_mode = CL_SALV_EXPORT_XML_DIALOG=&gt;C_DISPLAY_MODE_INACTIVE_CBOX.
*  endif.
*
*  if 1 = 1. &quot;Y7AK048443
*    lt_xml_choice = cl_salv_export_xml_dialog=&gt;execute( gui_type     = l_gui_type
*                                                        display_mode = l_display_mode ).
*
*    read table lt_xml_choice into ls_xml_choice index 1.
*    if sy-subrc ne 0.
*      exit.
*    endif.
*  else.
*    ls_xml_choice-xml_type = if_salv_bs_xml=&gt;c_type_xxl.
*  endif.
*
*  if ls_xml_choice-xml_type eq if_salv_bs_xml=&gt;c_type_xxl.
*
*    field-symbols: &lt;tab1&gt; type standard table.
*
*    data: ls_layout      type kkblo_layout,
*          l_appl         type i,
*          lt_fieldcat_wa type kkblo_fieldcat,
*          lt_fieldcat    type kkblo_t_fieldcat.
*
*    data: l_tabname      type slis_tabname.
*
*    message i064(0k).                                       &quot;B5AK000316
*    system-call pop list.                            &quot;#EC CI_SYSTEMCALL
*
**... Check Outtab
*    assign mt_outtab-&gt;* to &lt;tab1&gt;.
*    if not sy-subrc is initial.
*      message a534(0k).
*    endif.
*
*    call function &apos;LVC_TRANSFER_TO_KKBLO&apos;
*      exporting
*        it_fieldcat_lvc   = m_cl_variant-&gt;mt_fieldcatalog
*        is_layout_lvc     = m_cl_variant-&gt;ms_layout
*        is_tech_complete  = &apos; &apos;
*      importing
*        es_layout_kkblo   = ls_layout
*        et_fieldcat_kkblo = lt_fieldcat.
*
*    loop at lt_fieldcat into lt_fieldcat_wa.
*      clear lt_fieldcat_wa-tech_complete.
*      if lt_fieldcat_wa-tabname is initial.
*        lt_fieldcat_wa-tabname = &apos;1&apos;.
*        modify lt_fieldcat from lt_fieldcat_wa.
*      endif.
*      l_tabname = lt_fieldcat_wa-tabname.
*    endloop.
*
*    call function &apos;ALV_XXL_CALL&apos;
*      exporting
*        i_tabname           = l_tabname
*        is_layout           = ls_layout
*        it_fieldcat         = lt_fieldcat
*        i_title             = sy-title
*      tables
*        it_outtab           = &lt;tab1&gt;
*      exceptions
*        fatal_error         = 1
*        no_display_possible = 2
*        others              = 3.
*    if sy-subrc &lt;&gt; 0.
*      message id sy-msgid type &apos;S&apos; number sy-msgno
*              with sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
*    endif.
*
*  else.
**...Target
*    data:
*      lr_export  type ref to cl_salv_bs_tt_file.
*
*    field-symbols: &lt;lt_data&gt;       type standard table.
*
*    if cl_salv_bs_a_xml_base=&gt;get_version( ) eq if_salv_bs_xml=&gt;version_25 or
*       cl_salv_bs_a_xml_base=&gt;get_version( ) eq if_salv_bs_xml=&gt;version_26.
*
*      data: r_result_data type ref to cl_salv_ex_result_data_table.
*
*      r_result_data  = me-&gt;CREATE_EX_RESULT( ).
*
*      data: l_flavour type string.
*      data: l_version type string.
*
*      case cl_salv_bs_a_xml_base=&gt;get_version( ).
*        when if_salv_bs_xml=&gt;version_25.
*          l_version = if_salv_bs_xml=&gt;version_25.
*        when if_salv_bs_xml=&gt;version_26.
*          l_version = if_salv_bs_xml=&gt;version_26.
*      endcase.
*
**      if ls_xml_choice-xml_type eq IF_SALV_BS_C_TT=&gt;C_TT_ALVXML.
**        l_flavour = IF_SALV_BS_C_TT=&gt;C_TT_XML_FLAVOUR_FULL.
**      else.
*        l_flavour = IF_SALV_BS_C_TT=&gt;C_TT_XML_FLAVOUR_EXPORT.
**      endif.
*
*      call method cl_salv_bs_tt_util=&gt;IF_SALV_BS_TT_UTIL~TRANSFORM
*          exporting xml_type      = ls_xml_choice-xml_type
*                    xml_version   = l_version
*                    r_result_data = r_result_data
*                    xml_flavour   = l_flavour
*                    gui_type      = if_salv_bs_xml=&gt;c_gui_type_gui  &quot;Y6DK066330
*          importing xml           = xml
*                    t_msg         = data(lt_msg).        &quot;YI3K229857
*
*      if lt_msg is not initial.
*        data: ls_msg type symsg,
*              l_text type string.
** msgid = 203  IGS not available, 204 IGS without ZIP interpreter,
** single msg added in cl_salv_bs_tt_ods-&gt;add_metadata
*        read TABLE lt_msg index 1 into ls_msg.   &quot;msgid = SALV_BS_MSG&apos;
*        if sy-subrc eq 0.
*           message id ls_msg-msgid type ls_msg-msgty number ls_msg-msgno
*                   with ls_msg-msgv1 ls_msg-msgv2 ls_msg-msgv3 ls_msg-msgv4
*                   into l_text.
*
*            message l_text type &apos;S&apos;.
*        endif.
*        return.
*      endif.       &quot;YI3K229857
*
*    else.
*      data: lr_controller type ref to cl_salv_export_c8r.
*      data: lr_table      type ref to cl_salv_table.
*      data: lr_columns    type ref to cl_salv_columns_table.
*      data: l_column      type lvc_fname.
*      data: ls_hype       type if_salv_export=&gt;s_type_hlink.
*
*      if me-&gt;r_salv_adapter is bound.
*        lr_table ?= me-&gt;r_salv_adapter-&gt;r_controller-&gt;r_model.
*        lr_columns = lr_table-&gt;get_columns( ).
*        l_column = lr_columns-&gt;get_hyperlink_entry_column( ).
*      endif.
*
*      ls_hype-t_hype = mt_hyperlinks[].
*      ls_hype-hlink_colname = l_column.
*
*      create object lr_controller
*        exporting
*          t_choice = lt_xml_choice.
*
*      lr_controller-&gt;execute(
*                      exporting
*                        t_fcat     = m_cl_variant-&gt;mt_fieldcatalog
*                        t_sort     = m_cl_variant-&gt;mt_sort
*                        t_filt     = m_cl_variant-&gt;mt_filter
*                        s_layo     = m_cl_variant-&gt;ms_layout
*                        s_hype     = ls_hype
**                        r_form_tol = s_param_lvc-r_form_tol
**                        r_form_eol = s_param_lvc-r_form_eol
*                      importing
*                        e_xml      = xml
*                      changing
*                        r_data     = mt_outtab
*                             ).
*
*    endif.
**...Filedownload
*    cl_salv_export_xml_dialog=&gt;download(
*                      exporting
*                        s_xml_choice = ls_xml_choice
*                        xml          = xml
*                      ).
*  endif.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="FIJAR_LAYOUT_INICIAL" VERSION="1" LANGU="S" DESCRIPT="Fijar parámetros iniciales" EXPOSURE="1" STATE="1" EDITORDER="1 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD fijar_layout_inicial.
**   Atributos del grid

    DATA: effect     TYPE i,
          handle_alv TYPE i.

    layout-cwidth_opt = &apos;X&apos;.
    layout-zebra      = &apos;X&apos;.
    layout-sel_mode   = &apos;D&apos;.                &quot; Permite selección multiple
    layout-no_rowmark = &apos;&apos;.               &quot; Permitir selección de filas
*    ls_layo-info_fname = &apos;COLOR&apos;.          &quot;Campo que indica el color
**    ls_layo-excp_fname = &apos;LIGHTS&apos;.         &quot;Campo que indica semáfor
*    ls_layo-stylefname = &apos;ESTILO_CELDA&apos;.   &quot;Campo que indica el estilo
    layout-no_merging = &apos;&apos;.               &quot; Permite mezclar filas
    CONCATENATE sy-repid sy-dynnr INTO variant-report.
    key_layout-report = variant-report.

    IF v_usar_dragdrop &lt;&gt; &apos;X&apos;.
      RETURN.
    ENDIF.

    o_dragdrop = NEW #( ).

    effect = cl_dragdrop=&gt;move + cl_dragdrop=&gt;copy.
    o_dragdrop-&gt;add( flavor     = &apos;Line&apos;                                 ##NO_TEXT
                     dragsrc    = &apos;X&apos;
                     droptarget = &apos;X&apos;
                     effect     = effect ).

    o_dragdrop-&gt;get_handle( IMPORTING handle = handle_alv ).

    layout-s_dragdrop-row_ddid  = handle_alv.
    layout-s_dragdrop-fieldname = &apos;DRAGDROP&apos;.
    layout-s_dragdrop-grid_ddid = handle_alv.
    layout-s_dragdrop-cntr_ddid = handle_alv.

*CNTR_DDID
*GRID_DDID
*COL_DDID
*ROW_DDID
*FIELDNAME
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="FORZAR_NO_EDICION" VERSION="1" LANGU="S" DESCRIPT="Fuerza no edición de campos" EXPOSURE="2" STATE="1" EDITORDER="40 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="FORZAR_NO_EDICION" SCONAME="CAMPOS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <source>METHOD forzar_no_edicion.
    DATA : ts_fcat TYPE lvc_t_fcat,
           e_layo  TYPE lvc_s_layo.

    FIELD-SYMBOLS &lt;fs_fcat&gt; TYPE lvc_s_fcat.

    o_grid-&gt;get_frontend_fieldcatalog( IMPORTING et_fieldcatalog = ts_fcat ).

    LOOP AT ts_fcat ASSIGNING &lt;fs_fcat&gt; WHERE edit = &apos;X&apos;.
      IF campos IS INITIAL OR campos CS &lt;fs_fcat&gt;-fieldname.
        CLEAR &lt;fs_fcat&gt;-edit.
      ENDIF.
    ENDLOOP.
    IF sy-subrc = 0.
      o_grid-&gt;set_frontend_fieldcatalog( it_fieldcatalog = ts_fcat ).
    ENDIF.

    o_grid-&gt;get_frontend_layout( IMPORTING es_layout = e_layo ).
    IF NOT e_layo-edit IS INITIAL.
      CLEAR e_layo-edit.

      o_grid-&gt;set_frontend_layout( is_layout = e_layo ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="FREE" VERSION="1" LANGU="S" DESCRIPT="Liberar memoria" EXPOSURE="2" STATE="1" EDITORDER="12 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD free.
    IF NOT o_custom_container IS INITIAL.
      o_custom_container-&gt;free( ).
      CLEAR o_custom_container.
    ENDIF.
    IF NOT o_grid IS INITIAL.
      o_grid-&gt;free( EXCEPTIONS cntl_error        = 1
                               cntl_system_error = 2
                               OTHERS            = 3 ).

      CLEAR o_grid.
    ENDIF.

    CLEAR: t_fcat,
           layout,
           variant,
           prnt,
           hype,
           t_tool,
           t_sort,
           consistency_check,
           contenedor,
           o_custom_container,
           estructura,
           input,
           o_event,
           t_dropdown,
           i_filas_sel,
           fila,
           i_filas_sel2.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_BOTON_TEXT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="59 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_BOTON_TEXT" SCONAME="BOTON" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_BOTON_TEXT" SCONAME="TEXT" VERSION="1" LANGU="S" DESCRIPT="Menu Painter: Texto de función o de menú (4.0)" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="SMP_DYNTXT-TEXT"/>
  <source>METHOD get_boton_text.
    DATA but TYPE t_boton.

    READ TABLE i_botones INTO but WITH KEY boton = boton.
    IF sy-subrc = 0.
      IF NOT but-text IS INITIAL.
        text = but-text.
      ELSEIF NOT but-quickinfo IS INITIAL.
        text = but-quickinfo.
      ELSE.
        text = boton.
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_CATALOGO_CAMPOS" VERSION="1" LANGU="S" DESCRIPT="Recupera campos" EXPOSURE="0" STATE="1" EDITORDER="1 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD get_catalogo_campos.
    FIELD-SYMBOLS &lt;fcat&gt; TYPE lvc_s_fcat.

    CALL FUNCTION &apos;LVC_FIELDCATALOG_MERGE&apos;
      EXPORTING  i_buffer_active        = &apos; &apos;
                 i_structure_name       = estructura
                 i_client_never_display = &apos;X&apos;
                 i_bypassing_buffer     = &apos; &apos;
      CHANGING   ct_fieldcat            = t_fcat[]
      EXCEPTIONS inconsistent_interface = 1
                 program_error          = 2
                 OTHERS                 = 3.
    IF sy-subrc &lt;&gt; 0.
      MESSAGE &apos;No se han recuperado campos&apos;(nrc) TYPE &apos;S&apos;.
    ENDIF.

* Alguna vez, y no sé por qué, me han aparecido campos marcados como NOOUT por defecto
    LOOP AT t_fcat ASSIGNING &lt;fcat&gt; WHERE no_out = &apos;X&apos;.
      CLEAR &lt;fcat&gt;-no_out.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_CATALOGO_CAMPOS_TABINT" VERSION="1" LANGU="S" DESCRIPT="Recupera campos tabla interna" EXPOSURE="2" STATE="1" EDITORDER="20 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_CATALOGO_CAMPOS_TABINT" SCONAME="INCLUDE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-REPID" PARVALUE="SY-CPROG"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_CATALOGO_CAMPOS_TABINT" SCONAME="INTERNAL_TABNAME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SLIS_TABNAME"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_CATALOGO_CAMPOS_TABINT" SCONAME="PROGRAMA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-REPID" PARVALUE="SY-CPROG"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_CATALOGO_CAMPOS_TABINT" SCONAME="TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_CATALOGO_CAMPOS_TABINT" SCONAME="IT_FIELDCATALOG" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="LVC_T_FCAT"/>
  <source>METHOD get_catalogo_campos_tabint.
    &quot; TODO: parameter INCLUDE is only used in commented-out code (ABAP cleaner)
    &quot; TODO: parameter INTERNAL_TABNAME is only used in commented-out code (ABAP cleaner)
    &quot; TODO: parameter PROGRAMA is never used (ABAP cleaner)

*  DATA: it_fieldcat TYPE slis_t_fieldcat_alv,
*        l_abap_source TYPE TABLE OF rssource.
*
*  CLASS cx_sy_read_src_line_too_long DEFINITION LOAD.
*  DATA: ex_too_long TYPE REF TO  cx_sy_read_src_line_too_long.
*  TRY.
*      READ REPORT include INTO l_abap_source.
*    CATCH cx_sy_read_src_line_too_long INTO ex_too_long.
*      MESSAGE &apos;Longitud de línea demasiado larga&apos; type &apos;E&apos;.
*  ENDTRY.
*  CHECK sy-subrc EQ 0.
*
*  CALL FUNCTION &apos;REUSE_ALV_FIELDCATALOG_MERGE&apos;
*    EXPORTING
*      i_program_name         = PROGRAMA
*      i_internal_tabname     = internal_tabname
*      i_inclname             = include
*      i_bypassing_buffer     = &apos;X&apos;
*    CHANGING
*      ct_fieldcat            = it_fieldcat
*    EXCEPTIONS
*      inconsistent_interface = 1
*      program_error          = 2
*      OTHERS                 = 3.
*
*  CALL FUNCTION &apos;LVC_TRANSFER_FROM_SLIS&apos;
*    EXPORTING
*      it_fieldcat_alv       = it_fieldcat
**   IT_SORT_ALV           =
**   IT_FILTER_ALV         =
**   IS_LAYOUT_ALV         =
*   IMPORTING
*     et_fieldcat_lvc       = it_fieldcatalog
**   ET_SORT_LVC           =
**   ET_FILTER_LVC         =
**   ES_LAYOUT_LVC         =
*    TABLES
*      it_data               = tabla
*   EXCEPTIONS
*     it_data_missing       = 1
*     OTHERS                = 2.

    DATA:
      lr_table        TYPE REF TO data,
      lo_salv_table   TYPE REF TO cl_salv_table,
      lo_columns      TYPE REF TO cl_salv_columns_table,
      lo_aggregations TYPE REF TO cl_salv_aggregations.

    FIELD-SYMBOLS &lt;table&gt; TYPE STANDARD TABLE.

* create unprotected table from import table
* This is required because IMPORTed IT_TABLE can not be passed to CHANGING parameter t_table
    CREATE DATA lr_table LIKE tabla.
    ASSIGN lr_table-&gt;* TO &lt;table&gt;.
* New SALV Instance
    TRY.
        cl_salv_table=&gt;factory( EXPORTING list_display = abap_false
                                IMPORTING r_salv_table = lo_salv_table
                                CHANGING  t_table      = &lt;table&gt; ).
      CATCH cx_salv_msg ##NO_HANDLER.
    ENDTRY.
* get columns object (basic field catalog data)
    lo_columns = lo_salv_table-&gt;get_columns( ).
* get aggregations object (Sorts&amp;Sums)
    lo_aggregations = lo_salv_table-&gt;get_aggregations( ).
* use method to create field catalog from this information
    it_fieldcatalog =
      cl_salv_controller_metadata=&gt;get_lvc_fieldcatalog( r_columns      = lo_columns
                                                         r_aggregations = lo_aggregations ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_COL" VERSION="1" LANGU="S" DESCRIPT="Devuelve col" EXPOSURE="2" STATE="1" EDITORDER="47 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_COL" SCONAME="COLUM" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="NUMC2" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_COL" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_COL" SCONAME="COL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="ZAP_ALV_COLUMNAS"/>
  <source>METHOD get_col.
    CLEAR col.
    IF NOT colum IS INITIAL.
      READ TABLE i_columnas INTO col WITH KEY colum = colum.
    ELSEIF NOT campo IS INITIAL.
      READ TABLE i_columnas INTO col WITH KEY campo = campo.
    ENDIF.
  ENDMETHOD.                    &quot; GET_VALOR_CAMPO</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_DEFAULT_LAYOUT" VERSION="1" LANGU="S" DESCRIPT="Recupera el layout por defecto" EXPOSURE="2" STATE="1" EDITORDER="23 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_DEFAULT_LAYOUT" SCONAME="LAYOUT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="DISVARIANT-VARIANT"/>
  <source>METHOD get_default_layout.
    DATA ls_layout TYPE salv_s_layout_info.

    ls_layout = cl_salv_layout_service=&gt;get_default_layout( s_key    = key_layout
                                                            restrict = cl_salv_layout=&gt;restrict_none ).

    layout = ls_layout-layout.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_DESC_FROM_CLAVE" VERSION="1" LANGU="S" DESCRIPT="Recupera valor de descripción campo DropDown" EXPOSURE="2" STATE="1" EDITORDER="67 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_DESC_FROM_CLAVE" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_DESC_FROM_CLAVE" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="0" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_DESC_FROM_CLAVE" SCONAME="DESCRIPCION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD get_desc_from_clave.
    DATA: l_campos      TYPE t_campos_desc,
          l_campo_clave TYPE string,
          l_where       TYPE string.

    READ TABLE i_campos_desc INTO l_campos WITH KEY campo = campo.
    IF sy-subrc &lt;&gt; 0.
      RETURN.
    ENDIF.

    IF NOT l_campos-dominio IS INITIAL.
      descripcion = zcl_ap_utils=&gt;get_texto_dominio( dominio = l_campos-dominio valor = valor ).
    ELSEIF NOT l_campos-tabla IS INITIAL.
      IF l_campos-campo_clave IS INITIAL.
        l_campo_clave = campo.
      ELSE.
        l_campo_clave = l_campos-campo_clave.
      ENDIF.

      CONCATENATE l_campo_clave &apos; = &apos;&apos;&apos; valor &apos;&apos;&apos;&apos; INTO l_where.
      IF NOT l_campos-where IS INITIAL.
        CONCATENATE l_where &apos;and&apos; l_campos-where INTO l_where SEPARATED BY space.
      ENDIF.
      SELECT SINGLE (l_campos-campo_desc) FROM (l_campos-tabla)
        INTO descripcion
       WHERE (l_where).

      IF NOT l_campos-add_clave IS INITIAL.
        CONCATENATE valor descripcion INTO descripcion SEPARATED BY l_campos-add_clave.
      ENDIF.

    ELSEIF NOT l_campos-valores IS INITIAL.
      DATA(i_lista) = zcl_ap_lista=&gt;get_valores_lista( lista = l_campos-valores ).
      ASSIGN i_lista[ valor = valor ] TO FIELD-SYMBOL(&lt;lista&gt;).
      IF sy-subrc = 0.
        descripcion = &lt;lista&gt;-subvalor.
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_F4_LAYOUT" VERSION="1" LANGU="S" DESCRIPT="Matchcode de F4 para posibles layouts" EXPOSURE="2" STATE="1" EDITORDER="24 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_F4_LAYOUT" SCONAME="LAYOUT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="DISVARIANT-VARIANT"/>
  <source>METHOD get_f4_layout.
    DATA ls_layout TYPE salv_s_layout_info.

    ls_layout = cl_salv_layout_service=&gt;f4_layouts( s_key    = key_layout
                                                    restrict = cl_salv_layout=&gt;restrict_none ).

    layout = ls_layout-layout.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_FCAT_INICIAL" VERSION="1" LANGU="S" DESCRIPT="Recupera los campos iniciales del listado" EXPOSURE="2" STATE="1" EDITORDER="41 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_FCAT_INICIAL" SCONAME="FCAT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="LVC_T_FCAT"/>
  <source>METHOD get_fcat_inicial.
    IF i_fcat_ini IS INITIAL.
      o_grid-&gt;get_frontend_fieldcatalog( IMPORTING et_fieldcatalog = i_fcat_ini ).
    ENDIF.

    fcat = i_fcat_ini.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_FILAS_SEL" VERSION="1" LANGU="S" DESCRIPT="Recupear filas seleccionadas" EXPOSURE="2" STATE="1" EDITORDER="13 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD get_filas_sel.
    CLEAR: i_filas_sel,
           i_filas_sel2.
    o_grid-&gt;get_selected_rows( IMPORTING et_index_rows = i_filas_sel
                                         et_row_no     = i_filas_sel2 ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_FILA_ACTIVA" VERSION="1" LANGU="S" DESCRIPT="Devuelve la fila donde está posicionado el cursor" EXPOSURE="2" STATE="1" EDITORDER="17 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_FILA_ACTIVA" SCONAME="INDICE_SIN_FILTROS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_FILA_ACTIVA" SCONAME="FILA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="INT4"/>
  <source>METHOD get_fila_activa.
    DATA l_row_no TYPE lvc_s_roid.

    IF indice_sin_filtros IS INITIAL.
      o_grid-&gt;get_current_cell( IMPORTING e_row = fila  ). &quot; Fila filtrada
    ELSE.
      o_grid-&gt;get_current_cell( IMPORTING es_row_no = l_row_no ). &quot; Fila sin tener en cuenta filtros
      fila = l_row_no-row_id.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_LISTA_CAMPOS" VERSION="1" LANGU="S" DESCRIPT="Devuelve lista de campos de la estructura" EXPOSURE="2" STATE="1" EDITORDER="49 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_LISTA_CAMPOS" SCONAME="TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_LISTA_CAMPOS" SCONAME="QUITAR_CAMPOS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_LISTA_CAMPOS" SCONAME="LISTA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD get_lista_campos.
    FIELD-SYMBOLS &lt;campo&gt; TYPE dfies.

    CLEAR lista.
    DATA(i_campos) = zcl_ap_dev=&gt;get_fieldcatalog_tabla( tabla ).

    DATA(r_campos_quitar) = zcl_ap_itab=&gt;get_rango_campos( quitar_campos ).

    LOOP AT i_campos ASSIGNING &lt;campo&gt; WHERE NOT fieldname IN r_campos_quitar.
      zcl_ap_lista=&gt;add( EXPORTING valor = &lt;campo&gt;-fieldname CHANGING lista = lista ).
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_REGISTROS_FILTRADOS" VERSION="1" LANGU="S" DESCRIPT="Recupera registros filtrados" EXPOSURE="2" STATE="1" EDITORDER="63 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_REGISTROS_FILTRADOS" SCONAME="I_REGISTROS_FILTRADOS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE"/>
  <source>METHOD get_registros_filtrados.
    FIELD-SYMBOLS &lt;tabla&gt; TYPE table.

    ASSIGN table_ref-&gt;* TO &lt;tabla&gt;.

    i_registros_filtrados = &lt;tabla&gt;.

    &quot; Get excluded rows
    o_grid-&gt;get_filtered_entries( IMPORTING et_filtered_entries = DATA(lit_index) ).

    &quot; Reverse order to keep correct indizes; thnx futu
    SORT lit_index DESCENDING.

    &quot; Remove excluded rows from buffer
    LOOP AT lit_index ASSIGNING FIELD-SYMBOL(&lt;index&gt;).
      DELETE i_registros_filtrados INDEX &lt;index&gt;.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_TABLA_FILAS_SEL" VERSION="1" LANGU="S" DESCRIPT="Recupera copia de la tabla con las filas seleccionadas" EXPOSURE="2" STATE="1" EDITORDER="33 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_TABLA_FILAS_SEL" SCONAME="T_TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_TABLA_FILAS_SEL" SCONAME="T_TABLA_SEL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE"/>
  <source>METHOD get_tabla_filas_sel.
*  DATA l_tabla TYPE REF TO data.

    FIELD-SYMBOLS &lt;tabla&gt; TYPE any.

    CLEAR t_tabla_sel.
    get_filas_sel( ).
*  CREATE DATA l_tabla LIKE LINE OF t_tabla.

    LOOP AT i_filas_sel INTO fila WHERE rowtype IS INITIAL.
      ASSIGN t_tabla[ fila-index ] TO &lt;tabla&gt;.
      IF sy-subrc = 0.
        APPEND &lt;tabla&gt; TO t_tabla_sel.
      ENDIF.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_VALOR_CAMPO" VERSION="1" LANGU="S" DESCRIPT="Devuelve el valor del campo" EXPOSURE="2" STATE="1" EDITORDER="46 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_VALOR_CAMPO" SCONAME="REGISTRO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_VALOR_CAMPO" SCONAME="COLUM" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="NUMC2" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_VALOR_CAMPO" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_VALOR_CAMPO" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD get_valor_campo.
    DATA: l_col   TYPE zap_alv_columnas,
          l_campo TYPE string.

    FIELD-SYMBOLS &lt;fs&gt; TYPE any.

    CLEAR valor.
    l_col = get_col( colum = colum campo = campo ).

    IF NOT l_col IS INITIAL.
      CONCATENATE &apos;REGISTRO-&apos; l_col-campo INTO l_campo.
      ASSIGN (l_campo) TO &lt;fs&gt;.
      IF sy-subrc = 0.
        valor = &lt;fs&gt;.
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_VALOR_FROM_DESC" VERSION="1" LANGU="S" DESCRIPT="Recupera valor de descripción campo DropDown" EXPOSURE="2" STATE="1" EDITORDER="51 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_VALOR_FROM_DESC" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_VALOR_FROM_DESC" SCONAME="DESCRIPCION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="GET_VALOR_FROM_DESC" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD get_valor_from_desc.
    DATA: l_campos TYPE t_campos_desc,
          l_where  TYPE string.
    DATA l_descripcion TYPE string.

    READ TABLE i_campos_desc INTO l_campos WITH KEY campo = campo.
    IF sy-subrc &lt;&gt; 0.
      RETURN.
    ENDIF.

    IF NOT l_campos-dominio IS INITIAL.
      valor = zcl_ap_utils=&gt;get_valor_dominio( dominio = l_campos-dominio texto = descripcion ).
    ELSEIF NOT l_campos-tabla IS INITIAL.
      l_descripcion = descripcion.
      IF NOT l_campos-add_clave IS INITIAL.
        SPLIT descripcion AT l_campos-add_clave INTO valor l_descripcion.
        IF sy-subrc = 0.
          RETURN.
        ENDIF.
      ENDIF.

      CONCATENATE l_campos-campo_desc &apos; = &apos;&apos;&apos; l_descripcion &apos;&apos;&apos;&apos; INTO l_where.
      IF NOT l_campos-where IS INITIAL.
        CONCATENATE l_where &apos;and&apos; l_campos-where INTO l_where SEPARATED BY space.
      ENDIF.
      SELECT SINGLE (l_campos-campo_clave) FROM (l_campos-tabla)
        INTO valor
       WHERE (l_where).
    ELSEIF NOT l_campos-valores IS INITIAL.
      DATA(i_lista) = zcl_ap_lista=&gt;get_valores_lista( lista = l_campos-valores ).
      ASSIGN i_lista[ subvalor = descripcion ] TO FIELD-SYMBOL(&lt;lista&gt;).
      IF sy-subrc = 0.
        valor = &lt;lista&gt;-valor.
*    ELSE.
*      valor = descripcion.
      ENDIF.
    ELSEIF NOT l_campos-caract IS INITIAL.
      valor = zcl_ap_clasificacion=&gt;get_valor_caract_text2key( caract = l_Campos-caract valor = descripcion ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="IMPORTAR_EXCEL" VERSION="1" LANGU="S" DESCRIPT="Exportar Excel" EXPOSURE="2" STATE="1" EDITORDER="32 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="IMPORTAR_EXCEL" SCONAME="FICHERO_SALIDA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="IMPORTAR_EXCEL" SCONAME="CERRAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="IMPORTAR_EXCEL" SCONAME="AUTOFILTRO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="IMPORTAR_EXCEL" SCONAME="T_TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE"/>
  <source>METHOD importar_excel.
    &quot; TODO: parameter FICHERO_SALIDA is never used (ABAP cleaner)
    &quot; TODO: parameter CERRAR is never used (ABAP cleaner)
    &quot; TODO: parameter AUTOFILTRO is never used (ABAP cleaner)

    DATA: l_fcat     TYPE lvc_s_fcat,
          t_fieldcat TYPE lvc_t_fcat,
          tabla      TYPE REF TO data,
          ep_line    TYPE REF TO data,
          ep_tabla   TYPE REF TO data,
          l_fichero  TYPE string.
    DATA l_min   TYPE i.
    DATA l_numc4 TYPE numc4.

    FIELD-SYMBOLS: &lt;col3&gt;          TYPE zap_alv_columnas3,
                   &lt;l_table&gt;       TYPE STANDARD TABLE,
                   &lt;l_line&gt;        TYPE any,
                   &lt;tabla&gt;         TYPE any,
                   &lt;fcat&gt;          TYPE lvc_s_fcat,
                   &lt;valor_destino&gt; TYPE any,
                   &lt;valor_origen&gt;  TYPE any.

    LOOP AT t_fcat INTO l_fcat WHERE no_out = &apos;&apos;.
      IF l_fcat-datatype = &apos;DATS&apos;.
        l_fcat-datatype = &apos;CHAR&apos;.
        l_fcat-inttype  = &apos;C&apos;.
        l_fcat-intlen   = &apos;000010&apos;.
        l_fcat-domname  = &apos;CHAR10&apos;.
        CLEAR l_fcat-ref_table.
      ELSEIF l_fcat-datatype = &apos;TIMS&apos;.
        l_fcat-datatype = &apos;CHAR&apos;.
        l_fcat-inttype  = &apos;C&apos;.
        l_fcat-intlen   = &apos;000008&apos;.
        l_fcat-domname  = &apos;CHAR08&apos;.
        CLEAR l_fcat-ref_table.
      ELSE.
        ASSIGN i_columnas3[ campo = l_fcat-fieldname ] TO &lt;col3&gt;.
        IF sy-subrc = 0.
          IF &lt;col3&gt;-aux3 = &apos;NUMC4&apos;.
            l_fcat-datatype = &apos;CHAR&apos;.
            l_fcat-inttype  = &apos;C&apos;.
            l_fcat-intlen   = &apos;000004&apos;.
            l_fcat-domname  = &apos;NUMC4&apos;.
            l_fcat-convexit = &apos;ALPHA&apos;.
            CLEAR l_fcat-ref_table.
          ENDIF.
        ENDIF.
      ENDIF.
      APPEND l_fcat TO t_fieldcat.
    ENDLOOP.

    cl_alv_table_create=&gt;create_dynamic_table( EXPORTING  it_fieldcatalog           = t_fieldcat
                                               IMPORTING  ep_table                  = tabla
                                               EXCEPTIONS generate_subpool_dir_full = 1
                                                          OTHERS                    = 2 ).

    ASSIGN tabla-&gt;* TO &lt;l_table&gt;.
    CREATE DATA ep_line LIKE LINE OF &lt;l_table&gt;.
    ASSIGN ep_line-&gt;* TO &lt;l_line&gt;.

    CREATE DATA ep_tabla LIKE LINE OF t_tabla.
    ASSIGN ep_tabla-&gt;* TO &lt;tabla&gt;.

    l_fichero = zcl_ap_ficheros=&gt;popup_select_fichero( file_filter = zcl_ap_ficheros=&gt;c_filtro_xls ).
    IF NOT l_fichero IS INITIAL.
      zcl_ap_import_excel=&gt;importar( EXPORTING fichero = l_fichero
                                     CHANGING  tabla   = &lt;l_table&gt; ).

      IF NOT &lt;l_table&gt; IS INITIAL.
        CLEAR t_tabla.
        LOOP AT &lt;l_table&gt; ASSIGNING &lt;l_line&gt;.
          LOOP AT t_fieldcat ASSIGNING &lt;fcat&gt;.
            ASSIGN COMPONENT &lt;fcat&gt;-fieldname OF STRUCTURE &lt;tabla&gt; TO &lt;valor_destino&gt;.
            ASSIGN COMPONENT &lt;fcat&gt;-fieldname OF STRUCTURE &lt;l_line&gt; TO &lt;valor_origen&gt;.
            &lt;valor_destino&gt; = &lt;valor_origen&gt;.

            READ TABLE t_fcat INTO l_fcat WITH KEY fieldname = &lt;fcat&gt;-fieldname.
            IF sy-subrc &lt;&gt; 0.
              CONTINUE.
            ENDIF.

            IF l_fcat-datatype = &apos;DATS&apos;.
              &lt;valor_destino&gt; = zcl_ap_fechas=&gt;string2fecha( &lt;valor_origen&gt; ).
            ELSEIF l_fcat-datatype = &apos;TIMS&apos;.
              REPLACE &apos;,&apos; WITH &apos;.&apos; INTO &lt;valor_origen&gt;.
              l_min = 86400 * &lt;valor_origen&gt; ##NUMBER_OK.
              &lt;valor_destino&gt; = l_min.
            ELSEIF l_fcat-convexit = &apos;ALPHA&apos; OR l_fcat-convexit = &apos;NUMCV&apos;.
              zcl_ap_string=&gt;poner_ceros( EXPORTING cadena = &lt;valor_origen&gt;
                                          CHANGING  salida = &lt;valor_destino&gt; ).
            ELSE.
              READ TABLE t_fieldcat INTO l_fcat WITH KEY fieldname = &lt;fcat&gt;-fieldname.
              IF sy-subrc = 0.
                IF l_fcat-domname = &apos;NUMC4&apos;.
                  zcl_ap_string=&gt;poner_ceros( EXPORTING cadena = &lt;valor_origen&gt;
                                              CHANGING  salida = l_numc4 ).
                  &lt;valor_destino&gt; = l_numc4.
                ENDIF.
              ENDIF.
            ENDIF.
          ENDLOOP.
          INSERT &lt;tabla&gt; INTO TABLE t_tabla.
        ENDLOOP.
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="OCULTAR_COLUMNAS_VACIAS" VERSION="1" LANGU="S" DESCRIPT="Ocultar columnas vacias" EXPOSURE="2" STATE="1" EDITORDER="58 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="OCULTAR_COLUMNAS_VACIAS" SCONAME="T_TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE"/>
  <source>METHOD ocultar_columnas_vacias.
    DATA: i_campos TYPE abap_component_tab,
          l_campos TYPE abap_componentdescr,
          l_valor  TYPE c LENGTH 1.

    FIELD-SYMBOLS: &lt;linea&gt; TYPE any,
                   &lt;valor&gt; TYPE any.

    i_campos = zcl_ap_dev=&gt;get_fieldcatalog( t_tabla ).

    DELETE i_campos WHERE name IS INITIAL.
    DELETE i_campos WHERE name = &apos;CHECK&apos; OR name = &apos;LIGHTS&apos;.
    IF i_campos[] IS INITIAL.
      RETURN.
    ENDIF.

    LOOP AT i_campos INTO l_campos.
      CLEAR l_valor.
      LOOP AT t_tabla ASSIGNING &lt;linea&gt;.
        ASSIGN COMPONENT l_campos-name OF STRUCTURE &lt;linea&gt; TO &lt;valor&gt;.
        IF sy-subrc = 0.
          IF NOT &lt;valor&gt; IS INITIAL.
            l_valor = &apos;X&apos;.
            EXIT.
          ENDIF.
        ENDIF.
      ENDLOOP.
      IF l_valor IS INITIAL.
        set_field_noout( l_campos-name ).
      ENDIF.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="QUITAR_BOTONES" VERSION="1" LANGU="S" DESCRIPT="Quitar las botones de inserción dejando el de borrado" EXPOSURE="2" STATE="1" EDITORDER="38 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="QUITAR_BOTONES" SCONAME="TODOS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="QUITAR_BOTONES" SCONAME="INSERCION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="QUITAR_BOTONES" SCONAME="ORDENACION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="QUITAR_BOTONES" SCONAME="LAYOUT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="QUITAR_BOTONES" SCONAME="NO_TOOLBAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="QUITAR_BOTONES" SCONAME="OPERACIONES" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="QUITAR_BOTONES" SCONAME="RESTO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="QUITAR_BOTONES" SCONAME="FILTRO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="QUITAR_BOTONES" SCONAME="EXPORTACION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <source>METHOD quitar_botones.
    me-&gt;layout-no_toolbar = no_toolbar.

    IF insercion = &apos;X&apos; OR todos = &apos;X&apos;.
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_insert_row ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_paste_new_row ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_append_row ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_copy_row ).

      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_delete_row ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_paste ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_paste_new_row ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_cut ).

      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_copy ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_undo ).
    ENDIF.

    IF ordenacion = &apos;X&apos; OR todos = &apos;X&apos;.
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_sort ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_sort_asc ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_sort_dsc ).
    ENDIF.

    IF filtro = &apos;X&apos; OR todos = &apos;X&apos;.
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_filter ).
    ENDIF.

    IF operaciones = &apos;X&apos; OR todos = &apos;X&apos;.
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_subtot ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_sum ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_maximum ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_minimum ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_average ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_graph ).
    ENDIF.

    IF resto = &apos;X&apos; OR todos = &apos;X&apos;.
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_detail ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_check ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_find ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_refresh ).
    ENDIF.

    IF exportacion = &apos;X&apos; OR todos = &apos;X&apos;.
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_print ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_print_prev ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_print_back ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_info ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_views ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_mb_export ).
    ENDIF.

    IF layout = &apos;X&apos; OR todos = &apos;X&apos;.
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_load_variant ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_save_variant ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_variant_admin ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_current_variant ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="QUITAR_BOTONES_INSERCION" VERSION="1" LANGU="S" DESCRIPT="Quitar las botones de inserción dejando el de borrado" EXPOSURE="2" STATE="1" EDITORDER="11 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="QUITAR_BOTONES_INSERCION" SCONAME="TODOS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <source>METHOD quitar_botones_insercion.
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_insert_row ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_paste_new_row ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_append_row ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_copy_row ).

    IF todos = &apos;X&apos;.
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_delete_row ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_paste ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_paste_new_row ).
      quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_cut ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="QUITAR_OPCIONES" VERSION="1" LANGU="S" DESCRIPT="Elimina opciones" EXPOSURE="2" STATE="1" EDITORDER="8 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="QUITAR_OPCIONES" SCONAME="OPCION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="UI_FUNC"/>
  <source>METHOD quitar_opciones.
    DATA ls_exclude TYPE ui_func.

    ls_exclude = opcion. &quot; cl_gui_alv_grid=&gt;mc_fc_find.
    APPEND ls_exclude TO t_tool.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="QUITAR_TODOS_BOTONES_INSERCION" VERSION="1" LANGU="S" DESCRIPT="Quitar las botones de inserción" EXPOSURE="2" STATE="1" EDITORDER="25 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD quitar_todos_botones_insercion.
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_insert_row ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_paste_new_row ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_append_row ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_copy_row ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_delete_row ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_copy ).
    quitar_opciones( cl_gui_alv_grid=&gt;mc_fc_loc_cut ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="REFRESCAR_GRID" VERSION="1" LANGU="S" DESCRIPT="Refesca contenido del grid" EXPOSURE="2" STATE="1" EDITORDER="7 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="REFRESCAR_GRID" SCONAME="SOFT_REFRESH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="REFRESCAR_GRID" SCONAME="NEW_CODE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SYUCOMM" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="REFRESCAR_GRID" SCONAME="ESTABLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="REFRESCAR_GRID" SCONAME="SET_FOCUS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="REFRESCAR_GRID" SCONAME="MANTENER_SEL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <source>METHOD refrescar_grid.
    DATA l_lvc_s_stbl TYPE lvc_s_stbl.

* Refrescamos el ALV y limpiamos la variable

    IF mantener_sel = &apos;X&apos;.
      get_filas_sel( ).
    ENDIF.

    IF opt_cols = &apos;X&apos;.
      o_grid-&gt;get_frontend_layout( IMPORTING es_layout = layout ).

      layout-cwidth_opt = &apos;X&apos;.

* SE LANZA EL LAYOUT PARA QUE SE AJUSTE EL ANCHO
      o_grid-&gt;set_frontend_layout( is_layout = layout ).
    ENDIF.

    IF estable = &apos;X&apos;.
      l_lvc_s_stbl = &apos;XX&apos;.
    ENDIF.

    o_grid-&gt;refresh_table_display( is_stable = l_lvc_s_stbl i_soft_refresh = soft_refresh ).

    IF mantener_sel = &apos;X&apos; AND NOT i_filas_sel IS INITIAL.
      o_grid-&gt;set_selected_rows( it_index_rows            = i_filas_sel
                                 is_keep_other_selections = &apos;&apos; ).
    ENDIF.

    IF new_code IS INITIAL.
      IF set_focus = &apos;X&apos;.
        cl_gui_control=&gt;set_focus( control = o_grid ).
      ENDIF.

      cl_gui_cfw=&gt;flush( ).
    ELSE.
      cl_gui_cfw=&gt;set_new_ok_code( new_code ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="REGISTRAR_ENTER" VERSION="1" LANGU="S" DESCRIPT="Registrar objeto enter" EXPOSURE="2" STATE="1" EDITORDER="14 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD registrar_enter.
    o_grid-&gt;register_edit_event( i_event_id = cl_gui_alv_grid=&gt;mc_evt_enter ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="REGISTRAR_MOD" VERSION="1" LANGU="S" DESCRIPT="Registrar modificaciones en tabla" EXPOSURE="2" STATE="1" EDITORDER="44 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD registrar_mod.
    o_grid-&gt;register_edit_event( i_event_id = cl_gui_alv_grid=&gt;mc_evt_modified ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="REMOVE_BUTTON" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="53 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="REMOVE_BUTTON" SCONAME="BUTTON" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-UCOMM"/>
  <source>METHOD remove_button.
    CHECK button IS NOT INITIAL.
    IF NOT line_exists( allowed_buttons[ function = button ] ).
      DELETE excluded_buttons WHERE table_line = button.
      APPEND button TO excluded_buttons.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="RESTORE_BUTTONS" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="66 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="RESTORE_BUTTONS" SCONAME="STATUS2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <source>METHOD restore_buttons.
    IF status2 IS INITIAL.
      PERFORM restaurar_botones_v1 IN PROGRAM zap_status.
    ELSE.
      PERFORM restaurar_botones_v1 IN PROGRAM zap_status2.
    ENDIF.
    i_botones = i_botones_v0.
    buttons = buttons_v0.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SAVE_BUTTONS" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="65 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SAVE_BUTTONS" SCONAME="STATUS2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <source>METHOD save_buttons.
    IF status2 IS INITIAL.
      PERFORM guardar_botones_v1 IN PROGRAM zap_status.
      PERFORM clear_botones IN PROGRAM zap_status.
    ELSE.
      PERFORM guardar_botones_v1 IN PROGRAM zap_status2.
      PERFORM clear_botones IN PROGRAM zap_status2.
    ENDIF.
    i_botones_v0 = i_botones.
    buttons_v0 = buttons.
    CLEAR: i_botones,
           buttons.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_CAMPOS_TABINT" VERSION="1" LANGU="S" DESCRIPT="Recupera campos tabla interna" EXPOSURE="2" STATE="1" EDITORDER="39 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_CAMPOS_TABINT" SCONAME="TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE"/>
  <source>METHOD set_campos_tabint.
* https://wiki.scn.sap.com/wiki/display/Snippets/ALV+fieldcatalog+-+create+for+ANY+table

    DATA:
      lr_table        TYPE REF TO data,
      lo_salv_table   TYPE REF TO cl_salv_table,
      lo_columns      TYPE REF TO cl_salv_columns_table,
      lo_aggregations TYPE REF TO cl_salv_aggregations,
      lr_data         TYPE REF TO data,
      lv_help_id      TYPE string.

    FIELD-SYMBOLS:
      &lt;table&gt;    TYPE STANDARD TABLE,
      &lt;fieldcat&gt; TYPE lvc_s_fcat,
      &lt;rec&gt;      TYPE any,
      &lt;any&gt;      TYPE any.

* create unprotected table from import table
* This is required because IMPORTed IT_TABLE can not be passed to CHANGING parameter t_table
    CREATE DATA lr_table LIKE tabla.
    ASSIGN lr_table-&gt;* TO &lt;table&gt;.
* New SALV Instance
    TRY.
        cl_salv_table=&gt;factory( EXPORTING list_display = abap_false
                                IMPORTING r_salv_table = lo_salv_table
                                CHANGING  t_table      = &lt;table&gt; ).
      CATCH cx_salv_msg ##NO_HANDLER.
    ENDTRY.
* get columns object (basic field catalog data)
    lo_columns = lo_salv_table-&gt;get_columns( ).
* get aggregations object (Sorts&amp;Sums)
    lo_aggregations = lo_salv_table-&gt;get_aggregations( ).
* use method to create field catalog from this information
    t_fcat =
      cl_salv_controller_metadata=&gt;get_lvc_fieldcatalog( r_columns      = lo_columns
                                                         r_aggregations = lo_aggregations ).

    LOOP AT t_fcat ASSIGNING &lt;fieldcat&gt;.
      data(l_tabix) = sy-tabix.
      if &lt;fieldcat&gt;-col_pos is initial.
        &lt;fieldcat&gt;-col_pos = l_tabix.
      endif.

* gt_alv_out is the table to be displayed using i.e.FUNCTION &apos;REUSE_ALV_GRID_DISPLAY&apos;
      IF &lt;rec&gt; IS NOT ASSIGNED.
* just create a line dynamically that it works even for an empty table
        CREATE DATA lr_data LIKE LINE OF tabla.
        ASSIGN lr_data-&gt;* TO &lt;rec&gt;.
      ENDIF.
* get information about every field
      ASSIGN COMPONENT &lt;fieldcat&gt;-fieldname OF STRUCTURE &lt;rec&gt; TO &lt;any&gt;.
      DESCRIBE FIELD &lt;any&gt; HELP-ID lv_help_id.
* set reference table and fieldname - perfect F1 and F4!
* (wonder why SAP can&apos;t do it themselves)
      SPLIT lv_help_id AT &apos;-&apos;
            INTO &lt;fieldcat&gt;-ref_table &lt;fieldcat&gt;-ref_field.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_COLOR" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="64 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_COLOR" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_COLOR" SCONAME="COLOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <source>METHOD set_color.
    DATA l_column TYPE lvc_fname.

    IF campo IS INITIAL.
      l_column = campo_color.
    ELSE.
      l_column = campo.
    ENDIF.
    IF l_column IS INITIAL.
      RETURN.
    ENDIF.

    TRANSLATE l_column TO UPPER CASE.
    ASSIGN t_fcat[ fieldname = l_column ] TO FIELD-SYMBOL(&lt;fcat&gt;).
    IF sy-subrc = 0.
      &lt;fcat&gt;-emphasize(1)   = &apos;C&apos;.
      &lt;fcat&gt;-emphasize+1(1) = color.
      &lt;fcat&gt;-emphasize+2(1) = &apos;0&apos;. &quot; INT
      &lt;fcat&gt;-emphasize+3(1) = &apos;0&apos;. &quot; INV
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_COLUMNAS" VERSION="1" LANGU="S" DESCRIPT="Datos de columnas desde tabla interna" EXPOSURE="2" STATE="1" EDITORDER="26 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_COLUMNAS" SCONAME="I_COLUMNAS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ZAP_ALV_COLUMNAS_T"/>
  <source>METHOD set_columnas.
    DATA l_col TYPE zap_alv_columnas.

    LOOP AT i_columnas INTO l_col.
      set_field_text( campo = l_col-campo valor = l_col-descr valor2 = l_col-descr_larga ).
      IF l_col-noout = &apos;X&apos;.
        set_field_noout( l_col-campo ).
      ENDIF.
      IF l_col-input = &apos;X&apos;.
        set_field_input( l_col-campo ).
      ENDIF.
      IF l_col-dosum = &apos;X&apos;.
        set_field( campo = l_col-campo op = &apos;SUM&apos; ).
      ENDIF.
      IF l_col-no_cero = &apos;X&apos;.
        set_field( campo = l_col-campo op = &apos;NO_CERO&apos; ).
      ENDIF.
      IF l_col-f4 = &apos;X&apos;.
        set_field( campo = l_col-campo op = &apos;F4&apos; ).
      ENDIF.
      IF l_col-cambia_decimales = &apos;X&apos;.
        set_field( campo = l_col-campo op = &apos;DECIMALS&apos; valor = l_col-decimales ).
      ENDIF.
*    IF l_col-ancho NE 0.
*      set_field( campo = l_col-campo op = &apos;ANCHO&apos; valor = l_col-ancho ).
*    ENDIF.
    ENDLOOP.

    me-&gt;i_columnas = i_columnas.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_COLUMNAS3" VERSION="1" LANGU="S" DESCRIPT="Datos de columnas desde tabla interna" EXPOSURE="2" STATE="1" EDITORDER="29 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_COLUMNAS3" SCONAME="I_COLUMNAS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ZAP_ALV_COLUMNAS3_T"/>
  <source>METHOD set_columnas3.
    DATA l_col TYPE zap_alv_columnas3.

    i_columnas3 = i_columnas.

    LOOP AT i_columnas INTO l_col.
      set_field_text( campo = l_col-campo valor = l_col-descr ).
      IF l_col-noout = &apos;X&apos;.
        set_field_noout( l_col-campo ).
      ELSE.
        set_field( campo = l_col-campo op = &apos;OUT&apos; ).
      ENDIF.
      IF l_col-input = &apos;X&apos;.
        set_field_input( l_col-campo ).
      ENDIF.
      IF l_col-dosum = &apos;X&apos;.
        set_field( campo = l_col-campo op = &apos;SUM&apos; ).
      ENDIF.
      IF l_col-no_cero = &apos;X&apos;.
        set_field( campo = l_col-campo op = &apos;NO_CERO&apos; ).
      ENDIF.
      IF l_col-f4 = &apos;X&apos;.
        set_field( campo = l_col-campo op = &apos;F4&apos; ).
      ENDIF.
      IF l_col-borrar = &apos;X&apos;.
*        set_field_noout( l_col-campo ).
        set_field( campo = l_col-campo op = &apos;QUITAR&apos; ).
      ENDIF.
      IF l_col-ancho &lt;&gt; 0.
        set_field( campo = l_col-campo op = &apos;ANCHO&apos; valor = l_col-ancho ).
      ENDIF.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_DROPDOWN" VERSION="1" LANGU="S" DESCRIPT="Fija criterios de ordenación" EXPOSURE="2" STATE="1" EDITORDER="9 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_DROPDOWN" SCONAME="HANDLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="INT4"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_DROPDOWN" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <source>METHOD set_dropdown.
    DATA l_drop TYPE lvc_s_drop.

    CLEAR l_drop.
    l_drop-handle = handle.
    l_drop-value  = valor.
    APPEND l_drop TO t_dropdown.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD" VERSION="1" LANGU="S" DESCRIPT="Fija atributos de un campo" EXPOSURE="2" STATE="1" EDITORDER="4 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD" SCONAME="OP" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TEXT10"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD" SCONAME="VALOR2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <source>METHOD set_field.
    DATA: i_column TYPE TABLE OF lvc_fname,
          l_column TYPE lvc_fname,
          l_texto  TYPE scrtext_l, &quot; s,
          l_texto2 TYPE scrtext_l,
          l_text   TYPE c LENGTH 100,
          l_texto3 TYPE scrtext_m,
          l_error  TYPE string.
    DATA l_hotspot TYPE zcl_ap_alv=&gt;t_hotspot.

    FIELD-SYMBOLS: &lt;fcat&gt; TYPE lvc_s_fcat,
                   &lt;fs&gt;   TYPE any.

    SPLIT campo AT &apos;,&apos; INTO TABLE i_column.
    LOOP AT i_column INTO l_column.
      TRANSLATE l_column TO UPPER CASE.
      ASSIGN t_fcat[ fieldname = l_column ] TO &lt;fcat&gt;.
      IF sy-subrc = 0.
        CASE op.
          WHEN &apos;BORRAR&apos;.
            DELETE t_fcat INDEX sy-tabix.
          WHEN &apos;EDIT&apos; OR &apos;INPUT&apos;. &lt;fcat&gt;-edit = &apos;X&apos;.
          WHEN &apos;NOEDIT&apos; OR &apos;NOINPUT&apos;. &lt;fcat&gt;-edit = &apos;&apos;.
          WHEN &apos;OUT&apos;. &lt;fcat&gt;-no_out = &apos;&apos;.
          WHEN &apos;NOOUT&apos; OR &apos;NO_OUT&apos;. &lt;fcat&gt;-no_out = &apos;X&apos;.
          WHEN &apos;QUITAR&apos;. &lt;fcat&gt;-tech = &apos;X&apos;.
          WHEN &apos;SUM&apos; OR &apos;DOSUM&apos;. &lt;fcat&gt;-do_sum = &apos;X&apos;.
          WHEN &apos;MERGE&apos;. &lt;fcat&gt;-no_merging = &apos;&apos;.
          WHEN &apos;KEY&apos;. &lt;fcat&gt;-key = &apos;X&apos;.
          WHEN &apos;FIX&apos;. &lt;fcat&gt;-fix_column = &apos;X&apos;.
          WHEN &apos;LONG&apos;. &lt;fcat&gt;-outputlen = valor.
          WHEN &apos;NO_CERO&apos;. &lt;fcat&gt;-no_zero = &apos;X&apos;.
          WHEN &apos;CHECKBOX&apos;. &lt;fcat&gt;-checkbox = &apos;X&apos;.
          WHEN &apos;ICON&apos;. &lt;fcat&gt;-icon = &apos;X&apos;.
          WHEN &apos;COLOR&apos;. &lt;fcat&gt;-emphasize = valor.
          WHEN &apos;ANCHO&apos;. &lt;fcat&gt;-dd_outlen = valor.
                        &lt;fcat&gt;-outputlen = valor.
                        &lt;fcat&gt;-col_opt   = &apos;&apos;.
          WHEN &apos;DECIMALS&apos;. &lt;fcat&gt;-decimals_o = valor.
                           &lt;fcat&gt;-decimals   = valor.
          WHEN &apos;DRDN_FIELD&apos;.
            &lt;fcat&gt;-drdn_field = campo.
          WHEN &apos;DROPDOWN&apos;.
            &lt;fcat&gt;-drdn_hndl = valor.
          WHEN &apos;F4&apos;.
            &lt;fcat&gt;-f4availabl = &apos;X&apos;.
            CLEAR gs_f4.
            gs_f4-fieldname = l_column.
            gs_f4-register  = &apos;X&apos;.
*      gs_f4-getbefore  = &apos;X&apos;.
*      gs_f4-chngeafter = &apos;X&apos;.
            INSERT gs_f4 INTO TABLE gt_f4.
          WHEN &apos;HOTSPOT&apos;.
            &lt;fcat&gt;-hotspot = &apos;X&apos;.
            IF NOT valor IS INITIAL.
              l_hotspot-campo       = l_column.
              l_hotspot-transaccion = valor.
              l_texto = valor.
              IF l_texto(4) = &apos;IDA_&apos;.
                l_hotspot-filtro = valor2.
              ELSE.
                l_hotspot-campo_ref = valor2.
              ENDIF.
              APPEND l_hotspot TO i_hotspot.
            ENDIF.
          WHEN &apos;BUTTON&apos;.
            &lt;fcat&gt;-style = cl_gui_alv_grid=&gt;mc_style_button.
          WHEN &apos;TEXTO&apos;.
            l_texto = valor.
            IF valor2 IS INITIAL.
              l_texto2 = valor.
            ELSE.
              l_texto2 = valor2.
            ENDIF.

            IF valor IS INITIAL AND valor2 IS INITIAL.
              l_text = l_column.
              TRANSLATE l_text+1 TO LOWER CASE.
              l_text+1 = translate( val  = l_text+1
                                    from = `_`
                                    to   = ` ` ).
              l_texto  = l_text.
              l_texto2 = l_text.
              l_texto3 = l_text.
            ENDIF.
            IF l_texto3 IS INITIAL.
              l_texto3 = l_texto2.
            ENDIF.

            &lt;fcat&gt;-scrtext_m = l_texto3.
            &lt;fcat&gt;-scrtext_s = l_texto.
            &lt;fcat&gt;-coltext   = l_texto.
            &lt;fcat&gt;-scrtext_l = l_texto2.

          WHEN &apos;DDIC_REF&apos;.
            &lt;fcat&gt;-ref_table = valor.
            &lt;fcat&gt;-ref_field = valor2.

          WHEN &apos;COL_AFTER&apos;.
            READ TABLE t_fcat INTO DATA(l_fcat) WITH KEY fieldname = valor.
            IF sy-subrc = 0.
              &lt;fcat&gt;-col_pos = l_fcat-col_pos + 1.
              LOOP AT t_fcat ASSIGNING FIELD-SYMBOL(&lt;fcat2&gt;) WHERE col_pos &gt; l_fcat-col_pos AND fieldname &lt;&gt; l_column.
                &lt;fcat2&gt;-col_pos = &lt;fcat2&gt;-col_pos + 1.
              ENDLOOP.
              SORT t_fcat BY row_pos
                             col_pos.
            ENDIF.
          WHEN OTHERS.
            ASSIGN COMPONENT op OF STRUCTURE &lt;fcat&gt; TO &lt;fs&gt;.
            IF sy-subrc = 0.
* DO_SUM A MAXIMO/B MINIMO/C MEDIA
              &lt;fs&gt; = valor.
            ELSE.
              MESSAGE e398(00) WITH &apos;Error en SET_FIELD OP=&apos;(sfo) op
                                    &apos;no definida&apos;(nod) &apos;&apos;.
            ENDIF.
        ENDCASE.
      ELSE.
        IF sy-sysid &lt;&gt; zcl_c=&gt;entorno_produccion OR sy-uname = zcl_c=&gt;usuario_ap.
          CONCATENATE &apos;Campo&apos;(cam) l_column &apos;no existe&apos;(noe) INTO l_error
                      SEPARATED BY space.
          MESSAGE l_error TYPE &apos;I&apos;
                  DISPLAY LIKE &apos;E&apos;.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_DROPDOWN" VERSION="1" LANGU="S" DESCRIPT="Fija un campo como despegable" EXPOSURE="2" STATE="1" EDITORDER="50 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_DROPDOWN" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_DROPDOWN" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_DROPDOWN" SCONAME="VALOR2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_DROPDOWN" SCONAME="DOMINIO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_DROPDOWN" SCONAME="TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_DROPDOWN" SCONAME="CAMPO_DESC" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_DROPDOWN" SCONAME="CAMPO_CLAVE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_DROPDOWN" SCONAME="VALORES" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_DROPDOWN" SCONAME="WHERE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_DROPDOWN" SCONAME="ADD_CLAVE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_DROPDOWN" SCONAME="CARACT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <source>METHOD set_field_dropdown.
    TYPES: BEGIN OF t_reg,
             clave TYPE string,
             descr TYPE string,
           END OF t_reg.

    DATA: l_string     TYPE string,
          i_campos_sel TYPE TABLE OF string,
          l_reg        TYPE t_reg,
          i_lista      TYPE zap_lista_t,
          l_lista      TYPE zap_lista,
          l_campos     TYPE t_campos_desc.
    DATA l_cawnt TYPE cawnt.

    set_field( op = &apos;DROPDOWN&apos; campo = campo valor = valor valor2 = valor2 ).

    IF NOT dominio IS INITIAL.
      SELECT ddtext FROM dd07t
        INTO l_string
       WHERE domname    = dominio
         AND ddlanguage = sy-langu.
        set_dropdown( handle = valor valor = l_string ).
      ENDSELECT.
    ENDIF.

    IF NOT tabla IS INITIAL AND NOT campo_desc IS INITIAL.
      IF NOT add_clave IS INITIAL.
        IF campo_clave IS INITIAL.
          APPEND |{ campo } as clave| TO i_campos_sel.
        ELSE.
          APPEND |{ campo_clave } as clave| TO i_campos_sel.
        ENDIF.
        APPEND |{ campo_desc } as descr| TO i_campos_sel.
        SELECT (i_campos_sel) FROM (tabla)
          INTO l_reg
         WHERE (where).
          CONCATENATE l_reg-clave l_reg-descr INTO l_string SEPARATED BY add_clave.
          set_dropdown( handle = valor valor = l_string ).
        ENDSELECT.
      ELSE.
        SELECT (campo_desc) FROM (tabla)
          INTO l_string
         WHERE (where).
          set_dropdown( handle = valor valor = l_string ).
        ENDSELECT.
      ENDIF.
    ENDIF.

    IF NOT valores IS INITIAL.
      i_lista = zcl_ap_lista=&gt;get_valores_lista( lista = valores ).
      LOOP AT i_lista INTO l_lista.
        IF l_lista-subvalor IS INITIAL.
          set_dropdown( handle = valor valor = l_lista-valor ).
        ELSE.
          set_dropdown( handle = valor valor = l_lista-subvalor ).
        ENDIF.
      ENDLOOP.
    ENDIF.

    IF NOT caract IS INITIAL.
      DATA(i_cawn) = zcl_ap_clasificacion=&gt;get_valores_caract( caract ).
      LOOP AT i_cawn INTO DATA(l_cawn).
        CLEAR l_cawnt.
        SELECT SINGLE atwtb FROM  cawnt
          INTO l_cawnt-atwtb
         WHERE atinn = l_cawn-atinn
           AND atzhl = l_cawn-atzhl
           AND spras = sy-langu
           AND adzhl = l_cawn-adzhl.
        IF sy-subrc &lt;&gt; 0.
          SELECT atwtb FROM  cawnt
            INTO l_cawnt-atwtb
            UP TO 1 ROWS
           WHERE atinn = l_cawn-atinn
             AND atzhl = l_cawn-atzhl
             AND adzhl = l_cawn-adzhl
           ORDER BY PRIMARY KEY.
          ENDSELECT.
        ENDIF.
        set_dropdown( handle = valor valor = l_cawnt-atwtb ).
      ENDLOOP.

    ENDIF.

    CLEAR l_campos.
    l_campos-campo       = campo.
    l_campos-dominio     = dominio.
    l_campos-tabla       = tabla.
    l_campos-caract      = caract.
    l_campos-where       = where.
    l_campos-campo_desc  = campo_desc.
    l_campos-campo_clave = campo_clave.
    l_campos-valores     = valores.
    l_campos-add_clave   = add_clave.
    APPEND l_campos TO i_campos_desc.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_HOTSPOT" VERSION="1" LANGU="S" DESCRIPT="Marca el campo como editable" EXPOSURE="2" STATE="1" EDITORDER="61 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_HOTSPOT" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_HOTSPOT" SCONAME="AUTO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_HOTSPOT" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_HOTSPOT" SCONAME="VALOR2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <source>METHOD set_field_hotspot.
    DATA: i_campos TYPE TABLE OF string,
          l_campo  TYPE string.

    IF auto IS INITIAL.
      set_field( op = &apos;HOTSPOT&apos; campo = campo valor = valor valor2 = valor2 ).
    ELSE.
      SPLIT campo AT &apos;,&apos; INTO TABLE i_campos.
      LOOP AT i_campos INTO l_campo.
        l_campo = to_upper( l_campo ).
        CASE l_campo.
          WHEN &apos;KUNNR&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;XD03&apos; ).
          WHEN &apos;LIFNR&apos; OR &apos;TDLNR&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;XK03&apos; ).
          WHEN &apos;MATNR&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;MM03&apos; ).
          WHEN &apos;VBELN&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;VA03&apos; ).
          WHEN &apos;VBELN_VA&apos; OR &apos;KDAUF&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;VA03&apos; ).
          WHEN &apos;VBELN_VL&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;VL03N&apos; ).
          WHEN &apos;VBELN_VF&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;VF03&apos; ).
          WHEN &apos;TKNUM&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;VT03N&apos; ).
          WHEN &apos;BANFN&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;ME53N&apos; ).
          WHEN &apos;BNFPO&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;ME53N&apos; valor2 = &apos;BANFN&apos; ).
          WHEN &apos;EBELN&apos; OR &apos;KONNR&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;ME23N&apos; ).
          WHEN &apos;EBELP&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;ME23N&apos; valor2 = &apos;EBELN&apos; ).
          WHEN &apos;KTPNR&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;ME23N&apos; valor2 = &apos;KONNR&apos; ).
          WHEN &apos;BELNR&apos; OR &apos;AUGBL&apos;.
            set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;FB03&apos; ).
          WHEN &apos;BELNR_RBKP&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;MIR7&apos; ).
          WHEN &apos;GJAHR&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;FB03&apos;  valor2 = &apos;BELNR&apos; ).
          WHEN &apos;MBLNR&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;MB03&apos; ).
          WHEN &apos;MJAHR&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;MB03&apos;  valor2 = &apos;MJAHR&apos; ).
          WHEN &apos;EXIDV&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;HUMO&apos; ).
          WHEN &apos;AUFNR&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;CO03&apos; ).
          WHEN &apos;WARPL&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;IP03&apos; ).
          WHEN &apos;TPLNR&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;IL03&apos; ).
          WHEN &apos;EQUNR&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;IE03&apos; ).
          WHEN &apos;MDOCM&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;FO8U&apos; ).
          WHEN &apos;POINT&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;FO8X&apos; ).
          WHEN &apos;QMNUM&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;IW23&apos; ).
          WHEN &apos;TANUM&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;LT21&apos; ).
          WHEN &apos;TBNUM&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;LB03&apos; ).
          WHEN &apos;LQNUM&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;LS23&apos; ).
          WHEN &apos;FKNUM&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;VI03&apos; ).
          WHEN &apos;PLANS&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;PP01_S&apos; ).
          WHEN &apos;ORGEH&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;PP01_O&apos; ).
          WHEN &apos;CURSO&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;CURSO&apos; ).
          WHEN &apos;CURSO_EDT&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;CURSO_EDT&apos; ).
          WHEN &apos;DOCNUM&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;WEDI&apos; ).
          WHEN &apos;ANLN1&apos; OR &apos;ANLN1&apos;.
            set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;AS03&apos; ).
          WHEN &apos;KNUMA&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;VBO3&apos; ).
          WHEN &apos;PS_PSP_PNR&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;CJ13&apos; ).
          WHEN &apos;URL&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;URL&apos; ).
          WHEN &apos;WI_ID&apos; OR &apos;WORKITEMID&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;WI_ID&apos; ).
          WHEN &apos;DOKNR&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;CV03N&apos; ).
          WHEN &apos;LGTYP&apos; OR &apos;LGPLA&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;LS03N&apos; ).
          WHEN &apos;VLTYP&apos; OR &apos;VLPLA&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;LS03N_V&apos; ).
          WHEN &apos;NLTYP&apos; OR &apos;NLPLA&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;LS03N_N&apos; ).
          WHEN &apos;REINR&apos; OR &apos;TRIPNO&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;PR05&apos; ).
          WHEN &apos;PERNR&apos;. set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;PA20&apos; ).
          WHEN &apos;OBSERVACIONES&apos; OR &apos;TEXTO&apos; OR &apos;COMENTARIOS&apos;.
            set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;TEXT&apos; ).
          WHEN OTHERS.
            IF l_campo(3) = &apos;URL&apos;.
              set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = &apos;URL&apos; ).
            ELSE.
              set_field( op = &apos;HOTSPOT&apos; campo = l_campo valor = valor valor2 = valor2 ).
            ENDIF.
        ENDCASE.
      ENDLOOP.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_INPUT" VERSION="1" LANGU="S" DESCRIPT="Marca el campo como editable" EXPOSURE="2" STATE="1" EDITORDER="15 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_INPUT" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <source>METHOD set_field_input.
    set_field( op = &apos;INPUT&apos; campo = campo ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_NOOUT" VERSION="1" LANGU="S" DESCRIPT="Marca el campo como no visible" EXPOSURE="2" STATE="1" EDITORDER="16 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_NOOUT" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <source>METHOD set_field_noout.
    set_field( op = &apos;NO_OUT&apos; campo = campo ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_QUITAR" VERSION="1" LANGU="S" DESCRIPT="Elimina campo de la visualización" EXPOSURE="2" STATE="1" EDITORDER="62 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_QUITAR" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <source>METHOD set_field_quitar.
    set_field( op = &apos;QUITAR&apos; campo = campo ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_TEXT" VERSION="1" LANGU="S" DESCRIPT="Cambia cabeceras de columnas" EXPOSURE="2" STATE="1" EDITORDER="22 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_TEXT" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_TEXT" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_FIELD_TEXT" SCONAME="VALOR2" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <source>METHOD set_field_text.
    set_field( op = &apos;TEXTO&apos; campo = campo valor = valor valor2 = valor2 ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_LAYOUT" VERSION="1" LANGU="S" DESCRIPT="Cambia valores layout" EXPOSURE="2" STATE="1" EDITORDER="3 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_LAYOUT" SCONAME="SEL_MODE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_LAYOUT" SCONAME="ZEBRA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_LAYOUT" SCONAME="INPUT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_LAYOUT" SCONAME="EDIT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_LAYOUT" SCONAME="ANCHO_OPTIMIZADO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_LAYOUT" SCONAME="LIGHTS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_LAYOUT" SCONAME="COLOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_LAYOUT" SCONAME="COLORT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_LAYOUT" SCONAME="STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_LAYOUT" SCONAME="NO_MERGING" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_LAYOUT" SCONAME="NO_TOOLBAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_LAYOUT" SCONAME="NO_ROWMOVE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="12 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_LAYOUT" SCONAME="NO_ROWINS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="13 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <source>METHOD set_layout.
* Indicador de selección:
* http://help.sap.com/saphelp_erp2004/helpdata/en/ef/a2e9eff88311d2b48d006094192fe3/content.htm
    &quot; A -&gt; Fila y columna
    &quot; B (y blanco) Simple
    &quot; D -&gt; Múltiple
    IF sel_mode IS SUPPLIED.
      IF sel_mode = &apos;N&apos;.          &quot; No queremos selección
        layout-no_rowmark = &apos;X&apos;.
      ELSE.
        layout-sel_mode = sel_mode.
      ENDIF.
    ENDIF.

    IF zebra IS SUPPLIED.
      layout-zebra = zebra.
    ENDIF.

    IF input IS SUPPLIED.
      me-&gt;input = input.
    ENDIF.

    IF edit IS SUPPLIED.
      layout-edit = edit.
    ENDIF.

    IF input = &apos;X&apos; OR edit = &apos;X&apos;.
      registrar_enter( ).
      registrar_mod( ).
    ENDIF.

    IF lights IS SUPPLIED.
      layout-excp_fname = lights.
    ENDIF.

    IF color IS SUPPLIED.
      layout-info_fname = color.
    ENDIF.
    IF colort IS SUPPLIED.
      layout-ctab_fname = colort.
    ENDIF.

    IF ancho_optimizado IS SUPPLIED.
      opt_cols = ancho_optimizado.
      layout-cwidth_opt = ancho_optimizado.
    ENDIF.

    IF style IS SUPPLIED.
      layout-stylefname = style.
    ENDIF.

    IF no_merging IS SUPPLIED.
      layout-no_merging = no_merging.
    ENDIF.

    IF no_toolbar IS SUPPLIED.
      layout-no_toolbar = no_toolbar.
    ENDIF.

    IF no_rowmove IS SUPPLIED.
      layout-no_rowmove = no_rowmove.
    ENDIF.

    IF no_rowins IS SUPPLIED.
      layout-no_rowins = no_rowins.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_MARCA_FILAS_SEL" VERSION="1" LANGU="S" DESCRIPT="Fija el campo de selección de la tabla" EXPOSURE="2" STATE="1" EDITORDER="34 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_MARCA_FILAS_SEL" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;CHECK&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_MARCA_FILAS_SEL" SCONAME="VALIDAR_SELECCION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_MARCA_FILAS_SEL" SCONAME="FILA_ACTIVA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_MARCA_FILAS_SEL" SCONAME="T_TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_MARCA_FILAS_SEL" SCONAME="HAY_SEL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <source>METHOD set_marca_filas_sel.
    DATA: l_campo_check TYPE string,
          l_campo       TYPE c LENGTH 80.

    &quot; TODO: variable is assigned but never used (ABAP cleaner)
    FIELD-SYMBOLS: &lt;tabla&gt; TYPE any,
                   &lt;campo&gt; TYPE any.

    IF NOT me-&gt;campo_check IS INITIAL.
      l_campo_check = campo_check.
    ELSE.
      l_campo_check = campo.
    ENDIF.

    IF validar_seleccion = &apos;X&apos;.
      comprobar_cambios( ).
    ENDIF.

    CLEAR i_filas_sel.
    get_filas_sel( ).
    IF i_filas_sel IS INITIAL AND fila_activa = &apos;X&apos;.
      fila-index = get_fila_activa( ).
      IF NOT fila-index IS INITIAL.
        APPEND fila TO i_filas_sel.
      ENDIF.
    ENDIF.

    LOOP AT t_tabla ASSIGNING &lt;tabla&gt;.
      CONCATENATE &apos;&lt;TABLA&gt;-&apos; l_campo_check INTO l_campo.
      ASSIGN (l_campo) TO &lt;campo&gt;.
      IF sy-subrc = 0.
        CLEAR &lt;campo&gt;.
      ENDIF.
    ENDLOOP.

    LOOP AT i_filas_sel INTO fila WHERE rowtype = &apos;&apos;.
      ASSIGN t_tabla[ fila-index ] TO &lt;tabla&gt;.
      IF sy-subrc = 0.
        ASSIGN (l_campo) TO &lt;campo&gt;.
        IF sy-subrc = 0.
          &lt;campo&gt; = &apos;X&apos;.
          hay_sel = &apos;X&apos;.
        ENDIF.
      ENDIF.
    ENDLOOP.

    IF validar_seleccion = &apos;X&apos; AND hay_sel IS INITIAL.
      MESSAGE TEXT-saf TYPE &apos;I&apos;. &quot;&apos;Seleccione alguna fila&apos;
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_ORDEN" VERSION="1" LANGU="S" DESCRIPT="Fija criterios de ordenación" EXPOSURE="2" STATE="1" EDITORDER="5 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_ORDEN" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_ORDEN" SCONAME="UP" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_ORDEN" SCONAME="DOWN" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_ORDEN" SCONAME="GROUP" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_ORDEN" SCONAME="SUBTOT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PARVALUE="&apos;&apos;"/>
  <source>METHOD set_orden.
    DATA: l_columname TYPE lvc_fname,
          i_columnas  TYPE TABLE OF lvc_fname,
          l_subtot    TYPE abap_bool,
          l_len       TYPE i,
          l_sort      TYPE lvc_s_sort.

    l_columname = campo.
    SPLIT campo AT &apos;,&apos; INTO TABLE i_columnas.
    LOOP AT i_columnas INTO l_columname.
      l_subtot = subtot.
      IF l_columname CS &apos;*&apos;.
        l_len = strlen( l_columname ).
        IF l_len &gt; 2.
          l_len = l_len - 1.
          IF l_columname+l_len(1) = &apos;*&apos;.
            l_columname = l_columname(l_len).
            l_subtot = &apos;X&apos;.
          ENDIF.
        ENDIF.
      ENDIF.

      CLEAR l_sort.
      l_sort-spos      = lines( t_sort ).
      l_sort-spos      = l_sort-spos + 1.
      l_sort-fieldname = l_columname.
      l_sort-up        = up.
      l_sort-down      = down.
      l_sort-subtot    = l_subtot.
      l_sort-group     = group.
      APPEND l_sort TO t_sort.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_SELECCION" VERSION="1" LANGU="S" DESCRIPT="Fija el campo de selección de la tabla" EXPOSURE="2" STATE="1" EDITORDER="36 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_SELECCION" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;CHECK&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_SELECCION" SCONAME="T_TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE"/>
  <source>METHOD set_seleccion.
    DATA: l_campo_check TYPE string,
          l_row         TYPE lvc_s_row,
          l_campo       TYPE string,
          t_row         TYPE lvc_t_row.

    &quot; TODO: variable is assigned but never used (ABAP cleaner)
    FIELD-SYMBOLS: &lt;check&gt; TYPE any,
                   &lt;campo&gt; TYPE c.

    IF NOT me-&gt;campo_check IS INITIAL.
      l_campo_check = campo_check.
    ELSE.
      l_campo_check = campo.
    ENDIF.

    IF NOT l_campo_check IS INITIAL.
      LOOP AT t_tabla ASSIGNING &lt;check&gt;.
        l_row-index = sy-tabix.
        CONCATENATE &apos;&lt;CHECK&gt;-&apos; l_campo_check INTO l_campo.
        ASSIGN (l_campo) TO &lt;campo&gt;.
        IF &lt;campo&gt; = &apos;X&apos;.
          APPEND l_row TO t_row.
        ENDIF.
      ENDLOOP.
      o_grid-&gt;set_selected_rows( it_index_rows            = t_row
                                 is_keep_other_selections = &apos;&apos; ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_TITULO" VERSION="1" LANGU="S" DESCRIPT="Define título de grid" EXPOSURE="2" STATE="1" EDITORDER="30 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_TITULO" SCONAME="TITULO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <source>METHOD set_titulo.
    DATA l_title TYPE lvc_title.

    l_title = titulo.
    o_grid-&gt;set_gridtitle( i_gridtitle = l_title ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_VALOR_CAMPO" VERSION="1" LANGU="S" DESCRIPT="Modifica el valor del campo" EXPOSURE="2" STATE="1" EDITORDER="48 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_VALOR_CAMPO" SCONAME="COLUM" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="NUMC2" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_VALOR_CAMPO" SCONAME="CAMPO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_VALOR_CAMPO" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="0" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_VALOR_CAMPO" SCONAME="QUITAR_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_VALOR_CAMPO" SCONAME="QUITAR_COLOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_VALOR_CAMPO" SCONAME="CAMPO_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="FIELDNAME" PARVALUE="&apos;STYLE&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_VALOR_CAMPO" SCONAME="CAMPO_COLOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="FIELDNAME" PARVALUE="&apos;COLOR&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SET_VALOR_CAMPO" SCONAME="REGISTRO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <source>METHOD set_valor_campo.
    DATA: l_col   TYPE zap_alv_columnas,
          l_campo TYPE string.

    FIELD-SYMBOLS: &lt;fs&gt;    TYPE any,
                   &lt;color&gt; TYPE lvc_t_scol,
                   &lt;style&gt; TYPE lvc_t_styl.

    l_col = get_col( colum = colum campo = campo ).

    IF l_col IS INITIAL.
      RETURN.
    ENDIF.

    CONCATENATE &apos;REGISTRO-&apos; l_col-campo INTO l_campo.
    ASSIGN (l_campo) TO &lt;fs&gt;.
    IF sy-subrc &lt;&gt; 0.
      RETURN.
    ENDIF.

    &lt;fs&gt; = valor.

    IF quitar_color = &apos;X&apos;.
      CONCATENATE &apos;REGISTRO-&apos; campo_color INTO l_campo.
      ASSIGN (l_campo) TO &lt;color&gt;.
      IF sy-subrc = 0.
        DELETE &lt;color&gt; WHERE fname = l_col-campo.
      ENDIF.
    ENDIF.

    IF quitar_style = &apos;X&apos;.
      CONCATENATE &apos;REGISTRO-&apos; campo_style INTO l_campo.
      ASSIGN (l_campo) TO &lt;style&gt;.
      IF sy-subrc = 0.
        DELETE &lt;style&gt; WHERE fieldname = l_col-campo.
      ENDIF.
    ENDIF.
  ENDMETHOD.                    &quot; GET_VALOR_CAMPO</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SHOW" VERSION="1" LANGU="S" DESCRIPT="Muestra listado" EXPOSURE="2" STATE="1" EDITORDER="2 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SHOW" SCONAME="HANDLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SLIS_HANDL" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SHOW" SCONAME="INCLUDE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-REPID" PARVALUE="SY-CPROG"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SHOW" SCONAME="INTERNAL_TABNAME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SLIS_TABNAME" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SHOW" SCONAME="PROGRAMA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-REPID" PARVALUE="SY-CPROG"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SHOW" SCONAME="IT_FIELDCATALOG" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="LVC_T_FCAT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SHOW" SCONAME="TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="STANDARD TABLE"/>
  <source>METHOD show.
    DATA: l_fecha_buffer     TYPE d,
          l_bypassing_buffer TYPE c LENGTH 1,
          l_buffer           TYPE c LENGTH 1.

    IF input = &apos;X&apos;.
      o_grid-&gt;set_ready_for_input( i_ready_for_input = 1 ).
    ENDIF.

    IF NOT t_dropdown IS INITIAL.
      o_grid-&gt;set_drop_down_table( it_drop_down = t_dropdown ).
    ENDIF.

    IF NOT gt_f4 IS INITIAL.
      o_grid-&gt;register_f4_for_fields( it_f4 = gt_f4 ).
    ENDIF.

*  variant-report = sy-repid.
    variant-handle = handle.

    IF NOT it_fieldcatalog IS INITIAL.
      t_fcat = it_fieldcatalog.
    ELSEIF me-&gt;estructura IS INITIAL AND NOT internal_tabname IS INITIAL.
      get_catalogo_campos_tabint( EXPORTING include          = include
                                            programa         = programa
                                            internal_tabname = internal_tabname
                                  CHANGING  it_fieldcatalog  = t_fcat
                                            tabla            = tabla ).
      IF t_fcat IS INITIAL.
        MESSAGE &apos;No se ha podido identificar campos de tabla interna&apos;(nti) TYPE &apos;E&apos;.
      ENDIF.
    ELSEIF me-&gt;estructura IS INITIAL AND t_fcat IS INITIAL.
      set_campos_tabint( tabla ).
    ENDIF.

*With parameter I_BUFFER_ACTIVE = &apos;X&apos;, buffer A is activated.If I_BUFFER_ACTIVE remains initial, the contents are nevertheless buffered in buffer B.
* For dynamic reasons, you have to forgo buffering completely (for example, a constant dynamic creation of  structures) so that you have the following options as a developer:
*1. Set SET/GET parameters ALVBUFFER to the current date.All report, variant or field catalog buffers are reset until the current date exceeds the date of the SET/GET parameter.
*2. Set I_BYPASSING_BUFFER = &apos;X&apos; on the call interface for the function modules and class methods
*- Note 339258 - ALV buffer: concept, recommendations and known errors (BC-SRV-ALV, consulting)
*- Note 122975 - Resetting buffering of ALV field catalog (BC-SRV-ALV, Consulting)
*- Note 356792 - ALV buffer: SET/GET parameter ALVBUFFER created
    IF sy-sysid = zcl_c=&gt;entorno_desarrollo OR sin_buffer = &apos;X&apos;.
      cl_gui_alv_grid=&gt;m_buffer_inactive = &apos;X&apos;.
      l_fecha_buffer = sy-datum.                              &quot; + 1.
      SET PARAMETER ID &apos;ALVBUFFER&apos; FIELD l_fecha_buffer.
      l_bypassing_buffer = &apos;X&apos;.
* SUBMIT BALVBUFDEL
    ELSE.
      l_buffer = &apos;X&apos;.
    ENDIF.

    IF NOT tabla IS INITIAL.
      table_ref = REF #( tabla ).
    ENDIF.

*The I_SAVE &quot;Options for saving layouts&quot; parameter can have the following values:
*
*U Only user specific layouts can be saved
*X Only global layouts can be saved
*A Both user specific and global layouts can be saved
*Space Layouts can not be saved
*S Si es superusuario puede grabar todo, sino, solo layouts de usuario.
    DATA(l_restriccion_layout) = restriccion_layout.
    IF restriccion_layout = &apos;S&apos;.
      IF zcl_ap_autorizacion=&gt;es_sapall( ).
        l_restriccion_layout = &apos;A&apos;.
      ELSE.
        l_restriccion_layout = &apos;U&apos;.
      ENDIF.
    ENDIF.

    o_grid-&gt;set_table_for_first_display( EXPORTING i_buffer_active      = l_buffer
                                                   i_bypassing_buffer   = l_bypassing_buffer
                                                   i_structure_name     = estructura
                                                   is_layout            = layout
                                                   i_save               = l_restriccion_layout
                                                   i_default            = default_layout
                                                   is_variant           = variant
                                                   it_toolbar_excluding = t_tool
                                         CHANGING  it_outtab            = tabla
                                                   it_sort              = t_sort
                                                   it_fieldcatalog      = t_fcat
                                                   it_filter            = i_filter ).

    cl_gui_control=&gt;set_focus( control = o_grid ).
    cl_gui_cfw=&gt;flush( ).

    inicio = &apos;X&apos;.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SHOW_BUTTON" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="54 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="SHOW_BUTTON" SCONAME="BUTTON" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="SY-UCOMM"/>
  <source>METHOD show_button.
    DATA allowed TYPE t_allowed_but.

    CHECK button IS NOT INITIAL.
    IF NOT line_exists( allowed_buttons[ function = button ] ).
      allowed = button.
      APPEND allowed TO allowed_buttons.
      DELETE excluded_buttons WHERE table_line = button.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="TRADUCE_COLOR" VERSION="1" LANGU="S" DESCRIPT="Traduce código de color" EXPOSURE="2" STATE="1" EDITORDER="19 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="TRADUCE_COLOR" SCONAME="CODIGO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_ALV_GRID" CMPNAME="TRADUCE_COLOR" SCONAME="COLOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="INT4"/>
  <source>METHOD traduce_color.
    DATA: l_codigo  TYPE c LENGTH 12,
          l_inicial TYPE c LENGTH 1.

* http://www.abap.es/Centro_ALV_colores.htm
    l_codigo = codigo.
    l_codigo = to_upper( l_codigo ).

    l_inicial = codigo.

    CASE l_inicial.
      WHEN &apos;R&apos;.    &quot; Rojo
        color = c_color_rojo.
      WHEN &apos;B&apos;.   &quot; Azul
        IF l_codigo &lt;&gt; &apos;BLANCO&apos;.
          color = c_color_azul.
        ENDIF.
      WHEN &apos;N&apos;.    &quot; Naranja
        color = c_color_naranja.
      WHEN &apos;V&apos;.    &quot; Verde
        color = c_color_verde.
      WHEN &apos;G&apos;.    &quot; Gris
        color = c_color_gris.
      WHEN &apos;T&apos;.
        color = c_color_amarillo_osc.
      WHEN &apos;A&apos;.
        color = c_color_amarillo.
      WHEN &apos;L&apos;.
        color = c_color_blanco.
      WHEN OTHERS.
        CASE l_codigo.
          WHEN &apos;BLANCO&apos;.
            color = c_color_blanco.
          WHEN &apos;AZUL&apos;.
            color = c_color_azul.
          WHEN &apos;AMARILLO&apos;.
            color = c_color_amarillo.
          WHEN &apos;AMARILLO OSC&apos;.
            color = c_color_amarillo_osc.
        ENDCASE.
    ENDCASE.
  ENDMETHOD.</source>
 </method>
</CLAS>

<?xml version="1.0" encoding="utf-8"?>
<CLAS CLSNAME="ZCL_AP_EXCEL_OLE" VERSION="1" LANGU="S" DESCRIPT="Generación Excels vía OLE" CATEGORY="00" EXPOSURE="2" STATE="1" RELEASE="0" CLSCCINCL="X" FIXPT="X" UNICODE="X" CLSBCCAT="00" DURATION_TYPE="0 " RISK_LEVEL="0 " REFCLSNAME="ZCL_AP_OLE">
 <localImplementation>*&quot;* local class implementation for public class
*&quot;* use this source file for the implementation part of
*&quot;* local helper classes

type-pools abap.</localImplementation>
 <localTypes>*&quot;* use this source file for any type declarations (class
*&quot;* definitions, interfaces or data types) you need for method
*&quot;* implementation or private method&apos;s signature</localTypes>
 <localMacros>*&quot;* use this source file for any macro definitions you need
*&quot;* in the implementation part of the class</localMacros>
 <typeUsage CLSNAME="ZCL_AP_EXCEL_OLE" TYPEGROUP="ABAP" VERSION="1" TPUTYPE="0" IMPLICIT="X"/>
 <typeUsage CLSNAME="ZCL_AP_EXCEL_OLE" TYPEGROUP="OLE2" VERSION="1" TPUTYPE="0" IMPLICIT="X"/>
 <forwardDeclaration>ABAP</forwardDeclaration>
 <forwardDeclaration>OLE2</forwardDeclaration>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="ACTIVE_SHEET" VERSION="1" LANGU="S" DESCRIPT="Hoja activa" EXPOSURE="2" STATE="1" EDITORDER="7 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="OLE2_OBJECT" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_ALIGN_CENTER" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="8 " ATTDECLTYP="2" ATTVALUE="-4108" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_BORDE_BOTTON" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="3 " ATTDECLTYP="2" ATTVALUE="9" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_BORDE_HORIZONTAL" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="19 " ATTDECLTYP="2" ATTVALUE="12" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_BORDE_LEFT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="2 " ATTDECLTYP="2" ATTVALUE="7" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_BORDE_RIGHT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="4 " ATTDECLTYP="2" ATTVALUE="10" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_BORDE_TOP" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="1 " ATTDECLTYP="2" ATTVALUE="8" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_BORDE_VERTICAL" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="18 " ATTDECLTYP="2" ATTVALUE="11" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_COLORINDEX_NEGRO" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="6 " ATTDECLTYP="2" ATTVALUE="-4105" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_COLOR_AZUL" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="9 " ATTDECLTYP="2" ATTVALUE="41" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_COLOR_FONDO_AMARILLO" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="12 " ATTDECLTYP="2" ATTVALUE="65535" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_COLOR_FONDO_AMARILLO_CLARO" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="13 " ATTDECLTYP="2" ATTVALUE="13434879" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_COLOR_FONDO_AZUL" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="17 " ATTDECLTYP="2" ATTVALUE="16764057" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_COLOR_FONDO_SALMON" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="15 " ATTDECLTYP="2" ATTVALUE="10079487" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_COLOR_FONDO_VERDE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="14 " ATTDECLTYP="2" ATTVALUE="5296274" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_ESTILO_SOLIDO" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="5 " ATTDECLTYP="2" ATTVALUE="1" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_XLNONE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="20 " ATTDECLTYP="2" ATTVALUE="-4142" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="C_XLTOLEFT" VERSION="1" LANGU="S" DESCRIPT="Desplazamiento a la izquierda" EXPOSURE="2" STATE="1" EDITORDER="11 " ATTDECLTYP="2" ATTVALUE="-4159" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="FONDO_CELDA" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="16 " ATTDECLTYP="0" ATTVALUE="-999" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="FUENTE_COLOR" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="7 " ATTDECLTYP="0" ATTVALUE="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="FUENTE_CURSIVA" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="4 " ATTDECLTYP="0" ATTVALUE="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="FUENTE_FONDO" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="10 " ATTDECLTYP="0" ATTVALUE="-999" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="FUENTE_NEGRITA" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="3 " ATTDECLTYP="0" ATTVALUE="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="FUENTE_NOMBRE" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="2 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="FUENTE_SUBRAYADO" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="5 " ATTDECLTYP="0" ATTVALUE="-4142" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="FUENTE_TAMANYO" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="6 " ATTDECLTYP="0" ATTVALUE="10" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="RANGO" VERSION="1" LANGU="S" DESCRIPT="Rango" EXPOSURE="0" STATE="1" EDITORDER="1 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="OLE2_OBJECT" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <inheritance CLSNAME="ZCL_AP_EXCEL_OLE" REFCLSNAME="ZCL_AP_OLE" VERSION="1" STATE="1">
  <redefinition CLSNAME="ZCL_AP_EXCEL_OLE" REFCLSNAME="ZCL_AP_OLE" VERSION="1" MTDNAME="CONTROL_ERROR" EXPOSURE="0"/>
  <redefinition CLSNAME="ZCL_AP_EXCEL_OLE" REFCLSNAME="ZCL_AP_OLE" VERSION="1" MTDNAME="FREE" EXPOSURE="0"/>
 </inheritance>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="AUTOFIT" VERSION="1" LANGU="S" DESCRIPT="Autofit" EXPOSURE="2" STATE="1" EDITORDER="41 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD autofit.
    DATA l_columns TYPE ole2_object.

    CALL METHOD OF selection &apos;Columns&apos; = l_columns.
    CALL METHOD OF l_columns &apos;Autofit&apos;.
    FREE OBJECT l_columns.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="BORRAR_MARCADOR" VERSION="1" LANGU="S" DESCRIPT="Borrar marcador" EXPOSURE="2" STATE="1" EDITORDER="6 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="BORRAR_MARCADOR" SCONAME="MARCADOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD borrar_marcador.
    DATA l_marcador TYPE ole2_object.

    l_marcador = get_obj( origen = documento
                          metodo = &apos;Bookmarks&apos;
                          p1 = marcador ).
    exec_metodo( obj = l_marcador metodo = &apos;Delete&apos; ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="BORRAR_SELECCION" VERSION="1" LANGU="S" DESCRIPT="Borrar selección" EXPOSURE="2" STATE="1" EDITORDER="39 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="BORRAR_SELECCION" SCONAME="SHIFT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_XLTOLEFT"/>
  <source>METHOD borrar_seleccion.

    CHECK NOT rango IS INITIAL.
    CALL METHOD OF rango &apos;Delete&apos;
      EXPORTING
        #1 = shift.    &quot; Shift
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CARGAR_PLANTILLA" VERSION="1" LANGU="S" DESCRIPT="Crea documento Word" EXPOSURE="2" STATE="1" EDITORDER="3 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CARGAR_PLANTILLA" SCONAME="FICHERO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD cargar_plantilla.
    open_file( obj = documento fichero = fichero ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CELDA2FILACOL" VERSION="1" LANGU="S" DESCRIPT="Traduce valor celda a posición formato interno Excel" EXPOSURE="2" STATE="1" EDITORDER="30 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CELDA2FILACOL" SCONAME="CELDA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CELDA2FILACOL" SCONAME="FILA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="0" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CELDA2FILACOL" SCONAME="COLUMNA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <source>METHOD celda2filacol.
    DATA: l_lon   TYPE i,
          l_index TYPE i,
          l_letra TYPE c LENGTH 1,
          l_col   TYPE c LENGTH 2.

    l_lon = strlen( celda ).
    DO l_lon TIMES.
      l_index = sy-index - 1.
      l_letra = celda+l_index(1).
      IF l_letra CO &apos;ABCDEFGHIJKLMNOPQRSTUVWXYZ&apos;.
        CONCATENATE l_col l_letra INTO l_col.
      ELSE.
        EXIT.
      ENDIF.
    ENDDO.
    fila = celda+l_index.
    columna = indice_columna( l_col ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CELDA2POS" VERSION="1" LANGU="S" DESCRIPT="Traduce valor celda a posición formato interno Excel" EXPOSURE="2" STATE="1" EDITORDER="28 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CELDA2POS" SCONAME="CELDA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CELDA2POS" SCONAME="POSICION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD celda2pos.
    DATA: l_row    TYPE i,
          l_col    TYPE i,
          l_coltxt TYPE c LENGTH 3,
          l_rowtxt TYPE c LENGTH 5.

    celda2filacol( EXPORTING celda   = celda
                   IMPORTING fila    = l_row
                             columna = l_col ).
    l_coltxt = l_col.
    l_rowtxt = l_row.
    CONCATENATE &apos;R&apos; l_rowtxt &apos;C&apos; l_coltxt INTO posicion.
    CONDENSE posicion NO-GAPS.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CELDA_2_FILA_COL" VERSION="1" LANGU="S" DESCRIPT="Convierte celda en forma AA99 a fila columna" EXPOSURE="2" STATE="1" EDITORDER="47 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CELDA_2_FILA_COL" SCONAME="CELDA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CELDA_2_FILA_COL" SCONAME="FILA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CELDA_2_FILA_COL" SCONAME="COLUMNA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <source>METHOD celda_2_fila_col.
    DATA: l_celda TYPE string,
          l_fila  TYPE string.

    l_celda = celda.

    fila = zcl_ap_string=&gt;busca_numeros( string = l_celda cualquiera = &apos;X&apos; ).
    l_fila = fila.
    CONDENSE l_fila NO-GAPS.
    SPLIT l_celda AT l_fila INTO columna l_celda.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="COLOR_RANGO" VERSION="1" LANGU="S" DESCRIPT="Fija valor celda" EXPOSURE="2" STATE="1" EDITORDER="23 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="COLOR_RANGO" SCONAME="COLOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="COLOR_RANGO" SCONAME="TRAMA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="1"/>
  <source>METHOD color_rango.
    DATA l_celda TYPE ole2_object.

    CHECK NOT selection IS INITIAL.
    l_celda = get_obj( origen = selection metodo = &apos;Interior&apos; ).

    SET PROPERTY OF l_celda &apos;ColorIndex&apos; = color.
    SET PROPERTY OF l_celda &apos;Pattern&apos; = trama.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONFIGURAR_PAGINA" VERSION="1" LANGU="S" DESCRIPT="Condigurar pagina" EXPOSURE="2" STATE="1" EDITORDER="37 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONFIGURAR_PAGINA" SCONAME="RIGHTFOOTER" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONFIGURAR_PAGINA" SCONAME="CENTERHEADER" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONFIGURAR_PAGINA" SCONAME="PREVIEW" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PAROPTIONL="X"/>
  <source>METHOD configurar_pagina.
    &quot; TODO: parameter PREVIEW is never used (ABAP cleaner)

    DATA: l_activesheet TYPE ole2_object,
          l_pagesetup   TYPE ole2_object.

    l_activesheet = get_obj( origen = app metodo = &apos;ActiveSheet&apos; ).
    l_pagesetup = get_obj( origen = l_activesheet metodo = &apos;PageSetup&apos; ).
    set_prop( obj = l_pagesetup prop = &apos;CenterHeader&apos; valor = centerheader ).
    set_prop( obj = l_pagesetup prop = &apos;RightFooter&apos; valor = rightfooter ).

    exec_metodo( obj = l_activesheet
               metodo = &apos;PrintPreview&apos; ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONSTRUCTOR" VERSION="1" LANGU="S" DESCRIPT="CONSTRUCTOR" EXPOSURE="2" STATE="1" EDITORDER="1 " DISPID="0 " MTDTYPE="2" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONSTRUCTOR" SCONAME="O_LOG" VERSION="1" LANGU="S" DESCRIPT="Log" CMPTYPE="1" MTDTYPE="2" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="3" TYPE="ZCL_AP_LOG" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONSTRUCTOR" SCONAME="MOSTRAR_ERRORES" VERSION="1" LANGU="S" DESCRIPT="Mostrar errores" CMPTYPE="1" MTDTYPE="2" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PARVALUE="&apos;I&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONSTRUCTOR" SCONAME="VISIBLE" VERSION="1" LANGU="S" DESCRIPT="Indicador de una posición" CMPTYPE="1" MTDTYPE="2" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="INT1" PARVALUE="0"/>
  <source>METHOD constructor.
    super-&gt;constructor(
        objeto          = &apos;excel.application&apos;
        mostrar_errores = mostrar_errores
        o_log           = o_log ).

    set_prop_app( prop = &apos;Visible&apos; valor = visible ).
    set_prop_app( prop = &apos;ScreenUpdating&apos; valor = visible ).
    documento = get_obj_app( &apos;WorkBooks&apos; ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_OLE" CMPNAME="CONTROL_ERROR" VERSION="0" EXPOSURE="0" STATE="0" EDITORDER="0 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD control_error.
    DATA l_subrc TYPE sy-subrc.

    l_subrc = sy-subrc.

    IF l_subrc &lt;&gt; 0.
      error = &apos;X&apos;.

      IF mostrar_errores = &apos;X&apos;.
        IF NOT o_log IS INITIAL.
          o_log-&gt;l_msg2 = texto2.
          o_log-&gt;l_msg3 = texto3.
          o_log-&gt;msg_error( msgv1 = texto
                            msgv2 = o_log-&gt;l_msg2
                            msgv3 = o_log-&gt;l_msg3 ).
          IF me-&gt;mostrar_errores = &apos;X&apos;.
            o_log-&gt;grabar( ).
          ENDIF.
        ENDIF.
      ENDIF.

      hay_error = &apos;X&apos;.
      fijar_visible( ).

      IF mostrar_errores = &apos;X&apos;.
        IF me-&gt;mostrar_errores = &apos;X&apos;.
          MESSAGE e398(00) WITH texto texto2 texto3.
        ELSEIF me-&gt;mostrar_errores = &apos;I&apos;.
          MESSAGE s398(00) WITH texto texto2 texto3.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONVERT_COLUMNA" VERSION="1" LANGU="S" DESCRIPT="Convierte de entero a letras (columna)" EXPOSURE="2" STATE="1" EDITORDER="10 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONVERT_COLUMNA" SCONAME="COLUMNA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONVERT_COLUMNA" SCONAME="LETRAS" VERSION="1" LANGU="S" DESCRIPT="Componente del número de versión" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="CHAR2"/>
  <source>METHOD convert_columna.
    DATA: lv_column TYPE int4,
          lv_module TYPE int4,
          lv_uccpi  TYPE i,
          lv_text   TYPE sychar02.

    lv_column = columna.
    WHILE lv_column &gt; 0.
      lv_module = ( lv_column - 1 ) MOD 26.
      lv_uccpi  = 65 + lv_module.

      lv_column = ( lv_column - lv_module ) / 26.

      lv_text   = cl_abap_conv_in_ce=&gt;uccpi( lv_uccpi ).
      CONCATENATE lv_text letras INTO letras.
    ENDWHILE.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONVERT_RANGO" VERSION="1" LANGU="S" DESCRIPT="Convierte rango de enteros a letras" EXPOSURE="2" STATE="1" EDITORDER="11 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONVERT_RANGO" SCONAME="FILA_INI" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONVERT_RANGO" SCONAME="COLUMNA_INI" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONVERT_RANGO" SCONAME="FILA_FIN" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONVERT_RANGO" SCONAME="COLUMNA_FIN" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CONVERT_RANGO" SCONAME="RANGO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD convert_rango.
    DATA: l_col_ini  TYPE c LENGTH 2,
          l_fila_ini TYPE c LENGTH 5,
          l_col_fin  TYPE c LENGTH 2,
          l_fila_fin TYPE c LENGTH 5.

    l_col_ini = convert_columna( columna_ini ).
    l_fila_ini = fila_ini.

    IF columna_fin IS INITIAL.
      l_col_fin = l_col_ini.
      l_fila_fin = l_fila_fin.
    ELSE.
      l_col_fin = convert_columna( columna_fin ).
      l_fila_fin = fila_fin.
    ENDIF.

    CONCATENATE l_col_ini l_fila_ini &apos;:&apos; l_col_fin l_fila_fin
                INTO rango.
    CONDENSE rango NO-GAPS.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="COPIAR_HOJA" VERSION="1" LANGU="S" DESCRIPT="Copiar hoja" EXPOSURE="2" STATE="1" EDITORDER="43 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="COPIAR_HOJA" SCONAME="ORIGEN" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PARVALUE="&apos;Hoja1&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="COPIAR_HOJA" SCONAME="DESTINO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PARVALUE="&apos;&apos;"/>
  <source>METHOD copiar_hoja.
    DATA: work_copy TYPE ole2_object,
          workarea  TYPE ole2_object,
          l_destino TYPE string.

    work_copy = get_obj_app( metodo = &apos;Sheets&apos; p1 = origen ).
    workarea = get_obj_app( metodo = &apos;Sheets&apos; p1 = origen ).
    exec_metodo( obj = workarea metodo = &apos;Activate&apos; ).
    exec_metodo( obj = workarea metodo = &apos;Copy&apos; p1 = work_copy no_write = &apos;X&apos; ).

    get_active_sheet( ).
    exec_metodo( obj = active_sheet metodo = &apos;Select&apos; ).

    IF NOT destino IS INITIAL.
      l_destino = destino.
    ENDIF.

    set_prop( obj = active_sheet prop = &apos;Name&apos; valor = l_destino ).
    exec_metodo( obj = workarea metodo = &apos;Move&apos;  p2 = active_sheet no_write = &apos;X&apos; ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="COPIAR_TABLA" VERSION="1" LANGU="S" DESCRIPT="Pegar columna de tabla interna" EXPOSURE="2" STATE="1" EDITORDER="22 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="COPIAR_TABLA" SCONAME="I_TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE"/>
  <source>METHOD copiar_tabla.
    DATA l_rc TYPE i.

    cl_gui_frontend_services=&gt;clipboard_export(
      IMPORTING
        data                 = i_TABLA
      CHANGING
        rc                   = l_rc
      EXCEPTIONS
        cntl_error           = 1
        error_no_gui         = 2
        not_supported_by_gui = 3
        OTHERS               = 4 ).
    IF sy-subrc &lt;&gt; 0.
      MESSAGE &apos;Error exportando al portapapeles&apos; TYPE &apos;I&apos;.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="CREAR_DOCUMENTO" VERSION="1" LANGU="S" DESCRIPT="Crea documento Word" EXPOSURE="2" STATE="1" EDITORDER="2 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD crear_documento.
    exec_metodo( obj = documento metodo = &apos;Add&apos; ).
    set_prop_app( prop = &apos;Calculation&apos; valor = -4135 ). &quot; Manual
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="FIJAR_VISIBLE" VERSION="1" LANGU="S" DESCRIPT="Poner en estado visible" EXPOSURE="2" STATE="1" EDITORDER="24 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD fijar_visible.
    set_prop_app( prop = &apos;Visible&apos; valor = true ).
    set_prop_app( prop = &apos;ScreenUpdating&apos; valor = true ).
    SET PROPERTY OF me-&gt;app &apos;Calculation&apos; = -4105. &quot; Automático
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_OLE" CMPNAME="FREE" VERSION="0" EXPOSURE="0" STATE="0" EDITORDER="0 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD free.
*CALL METHOD SUPER-&gt;FREE
*    .
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="GENERAR_GRAFICO" VERSION="1" LANGU="S" DESCRIPT="Generar gráfico" EXPOSURE="2" STATE="1" EDITORDER="21 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="GENERAR_GRAFICO" SCONAME="TITULO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="GENERAR_GRAFICO" SCONAME="P_CHARTTYPE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="GENERAR_GRAFICO" SCONAME="P_COORDX" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="GENERAR_GRAFICO" SCONAME="P_COORDY" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="GENERAR_GRAFICO" SCONAME="P_HASLEGEND" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="INTEGER" PAROPTIONL="X"/>
  <source>METHOD generar_grafico.
    DATA: l_charts       TYPE ole2_object,
          l_chart        TYPE ole2_object,
          l_titulo       TYPE ole2_object,
          l_caracteres   TYPE ole2_object,
          l_axisx        TYPE ole2_object,
          l_axisy        TYPE ole2_object,
          l_legend       TYPE ole2_object,
          l_chartarea    TYPE ole2_object,
          l_plotarea     TYPE ole2_object,
          l_border       TYPE ole2_object,
          l_interior     TYPE ole2_object,
          l_activewindow TYPE ole2_object.

    l_charts = get_prop_obj( obj = app prop = &apos;Charts&apos; ).
    l_chart  = get_obj( origen = l_charts metodo = &apos;Add&apos; ).

* Tipo de gráfico:
    IF p_charttype IS SUPPLIED.
      SET PROPERTY OF l_chart &apos;ChartType&apos; = p_charttype.
    ENDIF.

* Título del gráfico:
    IF titulo IS SUPPLIED.
      SET PROPERTY OF l_chart &apos;HasTitle&apos; = 1.
      l_titulo = get_prop_obj( obj = l_chart prop = &apos;ChartTitle&apos; ).
      l_caracteres = get_prop_obj( obj = l_titulo prop = &apos;Characters&apos; ).
      SET PROPERTY OF l_caracteres &apos;Text&apos; = titulo.
    ENDIF.

* Título de la coordenada X:
    IF p_coordx IS SUPPLIED.
      l_axisx = get_obj( origen = l_chart metodo = &apos;Axes&apos;
                         p1 = 2 p2 = 1 ).
      SET PROPERTY OF l_axisx &apos;HasTitle&apos; = 1.
      l_titulo = get_prop_obj( obj = l_axisx prop = &apos;AxisTitle&apos; ).
      l_caracteres = get_prop_obj( obj = l_titulo prop = &apos;Characters&apos; ).
      SET PROPERTY OF l_caracteres &apos;Text&apos; = p_coordx.
    ENDIF.

* Título de la coordenada Y:
    IF p_coordy IS SUPPLIED.
      l_axisy = get_obj( origen = l_chart metodo = &apos;Axes&apos;
                         p1 = 2 p2 = 1 ).
      SET PROPERTY OF l_axisy &apos;HasTitle&apos; = 1.
      l_titulo = get_prop_obj( obj = l_axisy prop = &apos;AxisTitle&apos; ).
      l_caracteres = get_prop_obj( obj = l_titulo prop = &apos;Characters&apos; ).
      SET PROPERTY OF l_caracteres &apos;Text&apos; = p_coordy.
    ENDIF.

* Posición de la leyenda:
    IF p_haslegend IS SUPPLIED.
      IF p_haslegend = 0.
        SET PROPERTY OF l_chart &apos;HasLegend&apos; = 0.
      ELSE.
        l_legend = get_prop_obj( obj = l_chart prop = &apos;Legend&apos; ).
        exec_metodo( obj = l_legend metodo = &apos;Select&apos; ).
        SET PROPERTY OF l_legend &apos;Position&apos; = -4107.    &quot; Posición abajo
      ENDIF.
    ELSE.
      l_legend = get_prop_obj( obj = l_chart prop = &apos;Legend&apos; ).
      exec_metodo( obj = l_legend metodo = &apos;Select&apos; ).
      SET PROPERTY OF l_legend &apos;Position&apos; = -4107.       &quot; Posición abajo
    ENDIF.

* En caso de tratarse de un gráfico de quesitos, se quiere que salgan
* los datos de los valores y los porcentajes. Se quita un área cuadrada
* que sale por defecto en el gráfico:
    IF p_charttype = &apos;5&apos;.
      CALL METHOD OF l_chart &apos;ApplyDataLabels&apos;
        EXPORTING
          #1 = 1
          #2 = 1
          #3 = 0
          #4 = 0
          #5 = 0
          #6 = 1
          #7 = 1
          #8 = 1.

      l_chartarea = get_prop_obj( obj = l_chart prop = &apos;ChartArea&apos; ).
      exec_metodo( obj = l_chartarea metodo = &apos;Select&apos; ).
      l_plotarea = get_prop_obj( obj = l_chart prop = &apos;PlotArea&apos; ).
      exec_metodo( obj = l_chartarea metodo = &apos;Select&apos; ).

      l_border = get_prop_obj( obj = l_plotarea prop = &apos;Border&apos; ).
      SET PROPERTY OF l_border &apos;Weight&apos; = 2.
      SET PROPERTY OF l_border &apos;LineStyle&apos; = -4142.

      l_interior = get_prop_obj( obj = l_plotarea prop = &apos;Interior&apos; ).
      SET PROPERTY OF l_interior &apos;ColorIndex&apos; = -4142.
    ENDIF.

* Ponemos el gráfico como un objeto dentro de una hoja de datos para
* poder poner el logo de Vossloh:
    IF zcl_c=&gt;cliente_tasks = &apos;VOS&apos;.
      exec_metodo( obj = l_chart metodo = &apos;Location&apos; p1 = 2
                                                     p2 = &apos;Hoja2&apos; ).
    ELSE.
      exec_metodo( obj = l_chart metodo = &apos;Location&apos; p1 = 2
                                                     p2 = &apos;Hoja1&apos; ).
    ENDIF.

* Quitamos la selección al gráfico para poder seleccionar celdas y
* poner el logo y la fecha del sistema:
    l_activewindow = get_prop_obj( obj = app prop = &apos;ActiveWindow&apos; ).
    SET PROPERTY OF l_activewindow &apos;Visible&apos; = false.

    IF zcl_c=&gt;cliente_tasks = &apos;VOS&apos;.
* Ponemos la fecha del sistema:
      valor_celda( fila = 2 columna = 1 valor = sy-datum
                            aplicar_formato_fuente = &apos;X&apos; ).
* Ponemos el logo de la empresa:
      fuente_nombre = &apos;Vossloh Logo&apos;.
      fuente_tamanyo = 20.
      valor_celda( fila = 1 columna = 1 valor = &apos;abcd&apos;
                            aplicar_formato_fuente = &apos;X&apos; ).
    ENDIF.
* Activamos el gráfico:
    exec_metodo( obj = l_chart metodo = &apos;Activate&apos; ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="GET_ACTIVE_SHEET" VERSION="1" LANGU="S" DESCRIPT="Selecciona hoja activa" EXPOSURE="2" STATE="1" EDITORDER="19 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD get_active_sheet.
    active_sheet = get_obj_app( metodo = &apos;ActiveSheet&apos; ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="GET_CELDA_POR_NOMBRE" VERSION="1" LANGU="S" DESCRIPT="Recupera valor de la celda accediendo por nombre" EXPOSURE="2" STATE="1" EDITORDER="16 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="GET_CELDA_POR_NOMBRE" SCONAME="NOMBRE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="GET_CELDA_POR_NOMBRE" SCONAME="PROPIEDAD" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;FormulaR1C1&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="GET_CELDA_POR_NOMBRE" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD get_celda_por_nombre.
    DATA l_celda TYPE ole2_object.

    IF ir_a_marcador( marcador = nombre mostrar_errores = &apos;&apos; ) = &apos;&apos;.
      l_celda = get_obj_app( metodo = &apos;ActiveCell&apos; ).

      valor = get_prop( obj = l_celda prop = propiedad ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="GRABAR_DOCUMENTO" VERSION="1" LANGU="S" DESCRIPT="Grabar documento" EXPOSURE="2" STATE="1" EDITORDER="4 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="GRABAR_DOCUMENTO" SCONAME="FICHERO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="GRABAR_DOCUMENTO" SCONAME="CERRAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="GRABAR_DOCUMENTO" SCONAME="MOSTRAR_DIALOGO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <source>METHOD grabar_documento.
    DATA: l_active_workbook TYPE ole2_object,
          l_fichero         TYPE string.

    l_active_workbook = get_obj_app( metodo = &apos;ActiveWorkbook&apos; ).

    l_fichero = fichero.

    IF mostrar_dialogo = &apos;X&apos;.
      zcl_ap_ficheros=&gt;dialogo_grabar_fichero(
                              EXPORTING fichero_inicial = l_fichero
                                        mostrar_error   = &apos;X&apos;
                              IMPORTING ruta            = l_fichero ).
      IF l_fichero IS INITIAL.
        EXIT.
      ENDIF.
    ENDIF.

*  save_file( obj = documento fichero = fichero ).
    save_file( obj = l_active_workbook fichero = l_fichero ).

    IF cerrar = &apos;X&apos;.
*    set_prop_app( prop = &apos;Saved&apos; valor = true ).      &quot;lrr28/05/18
      set_prop_app( prop = &apos;DisplayAlerts&apos; valor = false ).

*    documento = get_obj_app( &apos;WorkBooks&apos; ).
*    exec_metodo( obj = documento metodo = &apos;Save&apos; ).
*    exec_metodo( obj = app metodo = &apos;Save&apos; ).

**   exec_metodo( obj = l_active_workbook metodo = &apos;Save&apos; ).
*    exec_metodo( obj = documento metodo = &apos;Close&apos; p1 = false ).
      exec_metodo( obj = l_active_workbook metodo = &apos;Close&apos; p1 = false ).
      exec_metodo( obj = app metodo = &apos;Quit&apos; ).
      MESSAGE i398(00) WITH &apos;Se ha grabado fichero&apos; l_fichero.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="IMPRIMIR" VERSION="1" LANGU="S" DESCRIPT="Imprimir" EXPOSURE="2" STATE="1" EDITORDER="46 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="IMPRIMIR" SCONAME="CERRAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="IMPRIMIR" SCONAME="MOSTRAR_DIALOGO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <source>METHOD imprimir.
    &quot; TODO: parameter MOSTRAR_DIALOGO is never used (ABAP cleaner)

    DATA l_active_workbook TYPE ole2_object.

    l_active_workbook = get_obj_app( metodo = &apos;ActiveWorkbook&apos; ).

    exec_metodo( obj = l_active_workbook metodo = &apos;PrintOut&apos; ).

    IF cerrar = &apos;X&apos;.
      set_prop_app( prop = &apos;DisplayAlerts&apos; valor = false ).
      exec_metodo( obj = l_active_workbook metodo = &apos;Close&apos; p1 = false ).
      exec_metodo( obj = app metodo = &apos;Quit&apos; ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="INDICE_COLUMNA" VERSION="1" LANGU="S" DESCRIPT="Convierte letra a nº" EXPOSURE="2" STATE="1" EDITORDER="27 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="1" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="INDICE_COLUMNA" SCONAME="LETRAS" VERSION="1" LANGU="S" DESCRIPT="Componente del número de versión" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="0" TYPTYPE="1" TYPE="CHAR2"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="INDICE_COLUMNA" SCONAME="COLUMNA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="I"/>
  <source>METHOD indice_columna.
    DATA: lv_char  TYPE c LENGTH 1,
          lv_uccpi TYPE i.

* Calculate most significant letter
    lv_char = letras+1(1).
    IF lv_char IS NOT INITIAL. &quot; To avoid the first 26 column that have only a char in first position
      columna = cl_abap_conv_out_ce=&gt;uccpi( lv_char ).

      columna = columna MOD 64.

      lv_char  = letras(1).
      lv_uccpi = cl_abap_conv_out_ce=&gt;uccpi( lv_char ).

      lv_uccpi = ( lv_uccpi MOD 64 ) * 26.

      columna = columna + lv_uccpi.
    ELSE.
      lv_char = letras(1).
      columna = cl_abap_conv_out_ce=&gt;uccpi( lv_char ).
      columna = columna - 64.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="INMOVILIZAR_PANELES" VERSION="1" LANGU="S" DESCRIPT="Inmovilizar paneles" EXPOSURE="2" STATE="1" EDITORDER="35 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD inmovilizar_paneles.
    DATA l_activewindow TYPE ole2_object.

    l_activewindow = get_obj_app( metodo = &apos;ActiveWindow&apos; ).

    set_prop( obj = l_activewindow prop = &apos;FreezePanes&apos; valor = 1 ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="INSERTAR_HOJA" VERSION="1" LANGU="S" DESCRIPT="Insertar nueva hoja" EXPOSURE="2" STATE="1" EDITORDER="42 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD insertar_hoja.
    DATA l_sheet TYPE ole2_object.

    l_sheet = get_obj_app( metodo = &apos;Sheets&apos; ).
    exec_metodo( obj = l_sheet
                 metodo = &apos;Add&apos; ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="IR_A_CELDA" VERSION="1" LANGU="S" DESCRIPT="Ir a celda" EXPOSURE="2" STATE="1" EDITORDER="29 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="IR_A_CELDA" SCONAME="CELDA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="IR_A_CELDA" SCONAME="FILA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="IR_A_CELDA" SCONAME="COLUMNA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <source>METHOD ir_a_celda.
    DATA: l_celda    TYPE string,
          l_row      TYPE c LENGTH 10,
          l_posicion TYPE string.

    IF celda IS INITIAL.
      l_celda = convert_columna( columna ).
      l_row = fila.
      CONCATENATE l_celda l_row INTO l_celda.
      CONDENSE l_celda NO-GAPS.
    ELSE.
      l_celda = celda.
    ENDIF.

    l_posicion = celda2pos( l_celda ).
    exec_metodo( obj = app
                 metodo = &apos;GoTo&apos;
                 p1 = l_posicion ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="IR_A_MARCADOR" VERSION="1" LANGU="S" DESCRIPT="Ir a marcador" EXPOSURE="2" STATE="1" EDITORDER="5 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="IR_A_MARCADOR" SCONAME="MARCADOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="IR_A_MARCADOR" SCONAME="BORRAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="IR_A_MARCADOR" SCONAME="MOSTRAR_ERRORES" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="IR_A_MARCADOR" SCONAME="ERROR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="ABAP_BOOL"/>
  <source>METHOD ir_a_marcador.
    error = exec_metodo( obj = app
                 metodo = &apos;GoTo&apos;
                 p1 = marcador
                 mostrar_errores = mostrar_errores ).

    IF error IS NOT INITIAL.
      RETURN.
    ENDIF.

    IF borrar = &apos;X&apos;.
      borrar_marcador( marcador ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PASTE" VERSION="1" LANGU="S" DESCRIPT="Pegar portapapeles" EXPOSURE="2" STATE="1" EDITORDER="18 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD paste.
    get_active_sheet( ).
    exec_metodo( obj = active_sheet metodo = &apos;Paste&apos; ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_COLUMNA" VERSION="1" LANGU="S" DESCRIPT="Pegar columna de tabla interna" EXPOSURE="2" STATE="1" EDITORDER="20 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_COLUMNA" SCONAME="I_COLUMNA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE"/>
  <source>METHOD pegar_columna.
    copiar_tabla( CHANGING i_tabla = i_columna ).
    paste( ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_IMAGEN" VERSION="1" LANGU="S" DESCRIPT="Pegar imagen" EXPOSURE="2" STATE="1" EDITORDER="36 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_IMAGEN" SCONAME="FICHERO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <source>METHOD pegar_imagen.
    DATA: l_activesheet TYPE ole2_object,
          l_pictures    TYPE ole2_object.

    l_activesheet = get_obj( origen = app metodo = &apos;ActiveSheet&apos; ).
    l_pictures = get_obj( origen = l_activesheet metodo = &apos;Pictures&apos; ).

    exec_metodo( obj = l_pictures
               metodo = &apos;Insert&apos;
               p1 = fichero ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" VERSION="1" LANGU="S" DESCRIPT="Pegar tabla" EXPOSURE="2" STATE="1" EDITORDER="25 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="CABECERA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="I_TITULOS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="I_TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="CELDA_ORIGEN" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PARVALUE="&apos;A1&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="COLUMNA_INICIAL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="1"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="COLUMNA_FINAL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="999"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="BORDE" VERSION="1" LANGU="S" DESCRIPT="&apos;T&apos; Todo" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="C" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="AUTOFILTRO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="FILA_INI" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="COLUMNA_INI" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="AUTOFIT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="RESALTAR_TITULOS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="12 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="COL_TEXTO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="13 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="COL_IMPORTES" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="14 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="REPLACEMENT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="15 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="I_COLUMNAS3" VERSION="1" LANGU="S" DESCRIPT="Tipo tabla ZAP_ALV_COLUMNAS3" CMPTYPE="1" MTDTYPE="0" EDITORDER="16 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ZAP_ALV_COLUMNAS3_T" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="I_CAMPOS_SEL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="17 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_COMPONENT_TAB" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA" SCONAME="CAMPOS_REP_PUNTO_COMA" VERSION="1" LANGU="S" DESCRIPT="Campos a reemplazar puntos por comas" CMPTYPE="1" MTDTYPE="0" EDITORDER="18 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PARVALUE="&apos;&apos;"/>
  <source>METHOD pegar_tabla.
    TYPES: BEGIN OF t_columnas,
             col   TYPE i,
             campo TYPE c LENGTH 20,
           END OF t_columnas.
    TYPES t_texto_largo TYPE c LENGTH 65535.

    DATA: i_col_texto    TYPE TABLE OF text1024,
          i_col_importes TYPE TABLE OF text1024,
          l_fila_ini     TYPE i,
          l_col_ini      TYPE i,
          l_fila_fin     TYPE i,
          l_col_fin      TYPE i,
          i_campos       TYPE abap_component_tab,
          i_campos_del   TYPE abap_component_tab,
          l_tab          TYPE t_texto_largo,
          i_tab          TYPE TABLE OF t_texto_largo,
          o_type         TYPE REF TO cl_abap_datadescr,
          l_col          TYPE i,
          l_columna      TYPE t_columnas,
          i_columnas     TYPE TABLE OF t_columnas,
          l_primera_fila TYPE c LENGTH 1,
          l_valortxt     TYPE c LENGTH 512,
          l_aux          TYPE c LENGTH 40,
          l_string       TYPE string,
          l_col_texto    TYPE text1024.
    DATA l_font    TYPE ole2_object.
    DATA l_columns TYPE ole2_object.

    FIELD-SYMBOLS: &lt;campo&gt; TYPE abap_componentdescr,
                   &lt;valor&gt; TYPE any,
                   &lt;tabla&gt; TYPE any,
                   &lt;col3&gt;  TYPE zap_alv_columnas3.

    SPLIT col_texto AT &apos;,&apos; INTO TABLE i_col_texto.
    SPLIT col_importes AT &apos;,&apos; INTO TABLE i_col_importes.

    IF NOT fila_ini IS INITIAL.
      l_fila_ini = fila_ini.
      l_col_ini  = columna_ini.
    ELSEIF NOT celda_origen IS INITIAL.
      celda2filacol( EXPORTING celda   = celda_origen
                     IMPORTING fila    = l_fila_ini
                               columna = l_col_ini ).
    ENDIF.
    l_fila_fin = l_fila_ini - 1.
    l_col_fin = l_col_ini - 1.

    IF i_campos_sel IS INITIAL.
      i_campos = zcl_ap_dev=&gt;get_fieldcatalog( i_tabla ).
    ELSE.
      i_campos = i_campos_sel.
    ENDIF.
    DELETE i_campos WHERE name IS INITIAL.

    IF NOT i_titulos IS INITIAL.
      LOOP AT i_campos ASSIGNING &lt;campo&gt;.
        READ TABLE i_titulos ASSIGNING &lt;valor&gt; INDEX sy-tabix.
        IF sy-subrc = 0.
          IF &lt;valor&gt; = &apos;#INVISIBLE#&apos;.
            APPEND &lt;campo&gt; TO i_campos_del.
          ENDIF.
        ENDIF.
      ENDLOOP.
      LOOP AT i_campos_del ASSIGNING &lt;campo&gt;.
        DELETE i_campos WHERE name = &lt;campo&gt;-name.
      ENDLOOP.
    ENDIF.

    IF cabecera = &apos;X&apos;.
      CLEAR l_tab.
      IF i_titulos IS INITIAL.
        LOOP AT i_campos ASSIGNING &lt;campo&gt; FROM columna_inicial.
          IF l_tab IS INITIAL.
            l_tab = &lt;campo&gt;-name.
          ELSE.
            CONCATENATE l_tab cl_abap_char_utilities=&gt;horizontal_tab &lt;campo&gt;-name INTO l_tab.
          ENDIF.
        ENDLOOP.
      ELSE.
        LOOP AT i_titulos ASSIGNING &lt;valor&gt; FROM columna_inicial.
          IF &lt;valor&gt; &lt;&gt; &apos;#INVISIBLE#&apos;.
            IF l_tab IS INITIAL.
              l_tab = &lt;valor&gt;.
            ELSE.
              CONCATENATE l_tab cl_abap_char_utilities=&gt;horizontal_tab &lt;valor&gt; INTO l_tab.
            ENDIF.
          ENDIF.
        ENDLOOP.
      ENDIF.
      APPEND l_tab TO i_tab.
    ENDIF.

    LOOP AT i_campos ASSIGNING &lt;campo&gt; FROM columna_inicial.
      o_type = &lt;campo&gt;-type.
      IF o_type-&gt;type_kind = &apos;h&apos;. &quot; No procesamos tablas internas
        CONTINUE.
      ENDIF.
      IF sy-tabix &gt; columna_final.
        EXIT.
      ENDIF.
      l_col = l_col + 1.
      CLEAR l_columna.
      l_columna-col   = l_col.
      l_columna-campo = &lt;campo&gt;-name.
      APPEND l_columna TO i_columnas.
    ENDLOOP.

    LOOP AT i_tabla ASSIGNING &lt;tabla&gt;.
      l_fila_fin = l_fila_fin + 1.
      CLEAR l_tab.
      LOOP AT i_campos ASSIGNING &lt;campo&gt; FROM columna_inicial.
        o_type = &lt;campo&gt;-type.
        IF o_type-&gt;type_kind = &apos;h&apos;. &quot; No procesamos tablas internas
          CONTINUE.
        ENDIF.
        IF sy-tabix &gt; columna_final.
          EXIT.
        ENDIF.
        IF l_primera_fila IS INITIAL.
          l_col_fin = l_col_fin + 1.
        ENDIF.
        ASSIGN COMPONENT &lt;campo&gt;-name OF STRUCTURE &lt;tabla&gt; TO &lt;valor&gt;.
        IF o_type-&gt;type_kind = &apos;D&apos; OR o_type-&gt;type_kind = &apos;T&apos;.
          WRITE &lt;valor&gt; TO l_valortxt.
          IF o_type-&gt;type_kind = &apos;D&apos;.
            IF l_valortxt = &apos;00.00.0000&apos;.
              CLEAR l_valortxt.
            ELSE.
              REPLACE ALL OCCURRENCES OF &apos;.&apos; IN l_valortxt WITH &apos;/&apos;.
              l_aux = l_valortxt(2).
              l_valortxt(2) = l_valortxt+3(2).
              l_valortxt+3(2) = l_aux(2).
            ENDIF.
          ENDIF.
        ELSE.
          l_valortxt = &lt;valor&gt;.

          IF o_type-&gt;type_kind = &apos;P&apos;.
            IF l_valortxt CS &apos;-&apos;.
              REPLACE &apos;-&apos; WITH &apos;&apos; INTO l_valortxt.
              CONCATENATE &apos;-&apos; l_valortxt INTO l_valortxt.
            ENDIF.

            if l_Valortxt cs &apos;.&apos; and not CAMPOS_REP_PUNTO_COMA is initial.
              if zcl_ap_lista=&gt;es_elemento( lista  = CAMPOS_REP_PUNTO_COMA elemento = &lt;campo&gt;-name ).
                replace &apos;.&apos; in l_valortxt with &apos;,&apos;.
              endif.
            endif.
          ELSE.
            IF o_type-&gt;type_kind = &apos;C&apos;.
              READ TABLE i_columnas3 ASSIGNING &lt;col3&gt; WITH KEY campo = &lt;campo&gt;-name.
              IF sy-subrc = 0.
                IF &lt;col3&gt;-aux3 = &apos;F&apos;.
                  REPLACE &apos;,&apos; WITH &apos;.&apos; INTO l_valortxt.
                  IF l_valortxt CS &apos;-&apos;.
                    REPLACE &apos;-&apos; WITH &apos;&apos; INTO l_valortxt.
                    CONCATENATE &apos;-&apos; l_valortxt INTO l_valortxt.
                  ENDIF.
                ENDIF.
              ENDIF.
            ENDIF.

            IF l_valortxt CS cl_abap_char_utilities=&gt;cr_lf.
              REPLACE ALL OCCURRENCES OF &apos;&quot;&apos; IN l_valortxt WITH &apos;&apos;.
              CONCATENATE &apos;&quot;&apos; l_valortxt &apos;&quot;&apos; INTO l_valortxt.
              sy-tfill = strlen( l_valortxt ).
              IF sy-tfill = 512.
                l_valortxt+511 = &apos;&quot;&apos;.
              ELSEIF sy-tfill = 511 AND l_valortxt+511(1) = &apos;&apos;.
                l_valortxt+511 = &apos;&quot;&apos;.
              ENDIF.
            ELSE.
              IF replacement &lt;&gt; &apos;&apos;.
                l_string = l_valortxt.
                zcl_ap_string=&gt;quitar_caracteres_extranos( EXPORTING replacement = replacement
                                                           CHANGING  string = l_string ).
*APC20140924 Eliminamos también las comillas porque causan problemas
                REPLACE ALL OCCURRENCES OF &apos;&quot;&apos; IN l_string WITH &apos;&apos;.
                l_valortxt = l_string.
              ENDIF.
            ENDIF.

            IF o_type-&gt;type_kind = &apos;C&apos;.
              IF &lt;campo&gt;-name = &apos;QMNUM&apos; OR &lt;campo&gt;-name = &apos;MATNR&apos; OR &lt;campo&gt;-name = &apos;QMINC&apos;.
                __quitar_ceros l_valortxt.
              ENDIF.

              IF l_valortxt CO &apos;0123456789 &apos;.
                sy-tfill = strlen( l_valortxt ).
                IF sy-tfill &gt; 8.
                  CONCATENATE &apos;&apos;&apos;&apos; l_valortxt INTO l_valortxt.
                ENDIF.
              ENDIF.
            ENDIF.
          ENDIF.
        ENDIF.
        IF     o_type-&gt;type_kind &lt;&gt; &apos;C&apos;
           AND o_type-&gt;type_kind &lt;&gt; &apos;g&apos;. &quot; String
          CONDENSE l_valortxt NO-GAPS.
        ENDIF.

        IF l_tab IS INITIAL.
          IF l_valortxt IS INITIAL.
            l_tab = &apos;&quot;&apos;.
          ELSE.
            l_tab = l_valortxt.
          ENDIF.
        ELSE.
          IF l_tab = &apos;&quot;&apos;.
            CLEAR l_tab.
          ENDIF.
          CONCATENATE l_tab cl_abap_char_utilities=&gt;horizontal_tab l_valortxt INTO l_tab.
        ENDIF.
      ENDLOOP.
      APPEND l_tab TO i_tab.
      l_primera_fila = &apos;X&apos;.
    ENDLOOP.

    l_fila_fin = l_fila_fin + 1.

    LOOP AT i_col_texto INTO l_col_texto.
      READ TABLE i_columnas INTO l_columna WITH KEY campo = l_col_texto.
      IF sy-subrc = 0.
        set_rango( columna_ini = l_columna-col fila_ini = l_fila_ini
                   columna_fin = l_columna-col fila_fin = l_fila_fin
                   set_seleccion = &apos;X&apos; ).
        set_prop( obj = selection prop = &apos;NumberFormat&apos; valor = &apos;@&apos; ).
      ENDIF.
    ENDLOOP.

    LOOP AT i_col_importes INTO l_col_texto.
      READ TABLE i_columnas INTO l_columna WITH KEY campo = l_col_texto.
      IF sy-subrc = 0.
        set_rango( columna_ini = l_columna-col fila_ini = l_fila_ini
                   columna_fin = l_columna-col fila_fin = l_fila_fin
                   set_seleccion = &apos;X&apos; ).
        set_prop( obj = selection prop = &apos;NumberFormat&apos; valor = &apos;0.00&apos; ).
      ENDIF.
    ENDLOOP.

    set_rango( columna_ini = 1 fila_ini = 1
               columna_fin = 1 fila_fin = 1
               set_seleccion = &apos;X&apos; ).

    l_fila_fin = l_fila_fin - 1.

    IF NOT fila_ini IS INITIAL.
      ir_a_celda( fila = fila_ini columna = columna_ini ).
    ELSEIF NOT celda_origen IS INITIAL.
      ir_a_celda( celda_origen ).
    ENDIF.

    copiar_tabla( CHANGING i_tabla = i_tab ).
    paste( ).

    IF resaltar_titulos = &apos;X&apos;.
      set_rango( columna_ini = l_col_ini fila_ini = l_fila_ini
                 columna_fin = l_col_fin fila_fin = l_fila_ini
                 set_seleccion = &apos;X&apos; ).

      l_font = get_obj( origen = selection metodo = &apos;Font&apos; ).

      IF NOT l_font IS INITIAL.
        SET PROPERTY OF l_font &apos;Bold&apos; = 1.
        FREE OBJECT l_font.
      ENDIF.

      l_font = get_obj( origen = selection metodo = &apos;Interior&apos; ).
      IF NOT l_font IS INITIAL.
        SET PROPERTY OF l_font &apos;ColorIndex&apos; = 33.
        SET PROPERTY OF l_font &apos;Pattern&apos; = 1.
        FREE OBJECT l_font.
      ENDIF.
    ENDIF.

    IF l_fila_fin &lt; l_fila_ini.
      l_fila_fin = l_fila_ini.
    ENDIF.

    set_rango( columna_ini = l_col_ini fila_ini = l_fila_ini
               columna_fin = l_col_fin fila_fin = l_fila_fin
               set_seleccion = &apos;X&apos; ).

    IF NOT borde IS INITIAL.
      rango_set_formato_borde( ).
    ENDIF.

    IF NOT autofiltro IS INITIAL.
      exec_metodo( obj = selection metodo = &apos;AutoFilter&apos; ).
    ENDIF.

    IF NOT autofit IS INITIAL.
      CALL METHOD OF selection &apos;Columns&apos; = l_columns.
      CALL METHOD OF l_columns &apos;Autofit&apos;.
      FREE OBJECT l_columns.
    ENDIF.

    set_rango( columna_ini = 1 fila_ini = 1
               columna_fin = 1 fila_fin = 1
               set_seleccion = &apos;X&apos; ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA_DDIC" VERSION="1" LANGU="S" DESCRIPT="Pegar tabla" EXPOSURE="2" STATE="1" EDITORDER="26 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PEGAR_TABLA_DDIC" SCONAME="I_TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE"/>
  <source>METHOD pegar_tabla_ddic.
    DATA: i_campos   TYPE ddfields,
          l_tab      TYPE text255,
          l_valortxt TYPE c LENGTH 40,
          i_tab      TYPE TABLE OF text255.

    FIELD-SYMBOLS: &lt;tabla&gt; TYPE any,
                   &lt;campo&gt; TYPE dfies,
                   &lt;valor&gt; TYPE any.

    i_campos = zcl_ap_dev=&gt;get_fieldcatalog_ddic( i_tabla ).

    LOOP AT i_tabla ASSIGNING &lt;tabla&gt;.
      CLEAR l_tab.
      LOOP AT i_campos ASSIGNING &lt;campo&gt; WHERE dynpfld = abap_true.
        ASSIGN COMPONENT &lt;campo&gt;-fieldname OF STRUCTURE &lt;tabla&gt; TO &lt;valor&gt;.
        IF sy-subrc = 0.
          WRITE &lt;valor&gt; TO l_valortxt.
          IF &lt;campo&gt;-inttype &lt;&gt; &apos;C&apos;.
            CONDENSE l_valortxt NO-GAPS.
          ENDIF.
          IF l_tab IS INITIAL.
            l_tab = l_valortxt.
          ELSE.
            CONCATENATE l_tab cl_abap_char_utilities=&gt;horizontal_tab l_valortxt INTO l_tab.
          ENDIF.
        ENDIF.
      ENDLOOP.
      APPEND l_tab TO i_tab.
    ENDLOOP.

    copiar_tabla( CHANGING i_tabla = i_tab ).
    paste( ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PROTEGER_HOJA" VERSION="1" LANGU="S" DESCRIPT="Proteger la hoja con contraseña" EXPOSURE="2" STATE="1" EDITORDER="17 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="PROTEGER_HOJA" SCONAME="PASSWORD" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD proteger_hoja.
    DATA l_activesheet TYPE ole2_object.

    l_activesheet = get_obj( origen = app
                          metodo = &apos;ActiveSheet&apos; ).

    exec_metodo( obj = l_activesheet p1 = password metodo = &apos;Protect&apos; ).

    set_prop( obj = l_activesheet prop = &apos;EnableSelection&apos;
                                  valor = -4142 ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="RANGO_ANCHO_COLUMNA" VERSION="1" LANGU="S" DESCRIPT="Centra valor en celdas" EXPOSURE="2" STATE="1" EDITORDER="34 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="RANGO_ANCHO_COLUMNA" SCONAME="ANCHO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <source>METHOD rango_ancho_columna.
    set_prop_sel( prop = &apos;ColumnWidth&apos; valor = ancho ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="RANGO_CENTRAR" VERSION="1" LANGU="S" DESCRIPT="Centra valor en celdas" EXPOSURE="2" STATE="1" EDITORDER="33 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="RANGO_CENTRAR" SCONAME="ALINEACION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_ALIGN_CENTER"/>
  <source>METHOD rango_centrar.
    set_prop_sel( prop = &apos;HorizontalAlignment&apos; valor = alineacion ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="RANGO_COLOR_INTERIOR" VERSION="1" LANGU="S" DESCRIPT="Pone un borde al rango" EXPOSURE="2" STATE="1" EDITORDER="32 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD rango_color_interior.
    DATA l_interior TYPE ole2_object.

    l_interior = get_obj( origen = selection metodo = &apos;Interior&apos; ).
    IF NOT l_interior IS INITIAL.
      SET PROPERTY OF l_interior &apos;ColorIndex&apos; = 33.
      SET PROPERTY OF l_interior &apos;Pattern&apos; = 1.
      FREE OBJECT l_interior.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="RANGO_FORMATEAR_SELECCION" VERSION="1" LANGU="S" DESCRIPT="Fija formato fuente en rango" EXPOSURE="2" STATE="1" EDITORDER="40 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="RANGO_FORMATEAR_SELECCION" SCONAME="WRAPTEXT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <source>METHOD rango_formatear_seleccion.
    DATA l_selection TYPE ole2_object.

    CHECK NOT rango IS INITIAL.
    IF selection IS INITIAL.
      l_selection = get_obj( origen = rango metodo = &apos;Select&apos; ).
    ELSE.
      l_selection = selection.
    ENDIF.

    IF NOT l_selection IS INITIAL.
      IF wraptext IS SUPPLIED.
        SET PROPERTY OF l_selection &apos;WrapText&apos; = wraptext.
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="RANGO_SET_FORMATO_BORDE" VERSION="1" LANGU="S" DESCRIPT="Formato borde" EXPOSURE="2" STATE="1" EDITORDER="14 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="RANGO_SET_FORMATO_BORDE" SCONAME="LADO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="RANGO_SET_FORMATO_BORDE" SCONAME="LINESTYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_ESTILO_SOLIDO"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="RANGO_SET_FORMATO_BORDE" SCONAME="WEIGHT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="2"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="RANGO_SET_FORMATO_BORDE" SCONAME="COLORINDEX" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_COLORINDEX_NEGRO"/>
  <source>METHOD rango_set_formato_borde.
    DATA l_borders TYPE ole2_object.

    CHECK NOT selection IS INITIAL.

    IF NOT lado IS SUPPLIED.
      l_borders = get_obj( origen = selection metodo = &apos;Borders&apos; ).
    ELSE.
      l_borders = get_obj( origen = selection metodo = &apos;Borders&apos;
                           p1 = lado ).
    ENDIF.

    IF NOT l_borders IS INITIAL.
      set_prop( obj = l_borders prop = &apos;LineStyle&apos; valor = linestyle ).
      IF weight &lt;&gt; 0.
        set_prop( obj = l_borders prop = &apos;Weight&apos; valor = weight ).
      ENDIF.
      set_prop( obj = l_borders prop = &apos;ColorIndex&apos; valor = colorindex ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="RANGO_SET_FORMATO_FUENTE" VERSION="1" LANGU="S" DESCRIPT="Fija formato fuente en rango" EXPOSURE="2" STATE="1" EDITORDER="12 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD rango_set_formato_fuente.
    DATA l_font TYPE ole2_object.

    CHECK NOT rango IS INITIAL.
    l_font = get_obj( origen = rango metodo = &apos;Font&apos; ).

    IF NOT l_font IS INITIAL.
      IF NOT fuente_nombre IS INITIAL.
        SET PROPERTY OF l_font &apos;Name&apos; = fuente_nombre.
      ENDIF.
      SET PROPERTY OF l_font &apos;Size&apos; = fuente_tamanyo.
      SET PROPERTY OF l_font &apos;Bold&apos; = fuente_negrita.
      SET PROPERTY OF l_font &apos;Italic&apos; = fuente_cursiva.
      SET PROPERTY OF l_font &apos;Underline&apos; = fuente_subrayado.
      SET PROPERTY OF l_font &apos;ColorIndex&apos; = fuente_color.

      FREE OBJECT l_font.

      IF fuente_fondo &lt;&gt; -999.
        l_font = get_obj( origen = selection metodo = &apos;Interior&apos; ).
        IF NOT l_font IS INITIAL.
          SET PROPERTY OF l_font &apos;ColorIndex&apos; = fuente_fondo.
          SET PROPERTY OF l_font &apos;Pattern&apos; = 1.
          FREE OBJECT l_font.
        ENDIF.
      ENDIF.

      IF fondo_celda &lt;&gt; -999.
        l_font = get_obj( origen = selection metodo = &apos;Interior&apos; ).
        IF NOT l_font IS INITIAL.
          SET PROPERTY OF l_font &apos;Color&apos; = fondo_celda.
          SET PROPERTY OF l_font &apos;Pattern&apos; = 1.
          SET PROPERTY OF l_font &apos;PatternColorIndex&apos; = -4105. &quot; xlAutomatic
          SET PROPERTY OF l_font &apos;TintAndShade&apos; = 0.
          SET PROPERTY OF l_font &apos;PatternTintAndShade&apos; = 0.
          FREE OBJECT l_font.
        ENDIF.
      ENDIF.

    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="RANGO_UNIR_CELDAS" VERSION="1" LANGU="S" DESCRIPT="Une celdas del rango" EXPOSURE="2" STATE="1" EDITORDER="31 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD rango_unir_celdas.
    CHECK NOT rango IS INITIAL.
    set_prop_app( prop = &apos;DisplayAlerts&apos; valor = false ).
    exec_metodo( obj = rango metodo = &apos;Merge&apos; ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="REEMPLAZAR_TEXTO" VERSION="1" LANGU="S" DESCRIPT="Reemplazar texto" EXPOSURE="2" STATE="1" EDITORDER="38 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="REEMPLAZAR_TEXTO" SCONAME="CLAVE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="REEMPLAZAR_TEXTO" SCONAME="TEXTO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <source>METHOD reemplazar_texto.
    DATA l_find TYPE ole2_object.

    l_find = get_obj_app( metodo = &apos;Cells&apos; ).

    CALL METHOD OF l_find &apos;Replace&apos;
      EXPORTING
        #1  = clave    &quot; What
        #2  = texto.    &quot; Text
*      #3  = 1      &quot;LookAt (xlWhole= 1 (coincidir todo el contenido), xlPart=2 parcialmente
*      #4  = &apos;1&apos;      &quot;SearchOrder (xlByRows = 1)
*      #5  = false  &quot;MatchCase
*      #6  = false  &quot;SearchFormat
*      #7  = false. &quot;ReplaceFormat.

    control_error( texto = &apos;Busqueda:&apos; texto2 = clave texto3 = texto ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="REEMPLAZAR_TEXTO_DOC" VERSION="1" LANGU="S" DESCRIPT="Reemplazar texto" EXPOSURE="2" STATE="1" EDITORDER="7 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="REEMPLAZAR_TEXTO_DOC" SCONAME="CLAVE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="REEMPLAZAR_TEXTO_DOC" SCONAME="TEXTO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <source>METHOD reemplazar_texto_doc.
    DATA l_find TYPE ole2_object.

*  l_find = get_obj( origen = documento
*                        metodo = &apos;Find&apos; ).
    l_find = get_obj_app( metodo = &apos;Find&apos; ).
    CALL METHOD OF l_find &apos;Execute&apos;
      EXPORTING
        #1  = clave
        #2  = &apos;0&apos;
        #3  = &apos;0&apos;
        #4  = &apos;0&apos;
        #5  = &apos;0&apos;
        #6  = &apos;0&apos;
        #7  = &apos;1&apos;
        #8  = &apos;1&apos;
        #9  = &apos;0&apos;
        #10 = texto
        #11 = &apos;2&apos;
        #12 = &apos;1&apos;
        #13 = &apos;1&apos;
        #14 = &apos;1&apos;
        #15 = &apos;1&apos;.
    control_error( texto = &apos;Busqueda:&apos; texto2 = clave texto3 = texto ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SELECCIONAR_HOJA" VERSION="1" LANGU="S" DESCRIPT="Seleccionar hoja" EXPOSURE="2" STATE="1" EDITORDER="44 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SELECCIONAR_HOJA" SCONAME="HOJA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PARVALUE="&apos;Hoja1&apos;"/>
  <source>METHOD seleccionar_hoja.
    DATA l_sheet TYPE ole2_object.

    l_sheet = get_obj_app( metodo = &apos;Sheets&apos; p1 = hoja ).
    exec_metodo( obj = l_sheet metodo = &apos;Activate&apos; ).
    exec_metodo( obj = l_sheet metodo = &apos;Select&apos; ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_CELDA_POR_NOMBRE" VERSION="1" LANGU="S" DESCRIPT="Cambia valor de la celda accediendo por nombre" EXPOSURE="2" STATE="1" EDITORDER="15 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_CELDA_POR_NOMBRE" SCONAME="NOMBRE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_CELDA_POR_NOMBRE" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <source>METHOD set_celda_por_nombre.
    DATA l_celda TYPE ole2_object.

    CLEAR hay_error.
    ir_a_marcador( nombre ).
    IF hay_error IS INITIAL.
      l_celda = get_obj_app( metodo = &apos;ActiveCell&apos; ).

      set_prop( obj = l_celda prop = &apos;FormulaR1C1&apos; valor = valor ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_DISPLAYALERTS" VERSION="1" LANGU="S" DESCRIPT="Fijar valor display alerts" EXPOSURE="2" STATE="1" EDITORDER="45 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_DISPLAYALERTS" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="FALSE"/>
  <source>METHOD set_displayalerts.
    set_prop_app( prop = &apos;DisplayAlerts&apos; valor = valor ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_FORMATO_FUENTE" VERSION="1" LANGU="S" DESCRIPT="Fija el formato de la fuente" EXPOSURE="2" STATE="1" EDITORDER="9 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_FORMATO_FUENTE" SCONAME="NOMBRE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_FORMATO_FUENTE" SCONAME="NEGRITA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_FORMATO_FUENTE" SCONAME="CURSIVA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_FORMATO_FUENTE" SCONAME="SUBRAYADO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_FORMATO_FUENTE" SCONAME="TAMANYO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_FORMATO_FUENTE" SCONAME="COLOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_FORMATO_FUENTE" SCONAME="FONDO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_FORMATO_FUENTE" SCONAME="FONDO_CELDA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <source>METHOD set_formato_fuente.
    IF nombre IS SUPPLIED.
      fuente_nombre = nombre.
    ENDIF.
    IF negrita IS SUPPLIED.
      fuente_negrita = negrita.
    ENDIF.
    IF cursiva IS SUPPLIED.
      fuente_cursiva = cursiva.
    ENDIF.
    IF subrayado IS SUPPLIED.
      fuente_subrayado = subrayado.
    ENDIF.
    IF tamanyo IS SUPPLIED.
      fuente_tamanyo = tamanyo.
    ENDIF.
    IF color IS SUPPLIED.
      fuente_color = color.
    ENDIF.
    IF fondo IS SUPPLIED.
      fuente_fondo = fondo.
    ENDIF.
    IF fondo_celda IS SUPPLIED.
      me-&gt;fondo_celda = fondo_celda.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_RANGO" VERSION="1" LANGU="S" DESCRIPT="Fija el rango" EXPOSURE="2" STATE="1" EDITORDER="13 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_RANGO" SCONAME="RANGO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X" PARPREFERD="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_RANGO" SCONAME="FILA_INI" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_RANGO" SCONAME="COLUMNA_INI" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_RANGO" SCONAME="FILA_FIN" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_RANGO" SCONAME="COLUMNA_FIN" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_RANGO" SCONAME="SET_SELECCION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_RANGO" SCONAME="COPIAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_RANGO" SCONAME="INSERTAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="SET_RANGO" SCONAME="BORRAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <source>METHOD set_rango.
    DATA l_rango TYPE string.

    IF NOT rango IS INITIAL.
      l_rango = rango.
    ELSE.
      l_rango = convert_rango( columna_ini = columna_ini
                               fila_ini = fila_ini
                               columna_fin = columna_fin
                               fila_fin = fila_fin ).
    ENDIF.

    me-&gt;rango = get_obj_app( metodo = &apos;Range&apos;
                             p1 = l_rango ).

    IF set_seleccion = &apos;X&apos; OR copiar = &apos;X&apos; OR insertar = &apos;X&apos; OR borrar = &apos;X&apos;.
      IF NOT me-&gt;rango IS INITIAL.
        exec_metodo( obj = me-&gt;rango metodo = &apos;Select&apos; ).
***????
        selection = get_obj( origen = me-&gt;rango metodo = &apos;Select&apos; ).
*      IF set_seleccion = &apos;X&apos; OR copiar = &apos;X&apos; OR insertar = &apos;X&apos; OR borrar = &apos;X&apos;.
*        CALL METHOD OF seleccion &apos;Activate&apos;.
**        exec_metodo( obj = seleccion metodo = &apos;Activate&apos; ).
*      ENDIF.
***????
*      get_seleccion( ).
        selection = get_obj_app( metodo = &apos;Selection&apos; ).
        exec_metodo( obj = selection metodo = &apos;Activate&apos; ).

        IF copiar = &apos;X&apos;.
          exec_metodo( obj = selection metodo = &apos;Copy&apos; ).
*        exec_metodo_seleccion( &apos;Copy&apos; ).
        ENDIF.

        IF insertar = &apos;X&apos;.
          exec_metodo( obj = selection metodo = &apos;Insert&apos; ).
*        exec_metodo_seleccion( &apos;Insert&apos; ).
        ENDIF.

        IF borrar = &apos;X&apos;.
          exec_metodo( obj = selection metodo = &apos;Delete&apos; ).
*        exec_metodo_seleccion( &apos;Delete&apos; ).
        ENDIF.

      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="VALOR_CELDA" VERSION="1" LANGU="S" DESCRIPT="Fija valor celda" EXPOSURE="2" STATE="1" EDITORDER="8 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="VALOR_CELDA" SCONAME="FILA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="VALOR_CELDA" SCONAME="COLUMNA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="VALOR_CELDA" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="VALOR_CELDA" SCONAME="APLICAR_FORMATO_FUENTE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_EXCEL_OLE" CMPNAME="VALOR_CELDA" SCONAME="CELDA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <source>METHOD valor_celda.
    DATA: l_row    TYPE i,
          l_col    TYPE i,
          l_celda  TYPE ole2_object,
          l_font   TYPE ole2_object,
          l_texto  TYPE c LENGTH 15,
          l_texto2 TYPE string.

    IF celda IS INITIAL.
      l_row = fila.
      l_col = columna.
    ELSE.
      celda2filacol( EXPORTING celda   = celda
                     IMPORTING fila    = l_row
                               columna = l_col ).
    ENDIF.

    l_celda = get_obj_app( metodo = &apos;Cells&apos;
                             p1 = l_row p2 = l_col ).

*  call method of app &apos;Cells&apos; = l_celda
*    exporting
*      #1 = fila
*      #2 = columna.
    IF NOT l_celda IS INITIAL.
      SET PROPERTY OF l_celda &apos;Value&apos; = valor.

      IF aplicar_formato_fuente = &apos;X&apos;.
        GET PROPERTY OF l_celda &apos;Font&apos; = l_font.

        IF NOT fuente_nombre IS INITIAL.
          SET PROPERTY OF l_font &apos;Name&apos; = fuente_nombre.
        ENDIF.
        SET PROPERTY OF l_font &apos;Size&apos; = fuente_tamanyo.
        SET PROPERTY OF l_font &apos;Bold&apos; = fuente_negrita.
        SET PROPERTY OF l_font &apos;Italic&apos; = fuente_cursiva.
        SET PROPERTY OF l_font &apos;Underline&apos; = fuente_subrayado.
        SET PROPERTY OF l_font &apos;ColorIndex&apos; = fuente_color.

        FREE OBJECT l_font.
      ENDIF.
      FREE OBJECT l_celda.
    ENDIF.

    IF sy-subrc &lt;&gt; 0.
      WRITE: fila TO l_texto(5),
             &apos;-&apos; TO l_texto+6(1),
             columna TO l_texto+7(3).
      l_texto = l_texto2.
      control_error( texto = &apos;Celda:&apos; texto2 = l_texto2 ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
</CLAS>

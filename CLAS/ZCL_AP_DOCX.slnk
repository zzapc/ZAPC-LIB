<?xml version="1.0" encoding="utf-8"?>
<CLAS CLSNAME="ZCL_AP_DOCX" VERSION="1" LANGU="S" DESCRIPT="Word" CATEGORY="00" EXPOSURE="2" STATE="1" RELEASE="0" CLSFINAL="X" CLSCCINCL="X" FIXPT="X" UNICODE="X" CLSBCCAT="00" DURATION_TYPE="0 " RISK_LEVEL="0 ">
 <types CLSNAME="ZCL_AP_DOCX" CMPNAME="T_MARCADORES" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="1 " TYPTYPE="4" SRCROW1="7 " SRCCOLUMN1="6 " SRCROW2="11 " SRCCOLUMN2="24 " TYPESRC_LENG="135 " TYPESRC="BEGIN OF t_marcadores,
        id    TYPE string,
        name  TYPE string,
        texto TYPE string,
      END OF t_marcadores
"/>
 <types CLSNAME="ZCL_AP_DOCX" CMPNAME="TT_MARCADORES" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="2 " TYPTYPE="4" SRCROW1="12 " SRCCOLUMN1="10 " SRCROW2="12 " SRCCOLUMN2="58 " TYPESRC_LENG="51 " TYPESRC="tt_marcadores TYPE STANDARD TABLE OF t_marcadores
"/>
 <types CLSNAME="ZCL_AP_DOCX" CMPNAME="TY_BORDER" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="3 " TYPTYPE="4" SRCROW1="14 " SRCCOLUMN1="6 " SRCROW2="31 " SRCCOLUMN2="21 " TYPESRC_LENG="527 " TYPESRC='BEGIN OF ty_border,
* Border width
* Integer: 8 = 1pt
* Default: no border
        width TYPE i,
* Space between border and content
* Integer
* Default: document default
        space TYPE i,
* Border color
* You can use the predefined font color constants or specify any rgb hexa color code
* Default : document default
        color TYPE string,
* Border style
* You can use the predefined border style constants
* Default : document default
        style TYPE string, &quot; border style
      END OF ty_border
'/>
 <types CLSNAME="ZCL_AP_DOCX" CMPNAME="TY_CHARACTER_STYLE_EFFECT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="4 " TYPTYPE="4" SRCROW1="33 " SRCCOLUMN1="6 " SRCROW2="94 " SRCCOLUMN2="37 " TYPESRC_LENG="2598 " TYPESRC="BEGIN OF ty_character_style_effect,
* Font name to use for the character text fragment
* You can use the predefined font constants
* Default : document default
        font      TYPE string,
* Size of the font in pt
* Default : document default
        size      TYPE i,
* Font color to apply to the character text fragment
* You can use the predefined font color constants or specify any rgb hexa color code
* Default : document default
        color     TYPE string,
* Background color to apply to the character text fragment
* You can use the predefined font color constants or specify any rgb hexa color code
* Default : document default
        bgcolor   TYPE string,
* Highlight color to apply to the character text fragment
* You must use the predefined highlight color constants (limited color choice)
* If you want to use other color, please use bgcolor instead of highlight
* Default : document default
        highlight TYPE string,
* Set character text fragment as bold (boolean)
* You must use predefined true/false constants
* Default : not bold
        bold      TYPE i,
* Set character text fragment as italic (boolean)
* You must use predefined true/false constants
* Default : not italic
        italic    TYPE i,
* Set character text fragment as underline (boolean)
* You must use predefined true/false constants
* Default : not underline
        underline TYPE i,
* Set character text fragment as strike (boolean)
* You must use predefined true/false constants
* Default : not strike
        strike    TYPE i,
* Set character text fragment as exponent (boolean)
* You must use predefined true/false constants
* Default : not exponent
        sup       TYPE i,
* Set character text fragment as subscript (boolean)
* You must use predefined true/false constants
* Default : not subscript
        sub       TYPE i,
* Set character text fragment as upper case (boolean)
* You must use predefined true/false constants
* Default : not upper case
        caps      TYPE i,
* Set character text fragment as small upper case (boolean)
* You must use predefined true/false constants
* Default : not small upper case
        smallcaps TYPE i,
* Letter spacing to apply to the character text fragment
* 0 = normal, +20 = expand 1pt, -20 = condense 1pt
* Default : document default
        spacing   TYPE string,
* Name of the label to use for this text fragment
* Be carefull that if c_label_anchor is not found in text fragment,
* this attribute is ignored
        label     TYPE string,
      END OF ty_character_style_effect
"/>
 <types CLSNAME="ZCL_AP_DOCX" CMPNAME="TY_PARAGRAPH_STYLE_EFFECT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="5 " TYPTYPE="4" SRCROW1="96 " SRCCOLUMN1="6 " SRCROW2="161 " SRCCOLUMN2="37 " TYPESRC_LENG="2601 " TYPESRC='BEGIN OF ty_paragraph_style_effect,
* Set alignment for the paragraph (left, right, center, justify)
* Use the predefined alignment constants
* Default : document default
        alignment           TYPE string,
* Set spacing before paragraph to &quot;auto&quot; (boolean)
* Use the predefined true/false constants
* Default : document default
        spacing_before_auto TYPE i, &quot; boolean
* Set spacing before paragraph
* Integer value, 20 = 1pt
* Default : document default
        spacing_before      TYPE string,
* Set spacing after paragraph to &quot;auto&quot; (boolean)
* Use the predefined true/false constants
* Default : document default
        spacing_after_auto  TYPE i, &quot; boolean
* Set spacing after paragraph
* Integer value: 20 = 1pt
* Default : document default
        spacing_after       TYPE string,
* Set interline in paragraph
* Integer value: 240 = normal interline, 120 = multiple x0.5, 480 = multiple x2
* Default : document default
        interline           TYPE i,
* Set left indentation in paragraph
* Integer value: 567 = 1cm
* Default : document default
        leftindent          TYPE string,
* Set right indentation in paragraph
* Integer value: 567 = 1cm
* Default : document default
        rightindent         TYPE string,
* Set left indentation for first line in paragraph
* Integer value: 567 = 1cm. Negative value allowed
* Default : document default
        firstindent         TYPE string,
* Add a breakpage before paragraph (boolean)
* Use the predefined true/false constants
* Default : no breakpage
        break_before        TYPE i,
* Set the hierarchical title level of the paragraph
* 1 for title1, 2 for title2...
* Default : not a hierarchical title
        hierarchy_level     TYPE i,
* Set the left border of the paragraph
* See class type ty_border for details
* Default : No border
        border_left         TYPE ty_border,
* Set the top border of the paragraph
* See class type ty_border for details
* Default : No border
        border_top          TYPE ty_border,
* Set the right border of the paragraph
* See class type ty_border for details
* Default : No border
        border_right        TYPE ty_border,
* Set the bottom border of the paragraph
* See class type ty_border for details
* Default : No border
        border_bottom       TYPE ty_border,
* Background color to apply to the paragraph
* You can use the predefined font color constants or specify any rgb hexa color code
* Default : document default
        bgcolor             TYPE string,
      END OF ty_paragraph_style_effect
'/>
 <types CLSNAME="ZCL_AP_DOCX" CMPNAME="TY_LIST_STYLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="6 " TYPTYPE="4" SRCROW1="163 " SRCCOLUMN1="6 " SRCROW2="166 " SRCCOLUMN2="25 " TYPESRC_LENG="107 " TYPESRC="BEGIN OF ty_list_style,
        type TYPE string,
        name TYPE string,
      END OF ty_list_style
"/>
 <types CLSNAME="ZCL_AP_DOCX" CMPNAME="TY_LIST_STYLE_TABLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="7 " TYPTYPE="4" SRCROW1="167 " SRCCOLUMN1="10 " SRCROW2="167 " SRCCOLUMN2="65 " TYPESRC_LENG="58 " TYPESRC="ty_list_style_table TYPE STANDARD TABLE OF ty_list_style
"/>
 <types CLSNAME="ZCL_AP_DOCX" CMPNAME="TY_LIST_OBJECT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="8 " TYPTYPE="4" SRCROW1="169 " SRCCOLUMN1="6 " SRCROW2="173 " SRCCOLUMN2="26 " TYPESRC_LENG="136 " TYPESRC="BEGIN OF ty_list_object,
        id   TYPE string,
        type TYPE string,
        path TYPE string,
      END OF ty_list_object
"/>
 <types CLSNAME="ZCL_AP_DOCX" CMPNAME="TY_LIST_OBJECT_TABLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="9 " TYPTYPE="4" SRCROW1="174 " SRCCOLUMN1="10 " SRCROW2="174 " SRCCOLUMN2="67 " TYPESRC_LENG="60 " TYPESRC="ty_list_object_table TYPE STANDARD TABLE OF ty_list_object
"/>
 <types CLSNAME="ZCL_AP_DOCX" CMPNAME="TY_TABLE_STYLE_FIELD" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="10 " TYPTYPE="4" SRCROW1="176 " SRCCOLUMN1="6 " SRCROW2="203 " SRCCOLUMN2="32 " TYPESRC_LENG="1186 " TYPESRC="BEGIN OF ty_table_style_field,
* Content of the cell
        textline          TYPE string,
* Character style name
        style             TYPE string,
* Direct character style effect
        style_effect      TYPE ty_character_style_effect,
* Paragraph style name
        line_style        TYPE string,
* Direct paragraph style effect
        line_style_effect TYPE ty_paragraph_style_effect,
* Cell background color in hexa RGB
        bgcolor           TYPE string,
* Set vertical alignment for cell
        valign            TYPE string,
* Set number of horizontal cell merged
* Start from 2 to merge the next cell with current
* Next cell will be completely ignored
* 0 or 1 to ignore this parameter
        merge             TYPE i,
* Instead of text, insert an image in the cell
* textline, style, style_effect are ignored
        image_id          TYPE string,
* For complex cell content, insert xml paragraph fragment
* You cannot insert xml fragment that are not in a (or many) paragraph
* textline, style, style_effect, line_style, line_style_effect, image_id are ignored
        xml               TYPE string,
      END OF ty_table_style_field
"/>
 <types CLSNAME="ZCL_AP_DOCX" CMPNAME="TY_STYLE_TABLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="11 " TYPTYPE="4" SRCROW1="205 " SRCCOLUMN1="6 " SRCROW2="212 " SRCCOLUMN2="26 " TYPESRC_LENG="397 " TYPESRC='BEGIN OF ty_style_table,
        firstcol TYPE i, &quot; boolean, first col is different
        firstrow TYPE i, &quot; boolean, first row is different
        lastcol  TYPE i, &quot; boolean, last col is different
        lastrow  TYPE i, &quot; boolean, last row is different
        nozebra  TYPE i, &quot; boolean, no line zebra
        novband  TYPE i, &quot; boolean, no column zebra
      END OF ty_style_table
'/>
 <localImplementation>*&quot;* use this source file for the definition and implementation of
*&quot;* local helper classes, interface definitions and type
*&quot;* declarations</localImplementation>
 <localTypes>*&quot;* use this source file for any type of declarations (class
*&quot;* definitions, interfaces or type declarations) you need for
*&quot;* components in the private section</localTypes>
 <localMacros>*&quot;* use this source file for any macro definitions you need
*&quot;* in the implementation part of the class</localMacros>
 <typeUsage CLSNAME="ZCL_AP_DOCX" TYPEGROUP="ABAP" VERSION="1" TPUTYPE="0" IMPLICIT="X"/>
 <forwardDeclaration>ABAP</forwardDeclaration>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_ALIGN_CENTER" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="45 " ATTDECLTYP="2" ATTVALUE="&apos;center&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_ALIGN_JUSTIFY" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="47 " ATTDECLTYP="2" ATTVALUE="&apos;both&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_ALIGN_LEFT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="44 " ATTDECLTYP="2" ATTVALUE="&apos;left&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_ALIGN_RIGHT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="46 " ATTDECLTYP="2" ATTVALUE="&apos;right&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_BASESIZE" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="11 " ATTDECLTYP="2" ATTVALUE="12700" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_BORDER_DASH" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="92 " ATTDECLTYP="2" ATTVALUE="&apos;dashed&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_BORDER_DOT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="91 " ATTDECLTYP="2" ATTVALUE="&apos;dotted&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_BORDER_DOUBLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="89 " ATTDECLTYP="2" ATTVALUE="&apos;double&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_BORDER_SIMPLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="88 " ATTDECLTYP="2" ATTVALUE="&apos;single&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_BORDER_TRIPLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="90 " ATTDECLTYP="2" ATTVALUE="&apos;triple&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_BORDER_WAVE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="93 " ATTDECLTYP="2" ATTVALUE="&apos;wave&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_BREAKTYPE_COLUMN" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="34 " ATTDECLTYP="2" ATTVALUE="1" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_BREAKTYPE_LINE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="32 " ATTDECLTYP="2" ATTVALUE="6" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_BREAKTYPE_PAGE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="33 " ATTDECLTYP="2" ATTVALUE="7" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_BREAKTYPE_SECTION" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="35 " ATTDECLTYP="2" ATTVALUE="2" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_BREAKTYPE_SECTION_CONTINUOUS" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="36 " ATTDECLTYP="2" ATTVALUE="3" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_COLOR_BLACK" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="72 " ATTDECLTYP="2" ATTVALUE="&apos;000000&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_COLOR_BLUE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="73 " ATTDECLTYP="2" ATTVALUE="&apos;0000FF&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_COLOR_BRIGHTGREEN" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="75 " ATTDECLTYP="2" ATTVALUE="&apos;00FF00&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_COLOR_DARKBLUE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="80 " ATTDECLTYP="2" ATTVALUE="&apos;000080&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_COLOR_DARKRED" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="84 " ATTDECLTYP="2" ATTVALUE="&apos;800000&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_COLOR_DARKYELLOW" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="85 " ATTDECLTYP="2" ATTVALUE="&apos;808000&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_COLOR_GRAY" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="86 " ATTDECLTYP="2" ATTVALUE="&apos;808080&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_COLOR_GREEN" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="82 " ATTDECLTYP="2" ATTVALUE="&apos;008000&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_COLOR_LIGHTGRAY" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="87 " ATTDECLTYP="2" ATTVALUE="&apos;C0C0C0&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_COLOR_PINK" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="76 " ATTDECLTYP="2" ATTVALUE="&apos;FF00FF&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_COLOR_RED" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="77 " ATTDECLTYP="2" ATTVALUE="&apos;FF0000&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_COLOR_TEAL" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="81 " ATTDECLTYP="2" ATTVALUE="&apos;008080&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_COLOR_TURQUOISE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="74 " ATTDECLTYP="2" ATTVALUE="&apos;00FFFF&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_COLOR_VIOLET" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="83 " ATTDECLTYP="2" ATTVALUE="&apos;800080&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_COLOR_WHITE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="79 " ATTDECLTYP="2" ATTVALUE="&apos;FFFFFF&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_COLOR_YELLOW" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="78 " ATTDECLTYP="2" ATTVALUE="&apos;FFFF00&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_DDRAW_OVALE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="43 " ATTDECLTYP="2" ATTVALUE="&apos;oval&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_DDRAW_RECTANGLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="41 " ATTDECLTYP="2" ATTVALUE="&apos;rect&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_DDRAW_RECTANGLE_ROUNDED" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="42 " ATTDECLTYP="2" ATTVALUE="&apos;roundrect&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_DRAW_IMAGE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="39 " ATTDECLTYP="2" ATTVALUE="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_DRAW_RECTANGLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="40 " ATTDECLTYP="2" ATTVALUE="1" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FALSE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="2 " ATTDECLTYP="2" ATTVALUE="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FIELD_AUTHOR" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="6 " ATTDECLTYP="2" ATTVALUE="&apos;##FIELD#AUTHOR##&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FIELD_AUTHORLASTMOD" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="7 " ATTDECLTYP="2" ATTVALUE="&apos;##FIELD#LASTSAVEDBY##&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FIELD_CATEGORY" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="10 " ATTDECLTYP="2" ATTVALUE="&apos;##FIELD#DOCPROPERTY CATEGORY##&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FIELD_COMMENTS" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="8 " ATTDECLTYP="2" ATTVALUE="&apos;##FIELD#COMMENTS##&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FIELD_CREATIONDATE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="13 " ATTDECLTYP="2" ATTVALUE="&apos;##FIELD#CREATEDATE##&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FIELD_FILENAME" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="16 " ATTDECLTYP="2" ATTVALUE="&apos;##FIELD#FILENAME##&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FIELD_KEYWORDS" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="9 " ATTDECLTYP="2" ATTVALUE="&apos;##FIELD#KEYWORDS##&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FIELD_MODDATE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="14 " ATTDECLTYP="2" ATTVALUE="&apos;##FIELD#SAVEDATE##&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FIELD_PAGECOUNT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="3 " ATTDECLTYP="2" ATTVALUE="&apos;##FIELD#PAGE##&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FIELD_PAGETOTAL" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="4 " ATTDECLTYP="2" ATTVALUE="&apos;##FIELD#NUMPAGES##&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FIELD_REVISION" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="12 " ATTDECLTYP="2" ATTVALUE="&apos;##FIELD#REVNUM##&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FIELD_SUBJECT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="11 " ATTDECLTYP="2" ATTVALUE="&apos;##FIELD#SUBJECT##&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FIELD_TITLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="5 " ATTDECLTYP="2" ATTVALUE="&apos;##FIELD#TITLE##&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FIELD_TODAYDATE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="15 " ATTDECLTYP="2" ATTVALUE="&apos;##FIELD#DATE##&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FONT_ARIAL" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="19 " ATTDECLTYP="2" ATTVALUE="&apos;Arial&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FONT_CALIBRI" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="22 " ATTDECLTYP="2" ATTVALUE="&apos;Calibri&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FONT_CAMBRIA" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="23 " ATTDECLTYP="2" ATTVALUE="&apos;Cambria&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FONT_COMIC" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="21 " ATTDECLTYP="2" ATTVALUE="&apos;Comic Sans MS&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FONT_COURIER" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="24 " ATTDECLTYP="2" ATTVALUE="&apos;Courier New&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FONT_SYMBOL" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="25 " ATTDECLTYP="2" ATTVALUE="&apos;Wingdings&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_FONT_TIMES" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="20 " ATTDECLTYP="2" ATTVALUE="&apos;Times New Roman&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_HIGHLIGHT_BLACK" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="108 " ATTDECLTYP="2" ATTVALUE="&apos;black&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_HIGHLIGHT_BLUE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="98 " ATTDECLTYP="2" ATTVALUE="&apos;blue&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_HIGHLIGHT_CYAN" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="96 " ATTDECLTYP="2" ATTVALUE="&apos;cyan&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_HIGHLIGHT_DARKBLUE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="100 " ATTDECLTYP="2" ATTVALUE="&apos;darkBlue&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_HIGHLIGHT_DARKCYAN" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="101 " ATTDECLTYP="2" ATTVALUE="&apos;darkCyan&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_HIGHLIGHT_DARKGRAY" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="106 " ATTDECLTYP="2" ATTVALUE="&apos;darkGray&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_HIGHLIGHT_DARKGREEN" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="102 " ATTDECLTYP="2" ATTVALUE="&apos;darkGreen&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_HIGHLIGHT_DARKMAGENTA" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="103 " ATTDECLTYP="2" ATTVALUE="&apos;darkMagenta&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_HIGHLIGHT_DARKRED" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="104 " ATTDECLTYP="2" ATTVALUE="&apos;darkRed&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_HIGHLIGHT_DARKYELLOW" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="105 " ATTDECLTYP="2" ATTVALUE="&apos;darkYellow&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_HIGHLIGHT_GREEN" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="95 " ATTDECLTYP="2" ATTVALUE="&apos;green&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_HIGHLIGHT_LIGHTGRAY" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="107 " ATTDECLTYP="2" ATTVALUE="&apos;lightGray&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_HIGHLIGHT_MAGENTA" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="97 " ATTDECLTYP="2" ATTVALUE="&apos;magenta&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_HIGHLIGHT_RED" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="99 " ATTDECLTYP="2" ATTVALUE="&apos;red&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_HIGHLIGHT_YELLOW" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="94 " ATTDECLTYP="2" ATTVALUE="&apos;yellow&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_IMGPOSX_CENTER" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="57 " ATTDECLTYP="2" ATTVALUE="&apos;center&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_IMGPOSX_LEFT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="55 " ATTDECLTYP="2" ATTVALUE="&apos;left&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_IMGPOSX_RIGHT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="56 " ATTDECLTYP="2" ATTVALUE="&apos;right&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_IMGPOSY_BOTTOM" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="60 " ATTDECLTYP="2" ATTVALUE="&apos;bottom&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_IMGPOSY_MIDDLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="59 " ATTDECLTYP="2" ATTVALUE="&apos;center&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_IMGPOSY_TOP" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="58 " ATTDECLTYP="2" ATTVALUE="&apos;top&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_IMGTYPE_BEHIND" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="54 " ATTDECLTYP="2" ATTVALUE="4" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_IMGTYPE_FLOAT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="52 " ATTDECLTYP="2" ATTVALUE="2" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_IMGTYPE_INLINE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="51 " ATTDECLTYP="2" ATTVALUE="1" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_IMGTYPE_OVER" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="53 " ATTDECLTYP="2" ATTVALUE="3" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_LABEL_ANCHOR" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="17 " ATTDECLTYP="2" ATTVALUE="&apos;##LABEL##&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_NOTETYPE_END" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="71 " ATTDECLTYP="2" ATTVALUE="2" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_NOTETYPE_FOOT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="70 " ATTDECLTYP="2" ATTVALUE="1" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_ORIENT_LANDSCAPE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="68 " ATTDECLTYP="2" ATTVALUE="1" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_ORIENT_PORTRAIT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="69 " ATTDECLTYP="2" ATTVALUE="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_SAPWR_PREFIX" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="18 " ATTDECLTYP="2" ATTVALUE="&apos;SAPWR:&apos;" ATTEXPVIRT="0" TYPTYPE="4" SRCROW1="231 " SRCCOLUMN1="14 " SRCROW2="231 " SRCCOLUMN2="59 " TYPESRC_LENG="48 " TYPESRC="c_sapwr_prefix                 TYPE c LENGTH 6
"/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_STYLE_NORMAL" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="31 " ATTDECLTYP="2" ATTVALUE="&apos;Normal&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_STYLE_TITLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="26 " ATTDECLTYP="2" ATTVALUE="&apos;Title&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_STYLE_TITLE1" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="27 " ATTDECLTYP="2" ATTVALUE="&apos;Title1&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_STYLE_TITLE2" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="28 " ATTDECLTYP="2" ATTVALUE="&apos;Title2&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_STYLE_TITLE3" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="29 " ATTDECLTYP="2" ATTVALUE="&apos;Title3&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_STYLE_TITLE4" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="30 " ATTDECLTYP="2" ATTVALUE="&apos;Title4&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_SYMBOL_CHECKBOX" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="38 " ATTDECLTYP="2" ATTVALUE="&apos;o&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_SYMBOL_CHECKBOX_CHECKED" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="37 " ATTDECLTYP="2" ATTVALUE="&apos;þ&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_TRUE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="1 " ATTDECLTYP="2" ATTVALUE="1" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_TYPE_CHARACTER" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="64 " ATTDECLTYP="2" ATTVALUE="&apos;character&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_TYPE_FOOTER" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="62 " ATTDECLTYP="2" ATTVALUE="&apos;footer&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_TYPE_HEADER" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="61 " ATTDECLTYP="2" ATTVALUE="&apos;header&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_TYPE_IMAGE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="67 " ATTDECLTYP="2" ATTVALUE="&apos;image&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_TYPE_NUMBERING" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="66 " ATTDECLTYP="2" ATTVALUE="&apos;numbering&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_TYPE_PARAGRAPH" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="63 " ATTDECLTYP="2" ATTVALUE="&apos;paragraph&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_TYPE_TABLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="65 " ATTDECLTYP="2" ATTVALUE="&apos;table&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_VALIGN_BOTTOM" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="50 " ATTDECLTYP="2" ATTVALUE="&apos;bottom&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_VALIGN_MIDDLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="49 " ATTDECLTYP="2" ATTVALUE="&apos;center&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="C_VALIGN_TOP" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="48 " ATTDECLTYP="2" ATTVALUE="&apos;top&apos;" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="I_MARCADORES" VERSION="1" LANGU="S" DESCRIPT="Tabla de strings" EXPOSURE="2" STATE="1" EDITORDER="111 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="TT_MARCADORES" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="MO_ZIP" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="4 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="3" TYPE="CL_ABAP_ZIP" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="MS_SECTION" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="5 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="4" SRCROW1="7 " SRCCOLUMN1="6 " SRCROW2="18 " SRCCOLUMN2="22 " TYPESRC_LENG="409 " TYPESRC="BEGIN OF ms_section,
        landscape     TYPE i,
        continuous    TYPE i,
        header_first  TYPE string,
        header        TYPE string,
        footer_first  TYPE string,
        footer        TYPE string,
        border_left   TYPE ty_border,
        border_top    TYPE ty_border,
        border_right  TYPE ty_border,
        border_bottom TYPE ty_border,
      END OF ms_section
"/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="MT_LIST_OBJECT" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="9 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="TY_LIST_OBJECT_TABLE" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="MT_LIST_STYLE" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="8 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="TY_LIST_STYLE_TABLE" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="MW_ATTACH" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="3 " ATTDECLTYP="0" ATTVALUE="10000" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="MW_AUTHOR" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="10 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="MW_DOCXML" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="110 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="MW_DOC_INICIAL" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="109 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="MW_FRAGXML" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="1 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="MW_IMGMAXID" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="2 " ATTDECLTYP="0" ATTVALUE="100" ATTEXPVIRT="0" TYPTYPE="1" TYPE="I" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="MW_SECTION_XML" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="6 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <attribute CLSNAME="ZCL_AP_DOCX" CMPNAME="MW_TPL_SECTION_XML" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="7 " ATTDECLTYP="0" ATTEXPVIRT="0" TYPTYPE="1" TYPE="STRING" SRCROW1="0 " SRCCOLUMN1="0 " SRCROW2="0 " SRCCOLUMN2="0 " TYPESRC_LENG="0 "/>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="BORRAR_MARCADOR" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="43 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="BORRAR_MARCADOR" SCONAME="MARCADOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="BORRAR_MARCADOR" SCONAME="MESSAGE" VERSION="1" LANGU="S" DESCRIPT="Texto de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="BAPI_MSG"/>
  <source>METHOD borrar_marcador.
    CLEAR message.
    DELETE i_marcadores WHERE name = marcador.
    IF sy-subrc &lt;&gt; 0.
      message = |No existe el marcador { marcador }|.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="CONSTRUCTOR" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="1 " DISPID="0 " MTDTYPE="2" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CONSTRUCTOR" SCONAME="TPL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CONSTRUCTOR" SCONAME="KEEP_TPL_CONTENT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_TRUE"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CONSTRUCTOR" SCONAME="CONTENT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="XSTRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CONSTRUCTOR" SCONAME="TCODE" VERSION="1" LANGU="S" DESCRIPT="Código transacción" CMPTYPE="1" MTDTYPE="2" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CONSTRUCTOR" SCONAME="PLANTILLA" VERSION="1" LANGU="S" DESCRIPT="Nombre plantilla" CMPTYPE="1" MTDTYPE="2" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CONSTRUCTOR" SCONAME="GET_MARCADORES" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="2" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <source>METHOD constructor.
    DATA : lt_find_result TYPE match_result_tab,
           lw_docx        TYPE xstring,
           lw_file        TYPE string,
           lw_url_begin   TYPE c LENGTH 6,
           lw_extension   TYPE string,
           ls_find_result LIKE LINE OF lt_find_result,
           ls_list_style  TYPE ty_list_style,
           lw_string      TYPE string,
           ls_list_object TYPE ty_list_object.

    mo_zip = NEW #( ).

    IF content IS SUPPLIED AND NOT content IS INITIAL.
      lw_docx = content.
    ELSEIF tpl IS SUPPLIED AND NOT tpl IS INITIAL.
* Load template document
      _load_file( EXPORTING filename = tpl
                  IMPORTING xcontent = lw_docx ).
      IF lw_docx IS INITIAL.
        MESSAGE e398(00) WITH &apos;No se puede abrir plantilla&apos; tpl.
      ENDIF.
    ELSEIF plantilla IS SUPPLIED AND NOT plantilla IS INITIAL AND NOT tcode IS INITIAL.
      SELECT SINGLE xstring FROM zdocumentos
        INTO lw_docx
        WHERE tcode  = tcode
          AND nombre = plantilla.
    ELSE.
* Empty docx creation
      TRY.
          lw_docx = cl_docx_form=&gt;create_form( ).
        CATCH cx_openxml_not_allowed
              cx_openxml_not_found
              cx_openxml_format
              cx_docx_form_not_unicode.
          MESSAGE &apos;Cannot create empty doc, please use template&apos; TYPE &apos;A&apos;.
      ENDTRY.
    ENDIF.

* Load docx into zip object
    mo_zip-&gt;load( EXPORTING  zip             = lw_docx
                  EXCEPTIONS zip_parse_error = 1
                             OTHERS          = 2 ).

* Keep actual content
    IF keep_tpl_content = c_true.
      _get_zip_file( EXPORTING filename = &apos;word/document.xml&apos;                    ##NO_TEXT
                     IMPORTING content  = lw_file ).

      FIND FIRST OCCURRENCE OF &apos;&lt;w:body&apos; IN lw_file
           MATCH OFFSET sy-fdpos IGNORING CASE.
      IF sy-subrc = 0.
        lw_file = lw_file+sy-fdpos.
        FIND FIRST OCCURRENCE OF &apos;&gt;&apos; IN lw_file
             MATCH OFFSET sy-fdpos IGNORING CASE.
      ENDIF.
      IF sy-subrc = 0.
        sy-fdpos = sy-fdpos + 1.
        lw_file = lw_file+sy-fdpos.
        FIND FIRST OCCURRENCE OF &apos;&lt;/w:body&apos; IN lw_file
             MATCH OFFSET sy-fdpos IGNORING CASE.
      ENDIF.
      IF sy-subrc = 0.
        mw_docxml = lw_file(sy-fdpos).
        mw_doc_inicial = mw_docxml.
        FIND ALL OCCURRENCES OF &apos;&lt;w:sectPr&apos; IN mw_docxml
             MATCH OFFSET sy-fdpos IGNORING CASE.
        IF sy-subrc = 0.
          mw_tpl_section_xml = mw_docxml+sy-fdpos.
          mw_docxml = mw_docxml(sy-fdpos).
        ENDIF.
      ELSE.
        MESSAGE &apos;Cannot parse template content: empty document created&apos;
                TYPE &apos;I&apos;.
      ENDIF.
    ENDIF.

* Remove docx body
    mo_zip-&gt;delete( EXPORTING  name            = &apos;word/document.xml&apos;               ##NO_TEXT
                    EXCEPTIONS zip_index_error = 1
                               OTHERS          = 2 ).

* If modele is a template, transform it to document
    IF tpl IS SUPPLIED AND NOT tpl IS INITIAL.
      lw_url_begin = tpl.
      IF lw_url_begin = c_sapwr_prefix.
        SELECT SINGLE value INTO lw_extension
          FROM wwwparams
          WHERE relid = &apos;MI&apos;
            AND objid = tpl+6
            AND name  = &apos;fileextension&apos;.
        IF NOT lw_extension IS INITIAL AND lw_extension(1) = &apos;.&apos;.
          lw_extension = lw_extension+1.
        ENDIF.
      ELSE.
        FIND ALL OCCURRENCES OF &apos;.&apos; IN tpl MATCH OFFSET sy-fdpos.
        IF sy-subrc = 0.
          sy-fdpos = sy-fdpos + 1.
          lw_extension = tpl+sy-fdpos.
        ELSE.
          lw_extension = tpl.
        ENDIF.
      ENDIF.
      lw_extension = to_lower( lw_extension ).

* Template without macro
      IF lw_extension = &apos;dotx&apos;.
        _get_zip_file( EXPORTING filename = &apos;[Content_Types].xml&apos;                ##NO_TEXT
                       IMPORTING content  = lw_file ).

        REPLACE ALL OCCURRENCES OF &apos;wordprocessingml.template&apos;
                IN lw_file WITH &apos;wordprocessingml.document&apos; ##NO_TEXT.

        _update_zip_file( filename = &apos;[Content_Types].xml&apos;
                          content  = lw_file ).
* Template with macro
      ELSEIF lw_extension = &apos;dotm&apos;.
        _get_zip_file( EXPORTING filename = &apos;[Content_Types].xml&apos;                ##NO_TEXT
                       IMPORTING content  = lw_file ).

        REPLACE ALL OCCURRENCES OF &apos;template.macroEnabledTemplate&apos;
                IN lw_file WITH &apos;document.macroEnabled&apos; ##NO_TEXT.

        _update_zip_file( filename = &apos;[Content_Types].xml&apos;
                          content  = lw_file ).
      ENDIF.
    ENDIF.

* Get author name
    CLEAR mw_author.
    SELECT SINGLE name_textc INTO mw_author
      FROM user_addr
      WHERE bname = sy-uname ##WARN_OK.
    IF sy-subrc &lt;&gt; 0.
      mw_author = sy-uname.
    ENDIF.

* Set Author, Creation date and Version number properties
    set_properties( author       = mw_author
                    creationdate = sy-datlo
                    creationtime = sy-timlo
                    revision     = 1 ).

* Get style file
    _get_zip_file( EXPORTING filename = &apos;word/styles.xml&apos;                        ##NO_TEXT
                   IMPORTING content  = lw_file ).

* Scan style file to search all styles
    FIND ALL OCCURRENCES OF REGEX &apos;&lt;w:style ([^&gt;]*)&gt;&apos;
         IN lw_file RESULTS lt_find_result
         IGNORING CASE.
    LOOP AT lt_find_result INTO ls_find_result.
      CLEAR ls_list_style.
      FIND FIRST OCCURRENCE OF REGEX &apos;w:styleId=&quot;([^&quot;]*)&quot;&apos;
           IN SECTION OFFSET ls_find_result-offset
           LENGTH ls_find_result-length
           OF lw_file
           SUBMATCHES lw_string
           IGNORING CASE.
      IF sy-subrc &lt;&gt; 0.
        CONTINUE.
      ENDIF.
      ls_list_style-name = lw_string.
      FIND FIRST OCCURRENCE OF REGEX &apos;w:type=&quot;(paragraph|character|numbering|table)&quot;&apos;
           IN SECTION OFFSET ls_find_result-offset
           LENGTH ls_find_result-length
           OF lw_file
           SUBMATCHES lw_string
           IGNORING CASE.
      IF sy-subrc = 0.
        ls_list_style-type = lw_string.
      ENDIF.
      APPEND ls_list_style TO mt_list_style.
    ENDLOOP.
    SORT mt_list_style BY type
                          name.

* Get relation file
    _get_zip_file( EXPORTING filename = &apos;word/_rels/document.xml.rels&apos;           ##NO_TEXT
                   IMPORTING content  = lw_file ).

* Scan relation file to get all objects
    FIND ALL OCCURRENCES OF REGEX &apos;&lt;Relationship ([^&gt;]*)/&gt;&apos;
         IN lw_file RESULTS lt_find_result
         IGNORING CASE.
    LOOP AT lt_find_result INTO ls_find_result.
      CLEAR ls_list_object.
* Search id of object
      FIND FIRST OCCURRENCE OF REGEX &apos;Id=&quot;([^&quot;]*)&quot;&apos;
           IN SECTION OFFSET ls_find_result-offset
           LENGTH ls_find_result-length
           OF lw_file
           SUBMATCHES lw_string
           IGNORING CASE.
      IF sy-subrc &lt;&gt; 0.
        CONTINUE.
      ENDIF.
      ls_list_object-id = lw_string.
* Search type of object
      FIND FIRST OCCURRENCE OF REGEX &apos;Type=&quot;.*(footer|header|image)&quot;&apos;
           IN SECTION OFFSET ls_find_result-offset
           LENGTH ls_find_result-length
           OF lw_file
           SUBMATCHES lw_string
           IGNORING CASE.
      IF sy-subrc &lt;&gt; 0.
        CONTINUE.
      ENDIF.
      ls_list_object-type = lw_string.

* Search path of file
      FIND FIRST OCCURRENCE OF REGEX &apos;Target=&quot;([^&quot;]*)&quot;&apos;
           IN SECTION OFFSET ls_find_result-offset
           LENGTH ls_find_result-length
           OF lw_file
           SUBMATCHES lw_string
           IGNORING CASE.
      IF sy-subrc &lt;&gt; 0.
        CONTINUE.
      ENDIF.
      CONCATENATE &apos;word/&apos; lw_string INTO ls_list_object-path.

      APPEND ls_list_object TO mt_list_object.
    ENDLOOP.
    SORT mt_list_object BY type
                           id.

    IF get_marcadores = &apos;X&apos;.
      get_marcadores( IMPORTING i_marcadores = i_marcadores ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="CREATE_CHARACTER_STYLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="21 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CREATE_CHARACTER_STYLE" SCONAME="OUTPUT_NAME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CREATE_CHARACTER_STYLE" SCONAME="STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_CHARACTER_STYLE_EFFECT"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CREATE_CHARACTER_STYLE" SCONAME="STYLE_REF" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CREATE_CHARACTER_STYLE" SCONAME="NAME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CREATE_CHARACTER_STYLE" SCONAME="INVALID_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <source>METHOD create_character_style.
    DATA : lw_style      TYPE string,
           lw_string     TYPE string,
           lw_file       TYPE string,
           ls_list_style LIKE LINE OF mt_list_style.

* Build simple style internal name
    name = output_name.
    REPLACE ALL OCCURRENCES OF REGEX &apos;[^A-Za-z0-9]&apos; IN name WITH space.
    CONDENSE name NO-GAPS.

* Check style internal name is available
    IF line_exists( mt_list_style[ type = c_type_character
                                   name = name ] ).
      CLEAR name.
      RETURN.
    ENDIF.

* Build character style
    _build_character_style( EXPORTING style_effect = style_effect
                            IMPORTING xml          = lw_style ).

    IF style_ref IS SUPPLIED AND NOT style_ref IS INITIAL.
      IF line_exists( mt_list_style[ type = c_type_character
                                     name = style_ref ] ).
        CONCATENATE &apos;&lt;w:basedOn w:val=&quot;&apos;
                    style_ref
                    &apos;&quot;/&gt;&apos;
                    INTO lw_string.
      ELSE.
        invalid_style = c_true.
      ENDIF.
    ENDIF.
    CONCATENATE &apos;&lt;w:style w:type=&quot;&apos;
                c_type_character
                &apos;&quot; w:customStyle=&quot;1&quot; w:styleId=&quot;&apos;
                name
                &apos;&quot;&gt;&apos;
                &apos;&lt;w:name w:val=&quot;&apos;
                output_name
                &apos;&quot;/&gt;&apos;
                lw_string
                lw_style
                &apos;&lt;/w:style&gt;&apos;
                &apos;&lt;/w:styles&gt;&apos;
                INTO lw_style.

* Get styles file
    _get_zip_file( EXPORTING filename = &apos;word/styles.xml&apos;
                   IMPORTING content  = lw_file ).

* Update style file content
    REPLACE &apos;&lt;/w:styles&gt;&apos; IN lw_file WITH lw_style.

* Update zipped style file
    _update_zip_file( filename = &apos;word/styles.xml&apos;
                      content  = lw_file ).

* Update style list
    CLEAR ls_list_style.
    ls_list_style-type = c_type_character.
    ls_list_style-name = name.
    APPEND ls_list_style TO mt_list_style.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="CREATE_CUSTOM_FIELD" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="20 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CREATE_CUSTOM_FIELD" SCONAME="FIELD" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CREATE_CUSTOM_FIELD" SCONAME="VALUE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD create_custom_field. &quot; not managed
    DATA : lw_file   TYPE string,
           lw_id     TYPE string,
           lw_string TYPE string.

* If customproperties does not exist, create it
    IF NOT line_exists( mo_zip-&gt;files[ name = &apos;docProps/custom.xml&apos; ] ).

* Declare new file in relations
      _get_zip_file( EXPORTING filename = &apos;_rels/.rels&apos;
                     IMPORTING content  = lw_file ).
* search available id
      DO.
        lw_id = sy-index.
        CONDENSE lw_id NO-GAPS.
        CONCATENATE &apos;rId&apos; lw_id INTO lw_id ##NO_TEXT.
        CONCATENATE &apos;Id=&quot;&apos; lw_id &apos;&quot;&apos; INTO lw_string ##NO_TEXT.
        FIND lw_string IN lw_file IGNORING CASE.
        IF sy-subrc &lt;&gt; 0.
          EXIT. &quot; exit do
        ENDIF.
      ENDDO.

      CONCATENATE &apos;&lt;Relationship Target=&quot;docProps/custom.xml&quot;&apos;
                  &apos; Type=&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties&quot;&apos;
                  &apos; Id=&quot;&apos;
                  lw_id
                  &apos;&quot;/&gt;&lt;/Relationships&gt;&apos;
                  INTO lw_string RESPECTING BLANKS.
      REPLACE &apos;&lt;/Relationships&gt;&apos; IN lw_file WITH lw_string.
      _update_zip_file( filename = &apos;_rels/.rels&apos;
                        content  = lw_file ).

* Declare new file in content type
      _get_zip_file( EXPORTING filename = &apos;[Content_Types].xml&apos;
                     IMPORTING content  = lw_file ).
      REPLACE &apos;&lt;/Types&gt;&apos; IN lw_file
              WITH &apos;&lt;Override ContentType=&quot;application/vnd.openxmlformats-officedocument.custom-properties+xml&quot; PartName=&quot;/docProps/custom.xml&quot;/&gt;&lt;/Types&gt;&apos;.
      _update_zip_file( filename = &apos;[Content_Types].xml&apos;
                        content  = lw_file ).

      CONCATENATE &apos;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot; ?&gt;&apos;
                  &apos;&lt;Properties xmlns=&quot;http://schemas.openxmlformats.org/officeDocument/2006/custom-properties&quot;&apos;
                  &apos; xmlns:vt=&quot;http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes&quot;&gt;&apos;
                  &apos;&lt;/Properties&gt;&apos;
                  INTO lw_file RESPECTING BLANKS.
      _update_zip_file( filename = &apos;docProps/custom.xml&apos;
                        content  = lw_file ).
    ENDIF.

* Open custom properties
    _get_zip_file( EXPORTING filename = &apos;docProps/custom.xml&apos;
                   IMPORTING content  = lw_file ).

* Search available ID
    DO.
      IF sy-index = 1.
        CONTINUE.
      ENDIF.
      lw_id = sy-index.
      CONDENSE lw_id NO-GAPS.
      CONCATENATE &apos;pid=&quot;&apos; lw_id &apos;&quot;&apos; INTO lw_string.
      FIND lw_string IN lw_file IGNORING CASE.
      IF sy-subrc &lt;&gt; 0.
        EXIT. &quot; exit do
      ENDIF.
    ENDDO.

* Add property
    CONCATENATE &apos;&lt;property fmtid=&quot;{D5CDD505-2E9C-101B-9397-08002B2CF9AE}&quot;&apos;
                &apos; pid=&quot;&apos;
                lw_id
                &apos;&quot; name=&quot;&apos;
                field
                &apos;&quot;&gt;&apos;
                &apos;&lt;vt:lpwstr&gt;&apos;
                value
                &apos;&lt;/vt:lpwstr&gt;&apos;
                &apos;&lt;/property&gt;&apos;
                &apos;&lt;/Properties&gt;&apos;
                INTO lw_string RESPECTING BLANKS.
    REPLACE &apos;&lt;/Properties&gt;&apos; IN lw_file WITH lw_string.

* Update custopproperties file
    _update_zip_file( filename = &apos;docProps/custom.xml&apos;
                      content  = lw_file ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="CREATE_PARAGRAPH_STYLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="22 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CREATE_PARAGRAPH_STYLE" SCONAME="OUTPUT_NAME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CREATE_PARAGRAPH_STYLE" SCONAME="STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_CHARACTER_STYLE_EFFECT"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CREATE_PARAGRAPH_STYLE" SCONAME="LINE_STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_PARAGRAPH_STYLE_EFFECT"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CREATE_PARAGRAPH_STYLE" SCONAME="STYLE_REF" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CREATE_PARAGRAPH_STYLE" SCONAME="NAME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="CREATE_PARAGRAPH_STYLE" SCONAME="INVALID_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <source>METHOD create_paragraph_style.
    DATA : lw_style      TYPE string,
           lw_stylepr    TYPE string,
           lw_string     TYPE string,
           lw_file       TYPE string,
           ls_list_style LIKE LINE OF mt_list_style.

* Build simple style internal name
    name = output_name.
    REPLACE ALL OCCURRENCES OF REGEX &apos;[^A-Za-z0-9]&apos; IN name WITH space.
    CONDENSE name NO-GAPS.

* Check style internal name is available
    IF line_exists( mt_list_style[ type = c_type_paragraph
                                   name = name ] ).
      CLEAR name.
      RETURN.
    ENDIF.

* Build character style
    _build_character_style( EXPORTING style_effect = style_effect
                            IMPORTING xml          = lw_style ).

* Build paragraph style
    _build_paragraph_style( EXPORTING style_effect = line_style_effect
                            IMPORTING xml          = lw_stylepr ).

    IF style_ref IS SUPPLIED AND NOT style_ref IS INITIAL.
      IF line_exists( mt_list_style[ type = c_type_paragraph
                                     name = style_ref ] ).
        CONCATENATE &apos;&lt;w:basedOn w:val=&quot;&apos;
                    style_ref
                    &apos;&quot;/&gt;&apos;
                    INTO lw_string.
      ELSE.
        invalid_style = c_true.
      ENDIF.
    ENDIF.
    CONCATENATE &apos;&lt;w:style w:type=&quot;&apos;
                c_type_paragraph
                &apos;&quot; w:customStyle=&quot;1&quot; w:styleId=&quot;&apos;
                name
                &apos;&quot;&gt;&apos;
                &apos;&lt;w:name w:val=&quot;&apos;
                output_name
                &apos;&quot;/&gt;&apos;
                lw_string
                lw_stylepr
                lw_style
                &apos;&lt;/w:style&gt;&apos;
                &apos;&lt;/w:styles&gt;&apos;
                INTO lw_style.

* Get styles file
    _get_zip_file( EXPORTING filename = &apos;word/styles.xml&apos;
                   IMPORTING content  = lw_file ).

* Update style file content
    REPLACE &apos;&lt;/w:styles&gt;&apos; IN lw_file WITH lw_style.

* Update zipped style file
    _update_zip_file( filename = &apos;word/styles.xml&apos;
                      content  = lw_file ).

* Update style list
    CLEAR ls_list_style.
    ls_list_style-type = c_type_paragraph.
    ls_list_style-name = name.
    APPEND ls_list_style TO mt_list_style.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="DIRECT_DRAW" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="13 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DIRECT_DRAW" SCONAME="TYPE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DIRECT_DRAW" SCONAME="WIDTH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="P"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DIRECT_DRAW" SCONAME="HEIGHT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="P"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DIRECT_DRAW" SCONAME="POSX" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="P" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DIRECT_DRAW" SCONAME="POSY" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="P" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DIRECT_DRAW" SCONAME="ZINDEX" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="100"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DIRECT_DRAW" SCONAME="BG_COLOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DIRECT_DRAW" SCONAME="BORDER_COLOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DIRECT_DRAW" SCONAME="BORDER_WIDTH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="P" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DIRECT_DRAW" SCONAME="UNIT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PARVALUE="&apos;pt&apos;"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DIRECT_DRAW" SCONAME="TEXT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DIRECT_DRAW" SCONAME="TEXT_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="12 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DIRECT_DRAW" SCONAME="TEXT_LINE_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="13 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PARVALUE="C_STYLE_NORMAL"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DIRECT_DRAW" SCONAME="TEXT_XML" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="14 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <source>METHOD direct_draw.
    DATA : lw_texte  TYPE string,
           lw_string TYPE string,
           lw_style  TYPE string.

* Prepare text content
    IF text_xml IS NOT INITIAL.
      lw_texte = text_xml.
    ELSEIF text IS NOT INITIAL.
      write_text( EXPORTING textline   = text
                            style      = text_style
                            line_style = text_line_style
                  IMPORTING virtual    = lw_texte ).
    ENDIF.
    IF NOT lw_texte IS INITIAL.
      CONCATENATE &apos;&lt;v:textbox&gt;&apos;
                  &apos;&lt;w:txbxContent&gt;&apos;
                  lw_texte
                  &apos;&lt;/w:txbxContent&gt;&apos;
                  &apos;&lt;/v:textbox&gt;&apos;
                  INTO lw_texte.
    ENDIF.

* Prepare object style
    lw_string = posx.
    CONDENSE lw_string NO-GAPS.
    CONCATENATE &apos; style=&quot;&apos;
                &apos;position:absolute;&apos;
                &apos;margin-left:&apos;
                lw_string
                unit
                &apos;;&apos;
                INTO lw_style RESPECTING BLANKS.

    lw_string = posy.
    CONDENSE lw_string NO-GAPS.
    CONCATENATE lw_style
                &apos;margin-top:&apos;
                lw_string
                unit
                &apos;;&apos;
                INTO lw_style RESPECTING BLANKS.
    lw_string = width.
    CONDENSE lw_string NO-GAPS.
    CONCATENATE lw_style
                &apos;width:&apos;
                lw_string
                unit
                &apos;;&apos;
                INTO lw_style RESPECTING BLANKS.
    lw_string = height.
    CONDENSE lw_string NO-GAPS.
    CONCATENATE lw_style
                &apos;height:&apos;
                lw_string
                unit
                &apos;;&apos;
                INTO lw_style RESPECTING BLANKS.
    lw_string = zindex.
    CONDENSE lw_string NO-GAPS.
    CONCATENATE lw_style
                &apos;z-index:&apos;
                lw_string
                &apos;;&quot;&apos;
                INTO lw_style RESPECTING BLANKS.

    IF bg_color IS INITIAL.
      CONCATENATE lw_style
                  &apos; filled=&quot;f&quot;&apos;
                  INTO lw_style RESPECTING BLANKS.
    ELSE.
      CONCATENATE lw_style
                  &apos; fillcolor=&quot;&apos;
                  bg_color
                  &apos;&quot;&apos;
                  INTO lw_style RESPECTING BLANKS.
    ENDIF.

    IF border_width IS INITIAL.
      CONCATENATE lw_style
                  &apos; stroked=&quot;f&quot;&apos;
                  INTO lw_style RESPECTING BLANKS.
    ELSEIF NOT border_color IS INITIAL.
      CONCATENATE lw_style
                  &apos; strokecolor=&quot;&apos;
                  border_color
                  &apos;&quot;&apos;
                  INTO lw_style RESPECTING BLANKS.
    ENDIF.

    lw_string = border_width.
    CONDENSE lw_string NO-GAPS.
    CONCATENATE lw_style
                &apos; strokeweight=&quot;&apos;
                lw_string
                unit
                &apos;&quot;&apos;
                INTO lw_style RESPECTING BLANKS.

    CONCATENATE mw_fragxml
                &apos;&lt;w:r&gt;&apos;
                &apos;&lt;w:pict&gt;&apos;
                &apos;&lt;v:&apos;
                type
                lw_style
                &apos;&gt;&apos;
                lw_texte
                &apos;&lt;/v:&apos;
                type
                &apos;&gt;&apos;
                &apos;&lt;/w:pict&gt;&apos;
                &apos;&lt;/w:r&gt;&apos;
                INTO mw_fragxml RESPECTING BLANKS.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="15 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW" SCONAME="OBJECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW" SCONAME="LEFT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="0"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW" SCONAME="TOP" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="0"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW" SCONAME="WIDTH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="0"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW" SCONAME="HEIGHT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="0"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW" SCONAME="URL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW" SCONAME="BGCOLOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW" SCONAME="BDCOLOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW" SCONAME="BDWIDTH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="F" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW" SCONAME="INVALID_IMAGE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW" SCONAME="ID" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <source>METHOD draw.
    DATA : lw_width    TYPE i,
           lw_string_x TYPE string,
           lw_string_y TYPE string,
           lw_string_w TYPE string,
           lw_string_h TYPE string,
           lw_style    TYPE string,
           lw_string   TYPE string,
           lw_color    TYPE string.

    lw_width = c_basesize * left.
    lw_string_x = lw_width.
    CONDENSE lw_string_x NO-GAPS.
    lw_width = c_basesize * top.
    lw_string_y = lw_width.
    CONDENSE lw_string_y NO-GAPS.
    lw_width = c_basesize * width.
    lw_string_w = lw_width.
    CONDENSE lw_string_w NO-GAPS.
    lw_width = c_basesize * height.
    lw_string_h = lw_width.
    CONDENSE lw_string_h NO-GAPS.

    CASE object.
      WHEN c_draw_image.
        invalid_image = c_false.
        _load_image( EXPORTING url = url
                     CHANGING  id  = id ).
        IF id IS INITIAL.
          invalid_image = c_true.
          RETURN.
        ENDIF.
        CLEAR lw_style.
        IF bgcolor IS SUPPLIED AND NOT bgcolor IS INITIAL.
          CONCATENATE lw_style
                      &apos;&lt;a:solidFill&gt;&apos;
                      &apos;&lt;a:srgbClr val=&quot;&apos;
                      bgcolor
                      &apos;&quot; /&gt;&apos;
                      &apos;&lt;/a:solidFill&gt;&apos;
                      INTO lw_style.
        ENDIF.

        IF     bdcolor IS SUPPLIED AND NOT bdcolor IS INITIAL
           AND bdwidth IS SUPPLIED AND NOT bdwidth IS INITIAL.
          lw_width = c_basesize * bdwidth.
          lw_string = lw_width.
          CONDENSE lw_string NO-GAPS.

          CONCATENATE lw_style
                      &apos;&lt;a:ln w=&quot;&apos;
                      lw_string
                      &apos;&quot;&gt;&apos;
                      &apos;&lt;a:solidFill&gt;&apos;
                      &apos;&lt;a:srgbClr val=&quot;&apos;
                      bdcolor
                      &apos;&quot; /&gt;&apos;
                      &apos;&lt;/a:solidFill&gt;&apos;
                      &apos;&lt;/a:ln&gt;&apos;
                      INTO lw_style.
        ENDIF.

        CONCATENATE mw_fragxml
                    &apos;&lt;pic:pic xmlns:pic=&quot;http://schemas.openxmlformats.org/drawingml/2006/picture&quot;&gt;&apos;
                    &apos;&lt;pic:nvPicPr&gt;&apos;
                    &apos;&lt;pic:cNvPr name=&quot;Image&quot; id=&quot;1&quot;/&gt;&apos;
                    &apos;&lt;pic:cNvPicPr&gt;&apos;
                    &apos;&lt;a:picLocks/&gt;&apos;
                    &apos;&lt;/pic:cNvPicPr&gt;&apos;
                    &apos;&lt;/pic:nvPicPr&gt;&apos;
                    &apos;&lt;pic:blipFill&gt;&apos;
                    &apos;&lt;a:blip r:embed=&quot;&apos;
                    id
                    &apos;&quot;&gt;&apos;
                    &apos;&lt;/a:blip&gt;&apos;
                    &apos;&lt;a:stretch&gt;&lt;a:fillRect/&gt;&lt;/a:stretch&gt;&apos;
                    &apos;&lt;/pic:blipFill&gt;&apos;
                    &apos;&lt;pic:spPr&gt;&apos;
                    &apos;&lt;a:xfrm&gt;&apos;
                    &apos;&lt;a:off y=&quot;&apos;
                    lw_string_y
                    &apos;&quot; x=&quot;&apos;
                    lw_string_x
                    &apos;&quot;/&gt;&apos;
                    &apos;&lt;a:ext cy=&quot;&apos;
                    lw_string_h
                    &apos;&quot; cx=&quot;&apos;
                    lw_string_w
                    &apos;&quot;/&gt;&apos;
                    &apos;&lt;/a:xfrm&gt;&apos;
                    &apos;&lt;a:prstGeom prst=&quot;rect&quot;/&gt;&apos;
                    lw_style
                    &apos;&lt;/pic:spPr&gt;&apos;
                    &apos;&lt;/pic:pic&gt;&apos;
                    INTO mw_fragxml.

      WHEN c_draw_rectangle.
* Default : white rect with 1pt black border
        CLEAR lw_style.
        IF bgcolor IS SUPPLIED AND NOT bgcolor IS INITIAL.
          lw_color = bgcolor.
        ELSE.
          lw_color = c_color_white.
        ENDIF.
        CONCATENATE lw_style
                    &apos;&lt;a:solidFill&gt;&apos;
                    &apos;&lt;a:srgbClr val=&quot;&apos;
                    lw_color
                    &apos;&quot; /&gt;&apos;
                    &apos;&lt;/a:solidFill&gt;&apos;
                    INTO lw_style.

        IF bdcolor IS SUPPLIED AND NOT bdcolor IS INITIAL.
          lw_color = bdcolor.
        ELSE.
          lw_color = c_color_black.
        ENDIF.
        IF bdwidth IS SUPPLIED AND NOT bdwidth IS INITIAL.
          lw_width = c_basesize * bdwidth.
        ELSE.
          lw_width = c_basesize.
        ENDIF.
        lw_string = lw_width.
        CONDENSE lw_string NO-GAPS.

        CONCATENATE lw_style
                    &apos;&lt;a:ln w=&quot;&apos;
                    lw_string
                    &apos;&quot;&gt;&apos;
                    &apos;&lt;a:solidFill&gt;&apos;
                    &apos;&lt;a:srgbClr val=&quot;&apos;
                    lw_color
                    &apos;&quot; /&gt;&apos;
                    &apos;&lt;/a:solidFill&gt;&apos;
                    &apos;&lt;/a:ln&gt;&apos;
                    INTO lw_style.

        CONCATENATE mw_fragxml
                    &apos;&lt;wps:wsp&gt;&apos;
                    &apos;&lt;wps:cNvPr name=&quot;Rectangle&quot; id=&quot;1&quot;/&gt;&apos;
                    &apos;&lt;wps:cNvSpPr/&gt;&apos;
                    &apos;&lt;wps:spPr&gt;&apos;
                    &apos;&lt;a:xfrm&gt;&apos;
                    &apos;&lt;a:off y=&quot;&apos;
                    lw_string_y
                    &apos;&quot; x=&quot;&apos;
                    lw_string_x
                    &apos;&quot;/&gt;&apos;
                    &apos;&lt;a:ext cy=&quot;&apos;
                    lw_string_h
                    &apos;&quot; cx=&quot;&apos;
                    lw_string_w
                    &apos;&quot;/&gt;&apos;
                    &apos;&lt;/a:xfrm&gt;&apos;
                    &apos;&lt;a:prstGeom prst=&quot;rect&quot;/&gt;&apos;
                    lw_style
                    &apos;&lt;/wps:spPr&gt;&apos;
                    &apos;&lt;wps:bodyPr /&gt;&apos;
                    &apos;&lt;/wps:wsp&gt;&apos;
                    INTO mw_fragxml RESPECTING BLANKS.
    ENDCASE.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW_FINALIZE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="16 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD draw_finalize.
    CONCATENATE mw_docxml
                &apos;&lt;w:p&gt;&apos;
                mw_fragxml
                &apos;&lt;/wpc:wpc&gt;&apos;
                &apos;&lt;/a:graphicData&gt;&apos;
                &apos;&lt;/a:graphic&gt;&apos;
                &apos;&lt;/wp:anchor&gt;&apos;
                &apos;&lt;/w:drawing&gt;&apos;
                &apos;&lt;/mc:Choice&gt;&apos;
                &apos;&lt;mc:Fallback&gt;&apos;
                &apos;&lt;w:t&gt;Canvas graphic cannot be loaded (compatible only from Word 2010)&lt;/w:t&gt;&apos;
                &apos;&lt;/mc:Fallback&gt;&apos;
                &apos;&lt;/mc:AlternateContent&gt;&apos;
                &apos;&lt;/w:r&gt;&apos;
                &apos;&lt;/w:p&gt;&apos;
                INTO mw_docxml.
    CLEAR mw_fragxml.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW_INIT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="14 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW_INIT" SCONAME="LEFT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW_INIT" SCONAME="TOP" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW_INIT" SCONAME="WIDTH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW_INIT" SCONAME="HEIGHT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW_INIT" SCONAME="BGCOLOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW_INIT" SCONAME="BDCOLOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DRAW_INIT" SCONAME="BDWIDTH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="F" PAROPTIONL="X"/>
  <source>METHOD draw_init.
    DATA : lw_style    TYPE string,
           lw_width    TYPE i,
           lw_string   TYPE string,
           lw_string_x TYPE string,
           lw_string_y TYPE string,
           lw_string_w TYPE string,
           lw_string_h TYPE string.

    CLEAR mw_fragxml.
    IF bgcolor IS SUPPLIED AND NOT bgcolor IS INITIAL.
      CONCATENATE lw_style
                  &apos;&lt;wpc:bg&gt;&apos;
                  &apos;&lt;a:solidFill&gt;&apos;
                  &apos;&lt;a:srgbClr val=&quot;&apos;
                  bgcolor
                  &apos;&quot; /&gt;&apos;
                  &apos;&lt;/a:solidFill&gt;&apos;
                  &apos;&lt;/wpc:bg&gt;&apos;
                  INTO lw_style.
    ENDIF.

    IF     bdcolor IS SUPPLIED AND NOT bdcolor IS INITIAL
       AND bdwidth IS SUPPLIED AND NOT bdwidth IS INITIAL.
      lw_width = c_basesize * bdwidth.
      lw_string = lw_width.
      CONDENSE lw_string NO-GAPS.

      CONCATENATE lw_style
                  &apos;&lt;wpc:whole&gt;&apos;
                  &apos;&lt;a:ln w=&quot;&apos;
                  lw_string
                  &apos;&quot;&gt;&apos;
                  &apos;&lt;a:solidFill&gt;&apos;
                  &apos;&lt;a:srgbClr val=&quot;&apos;
                  bdcolor
                  &apos;&quot; /&gt;&apos;
                  &apos;&lt;/a:solidFill&gt;&apos;
                  &apos;&lt;/a:ln&gt;&apos;
                  &apos;&lt;/wpc:whole&gt;&apos;
                  INTO lw_style.
    ENDIF.

    lw_width = c_basesize * left.
    lw_string_x = lw_width.
    CONDENSE lw_string_x NO-GAPS.
    lw_width = c_basesize * top.
    lw_string_y = lw_width.
    CONDENSE lw_string_y NO-GAPS.
    lw_width = c_basesize * width.
    lw_string_w = lw_width.
    CONDENSE lw_string_w NO-GAPS.
    lw_width = c_basesize * height.
    lw_string_h = lw_width.
    CONDENSE lw_string_h NO-GAPS.

    CONCATENATE &apos;&lt;w:r&gt;&apos;
                &apos;&lt;mc:AlternateContent&gt;&apos;
                &apos;&lt;mc:Choice Requires=&quot;wpc&quot;&gt;&apos;
                &apos;&lt;w:drawing&gt;&apos;
                &apos;&lt;wp:anchor distR=&quot;0&quot; distL=&quot;0&quot; distB=&quot;0&quot; distT=&quot;0&quot; allowOverlap=&quot;0&quot; layoutInCell=&quot;1&quot; locked=&quot;0&quot; behindDoc=&quot;1&quot; relativeHeight=&quot;0&quot; simplePos=&quot;0&quot;&gt;&apos;
                &apos;&lt;wp:simplePos y=&quot;0&quot; x=&quot;0&quot;/&gt;&apos;
                &apos;&lt;wp:positionH relativeFrom=&quot;column&quot;&gt;&apos;
                &apos;&lt;wp:posOffset&gt;&apos;
                lw_string_x
                &apos;&lt;/wp:posOffset&gt;&apos;
                &apos;&lt;/wp:positionH&gt;&apos;
                &apos;&lt;wp:positionV relativeFrom=&quot;paragraph&quot;&gt;&apos;
                &apos;&lt;wp:posOffset&gt;&apos;
                lw_string_y
                &apos;&lt;/wp:posOffset&gt;&apos;
                &apos;&lt;/wp:positionV&gt;&apos;
                &apos;&lt;wp:extent cy=&quot;&apos;
                lw_string_h
                &apos;&quot; cx=&quot;&apos;
                lw_string_w
                &apos;&quot;/&gt;&apos;
                &apos;&lt;wp:wrapNone/&gt;&apos;
                &apos;&lt;wp:docPr name=&quot;Draw container&quot; id=&quot;3&quot;/&gt;&apos;
                &apos;&lt;a:graphic xmlns:a=&quot;http://schemas.openxmlformats.org/drawingml/2006/main&quot;&gt;&apos;
                &apos;&lt;a:graphicData uri=&quot;http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas&quot;&gt;&apos;
                &apos;&lt;wpc:wpc&gt;&apos;
                lw_style
                INTO mw_fragxml RESPECTING BLANKS.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="DUPLICAR_CONTENIDO" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="37 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="DUPLICAR_CONTENIDO" SCONAME="SALTO_PAGINA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <source>METHOD duplicar_contenido.
    IF salto_pagina = &apos;X&apos;.
      write_break( breaktype = c_breaktype_page ).
    ENDIF.

    CONCATENATE mw_docxml mw_doc_inicial INTO mw_docxml.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_BLOQUE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="38 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_BLOQUE" SCONAME="TAG" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_BLOQUE" SCONAME="DOC" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_BLOQUE" SCONAME="INCLUIR_TAG" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_BLOQUE" SCONAME="STRING" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD get_bloque.
    DATA: l_doc TYPE string,
          l_ini TYPE string,
          l_fin TYPE string.

    IF doc IS INITIAL.
      l_doc = mw_docxml.
    ELSE.
      l_doc = doc.
    ENDIF.

    CLEAR string.

    CONCATENATE &apos;&lt;w:&apos; tag &apos;&gt;&apos; INTO l_ini.

    FIND FIRST OCCURRENCE OF l_ini IN l_doc MATCH OFFSET sy-fdpos IGNORING CASE.
    IF sy-subrc = 0.
      string = l_doc+sy-fdpos.
      IF incluir_tag IS INITIAL.
        FIND FIRST OCCURRENCE OF &apos;&gt;&apos; IN string MATCH OFFSET sy-fdpos IGNORING CASE.
      ENDIF.
    ELSE.
      CONCATENATE &apos;&lt;w:&apos; tag space INTO l_ini RESPECTING BLANKS.
      FIND FIRST OCCURRENCE OF l_ini IN l_doc MATCH OFFSET sy-fdpos IGNORING CASE.
      IF sy-subrc = 0.
        string = l_doc+sy-fdpos.
        IF incluir_tag IS INITIAL.
          FIND FIRST OCCURRENCE OF &apos;&gt;&apos; IN string MATCH OFFSET sy-fdpos IGNORING CASE.
        ENDIF.
      ENDIF.
    ENDIF.

    IF string IS INITIAL.
      RETURN.
    ENDIF.

    IF incluir_tag IS INITIAL.
      sy-fdpos = sy-fdpos + 1.
    ENDIF.
    string = string+sy-fdpos.

    CONCATENATE &apos;&lt;/w:&apos; tag &apos;&gt;&apos; INTO l_fin.
    FIND FIRST OCCURRENCE OF l_fin IN string MATCH OFFSET sy-fdpos IGNORING CASE.
    IF sy-subrc = 0.
      IF incluir_tag IS INITIAL.
        string = string(sy-fdpos).
      ELSE.
        DATA(l_pos) = sy-fdpos.
        FIND FIRST OCCURRENCE OF &apos;&gt;&apos; IN string+l_pos MATCH OFFSET sy-fdpos IGNORING CASE.
        IF sy-subrc = 0.
          sy-fdpos = l_pos + sy-fdpos + 1.
          string = string(sy-fdpos).
        ENDIF.
      ENDIF.
    ELSE.
      CONCATENATE &apos;&lt;/w:&apos; tag space INTO l_fin RESPECTING BLANKS.
      FIND FIRST OCCURRENCE OF l_fin IN string MATCH OFFSET sy-fdpos IGNORING CASE.
      IF sy-subrc = 0.
        IF incluir_tag IS INITIAL.
          string = string(sy-fdpos).
        ELSE.
          l_pos = sy-fdpos.
          FIND FIRST OCCURRENCE OF &apos;&gt;&apos; IN string+l_pos MATCH OFFSET sy-fdpos IGNORING CASE.
          IF sy-subrc = 0.
            sy-fdpos = l_pos + sy-fdpos + 1.
            string = string(sy-fdpos).
          ENDIF.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_BLOQUE_MARCADOR" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="39 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_BLOQUE_MARCADOR" SCONAME="MARCADOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_BLOQUE_MARCADOR" SCONAME="DOC" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_BLOQUE_MARCADOR" SCONAME="TAG" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_BLOQUE_MARCADOR" SCONAME="INCLUIR_TAG" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_BLOQUE_MARCADOR" SCONAME="STRING" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD get_bloque_marcador.
    DATA: l_doc      TYPE string,
          l_aux      TYPE string,
          l_pos      TYPE i,
          l_ini_tag1 TYPE string,
          l_ini_tag2 TYPE string,
          l_long     TYPE i,
          &quot; TODO: variable is assigned but never used (ABAP cleaner)
          l_ini      TYPE i.

    IF doc IS INITIAL.
      l_doc = mw_docxml.
    ELSE.
      l_doc = doc.
    ENDIF.

    CLEAR string.

    l_aux = |w:name=&quot;{ marcador }&quot;/&gt;&lt;w:bookmarkEnd|.

    FIND FIRST OCCURRENCE OF l_aux IN l_doc MATCH OFFSET sy-fdpos IGNORING CASE.
    IF sy-subrc = 0.
      l_pos = sy-fdpos - 10.
      DO 3000 TIMES.
        IF l_pos &lt; 0.
          EXIT.
        ENDIF.
        CONCATENATE &apos;&lt;w:&apos; tag space INTO l_ini_tag1 RESPECTING BLANKS.
        CONCATENATE &apos;&lt;w:&apos; tag &apos;&gt;&apos; INTO l_ini_tag2 RESPECTING BLANKS.
        l_long = strlen( l_ini_tag1 ).
        IF l_doc+l_pos(l_long) = l_ini_tag1 OR l_doc+l_pos(l_long) = l_ini_tag2.
          DATA(l_ok) = &apos;X&apos;.
          l_ini = l_pos.
          EXIT.
        ENDIF.
        l_pos = l_pos - 1.
      ENDDO.
      IF l_ok = &apos;X&apos;.
        l_aux = l_doc+l_pos.
        string = get_bloque( tag         = tag
                             doc         = l_aux
                             incluir_tag = incluir_tag ).
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_DOCX_FILE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="28 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_DOCX_FILE" SCONAME="XCONTENT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="XSTRING"/>
  <source>METHOD get_docx_file.
    DATA lw_xmlns TYPE string.

    CLEAR xcontent.

* Add final section info
    _write_section( ).
    CONCATENATE mw_docxml mw_section_xml INTO mw_docxml.

    _get_xml_ns( IMPORTING xml = lw_xmlns ).

* Add complete xml header
    CONCATENATE
    &apos;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;&apos;
    &apos;&lt;w:document &apos;
    lw_xmlns
    &apos;&gt;&apos;
    &apos;&lt;w:body&gt;&apos;
    mw_docxml
    &apos;&lt;/w:body&gt;&lt;/w:document&gt;&apos;
    INTO mw_docxml RESPECTING BLANKS.

* Add custom body into docx
    _update_zip_file( filename = &apos;word/document.xml&apos;
                      content  = mw_docxml ).

* Get final docx
    xcontent = mo_zip-&gt;save( ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_LIST_HEADERFOOTER" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="32 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_LIST_HEADERFOOTER" SCONAME="HEADERFOOTER_LIST" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_LIST_OBJECT_TABLE"/>
  <source>METHOD get_list_headerfooter.
    DATA ls_list_object LIKE LINE OF mt_list_object.

    REFRESH headerfooter_list.
    LOOP AT mt_list_object INTO ls_list_object
         WHERE type = c_type_header OR type = c_type_footer.
      APPEND ls_list_object TO headerfooter_list.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_LIST_IMAGE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="31 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_LIST_IMAGE" SCONAME="IMAGE_LIST" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_LIST_OBJECT_TABLE"/>
  <source>METHOD get_list_image.
    DATA ls_list_object LIKE LINE OF mt_list_object.

    REFRESH image_list.
    LOOP AT mt_list_object INTO ls_list_object WHERE type = c_type_image.
      APPEND ls_list_object TO image_list.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_LIST_STYLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="30 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_LIST_STYLE" SCONAME="STYLE_LIST" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_LIST_STYLE_TABLE"/>
  <source>METHOD get_list_style.
    style_list[] = mt_list_style[].
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_MARCADORES" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="41 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_MARCADORES" SCONAME="DOC" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_MARCADORES" SCONAME="I_MARCADORES" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="TT_MARCADORES"/>
  <source>METHOD get_marcadores.
    DATA: l_doc      TYPE string,
          l_marcador TYPE t_marcadores,
          aux1       TYPE string,
          aux2       TYPE string.

    CLEAR i_marcadores.
    IF doc IS INITIAL.
      l_doc = mw_docxml.
    ELSE.
      l_doc = doc.
    ENDIF.

    zcl_ap_regexp=&gt;buscar_patron( EXPORTING string    = l_doc
                                            patron    = &apos;&lt;w:bookmark[a-zA-Z\/][^&gt;]*&gt;&apos;
                                  IMPORTING busquedas = DATA(marcadores) ).

    LOOP AT marcadores ASSIGNING FIELD-SYMBOL(&lt;marc&gt;).
      IF &lt;marc&gt;-texto NS &apos;&lt;w:bookmarkStart&apos;.
        CONTINUE.
      ENDIF.

      CLEAR l_marcador.
      SPLIT &lt;marc&gt;-texto AT &apos;&lt;w:bookmarkStart w:id=&quot;&apos; INTO aux1 aux2.
      SPLIT aux2 AT &apos;&quot;&apos; INTO l_marcador-id aux1.
      SPLIT aux1 AT &apos;w:name=&quot;&apos; INTO aux1 aux2.
      SPLIT aux2 AT &apos;&quot;&apos; INTO l_marcador-name aux2.

      aux1 = |&lt;w:bookmarkEnd w:id=&quot;{ l_marcador-id }&quot;/&gt;|.
      READ TABLE marcadores INTO DATA(l_end) WITH KEY texto = aux1.
      IF sy-subrc = 0.
        DATA(l_long) = l_end-offset - &lt;marc&gt;-offset + l_end-length.
        l_marcador-texto = l_doc+&lt;marc&gt;-offset(l_long).
      ELSE.
        l_marcador-texto = &lt;marc&gt;-texto.
      ENDIF.
      APPEND l_marcador TO i_marcadores.
    ENDLOOP.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_TEXTO_MARCADOR" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="42 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_TEXTO_MARCADOR" SCONAME="MARCADOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_TEXTO_MARCADOR" SCONAME="TEXTO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="GET_TEXTO_MARCADOR" SCONAME="MESSAGE" VERSION="1" LANGU="S" DESCRIPT="Texto de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="BAPI_MSG"/>
  <source>METHOD get_texto_marcador.
    CLEAR: texto,
           message.
    ASSIGN i_marcadores[ name = marcador ] TO FIELD-SYMBOL(&lt;marcador&gt;).
    IF sy-subrc = 0.
      texto = &lt;marcador&gt;-texto.
    ELSE.
      message = |No existe el marcador { marcador }|.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="HEADER_FOOTER_DIRECT_ASSIGN" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="29 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="HEADER_FOOTER_DIRECT_ASSIGN" SCONAME="HEADER" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="HEADER_FOOTER_DIRECT_ASSIGN" SCONAME="HEADER_FIRST" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="HEADER_FOOTER_DIRECT_ASSIGN" SCONAME="FOOTER" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="HEADER_FOOTER_DIRECT_ASSIGN" SCONAME="FOOTER_FIRST" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="HEADER_FOOTER_DIRECT_ASSIGN" SCONAME="INVALID_HEADER" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="HEADER_FOOTER_DIRECT_ASSIGN" SCONAME="INVALID_FOOTER" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <source>METHOD header_footer_direct_assign.
    invalid_header = c_false.
    invalid_footer = c_false.
    IF header IS SUPPLIED.
      sy-subrc = 0.
      IF NOT header IS INITIAL.
        READ TABLE mt_list_object WITH KEY type = c_type_header
                                           id   = header
             TRANSPORTING NO FIELDS.
      ENDIF.
      IF sy-subrc = 0.
        ms_section-header = header.
      ELSE.
        invalid_header = c_true.
      ENDIF.
    ENDIF.
    IF footer IS SUPPLIED.
      sy-subrc = 0.
      IF NOT footer IS INITIAL.
        READ TABLE mt_list_object WITH KEY type = c_type_footer
                                           id   = footer
             TRANSPORTING NO FIELDS.
      ENDIF.
      IF sy-subrc = 0.
        ms_section-footer = footer.
      ELSE.
        invalid_footer = c_true.
      ENDIF.
    ENDIF.
    IF header_first IS SUPPLIED.
      sy-subrc = 0.
      IF NOT header_first IS INITIAL.
        READ TABLE mt_list_object WITH KEY type = c_type_header
                                           id   = header_first
             TRANSPORTING NO FIELDS.
      ENDIF.
      IF sy-subrc = 0.
        ms_section-header_first = header_first.
      ELSE.
        invalid_header = c_true.
      ENDIF.
    ENDIF.
    IF footer_first IS SUPPLIED.
      sy-subrc = 0.
      IF NOT footer_first IS INITIAL.
        READ TABLE mt_list_object WITH KEY type = c_type_footer
                                           id   = footer_first
             TRANSPORTING NO FIELDS.
      ENDIF.
      IF sy-subrc = 0.
        ms_section-footer_first = footer_first.
      ELSE.
        invalid_footer = c_true.
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_ATTACHMENT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="24 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_ATTACHMENT" SCONAME="URL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_ATTACHMENT" SCONAME="FILE_CONTENT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="XSTRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_ATTACHMENT" SCONAME="URL_IMG" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_ATTACHMENT" SCONAME="AS_PARAGRAPH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_TRUE"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_ATTACHMENT" SCONAME="STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_ATTACHMENT" SCONAME="STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_PARAGRAPH_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_ATTACHMENT" SCONAME="INVALID_IMAGE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_ATTACHMENT" SCONAME="INVALID_FILE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_ATTACHMENT" SCONAME="INVALID_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_ATTACHMENT" SCONAME="VIRTUAL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_ATTACHMENT" SCONAME="ID_IMG" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <source>METHOD insert_attachment.
    DATA : lw_filex      TYPE xstring,
           lw_url_begin  TYPE c LENGTH 6,
           lw_extension  TYPE string,
           lw_ct_string  TYPE string,
           lw_rel_string TYPE string,
           lw_filename   TYPE string,
           lw_file       TYPE string,
           lw_string     TYPE string,
           lw_id         TYPE string,
           lw_style      TYPE string.

    invalid_image = c_false.
    invalid_file = c_false.

    IF url IS INITIAL AND file_content IS INITIAL.
      invalid_file = c_true.
      RETURN.
    ENDIF.

* Load file
    IF file_content IS INITIAL.
      _load_file( EXPORTING filename = url
                  IMPORTING xcontent = lw_filex ).
      IF lw_filex IS INITIAL.
        invalid_file = c_true.
        RETURN.
      ENDIF.
    ELSE.
      lw_filex = file_content.
    ENDIF.

* Get file extension
* For file from sapwr, get file extension from DB
    lw_url_begin = url.
    IF lw_url_begin = c_sapwr_prefix.
      SELECT SINGLE value INTO lw_extension
        FROM wwwparams
        WHERE relid = &apos;MI&apos;
          AND objid = url+6
          AND name  = &apos;fileextension&apos;.
      IF NOT lw_extension IS INITIAL AND lw_extension(1) = &apos;.&apos;.
        lw_extension = lw_extension+1.
      ENDIF.
    ELSE.
* For other file, get file extension from filename
      FIND ALL OCCURRENCES OF &apos;.&apos; IN url MATCH OFFSET sy-fdpos.
      IF sy-subrc = 0.
        sy-fdpos = sy-fdpos + 1.
        lw_extension = url+sy-fdpos.
        lw_extension = to_lower( lw_extension ).
        IF lw_extension = &apos;jpeg&apos;.
          lw_extension = &apos;jpg&apos;.
        ENDIF.
      ENDIF.
    ENDIF.
    lw_extension = to_lower( lw_extension ).
    CASE lw_extension.
      WHEN &apos;pptx&apos;.
        lw_ct_string = &apos;application/vnd.openxmlformats-officedocument.presentationml.presentation&apos;.
        lw_rel_string = &apos;http://schemas.openxmlformats.org/officeDocument/2006/relationships/package&apos;.
      WHEN &apos;ppt&apos;.
        lw_ct_string = &apos;application/vnd.ms-powerpoint&apos;.
        lw_rel_string = &apos;http://schemas.openxmlformats.org/officeDocument/2006/relationships/oleObject&apos;.
      WHEN &apos;docx&apos;.
        lw_ct_string = &apos;application/vnd.openxmlformats-officedocument.wordprocessingml.document&apos;.
        lw_rel_string = &apos;http://schemas.openxmlformats.org/officeDocument/2006/relationships/package&apos;.
      WHEN &apos;docm&apos;.
        lw_ct_string = &apos;application/vnd.ms-word.document.macroEnabled.12&apos;.
        lw_rel_string = &apos;http://schemas.openxmlformats.org/officeDocument/2006/relationships/package&apos;.
      WHEN &apos;doc&apos;.
        lw_ct_string = &apos;application/msword&apos;.
        lw_rel_string = &apos;http://schemas.openxmlformats.org/officeDocument/2006/relationships/oleObject&apos;.
      WHEN &apos;xlsx&apos;.
        lw_ct_string = &apos;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&apos;.
        lw_rel_string = &apos;http://schemas.openxmlformats.org/officeDocument/2006/relationships/package&apos;.
      WHEN &apos;xls&apos;.
        lw_ct_string = &apos;application/vnd.ms-excel&apos;.
        lw_rel_string = &apos;http://schemas.openxmlformats.org/officeDocument/2006/relationships/oleObject&apos;.
      WHEN OTHERS.
        invalid_file = c_true.
        RETURN.
    ENDCASE.

* Search available file name
    DO.
      lw_filename = sy-index.
      CONDENSE lw_filename NO-GAPS.
      CONCATENATE &apos;word/embeddings/attached&apos; lw_filename &apos;.&apos; lw_extension
                  INTO lw_filename.
      IF NOT line_exists( mo_zip-&gt;files[ name = lw_filename ] ).
        EXIT. &quot; exit do
      ENDIF.
    ENDDO.

* Add file in ZIP
    mo_zip-&gt;add( name    = lw_filename
                 content = lw_filex ).

* Get file extension list
    _get_zip_file( EXPORTING filename = &apos;[Content_Types].xml&apos;
                   IMPORTING content  = lw_file ).

* Add attachment exception in content type file
    CONCATENATE &apos;&lt;Override PartName=&quot;/&apos;
                lw_filename
                &apos;&quot; ContentType=&quot;&apos;
                lw_ct_string
                &apos;&quot;/&gt;&lt;/Types&gt;&apos;
                INTO lw_string.
    REPLACE &apos;&lt;/Types&gt;&apos; WITH lw_string
            INTO lw_file.

* Update file extension list
    _update_zip_file( filename = &apos;[Content_Types].xml&apos;
                      content  = lw_file ).

* Get relation file
    _get_zip_file( EXPORTING filename = &apos;word/_rels/document.xml.rels&apos;
                   IMPORTING content  = lw_file ).

* Create file ID
    DO.
      lw_id = sy-index.
      CONDENSE lw_id NO-GAPS.
      CONCATENATE &apos;rId&apos; lw_id INTO lw_id ##NO_TEXT.
      CONCATENATE &apos;Id=&quot;&apos; lw_id &apos;&quot;&apos; INTO lw_string ##NO_TEXT.
      FIND FIRST OCCURRENCE OF lw_string IN lw_file IGNORING CASE.
      IF sy-subrc &lt;&gt; 0.
        EXIT. &quot; exit do
      ENDIF.
    ENDDO.

* Add relation
    lw_filename = lw_filename+5.
    CONCATENATE &apos;&lt;Relationship Target=&quot;&apos;
                lw_filename
                &apos;&quot; Type=&quot;&apos;
                lw_rel_string
                &apos;&quot; Id=&quot;&apos;
                lw_id
                &apos;&quot;/&gt;&apos;
                &apos;&lt;/Relationships&gt;&apos;
                INTO lw_string.
    REPLACE &apos;&lt;/Relationships&gt;&apos; WITH lw_string INTO lw_file.

* Update relation file
    _update_zip_file( filename = &apos;word/_rels/document.xml.rels&apos;
                      content  = lw_file ).

* Load icon
    _load_image( EXPORTING url = url_img
*      IMPORTING
*                           imgres_x = lw_imgres_x
*                           imgres_y = lw_imgres_y
                 CHANGING  id  = id_img ).
    IF id_img IS INITIAL.
      invalid_image = c_true.
      RETURN.
    ENDIF.

* Search next id for some useless mandatory word attributes
    mw_attach = mw_attach + 1.
    lw_string = mw_attach.
    CONDENSE lw_string NO-GAPS.

* Everything fine, build xml fragment
    CONCATENATE &apos;&lt;w:r&gt;&apos;
                &quot; lw_style
                &apos;&lt;w:object&gt;&apos;
                &apos;&lt;v:shape id=&quot;_x0000_&apos;
                lw_string
                &apos;&quot; type=&quot;#_x0000_t75&quot; o:ole=&quot;&quot;&gt;&apos;
                &apos;&lt;v:imagedata r:id=&quot;&apos;
                id_img
                &apos;&quot; o:title=&quot;&quot;/&gt;&apos;
                &apos;&lt;/v:shape&gt;&apos;
                &apos;&lt;o:OLEObject Type=&quot;Embed&quot; ProgID=&quot;Package&quot; DrawAspect=&quot;Icon&quot; ShapeID=&quot;_x0000_&apos;
                lw_string
                &apos;&quot; ObjectID=&quot;_10000&apos;
                lw_string
                &apos;&quot; r:id=&quot;&apos;
                lw_id
                &apos;&quot;/&gt;&apos;
                &apos;&lt;/w:object&gt;&apos;
                &apos;&lt;/w:r&gt;&apos;
                INTO virtual RESPECTING BLANKS.

    IF as_paragraph = c_true.
* Add paragraphe style
      IF NOT style IS INITIAL OR NOT style_effect IS INITIAL.
        _build_paragraph_style( EXPORTING style         = style
                                          style_effect  = style_effect
                                IMPORTING xml           = lw_style
                                          invalid_style = invalid_style ).
      ENDIF.

      CONCATENATE &apos;&lt;w:p&gt;&apos;
                  lw_style
                  virtual
                  &apos;&lt;/w:p&gt;&apos;
                  INTO virtual.
    ENDIF.

* Insert attachment in document
    IF NOT virtual IS SUPPLIED.
      IF as_paragraph = c_true.
        CONCATENATE mw_docxml
                    virtual
                    INTO mw_docxml.
      ELSE.
        CONCATENATE mw_fragxml
                    virtual
                    INTO mw_fragxml.
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_CUSTOM_FIELD" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="17 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_CUSTOM_FIELD" SCONAME="FIELD" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD insert_custom_field.
    CONCATENATE mw_fragxml
                &apos;&lt;w:fldSimple w:instr=&quot; DOCPROPERTY &apos;
                field
                &apos; \* MERGEFORMAT &quot;&gt;&lt;w:r&gt;&lt;w:rPr&gt;&lt;w:b/&gt;&lt;/w:rPr&gt;&lt;w:t&gt;Please update field&lt;/w:t&gt;&lt;/w:r&gt;&lt;/w:fldSimple&gt;&apos;
                INTO mw_fragxml RESPECTING BLANKS.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_IMAGE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="23 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_IMAGE" SCONAME="URL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_IMAGE" SCONAME="FILE_CONTENT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="XSTRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_IMAGE" SCONAME="ZOOM" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="F" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_IMAGE" SCONAME="AS_PARAGRAPH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_TRUE"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_IMAGE" SCONAME="STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_IMAGE" SCONAME="STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_PARAGRAPH_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_IMAGE" SCONAME="TYPE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_IMGTYPE_INLINE"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_IMAGE" SCONAME="POSX" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PARVALUE="C_IMGPOSX_LEFT"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_IMAGE" SCONAME="POSY" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PARVALUE="C_IMGPOSY_TOP"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_IMAGE" SCONAME="MARGIN" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_IMAGE" SCONAME="INVALID_IMAGE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_IMAGE" SCONAME="INVALID_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="12 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_IMAGE" SCONAME="VIRTUAL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="13 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_IMAGE" SCONAME="ID" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="14 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <source>METHOD insert_image.
    DATA : lw_imgres_x TYPE i,
           lw_imgres_y TYPE i,
           lw_string   TYPE string.
    DATA : lw_scalex    TYPE f,
           lw_scaley    TYPE f,
           lw_scale_max TYPE i,
           lw_scale     TYPE i,
           lw_x         TYPE i,
           lw_y         TYPE i,
           lw_x_string  TYPE string,
           lw_y_string  TYPE string,
           lw_margin    TYPE string,
           lw_type_on   TYPE string,
           lw_type_in   TYPE string,
           lw_type_off  TYPE string,
           lw_posx      TYPE string,
           lw_posy      TYPE string,
           lw_style     TYPE string.

    invalid_image = c_false.
    _load_image( EXPORTING url          = url
                           file_content = file_content
                 IMPORTING imgres_x     = lw_imgres_x
                           imgres_y     = lw_imgres_y
                 CHANGING  id           = id ).
    IF id IS INITIAL.
      invalid_image = c_true.
      RETURN.
    ENDIF.

* Calculate image scale
    IF ms_section-landscape = c_true.
* Max X in landscape : 8877300
* Max Y in landscape : 5743575 &quot;could be less... depend of header/footer
      lw_scalex = 8877300 / lw_imgres_x.
      lw_scaley = 5762625 / lw_imgres_y.
    ELSE.
* Max X in portrait : 5762625
* Max Y in portrait : 8886825 &quot;could be less... depend of header/footer
      lw_scalex = 5762625 / lw_imgres_x.
      lw_scaley = 8886825 / lw_imgres_y.
    ENDIF.
    IF lw_scalex &lt; lw_scaley.
      lw_scale_max = floor( lw_scalex ).
    ELSE.
      lw_scale_max = floor( lw_scaley ).
    ENDIF.
* Image is smaler than page
    IF lw_scale_max &gt; 9525.
      lw_scale = 9525. &quot; no zoom
      IF zoom IS SUPPLIED.
        lw_scale = lw_scale * zoom.
        IF lw_scale &gt; lw_scale_max.
          lw_scale = lw_scale_max.
        ENDIF.
      ENDIF.
    ELSE.
* Image is greater than page
      lw_scale = lw_scale_max.
      IF zoom IS SUPPLIED AND zoom &lt; 1.
        lw_scale_max = 9525 * zoom.
        IF lw_scale_max &lt; lw_scale.
          lw_scale = lw_scale_max.
        ENDIF.
      ENDIF.
    ENDIF.
    lw_x = lw_imgres_x * lw_scale.
    lw_y = lw_imgres_y * lw_scale.
    lw_x_string = lw_x.
    CONDENSE lw_x_string NO-GAPS.
    lw_y_string = lw_y.
    CONDENSE lw_y_string NO-GAPS.

* Finally insert image in document
    mw_imgmaxid = mw_imgmaxid + 1.
    lw_string = mw_imgmaxid.
    CONDENSE lw_string NO-GAPS.

    lw_margin = margin.
    CONDENSE lw_margin NO-GAPS.

    CASE type.
      WHEN c_imgtype_inline.
        CONCATENATE &apos;&lt;wp:inline distT=&quot;&apos;
                    lw_margin
                    &apos;&quot; distB=&quot;&apos;
                    lw_margin
                    &apos;&quot; distL=&quot;&apos;
                    lw_margin
                    &apos;&quot; distR=&quot;&apos;
                    lw_margin
                    &apos;&quot;&gt;&apos;
                    INTO lw_type_on.
        lw_type_in = &apos;&apos;.
        lw_type_off = &apos;&lt;/wp:inline&gt;&apos;.

      WHEN c_imgtype_float OR c_imgtype_over OR c_imgtype_behind.
        IF type = c_imgtype_behind.
          lw_type_on = &apos;1&apos;.
        ELSE.
          lw_type_on = &apos;0&apos;.
        ENDIF.
        IF posx CO &apos;0123456789-&apos;.
          CONCATENATE &apos;&lt;wp:posOffset&gt;&apos; posx &apos;&lt;/wp:posOffset&gt;&apos; INTO lw_posx.
        ELSE.
          CONCATENATE &apos;&lt;wp:align&gt;&apos; posx &apos;&lt;/wp:align&gt;&apos; INTO lw_posx.
        ENDIF.
        IF posy CO &apos;0123456789-&apos;.
          CONCATENATE &apos;&lt;wp:posOffset&gt;&apos; posy &apos;&lt;/wp:posOffset&gt;&apos; INTO lw_posy.
        ELSE.
          CONCATENATE &apos;&lt;wp:align&gt;&apos; posy &apos;&lt;/wp:align&gt;&apos; INTO lw_posy.
        ENDIF.

        CONCATENATE &apos;&lt;wp:anchor distT=&quot;&apos;
                    lw_margin
                    &apos;&quot; distB=&quot;&apos;
                    lw_margin
                    &apos;&quot; distL=&quot;&apos;
                    lw_margin
                    &apos;&quot; distR=&quot;&apos;
                    lw_margin
                    &apos;&quot; behindDoc=&quot;&apos;
                    lw_type_on
                    &apos;&quot; allowOverlap=&quot;1&quot;&apos;
                    &apos; simplePos=&quot;0&quot; locked=&quot;0&quot; layoutInCell=&quot;1&quot; relativeHeight=&quot;251658240&quot; &gt;&apos;
                    &apos;&lt;wp:simplePos x=&quot;0&quot; y=&quot;0&quot;/&gt;&apos;
                    &apos;&lt;wp:positionH relativeFrom=&quot;column&quot;&gt;&apos;
                    lw_posx
                    &apos;&lt;/wp:positionH&gt;&apos;
                    &apos;&lt;wp:positionV relativeFrom=&quot;paragraph&quot;&gt;&apos;
                    lw_posy
                    &apos;&lt;/wp:positionV&gt;&apos;
                    INTO lw_type_on RESPECTING BLANKS.

        IF type = c_imgtype_float.
          lw_type_in = &apos;&lt;wp:wrapSquare wrapText=&quot;bothSides&quot;/&gt;&apos;.
        ELSE.
          lw_type_in = &apos;&lt;wp:wrapNone/&gt;&apos;.
        ENDIF.

        lw_type_off = &apos;&lt;/wp:anchor&gt;&apos;.
    ENDCASE.
* Prepare image insertion xml fragment
    CONCATENATE
    &apos;&lt;w:r&gt;&apos;
    &apos;&lt;w:drawing&gt;&apos;
    lw_type_on
    &apos;&lt;wp:extent cx=&quot;&apos;
    lw_x_string
    &apos;&quot; cy=&quot;&apos;
    lw_y_string
    &apos;&quot;/&gt;&apos;
    lw_type_in
    &apos;&lt;wp:docPr id=&quot;&apos;
    lw_string &quot; mw_imgmaxid
    &apos;&quot; name=&quot;&quot;/&gt;&apos;
    &apos;&lt;wp:cNvGraphicFramePr/&gt;&apos;
    &apos;&lt;a:graphic xmlns:a=&quot;http://schemas.openxmlformats.org/drawingml/2006/main&quot;&gt;&apos;
    &apos;&lt;a:graphicData uri=&quot;http://schemas.openxmlformats.org/drawingml/2006/picture&quot;&gt;&apos;
    &apos;&lt;pic:pic xmlns:pic=&quot;http://schemas.openxmlformats.org/drawingml/2006/picture&quot;&gt;&apos;
    &apos;&lt;pic:nvPicPr&gt;&apos;
    &apos;&lt;pic:cNvPr id=&quot;0&quot; name=&quot;&quot;/&gt;&apos;
    &apos;&lt;pic:cNvPicPr/&gt;&apos;
    &apos;&lt;/pic:nvPicPr&gt;&apos;
    &apos;&lt;pic:blipFill&gt;&apos;
    &apos;&lt;a:blip r:embed=&quot;&apos;
    id
    &apos;&quot;/&gt;&apos;
    &apos;&lt;a:stretch&gt;&apos;
    &apos;&lt;a:fillRect/&gt;&apos;
    &apos;&lt;/a:stretch&gt;&apos;
    &apos;&lt;/pic:blipFill&gt;&apos;
    &apos;&lt;pic:spPr&gt;&apos;
    &apos;&lt;a:xfrm&gt;&apos;
    &apos;&lt;a:off x=&quot;0&quot; y=&quot;0&quot;/&gt;&apos;
    &apos;&lt;a:ext cx=&quot;&apos;
    lw_x_string
    &apos;&quot; cy=&quot;&apos;
    lw_y_string
    &apos;&quot;/&gt;&apos;
    &apos;&lt;/a:xfrm&gt;&apos;
    &apos;&lt;a:prstGeom prst=&quot;rect&quot;&gt;&apos;
    &apos;&lt;a:avLst/&gt;&apos;
    &apos;&lt;/a:prstGeom&gt;&apos;
    &apos;&lt;/pic:spPr&gt;&apos;
    &apos;&lt;/pic:pic&gt;&apos;
    &apos;&lt;/a:graphicData&gt;&apos;
    &apos;&lt;/a:graphic&gt;&apos;
    lw_type_off
    &apos;&lt;/w:drawing&gt;&apos;
    &apos;&lt;/w:r&gt;&apos;
    INTO virtual.

    IF as_paragraph = c_true.
* Add paragraphe style
      IF NOT style IS INITIAL OR NOT style_effect IS INITIAL.
        _build_paragraph_style( EXPORTING style         = style
                                          style_effect  = style_effect
                                IMPORTING xml           = lw_style
                                          invalid_style = invalid_style ).
      ENDIF.

      CONCATENATE &apos;&lt;w:p&gt;&apos;
                  lw_style
                  virtual
                  &apos;&lt;/w:p&gt;&apos;
                  INTO virtual.
    ENDIF.

* Insert image in document
    IF NOT virtual IS SUPPLIED.
      IF as_paragraph = c_true.
        CONCATENATE mw_docxml
                    virtual
                    INTO mw_docxml.
      ELSE.
        CONCATENATE mw_fragxml
                    virtual
                    INTO mw_fragxml.
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_VIRTUAL_FIELD" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="18 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_VIRTUAL_FIELD" SCONAME="FIELD" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_VIRTUAL_FIELD" SCONAME="FIELD_AS_PARAGRAPH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_FALSE"/>
  <source>METHOD insert_virtual_field.
    IF field_as_paragraph = c_false.
      CONCATENATE mw_fragxml
                  &apos;&lt;w:virtual&gt;&apos;
                  field
                  &apos;&lt;/w:virtual&gt;&apos;
                  INTO mw_fragxml.
    ELSE.
      CONCATENATE mw_docxml
                  &apos;&lt;w:virtual&gt;&apos;
                  field
                  &apos;&lt;/w:virtual&gt;&apos;
                  INTO mw_docxml.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_XML" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="34 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_XML" SCONAME="XML" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD insert_xml.
    CONCATENATE mw_docxml xml INTO mw_docxml.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_XML_FRAGMENT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="33 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="INSERT_XML_FRAGMENT" SCONAME="XML" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD insert_xml_fragment.
    CONCATENATE mw_fragxml xml INTO mw_fragxml.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="MOSTRAR_EN_PANTALLA" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="35 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD mostrar_en_pantalla.
    DATA: xdata     TYPE xstring,   &quot; Will be used for sending as email
          t_rawdata TYPE solix_tab, &quot; Will be used for downloading or open directly
          bytecount TYPE i.         &quot; Will be used for downloading or open directly
    DATA: cl_control  TYPE REF TO i_oi_container_control, &quot; OIContainerCtrl
          error       TYPE REF TO i_oi_error,
          &quot; TODO: variable is assigned but never used (ABAP cleaner)
          t_errors    TYPE STANDARD TABLE OF REF TO i_oi_error WITH NON-UNIQUE DEFAULT KEY,
          cl_document TYPE REF TO i_oi_document_proxy.    &quot; Office Dokument

    get_docx_file( IMPORTING xcontent = xdata ).

    t_rawdata = cl_bcs_convert=&gt;xstring_to_solix( iv_xstring = xdata ).

    bytecount = xstrlen( xdata ).

    c_oi_container_control_creator=&gt;get_container_control( IMPORTING control = cl_control
                                                                     error   = error ).
    APPEND error TO t_errors.

    cl_control-&gt;init_control( EXPORTING  inplace_enabled     = &apos;X&apos;
                                         no_flush            = &apos;X&apos;
                                         r3_application_name = &apos;Demo Document Container&apos;
                                         parent              = cl_gui_container=&gt;screen0
                              IMPORTING  error               = error
                              EXCEPTIONS OTHERS              = 2 ).
    APPEND error TO t_errors.

    cl_control-&gt;get_document_proxy( EXPORTING document_type  = &apos;Word.Document&apos;
                                              no_flush       = &apos; &apos;
                                    IMPORTING document_proxy = cl_document
                                              error          = error ).
    APPEND error TO t_errors.
* Errorhandling should be inserted here

    cl_document-&gt;open_document_from_table( document_size  = bytecount
                                           document_table = t_rawdata
                                           open_inplace   = &apos;X&apos; ).
    WRITE &apos;.&apos;.  &quot; To create an output.  That way screen0 will exist
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="REEMPLAZAR_MARCADOR" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="44 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REEMPLAZAR_MARCADOR" SCONAME="MARCADOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REEMPLAZAR_MARCADOR" SCONAME="NUEVO_CONTENIDO" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REEMPLAZAR_MARCADOR" SCONAME="ADD_MARCADOR_END" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REEMPLAZAR_MARCADOR" SCONAME="MESSAGE" VERSION="1" LANGU="S" DESCRIPT="Texto de mensaje" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="BAPI_MSG"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REEMPLAZAR_MARCADOR" SCONAME="DOC" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <source>METHOD reemplazar_marcador.
    &quot; TODO: variable is assigned but never used (ABAP cleaner)
    DATA: l_doc             TYPE string,
          l_nuevo_contenido TYPE string.

    IF doc IS INITIAL.
      l_doc = mw_docxml.
    ELSE.
      l_doc = doc.
    ENDIF.

    CLEAR message.
    get_texto_marcador( EXPORTING marcador = marcador
                        IMPORTING texto    = DATA(texto_marcador)
                                  message  = message ).

    IF message IS NOT INITIAL.
      RETURN.
    ENDIF.

    IF add_marcador_end IS INITIAL.
      l_nuevo_contenido = nuevo_contenido.
    ELSE.
      CONCATENATE nuevo_contenido texto_marcador INTO l_nuevo_contenido.
    ENDIF.

    IF doc IS INITIAL.
      REPLACE texto_marcador INTO mw_docxml WITH l_nuevo_contenido.
    ELSE.
      REPLACE texto_marcador INTO l_doc WITH l_nuevo_contenido.
    ENDIF.
    IF sy-subrc &lt;&gt; 0.
      message = |Error reemplazando marcador { marcador }|.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="REEMPLAZAR_VALOR" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="36 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REEMPLAZAR_VALOR" SCONAME="VAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REEMPLAZAR_VALOR" SCONAME="VALOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REEMPLAZAR_VALOR" SCONAME="CAR_MARCA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY" PARVALUE="&apos;&amp;&apos;"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REEMPLAZAR_VALOR" SCONAME="TODAS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REEMPLAZAR_VALOR" SCONAME="FORMAT_FECHA" VERSION="1" LANGU="S" DESCRIPT="Indicador de una posición" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PARVALUE="&apos;/&apos;"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REEMPLAZAR_VALOR" SCONAME="FORMAT_HORA" VERSION="1" LANGU="S" DESCRIPT="Indicador de una posición" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PARVALUE="&apos;5&apos;"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REEMPLAZAR_VALOR" SCONAME="QUITAR_CEROS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REEMPLAZAR_VALOR" SCONAME="DOC" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REEMPLAZAR_VALOR" SCONAME="ERROR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="3" PARPASSTYP="0" TYPTYPE="1" TYPE="ABAP_BOOL"/>
  <source>METHOD reemplazar_valor.
    DATA: l_var   TYPE string,
          l_marca TYPE string,
          l_valor TYPE text1024.
    DATA l_string TYPE string.

    IF car_marca IS INITIAL.
      l_var = var.
    ELSE.
      IF car_marca = &apos;&amp;&apos;.
        l_marca = &apos;&amp;amp;&apos;.
      ELSE.
        l_marca = car_marca.
      ENDIF.

      l_var = var.
      CONCATENATE l_marca l_var l_marca INTO l_var.
    ENDIF.

    DESCRIBE FIELD valor TYPE DATA(l_tipo).

    IF l_tipo = &apos;C&apos; OR l_tipo = &apos;g&apos; AND valor CS cl_abap_char_utilities=&gt;cr_lf.
      IF strlen( valor ) &gt; 1000.
        SPLIT valor AT cl_abap_char_utilities=&gt;cr_lf INTO TABLE DATA(i_lineas2).
        LOOP AT i_lineas2 ASSIGNING FIELD-SYMBOL(&lt;lin2&gt;).
          CONCATENATE &lt;lin2&gt; &apos;&lt;w:br/&gt;&apos; l_var INTO l_string.
          reemplazar_valor( EXPORTING var   = var
                                      valor = l_string
                            CHANGING  doc   = doc ).
        ENDLOOP.
        RETURN.
*      DATA: l_txt    TYPE text4096,
*            l_string TYPE string.
*      l_txt = valor.
*      DO 5 TIMES.
*        l_string = l_txt(800).
*        l_txt = l_txt+800.
*        IF NOT l_txt IS INITIAL.
*          CONCATENATE l_string l_var INTO l_string.
*        ENDIF.
*        reemplazar_valor( EXPORTING var = var valor = l_string CHANGING doc = doc ).
*        IF l_txt IS INITIAL.
*          RETURN.
*        ENDIF.
*      ENDDO.
      ENDIF.
    ENDIF.

    IF l_tipo = &apos;I&apos; OR l_tipo = &apos;P&apos; OR l_tipo = &apos;D&apos; OR l_tipo = &apos;T&apos;.
      WRITE valor TO l_valor LEFT-JUSTIFIED.
      CONDENSE l_valor NO-GAPS.
      IF l_tipo = &apos;D&apos; AND NOT format_fecha IS INITIAL.
        IF format_fecha = &apos;/&apos;.
          REPLACE ALL OCCURRENCES OF &apos;.&apos; IN l_valor WITH &apos;/&apos;.
        ENDIF.
      ENDIF.
      IF l_tipo = &apos;T&apos; AND NOT format_hora IS INITIAL.
        IF format_hora = &apos;5&apos;.
          l_valor = l_valor(5).
        ENDIF.
      ENDIF.
    ELSEIF valor CS cl_abap_char_utilities=&gt;cr_lf.
*    l_valor = &apos;&lt;w:p&gt;&lt;w:r&gt;&lt;w:t&gt;&apos;.
      SPLIT valor AT cl_abap_char_utilities=&gt;cr_lf INTO TABLE DATA(i_lineas).
      DATA(l_tot_lineas) = lines( i_lineas ).
      LOOP AT i_lineas ASSIGNING FIELD-SYMBOL(&lt;linea&gt;).
*      IF sy-tabix &lt; l_tot_lineas.
*        CONCATENATE l_valor &lt;linea&gt; &apos;&lt;/w:t&gt;&lt;/w:r&gt;&lt;w:r&gt;&lt;w:br/&gt;&lt;/w:r&gt;&lt;w:r&gt;&lt;w:t&gt;&apos; INTO l_valor.
*      ELSE.
*        CONCATENATE l_valor &lt;linea&gt; &apos;&lt;/w:t&gt;&lt;/w:r&gt;&lt;/w:p&gt;&apos; INTO l_valor.
*      ENDIF.
        IF l_valor IS INITIAL.
          l_valor = &lt;linea&gt;.
        ELSE.
          CONCATENATE l_valor &apos;&lt;w:br/&gt;&apos; &lt;linea&gt; INTO l_valor.
        ENDIF.
      ENDLOOP.
    ELSE.
      WRITE valor TO l_valor LEFT-JUSTIFIED.
      IF quitar_ceros = &apos;X&apos;.
        __quitar_ceros l_valor.
      ENDIF.
    ENDIF.

    IF todas IS INITIAL.
      IF NOT doc IS INITIAL.
        REPLACE l_var IN doc WITH l_valor IGNORING CASE.
        IF sy-subrc &lt;&gt; 0.
          error = &apos;X&apos;.
        ENDIF.
      ELSE.
        REPLACE l_var IN mw_fragxml WITH l_valor IGNORING CASE.
        IF sy-subrc &lt;&gt; 0.
          REPLACE l_var IN mw_docxml WITH l_valor IGNORING CASE.
          IF sy-subrc &lt;&gt; 0.
            error = &apos;X&apos;.
          ENDIF.
        ENDIF.
      ENDIF.
    ELSE.
      IF NOT doc IS INITIAL.
        REPLACE ALL OCCURRENCES OF l_var IN doc WITH l_valor IGNORING CASE.
        IF sy-subrc &lt;&gt; 0.
          error = &apos;X&apos;.
        ENDIF.
      ELSE.
        REPLACE ALL OCCURRENCES OF l_var IN mw_fragxml WITH l_valor IGNORING CASE.
        IF sy-subrc &lt;&gt; 0.
          REPLACE ALL OCCURRENCES OF l_var IN mw_docxml WITH l_valor IGNORING CASE.
          IF sy-subrc &lt;&gt; 0.
            error = &apos;X&apos;.
*            zcl_ap_string=&gt;to_clipboard( mw_docxml ).
          ENDIF.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDMETHOD.                    &quot; replace_virtual_field</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="REPLACE_VIRTUAL_FIELD" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="19 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REPLACE_VIRTUAL_FIELD" SCONAME="FIELD" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REPLACE_VIRTUAL_FIELD" SCONAME="VALUE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REPLACE_VIRTUAL_FIELD" SCONAME="VALUE_AS_XML" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_FALSE"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REPLACE_VIRTUAL_FIELD" SCONAME="STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_CHARACTER_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REPLACE_VIRTUAL_FIELD" SCONAME="STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="REPLACE_VIRTUAL_FIELD" SCONAME="INVALID_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <source>METHOD replace_virtual_field.
    DATA : lw_field TYPE string,
           lw_value TYPE string.

    CONCATENATE &apos;&lt;w:virtual&gt;&apos;
                field
                &apos;&lt;/w:virtual&gt;&apos;
                INTO lw_field.

    IF value_as_xml = c_true.
      lw_value = value.
    ELSE.
      write_text( EXPORTING textline      = value
                            style_effect  = style_effect
                            style         = style
                  IMPORTING virtual       = lw_value
                            invalid_style = invalid_style ).
    ENDIF.

    REPLACE lw_field IN mw_fragxml WITH lw_value IGNORING CASE.
    IF sy-subrc &lt;&gt; 0.
      REPLACE lw_field IN mw_docxml WITH lw_value IGNORING CASE.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="SAVE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="27 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SAVE" SCONAME="URL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SAVE" SCONAME="LOCAL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_TRUE"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SAVE" SCONAME="ABRIR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <source>METHOD save.
    &quot; TODO: parameter LOCAL is only used in commented-out code (ABAP cleaner)

    DATA lw_docx TYPE xstring.

*        lt_data_tab TYPE STANDARD TABLE OF x255,
*        lw_lraw     TYPE x255,
*        lw_xlen     TYPE i,
*        lw_count    TYPE i,
*        lw_off      TYPE i,
*        lw_mod      TYPE i.

    get_docx_file( IMPORTING xcontent = lw_docx ).

    zcl_ap_ficheros=&gt;grabar_xstring( fichero = url
                                     xstring = lw_docx ).

    IF abrir = &apos;X&apos;.
      zcl_ap_gos=&gt;visualizar_fichero_st( fichero = url ).
    ENDIF.
*
** Convert docx xString to xTable(255)
*    refresh lt_data_tab.
*    clear   lw_off.
*    lw_xlen  = xstrlen( lw_docx ).
*    lw_count = lw_xlen div 255.
*    do lw_count times.
*      lw_lraw = lw_docx+lw_off(255).
*      lw_off = lw_off + 255.
*      append lw_lraw to lt_data_tab.
*    enddo.
*    lw_mod = lw_xlen mod 255.
*    if lw_mod &gt; 0.
*      lw_lraw = lw_docx+lw_off(lw_mod).
*      append lw_lraw to lt_data_tab.
*    endif.
*    clear lw_docx.
*
** Save document on server
*    if local = c_false.
*      open dataset url for output in binary mode.
*      if sy-subrc ne 0.
** Error opening the file
*        message &apos;Cannot create remote file&apos; type &apos;E&apos;.
*        return.
*      endif.
*      loop at lt_data_tab into lw_lraw.
*        if lw_xlen &gt; 255.
*          lw_mod = 255.
*        else.
*          lw_mod = lw_xlen.
*        endif.
*        transfer lw_lraw to url length lw_mod.
*        lw_xlen = lw_xlen - lw_mod.
*      endloop.
*      close dataset url.
*
** Save document on local computer
*    elseif local = c_true.
*      call method cl_gui_frontend_services=&gt;gui_download
*        exporting
*          bin_filesize            = lw_xlen
*          filename                = url
*          filetype                = &apos;BIN&apos;
*          confirm_overwrite       = &apos;X&apos;
*        changing
*          data_tab                = lt_data_tab
*        exceptions
*          file_write_error        = 1
*          no_batch                = 2
*          gui_refuse_filetransfer = 3
*          invalid_type            = 4
*          no_authority            = 5
*          unknown_error           = 6
*          header_not_allowed      = 7
*          separator_not_allowed   = 8
*          filesize_not_allowed    = 9
*          header_too_long         = 10
*          dp_error_create         = 11
*          dp_error_send           = 12
*          dp_error_write          = 13
*          unknown_dp_error        = 14
*          access_denied           = 15
*          dp_out_of_memory        = 16
*          disk_full               = 17
*          dp_timeout              = 18
*          file_not_found          = 19
*          dataprovider_exception  = 20
*          control_flush_error     = 21
*          not_supported_by_gui    = 22
*          error_no_gui            = 23
*          others                  = 24.
** Error on save
*      if sy-subrc ne 0.
*        message id sy-msgid type sy-msgty number sy-msgno.
*      endif.
*    endif.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PARAMS" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="26 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PARAMS" SCONAME="ORIENTATION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_ORIENT_PORTRAIT"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PARAMS" SCONAME="BORDER_LEFT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_BORDER" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PARAMS" SCONAME="BORDER_TOP" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_BORDER" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PARAMS" SCONAME="BORDER_RIGHT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_BORDER" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PARAMS" SCONAME="BORDER_BOTTOM" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_BORDER" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PARAMS" SCONAME="NOSPELLCHECK" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_FALSE"/>
  <source>METHOD set_params.
    DATA : lw_xml   TYPE string,
           lw_xmlns TYPE string.

* Define orientation
    IF orientation = c_orient_landscape.
      ms_section-landscape = c_true.
    ENDIF.

* Define Border
    IF border_left IS SUPPLIED.
      ms_section-border_left = border_left.
    ENDIF.
    IF border_top IS SUPPLIED.
      ms_section-border_top = border_top.
    ENDIF.
    IF border_right IS SUPPLIED.
      ms_section-border_right = border_right.
    ENDIF.
    IF border_bottom IS SUPPLIED.
      ms_section-border_bottom = border_bottom.
    ENDIF.

* Hide spellcheck for this document
    IF nospellcheck = c_false.
      RETURN.
    ENDIF.

    _get_zip_file( EXPORTING filename = &apos;word/settings.xml&apos;
                   IMPORTING content  = lw_xml ).
* File doesn&apos;t exist ? create it !
    IF lw_xml IS INITIAL.
      _get_xml_ns( IMPORTING xml = lw_xmlns ).
      CONCATENATE &apos;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;&apos;
                  &apos;&lt;w:settings &apos;
                  lw_xmlns
                  &apos;&gt;&apos;
                  &apos;&lt;/w:settings&gt;&apos;
                  INTO lw_xml RESPECTING BLANKS.
    ENDIF.
    FIND &apos;hideSpellingErrors&apos; IN lw_xml.
    IF sy-subrc &lt;&gt; 0.
      REPLACE FIRST OCCURRENCE OF &apos;&lt;/w:settings&gt;&apos;
              IN lw_xml
              WITH &apos;&lt;w:hideSpellingErrors/&gt;&lt;/w:settings&gt;&apos;
              IGNORING CASE.
    ENDIF.
    FIND &apos;hideGrammaticalErrors&apos; IN lw_xml.
    IF sy-subrc &lt;&gt; 0.
      REPLACE FIRST OCCURRENCE OF &apos;&lt;/w:settings&gt;&apos;
              IN lw_xml
              WITH &apos;&lt;w:hideGrammaticalErrors/&gt;&lt;/w:settings&gt;&apos;
              IGNORING CASE.
    ENDIF.
    _update_zip_file( filename = &apos;word/settings.xml&apos;
                      content  = lw_xml ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PROPERTIES" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="25 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PROPERTIES" SCONAME="TITLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PROPERTIES" SCONAME="AUTHOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PROPERTIES" SCONAME="DESCRIPTION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PROPERTIES" SCONAME="OBJECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PROPERTIES" SCONAME="CATEGORY" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PROPERTIES" SCONAME="KEYWORDS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PROPERTIES" SCONAME="STATUS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PROPERTIES" SCONAME="CREATIONDATE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="D" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PROPERTIES" SCONAME="CREATIONTIME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="T" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_PROPERTIES" SCONAME="REVISION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <source>METHOD set_properties.
    DATA : lw_xml    TYPE string,
           lw_string TYPE string.

* Get prperties file
    _get_zip_file( EXPORTING filename = &apos;docProps/core.xml&apos;
                   IMPORTING content  = lw_xml ).

    IF title IS SUPPLIED.
* Replace existing title by new one
      _protect_string( EXPORTING in  = title
                       IMPORTING out = lw_string ).
      CONCATENATE &apos;&lt;dc:title&gt;&apos;
                  lw_string
                  &apos;&lt;/dc:title&gt;&apos;
                  INTO lw_string.
      REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;dc:title&gt;(.*)&lt;/dc:title&gt;&apos; IN lw_xml WITH lw_string.
      IF sy-subrc &lt;&gt; 0.
        REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;dc:title\s*/&gt;&apos; IN lw_xml WITH lw_string.
      ENDIF.
* If no title property found, add it at end of xml
      IF sy-subrc &lt;&gt; 0.
        CONCATENATE lw_string
                    &apos;&lt;/cp:coreProperties&gt;&apos;
                    INTO lw_string.
        REPLACE &apos;&lt;/cp:coreProperties&gt;&apos;
                WITH lw_string
                INTO lw_xml.
      ENDIF.
    ENDIF.

    IF object IS SUPPLIED.
* Replace existing object by new one
      _protect_string( EXPORTING in  = object
                       IMPORTING out = lw_string ).
      CONCATENATE &apos;&lt;dc:subject&gt;&apos;
                  lw_string
                  &apos;&lt;/dc:subject&gt;&apos;
                  INTO lw_string.
      REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;dc:subject&gt;(.*)&lt;/dc:subject&gt;&apos; IN lw_xml WITH lw_string.
      IF sy-subrc &lt;&gt; 0.
        REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;dc:subject\s*/&gt;&apos; IN lw_xml WITH lw_string.
      ENDIF.
* If no object property found, add it at end of xml
      IF sy-subrc &lt;&gt; 0.
        CONCATENATE lw_string
                    &apos;&lt;/cp:coreProperties&gt;&apos;
                    INTO lw_string.
        REPLACE &apos;&lt;/cp:coreProperties&gt;&apos;
                WITH lw_string
                INTO lw_xml.
      ENDIF.
    ENDIF.

    IF author IS SUPPLIED.
* Replace existing author by new one
      _protect_string( EXPORTING in  = author
                       IMPORTING out = mw_author ).
      CONCATENATE &apos;&lt;dc:creator&gt;&apos;
                  mw_author
                  &apos;&lt;/dc:creator&gt;&apos;
                  INTO lw_string.
      REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;dc:creator&gt;(.*)&lt;/dc:creator&gt;&apos; IN lw_xml WITH lw_string.
      IF sy-subrc &lt;&gt; 0.
        REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;dc:creator\s*/&gt;&apos; IN lw_xml WITH lw_string.
      ENDIF.
* If no author property found, add it at end of xml
      IF sy-subrc &lt;&gt; 0.
        CONCATENATE lw_string
                    &apos;&lt;/cp:coreProperties&gt;&apos;
                    INTO lw_string.
        REPLACE &apos;&lt;/cp:coreProperties&gt;&apos;
                WITH lw_string
                INTO lw_xml.
      ENDIF.
* Set also last modified property
      _protect_string( EXPORTING in  = author
                       IMPORTING out = lw_string ).
      CONCATENATE &apos;&lt;cp:lastModifiedBy&gt;&apos;
                  lw_string
                  &apos;&lt;/cp:lastModifiedBy&gt;&apos;
                  INTO lw_string.
      REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;cp:lastModifiedBy&gt;(.*)&lt;/cp:lastModifiedBy&gt;&apos; IN lw_xml WITH lw_string.
      IF sy-subrc &lt;&gt; 0.
        REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;cp:lastModifiedBy\s*/&gt;&apos; IN lw_xml WITH lw_string.
      ENDIF.
* If no lastmodified property found, add it at end of xml
      IF sy-subrc &lt;&gt; 0.
        CONCATENATE lw_string
                    &apos;&lt;/cp:coreProperties&gt;&apos;
                    INTO lw_string.
        REPLACE &apos;&lt;/cp:coreProperties&gt;&apos;
                WITH lw_string
                INTO lw_xml.
      ENDIF.
    ENDIF.

    IF creationdate IS SUPPLIED.
* Replace existing creation date by new one
      CONCATENATE &apos;&lt;dcterms:created xsi:type=&quot;dcterms:W3CDTF&quot;&gt;&apos;
                  creationdate(4)
                  &apos;-&apos;
                  creationdate+4(2)
                  &apos;-&apos;
                  creationdate+6(2)
                  &apos;T&apos;
                  creationtime(2)
                  &apos;:&apos;
                  creationtime+2(2)
                  &apos;:&apos;
                  creationtime+2(2)
                  &apos;Z&apos;
                  &apos;&lt;/dcterms:created&gt;&apos;
                  INTO lw_string.
      REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;dcterms:created(.*)&lt;/dcterms:created&gt;&apos; IN lw_xml WITH lw_string.
      IF sy-subrc &lt;&gt; 0.
        REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;dcterms:created\s*/&gt;&apos; IN lw_xml WITH lw_string.
      ENDIF.
* If no creation date property found, add it at end of xml
      IF sy-subrc &lt;&gt; 0.
        CONCATENATE lw_string
                    &apos;&lt;/cp:coreProperties&gt;&apos;
                    INTO lw_string.
        REPLACE &apos;&lt;/cp:coreProperties&gt;&apos;
                WITH lw_string
                INTO lw_xml.
      ENDIF.
* Replace also last modification date by new one
      CONCATENATE &apos;&lt;dcterms:modified xsi:type=&quot;dcterms:W3CDTF&quot;&gt;&apos;
                  creationdate(4)
                  &apos;-&apos;
                  creationdate+4(2)
                  &apos;-&apos;
                  creationdate+6(2)
                  &apos;T&apos;
                  creationtime(2)
                  &apos;:&apos;
                  creationtime+2(2)
                  &apos;:&apos;
                  creationtime+2(2)
                  &apos;Z&apos;
                  &apos;&lt;/dcterms:modified&gt;&apos;
                  INTO lw_string.
      REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;dcterms:modified(.*)&lt;/dcterms:modified&gt;&apos; IN lw_xml WITH lw_string.
      IF sy-subrc &lt;&gt; 0.
        REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;dcterms:modified\s*/&gt;&apos; IN lw_xml WITH lw_string.
      ENDIF.
* If no modification date property found, add it at end of xml
      IF sy-subrc &lt;&gt; 0.
        CONCATENATE lw_string
                    &apos;&lt;/cp:coreProperties&gt;&apos;
                    INTO lw_string.
        REPLACE &apos;&lt;/cp:coreProperties&gt;&apos;
                WITH lw_string
                INTO lw_xml.
      ENDIF.
    ENDIF.

    IF description IS SUPPLIED.
* Replace existing description by new one
      _protect_string( EXPORTING in  = description
                       IMPORTING out = lw_string ).
      CONCATENATE &apos;&lt;dc:description&gt;&apos;
                  lw_string
                  &apos;&lt;/dc:description&gt;&apos;
                  INTO lw_string.
      REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;dc:description&gt;(.*)&lt;/dc:description&gt;&apos; IN lw_xml WITH lw_string.
      IF sy-subrc &lt;&gt; 0.
        REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;dc:description\s*/&gt;&apos; IN lw_xml WITH lw_string.
      ENDIF.
* If no description property found, add it at end of xml
      IF sy-subrc &lt;&gt; 0.
        CONCATENATE lw_string
                    &apos;&lt;/cp:coreProperties&gt;&apos;
                    INTO lw_string.
        REPLACE &apos;&lt;/cp:coreProperties&gt;&apos;
                WITH lw_string
                INTO lw_xml.
      ENDIF.
    ENDIF.

    IF category IS SUPPLIED.
* Replace existing category by new one
      _protect_string( EXPORTING in  = category
                       IMPORTING out = lw_string ).
      CONCATENATE &apos;&lt;cp:category&gt;&apos;
                  lw_string
                  &apos;&lt;/cp:category&gt;&apos;
                  INTO lw_string.
      REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;cp:category&gt;(.*)&lt;/cp:category&gt;&apos; IN lw_xml WITH lw_string.
      IF sy-subrc &lt;&gt; 0.
        REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;cp:category\s*/&gt;&apos; IN lw_xml WITH lw_string.
      ENDIF.
* If no category property found, add it at end of xml
      IF sy-subrc &lt;&gt; 0.
        CONCATENATE lw_string
                    &apos;&lt;/cp:coreProperties&gt;&apos;
                    INTO lw_string.
        REPLACE &apos;&lt;/cp:coreProperties&gt;&apos;
                WITH lw_string
                INTO lw_xml.
      ENDIF.
    ENDIF.

    IF keywords IS SUPPLIED.
* Replace existing keywords by new one
      _protect_string( EXPORTING in  = keywords
                       IMPORTING out = lw_string ).
      CONCATENATE &apos;&lt;cp:keywords&gt;&apos;
                  lw_string
                  &apos;&lt;/cp:keywords&gt;&apos;
                  INTO lw_string.
      REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;cp:keywords&gt;(.*)&lt;/cp:keywords&gt;&apos; IN lw_xml WITH lw_string.
      IF sy-subrc &lt;&gt; 0.
        REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;cp:keywords\s*/&gt;&apos; IN lw_xml WITH lw_string.
      ENDIF.
* If no keywords property found, add it at end of xml
      IF sy-subrc &lt;&gt; 0.
        CONCATENATE lw_string
                    &apos;&lt;/cp:coreProperties&gt;&apos;
                    INTO lw_string.
        REPLACE &apos;&lt;/cp:coreProperties&gt;&apos;
                WITH lw_string
                INTO lw_xml.
      ENDIF.
    ENDIF.

    IF status IS SUPPLIED.
* Replace existing status by new one
      _protect_string( EXPORTING in  = status
                       IMPORTING out = lw_string ).
      CONCATENATE &apos;&lt;cp:contentStatus&gt;&apos;
                  lw_string
                  &apos;&lt;/cp:contentStatus&gt;&apos;
                  INTO lw_string.
      REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;cp:contentStatus&gt;(.*)&lt;/cp:contentStatus&gt;&apos; IN lw_xml WITH lw_string.
      IF sy-subrc &lt;&gt; 0.
        REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;cp:contentStatus\s*/&gt;&apos; IN lw_xml WITH lw_string.
      ENDIF.
* If no status property found, add it at end of xml
      IF sy-subrc &lt;&gt; 0.
        CONCATENATE lw_string
                    &apos;&lt;/cp:coreProperties&gt;&apos;
                    INTO lw_string.
        REPLACE &apos;&lt;/cp:coreProperties&gt;&apos;
                WITH lw_string
                INTO lw_xml.
      ENDIF.
    ENDIF.

    IF revision IS SUPPLIED.
* Replace existing status by new one
      lw_string = revision.
      CONDENSE lw_string NO-GAPS.
      CONCATENATE &apos;&lt;cp:revision&gt;&apos;
                  lw_string
                  &apos;&lt;/cp:revision&gt;&apos;
                  INTO lw_string.
      REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;cp:revision&gt;(.*)&lt;/cp:revision&gt;&apos; IN lw_xml WITH lw_string.
      IF sy-subrc &lt;&gt; 0.
        REPLACE FIRST OCCURRENCE OF REGEX &apos;&lt;cp:revision\s*/&gt;&apos; IN lw_xml WITH lw_string.
      ENDIF.
* If no revision property found, add it at end of xml
      IF sy-subrc &lt;&gt; 0.
        CONCATENATE lw_string
                    &apos;&lt;/cp:coreProperties&gt;&apos;
                    INTO lw_string.
        REPLACE &apos;&lt;/cp:coreProperties&gt;&apos;
                WITH lw_string
                INTO lw_xml.
      ENDIF.
    ENDIF.

* Update properties file
    _update_zip_file( filename = &apos;docProps/core.xml&apos;
                      content  = lw_xml ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_TABLA" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="40 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_TABLA" SCONAME="TABLA" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TABLE"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_TABLA" SCONAME="MARCADOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_TABLA" SCONAME="I_VAR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="APB_LPD_T_KEY_VALUE"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_TABLA" SCONAME="QUITAR_MARCADOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;X&apos;"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_TABLA" SCONAME="FORMAT_FECHA" VERSION="1" LANGU="S" DESCRIPT="Indicador de una posición" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PARVALUE="&apos;/&apos;"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_TABLA" SCONAME="FORMAT_HORA" VERSION="1" LANGU="S" DESCRIPT="Indicador de una posición" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="CHAR1" PARVALUE="&apos;5&apos;"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_TABLA" SCONAME="QUITAR_CEROS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ABAP_BOOL" PARVALUE="&apos;&apos;"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_TABLA" SCONAME="TAG" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PARVALUE="&apos;tr&apos;"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_TABLA" SCONAME="DOC" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <source>METHOD set_tabla.
    DATA : ls_content   TYPE REF TO data,
           l_doc        TYPE string,
           l_bloque_edt TYPE string,
           l_aux        TYPE string,
           l_linea      TYPE string,
           l_tabla      TYPE string.

    FIELD-SYMBOLS &lt;line&gt;  TYPE any.
    FIELD-SYMBOLS &lt;field&gt; TYPE any.

    CREATE DATA ls_content LIKE LINE OF tabla.
    ASSIGN ls_content-&gt;* TO &lt;line&gt;.
    IF sy-subrc &lt;&gt; 0.
      RETURN.
    ENDIF.

* count number of lines and columns of the table
    DATA(lw_lines) = LINES( tabla ).
    IF lw_lines = 0.
*    RETURN. &quot;Aunque hay 0 registros la pintamos
    ENDIF.

    DESCRIBE FIELD &lt;line&gt; TYPE DATA(lw_type) COMPONENTS DATA(lw_cols).
    IF lw_cols = 0.
      RETURN.
    ENDIF.

    IF doc IS INITIAL.
      l_doc = mw_docxml.
    ELSE.
      l_doc = doc.
    ENDIF.

    DATA(bloque) = get_bloque_marcador( marcador    = marcador
                                        tag         = tag
                                        doc         = l_doc
                                        incluir_tag = &apos;X&apos; ).

    IF bloque IS INITIAL.
      MESSAGE |No encuentro marcador { marcador }| TYPE &apos;E&apos;.
    ELSE.
      l_bloque_edt = bloque.
      IF quitar_marcador = &apos;X&apos;.
        l_aux = |w:name=&quot;{ marcador }&quot;/&gt;&lt;w:bookmarkEnd|.
        l_linea = |w:name=&quot;{ marcador }_DESACTIVADO&quot;/&gt;&lt;w:bookmarkEnd|.
        REPLACE l_aux IN l_bloque_edt WITH l_linea.
      ENDIF.
    ENDIF.

    LOOP AT tabla INTO &lt;line&gt;.
      l_linea = l_bloque_edt.
      LOOP AT i_var ASSIGNING FIELD-SYMBOL(&lt;var&gt;).
        ASSIGN COMPONENT &lt;var&gt;-value OF STRUCTURE &lt;line&gt; TO &lt;field&gt;.
        IF sy-subrc = 0.
          reemplazar_valor( EXPORTING var          = &lt;var&gt;-key
                                      valor        = &lt;field&gt;
                                      format_fecha = format_fecha
                                      format_hora  = format_hora
                                      quitar_ceros = quitar_ceros
                            CHANGING  doc          = l_linea ).
        ENDIF.
      ENDLOOP.
      IF l_tabla IS INITIAL.
        l_tabla = l_linea.
      ELSE.
        CONCATENATE l_tabla l_linea INTO l_tabla.
      ENDIF.
    ENDLOOP.
    IF sy-subrc &lt;&gt; 0. &quot; Ningun registro, valores por dfecto
      l_linea = l_bloque_edt.
      LOOP AT i_var ASSIGNING &lt;var&gt;.
        ASSIGN COMPONENT &lt;var&gt;-value OF STRUCTURE &lt;line&gt; TO &lt;field&gt;.
        IF sy-subrc = 0.
          reemplazar_valor( EXPORTING var          = &lt;var&gt;-key
                                      valor        = &lt;field&gt;
                                      format_fecha = format_fecha
                                      format_hora  = format_hora
                                      quitar_ceros = quitar_ceros
                            CHANGING  doc          = l_linea ).
        ENDIF.
      ENDLOOP.
      l_tabla = l_linea.
    ENDIF.

    IF doc IS INITIAL.
      REPLACE bloque IN mw_docxml WITH l_tabla.
    ELSE.
      REPLACE bloque IN doc WITH l_tabla.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_TITLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="8 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="SET_TITLE" SCONAME="TITLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD set_title.
    set_properties( title = title ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_BREAK" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="4 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_BREAK" SCONAME="BREAKTYPE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_BREAKTYPE_LINE"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_BREAK" SCONAME="WRITE_LINE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_BREAK" SCONAME="VIRTUAL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <source>METHOD write_break.
    CASE breaktype.
      WHEN c_breaktype_line.
        IF virtual IS SUPPLIED.
          CONCATENATE virtual
                      &apos;&lt;w:r&gt;&lt;w:br/&gt;&lt;/w:r&gt;&apos;
                      INTO virtual.
        ELSE.
          CONCATENATE mw_fragxml
                      &apos;&lt;w:r&gt;&lt;w:br/&gt;&lt;/w:r&gt;&apos;
                      INTO mw_fragxml.
        ENDIF.
      WHEN c_breaktype_page.
        IF virtual IS SUPPLIED.
          CONCATENATE virtual
                      &apos;&lt;w:br w:type=&quot;page&quot;/&gt;&apos;
                      INTO virtual.
        ELSE.
          CONCATENATE mw_fragxml
                      &apos;&lt;w:br w:type=&quot;page&quot;/&gt;&apos;
                      INTO mw_fragxml.
        ENDIF.
      WHEN c_breaktype_section.
        IF virtual IS SUPPLIED.
          sy-subrc = 8.
          RETURN.
        ENDIF.
        _write_section( ).
      WHEN c_breaktype_section_continuous.
        IF virtual IS SUPPLIED.
          sy-subrc = 8.
          RETURN.
        ENDIF.
        _write_section( ).
        ms_section-continuous = c_true.
      WHEN OTHERS. &quot; invalid breaktype
        sy-subrc = 8.
        RETURN.
    ENDCASE.
* Write line if required
* But also automatically except for simple break line
    IF    write_line = c_true
       OR ( NOT write_line IS SUPPLIED AND breaktype &lt;&gt; c_breaktype_line ).
      write_line( ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_COMMENT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="12 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_COMMENT" SCONAME="TEXT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_COMMENT" SCONAME="STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_COMMENT" SCONAME="STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_CHARACTER_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_COMMENT" SCONAME="LINE_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_COMMENT" SCONAME="LINE_STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_PARAGRAPH_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_COMMENT" SCONAME="HEAD_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_COMMENT" SCONAME="HEAD_STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_CHARACTER_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_COMMENT" SCONAME="DATUM" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="D" PARVALUE="SY-DATUM"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_COMMENT" SCONAME="UZEIT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="T" PARVALUE="SY-UZEIT"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_COMMENT" SCONAME="AUTHOR" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_COMMENT" SCONAME="INITIALS" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_COMMENT" SCONAME="INVALID_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="12 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_COMMENT" SCONAME="INVALID_HEAD_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="13 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_COMMENT" SCONAME="INVALID_LINE_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="14 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <source>METHOD write_comment.
    DATA : lw_file              TYPE string,
           lw_string            TYPE string,
           lw_id                TYPE string,
           lw_xmlns             TYPE string,
           lw_text              TYPE string,
           ls_head_style_effect TYPE ty_character_style_effect,
           lw_head_style        TYPE string,
           lw_line_style        TYPE string,
           lw_author            TYPE string,
           lw_initials          TYPE string.

    IF line_exists( mo_zip-&gt;files[ name = &apos;word/comments.xml&apos; ] ).
* If comment file exists, load the file
      _get_zip_file( EXPORTING filename = &apos;word/comments.xml&apos;
                     IMPORTING content  = lw_file ).
    ELSE.
* If comments file doesn&apos;t exist, declare it and create it
* Add comments in content_types
      _get_zip_file( EXPORTING filename = &apos;[Content_Types].xml&apos;
                     IMPORTING content  = lw_file ).

      CONCATENATE &apos;&lt;Override&apos;
                  &apos; ContentType=&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml&quot;&apos;
                  &apos; PartName=&quot;/word/comments.xml&quot;/&gt;&lt;/Types&gt;&apos;
                  INTO lw_string RESPECTING BLANKS.
      REPLACE &apos;&lt;/Types&gt;&apos; WITH lw_string
              INTO lw_file.

      _update_zip_file( filename = &apos;[Content_Types].xml&apos;
                        content  = lw_file ).

* Add comments in relation file
      _get_zip_file( EXPORTING filename = &apos;word/_rels/document.xml.rels&apos;
                     IMPORTING content  = lw_file ).

* Create comments relation ID
      DO.
        lw_id = sy-index.
        CONDENSE lw_id NO-GAPS.
        CONCATENATE &apos;rId&apos; lw_id INTO lw_id ##NO_TEXT.
        CONCATENATE &apos;Id=&quot;&apos; lw_id &apos;&quot;&apos; INTO lw_string ##NO_TEXT.
        FIND FIRST OCCURRENCE OF lw_string IN lw_file IGNORING CASE.
        IF sy-subrc &lt;&gt; 0.
          EXIT. &quot; exit do
        ENDIF.
      ENDDO.

* Add relation
      CONCATENATE &apos;&lt;Relationship Target=&quot;comments.xml&quot;&apos;
                  &apos; Type=&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments&quot;&apos;
                  &apos; Id=&quot;&apos;
                  lw_id
                  &apos;&quot;/&gt;&apos;
                  &apos;&lt;/Relationships&gt;&apos;
                  INTO lw_string RESPECTING BLANKS.
      REPLACE &apos;&lt;/Relationships&gt;&apos; WITH lw_string INTO lw_file.

* Update relation file
      _update_zip_file( filename = &apos;word/_rels/document.xml.rels&apos;
                        content  = lw_file ).

      _get_xml_ns( IMPORTING xml = lw_xmlns ).

* Create empty comments file
      CONCATENATE &apos;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;&apos;
                  &quot; cl_abap_char_utilities=&gt;cr_lf
                  cl_abap_char_utilities=&gt;newline
                  &apos;&lt;w:comments &apos;
                  lw_xmlns
                  &apos;&gt;&apos;
                  &apos;&lt;/w:comments&gt;&apos;
                  INTO lw_file RESPECTING BLANKS.
    ENDIF.

* Search available comment id
    DO.
      &quot; sy-index = sy-index + 4.
      lw_id = sy-index.
      CONDENSE lw_id NO-GAPS.
      CONCATENATE &apos;w:id=&quot;&apos; lw_id &apos;&quot;&apos; INTO lw_string ##NO_TEXT.
      FIND FIRST OCCURRENCE OF lw_string IN lw_file IGNORING CASE.
      IF sy-subrc &lt;&gt; 0.
        EXIT. &quot; exit do
      ENDIF.
    ENDDO.

* Add blank at start of note
    lw_text = text.
    IF lw_text IS INITIAL OR lw_text(1) &lt;&gt; space.
      CONCATENATE space lw_text INTO lw_text RESPECTING BLANKS.
    ENDIF.

    write_text( EXPORTING textline      = lw_text
                          style_effect  = style_effect
                          style         = style
                IMPORTING virtual       = lw_text
                          invalid_style = invalid_style ).

* Define default style for comment head
    ls_head_style_effect = head_style_effect.
    IF ls_head_style_effect IS INITIAL AND head_style IS INITIAL.
      ls_head_style_effect-bold = c_true.
    ENDIF.

    _build_character_style( EXPORTING style         = head_style
                                      style_effect  = ls_head_style_effect
                            IMPORTING xml           = lw_head_style
                                      invalid_style = invalid_head_style ).

    IF NOT line_style_effect IS INITIAL OR NOT line_style IS INITIAL.
      _build_paragraph_style( EXPORTING style         = line_style
                                        style_effect  = line_style_effect
                              IMPORTING xml           = lw_line_style
                                        invalid_style = invalid_line_style ).
    ENDIF.

* Define author property
    IF author IS INITIAL.
      lw_author = mw_author.
    ELSE.
      lw_author = author.
    ENDIF.

* Define initial property
    IF initials IS INITIAL.
      lw_initials = lw_author.
    ELSE.
      lw_initials = initials.
    ENDIF.

    CONCATENATE &apos;&lt;w:comment w:initials=&quot;&apos;
                lw_initials
                &apos;&quot;&apos;
                &apos; w:date=&quot;&apos;
                datum(4)
                &apos;-&apos;
                datum+4(2)
                &apos;-&apos;
                datum+6(2)
                &apos;T&apos;
                uzeit(2)
                &apos;:&apos;
                uzeit+2(2)
                &apos;:&apos;
                uzeit+4(2)
                &apos;Z&quot;&apos;
                &apos; w:author=&quot;&apos;
                lw_author
                &apos;&quot;&apos;
                &apos; w:id=&quot;&apos;
                lw_id
                &apos;&quot;&gt;&apos;
                &apos;&lt;w:p&gt;&apos;
                lw_line_style
                &apos;&lt;w:r&gt;&apos;
                lw_head_style
                &apos;&lt;w:annotationRef/&gt;&apos;
                &apos;&lt;/w:r&gt;&apos;
                lw_text
                &apos;&lt;/w:p&gt;&apos;
                &apos;&lt;/w:comment&gt;&apos;
                &apos;&lt;/w:comments&gt;&apos;
                INTO lw_string RESPECTING BLANKS.
    REPLACE &apos;&lt;/w:comments&gt;&apos; WITH lw_string INTO lw_file.

    _update_zip_file( filename = &apos;word/comments.xml&apos;
                      content  = lw_file ).

* Finally insert reference to comment in current text fragment
    CONCATENATE mw_fragxml
                &apos;&lt;w:r&gt;&lt;w:commentReference w:id=&quot;&apos;
                lw_id
                &apos;&quot;/&gt;&lt;/w:r&gt;&apos;
                INTO mw_fragxml.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_HEADERFOOTER" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="7 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_HEADERFOOTER" SCONAME="TYPE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PARVALUE="C_TYPE_HEADER"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_HEADERFOOTER" SCONAME="TEXTLINE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_HEADERFOOTER" SCONAME="USENOW_DEFAULT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_TRUE"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_HEADERFOOTER" SCONAME="USENOW_FIRST" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_TRUE"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_HEADERFOOTER" SCONAME="STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_HEADERFOOTER" SCONAME="STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_CHARACTER_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_HEADERFOOTER" SCONAME="LINE_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_HEADERFOOTER" SCONAME="LINE_STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_PARAGRAPH_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_HEADERFOOTER" SCONAME="ID" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_HEADERFOOTER" SCONAME="INVALID_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_HEADERFOOTER" SCONAME="INVALID_LINE_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <source>METHOD write_headerfooter.
    DATA : lw_xml         TYPE string,
           lw_style       TYPE string,
           lw_xmlns       TYPE string,
           lw_string      TYPE string,
           lw_filename    TYPE string,
           lw_file        TYPE string,
           ls_list_object LIKE LINE OF mt_list_object.

    IF type &lt;&gt; c_type_header AND type &lt;&gt; c_type_footer.
      RETURN.
    ENDIF.

* Build header/footer xml fragment
    write_text( EXPORTING textline      = textline
                          style_effect  = style_effect
                          style         = style
                IMPORTING virtual       = lw_xml
                          invalid_style = invalid_style ).

    CLEAR lw_style.
    IF NOT line_style IS INITIAL OR NOT line_style_effect IS INITIAL.
      _build_paragraph_style( EXPORTING style         = line_style
                                        style_effect  = line_style_effect
                              IMPORTING xml           = lw_style
                                        invalid_style = invalid_line_style ).
    ENDIF.

    _get_xml_ns( IMPORTING xml = lw_xmlns ).

    IF type = c_type_header.
      lw_string = &apos;hdr&apos;.
    ELSE.
      lw_string = &apos;ftr&apos;.
    ENDIF.
    CONCATENATE &apos;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;&apos;
                &apos;&lt;w:&apos;
                lw_string
                lw_xmlns
                &apos;&gt;&apos;
                &apos;&lt;w:p&gt;&apos;
                lw_style
                lw_xml
                &apos;&lt;/w:p&gt;&apos;
                &apos;&lt;/w:&apos;
                lw_string
                &apos;&gt;&apos;
                INTO lw_xml RESPECTING BLANKS.

* Search available header/footer name
    DO.
      lw_filename = sy-index.
      CONCATENATE &apos;word/&apos;
                  type
                  lw_filename
                  &apos;.xml&apos;
                  INTO lw_filename.
      CONDENSE lw_filename NO-GAPS.

      IF NOT line_exists( mo_zip-&gt;files[ name = lw_filename ] ).
        EXIT. &quot; exit do
      ENDIF.
    ENDDO.

* Add header/footer file into zip
    _update_zip_file( filename = lw_filename
                      content  = lw_xml ).

* Add content type exception for new header/footer
    _get_zip_file( EXPORTING filename = &apos;[Content_Types].xml&apos;
                   IMPORTING content  = lw_file ).
    CONCATENATE &apos;&lt;Override PartName=&quot;/&apos;
                lw_filename
                &apos;&quot; ContentType=&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.&apos;
                type
                &apos;+xml&quot;/&gt;&apos;
                &apos;&lt;/Types&gt;&apos;
                INTO lw_string.
    REPLACE &apos;&lt;/Types&gt;&apos; WITH lw_string INTO lw_file.

* Update content type file
    _update_zip_file( filename = &apos;[Content_Types].xml&apos;
                      content  = lw_file ).

* Get relation file
    _get_zip_file( EXPORTING filename = &apos;word/_rels/document.xml.rels&apos;
                   IMPORTING content  = lw_file ).

* Create header/footer ID
    DO.
      id = sy-index.
      CONDENSE id NO-GAPS.
      CONCATENATE &apos;rId&apos; id INTO id ##NO_TEXT.
      CONCATENATE &apos;Id=&quot;&apos; id &apos;&quot;&apos; INTO lw_string ##NO_TEXT.
      FIND FIRST OCCURRENCE OF lw_string IN lw_file IGNORING CASE.
      IF sy-subrc &lt;&gt; 0.
        EXIT. &quot; exit do
      ENDIF.
    ENDDO.

* Update object list
    ls_list_object-id   = id.
    ls_list_object-type = type.
    ls_list_object-path = lw_filename.
    APPEND ls_list_object TO mt_list_object.

* Add relation
    lw_filename = lw_filename+5.
    CONCATENATE &apos;&lt;Relationship Id=&quot;&apos;
                id
                &apos;&quot; Type=&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/&apos;
                type
                &apos;&quot; Target=&quot;&apos;
                lw_filename
                &apos;&quot;/&gt;&apos;
                &apos;&lt;/Relationships&gt;&apos;
                INTO lw_string.
    REPLACE &apos;&lt;/Relationships&gt;&apos; WITH lw_string INTO lw_file.

* Update relation file
    _update_zip_file( filename = &apos;word/_rels/document.xml.rels&apos;
                      content  = lw_file ).

    IF usenow_default = c_true AND type = c_type_header.
      header_footer_direct_assign( header = id ).
    ELSEIF usenow_default = c_true AND type = c_type_footer.
      header_footer_direct_assign( footer = id ).
    ENDIF.

    IF usenow_first = c_true AND type = c_type_header.
      header_footer_direct_assign( header_first = id ).
    ELSEIF usenow_first = c_true AND type = c_type_footer.
      header_footer_direct_assign( footer_first = id ).
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_LINE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="3 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_LINE" SCONAME="STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_LINE" SCONAME="STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_PARAGRAPH_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_LINE" SCONAME="INVALID_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_LINE" SCONAME="VIRTUAL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <source>METHOD write_line.
    DATA lw_style TYPE string.

    _build_paragraph_style( EXPORTING style         = style
                                      style_effect  = style_effect
                            IMPORTING xml           = lw_style
                                      invalid_style = invalid_style ).

    IF virtual IS SUPPLIED.
      IF virtual IS INITIAL.
        CONCATENATE mw_docxml
                    &apos;&lt;w:p&gt;&apos;
                    lw_style
                    mw_fragxml
                    &apos;&lt;/w:p&gt;&apos;
                    INTO virtual.
        CLEAR mw_fragxml.
      ELSE.
        CONCATENATE &apos;&lt;w:p&gt;&apos;
                    lw_style
                    virtual
                    &apos;&lt;/w:p&gt;&apos;
                    INTO virtual.
      ENDIF.
    ELSE.
      CONCATENATE mw_docxml
                  &apos;&lt;w:p&gt;&apos;
                  lw_style
                  mw_fragxml
                  &apos;&lt;/w:p&gt;&apos;
                  INTO mw_docxml.
      CLEAR mw_fragxml.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_NEWPAGE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="9 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD write_newpage.
    write_break( breaktype = c_breaktype_page ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_NOTE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="11 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_NOTE" SCONAME="TEXT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_NOTE" SCONAME="TYPE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_NOTETYPE_FOOT"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_NOTE" SCONAME="STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_NOTE" SCONAME="STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_CHARACTER_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_NOTE" SCONAME="LINE_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_NOTE" SCONAME="LINE_STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_PARAGRAPH_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_NOTE" SCONAME="LINK_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_NOTE" SCONAME="LINK_STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_CHARACTER_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_NOTE" SCONAME="INVALID_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_NOTE" SCONAME="INVALID_LINK_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_NOTE" SCONAME="INVALID_LINE_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <source>METHOD write_note.
    DATA : ls_link_style_effect TYPE ty_character_style_effect,
           ls_line_style_effect TYPE ty_paragraph_style_effect,
           lw_id                TYPE string,
           lw_style             TYPE string,
           lw_string            TYPE string.

* Define a default style for link
    ls_link_style_effect = link_style_effect.
    IF link_style IS INITIAL AND ls_link_style_effect IS INITIAL.
      ls_link_style_effect-sup = c_true.
    ENDIF.

* Define a default style for footnote
    ls_line_style_effect = line_style_effect.
    IF line_style IS INITIAL AND ls_line_style_effect IS INITIAL.
      ls_line_style_effect-spacing_before = &apos;0&apos;.
      ls_line_style_effect-spacing_after  = &apos;0&apos;.
      ls_line_style_effect-interline      = 240.
    ENDIF.

* Create a new footnote
    _create_note( EXPORTING text               = text
                            type               = type
                            style              = style
                            style_effect       = style_effect
                            line_style         = line_style
                            line_style_effect  = ls_line_style_effect
                            link_style         = link_style
                            link_style_effect  = ls_link_style_effect
                  IMPORTING invalid_style      = invalid_style
                            invalid_line_style = invalid_line_style
                            id                 = lw_id ).

    IF lw_id IS INITIAL.
      RETURN.
    ENDIF.

* Prepare style for the footnote link
    _build_character_style( EXPORTING style         = link_style
                                      style_effect  = ls_link_style_effect
                            IMPORTING xml           = lw_style
                                      invalid_style = invalid_link_style ).

* Now insert note in document
    IF type = c_notetype_foot.
      lw_string = &apos;&lt;w:footnoteReference w:id=&quot;&apos;.
    ELSEIF type = c_notetype_end.
      lw_string = &apos;&lt;w:endnoteReference w:id=&quot;&apos;.
    ENDIF.

    CONCATENATE mw_fragxml
                &apos;&lt;w:r&gt;&apos;
                lw_style
                lw_string
                lw_id
                &apos;&quot;/&gt;&apos;
                &apos;&lt;/w:r&gt;&apos;
                INTO mw_fragxml.
  ENDMETHOD.                    &quot; write_footnote</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_SYMBOL" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="5 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_SYMBOL" SCONAME="SYMBOL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD write_symbol.
    DATA lw_style_effect TYPE ty_character_style_effect.

    lw_style_effect-font = c_font_symbol.
    write_text( textline     = symbol
                style_effect = lw_style_effect ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TABLE" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="6 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TABLE" SCONAME="CONTENT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STANDARD TABLE"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TABLE" SCONAME="STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TABLE" SCONAME="STYLE_OVERWRITE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_STYLE_TABLE" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TABLE" SCONAME="BORDER" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="C_TRUE"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TABLE" SCONAME="TBLWIDTH" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I" PARVALUE="0"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TABLE" SCONAME="VIRTUAL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TABLE" SCONAME="INVALID_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <source>METHOD write_table.
    DATA : ls_content     TYPE REF TO data,
           lw_lines       TYPE i,
           lw_type        TYPE c LENGTH 1 ##NEEDED,
           lw_cols        TYPE i,
           lw_style_table TYPE i,
           lw_xml         TYPE string,
           lw_style       TYPE string,
           lw_tblwidth    TYPE string,
           lw_col         TYPE i,
           lw_col_inc     TYPE i,
           lw_string      TYPE string,
           lw_stylep      TYPE string,
           lw_merge       TYPE string.

    FIELD-SYMBOLS &lt;line&gt;        TYPE any.
    FIELD-SYMBOLS &lt;field&gt;       TYPE any.
    FIELD-SYMBOLS &lt;field_style&gt; TYPE ty_table_style_field.

    CREATE DATA ls_content LIKE LINE OF content.
    ASSIGN ls_content-&gt;* TO &lt;line&gt;.
    IF sy-subrc &lt;&gt; 0.
      RETURN.
    ENDIF.

* count number of lines and columns of the table
    lw_lines = LINES( content ).
    IF lw_lines = 0.
      RETURN.
    ENDIF.
    DESCRIBE FIELD &lt;line&gt; TYPE lw_type COMPONENTS lw_cols.
    IF lw_cols = 0.
      RETURN.
    ENDIF.

* search if data table is simple or have style infos for each field
    ASSIGN COMPONENT 1 OF STRUCTURE &lt;line&gt; TO &lt;field&gt;.
    IF sy-subrc &lt;&gt; 0.
      RETURN.
    ENDIF.
    DESCRIBE FIELD &lt;field&gt; TYPE lw_type COMPONENTS lw_style_table.

* Write table properties
    CLEAR lw_xml.
    CONCATENATE &apos;&lt;w:tbl&gt;&apos;
                &apos;&lt;w:tblPr&gt;&apos;
                INTO lw_xml.

    &quot; Styled table : define style
    IF style IS SUPPLIED AND NOT style IS INITIAL.
      IF line_exists( mt_list_style[ type = c_type_table
                                     name = style ] ).
        CONCATENATE lw_xml
                    &apos;&lt;w:tblStyle w:val=&quot;&apos;
                    style
                    &apos;&quot;/&gt;&apos;
                    INTO lw_xml.
      ELSE.
        invalid_style = c_true.
      ENDIF.

* If defined, overwrite style table layout (no effect without table style defined)
      CLEAR lw_style.
      IF style_overwrite IS SUPPLIED.
        lw_tblwidth = style_overwrite-firstrow.
        CONDENSE lw_tblwidth NO-GAPS.
        CONCATENATE lw_style
                    &apos; w:firstRow=&quot;&apos;
                    lw_tblwidth
                    &apos;&quot;&apos;
                    INTO lw_style RESPECTING BLANKS.
        lw_tblwidth = style_overwrite-firstcol.
        CONDENSE lw_tblwidth NO-GAPS.
        CONCATENATE lw_style
                    &apos; w:firstColumn=&quot;&apos;
                    lw_tblwidth
                    &apos;&quot;&apos;
                    INTO lw_style RESPECTING BLANKS.
        lw_tblwidth = style_overwrite-nozebra.
        CONDENSE lw_tblwidth NO-GAPS.
        CONCATENATE lw_style
                    &apos; w:noHBand=&quot;&apos;
                    lw_tblwidth
                    &apos;&quot;&apos;
                    INTO lw_style RESPECTING BLANKS.
        lw_tblwidth = style_overwrite-novband.
        CONDENSE lw_tblwidth NO-GAPS.
        CONCATENATE lw_style
                    &apos; w:noVBand=&quot;&apos;
                    lw_tblwidth
                    &apos;&quot;&apos;
                    INTO lw_style RESPECTING BLANKS.
        lw_tblwidth = style_overwrite-lastrow.
        CONDENSE lw_tblwidth NO-GAPS.
        CONCATENATE lw_style
                    &apos; w:lastRow=&quot;&apos;
                    lw_tblwidth
                    &apos;&quot;&apos;
                    INTO lw_style RESPECTING BLANKS.
        lw_tblwidth = style_overwrite-lastcol.
        CONDENSE lw_tblwidth NO-GAPS.
        CONCATENATE lw_style
                    &apos; w:lastColumn=&quot;&apos;
                    lw_tblwidth
                    &apos;&quot;&apos;
                    INTO lw_style RESPECTING BLANKS.

        CONCATENATE lw_xml
                    &apos;&lt;w:tblLook&apos;
                    lw_style
                    &apos;/&gt;&apos;
                    INTO lw_xml RESPECTING BLANKS.
        CLEAR lw_style.
      ENDIF.
    ENDIF.

* Default not styled table : add border
    IF NOT style IS SUPPLIED.
      IF border = c_true.
        CONCATENATE lw_xml
                    &apos;&lt;w:tblBorders&gt;&apos;
                    &apos;&lt;w:top w:color=&quot;auto&quot; w:space=&quot;0&quot; w:sz=&quot;4&quot; w:val=&quot;single&quot;/&gt;&apos;
                    &apos;&lt;w:left w:color=&quot;auto&quot; w:space=&quot;0&quot; w:sz=&quot;4&quot; w:val=&quot;single&quot;/&gt;&apos;
                    &apos;&lt;w:bottom w:color=&quot;auto&quot; w:space=&quot;0&quot; w:sz=&quot;4&quot; w:val=&quot;single&quot;/&gt;&apos;
                    &apos;&lt;w:right w:color=&quot;auto&quot; w:space=&quot;0&quot; w:sz=&quot;4&quot; w:val=&quot;single&quot;/&gt;&apos;
                    &apos;&lt;w:insideH w:color=&quot;auto&quot; w:space=&quot;0&quot; w:sz=&quot;4&quot; w:val=&quot;single&quot;/&gt;&apos;
                    &apos;&lt;w:insideV w:color=&quot;auto&quot; w:space=&quot;0&quot; w:sz=&quot;4&quot; w:val=&quot;single&quot;/&gt;&apos;
                    &apos;&lt;/w:tblBorders&gt;&apos;
                    INTO lw_xml.
      ENDIF.
    ENDIF.

* Define table width
    lw_tblwidth = tblwidth.
    CONDENSE lw_tblwidth NO-GAPS.
    IF tblwidth = 0.
* If no table width given, set it to &quot;auto&quot;
      CONCATENATE lw_xml
                  &apos;&lt;w:tblW w:w=&quot;&apos;
                  lw_tblwidth
                  &apos;&quot; w:type=&quot;auto&quot;/&gt;&apos;
                  &apos;&lt;/w:tblPr&gt;&apos;
                  INTO lw_xml.
    ELSE.
      CONCATENATE lw_xml
                  &apos;&lt;w:tblW w:w=&quot;&apos;
                  lw_tblwidth
                  &apos;&quot; w:type=&quot;dxa&quot;/&gt;&apos;
                  &apos;&lt;/w:tblPr&gt;&apos;
                  INTO lw_xml.
    ENDIF.

* Fill table content
    LOOP AT content INTO &lt;line&gt;.
      CONCATENATE lw_xml
                  &apos;&lt;w:tr&gt;&apos;
                  INTO lw_xml.
      lw_col = 1.
      DO lw_cols TIMES.
        lw_col_inc = 1.
*--Filling the cell
        IF lw_style_table = 0. &quot; fields are plain text
          CONCATENATE lw_xml
                      &apos;&lt;w:tc&gt;&apos;
                      INTO lw_xml.

          ASSIGN COMPONENT lw_col OF STRUCTURE &lt;line&gt; TO &lt;field&gt;.
          lw_string = &lt;field&gt;.
          write_text( EXPORTING textline = lw_string
                      IMPORTING virtual  = lw_string ).
          CONCATENATE lw_xml
                      &apos;&lt;w:p&gt;&apos;
                      lw_string
                      &apos;&lt;/w:p&gt;&apos;
                      INTO lw_xml.
        ELSE. &quot; fields have ty_table_style_field structure, apply styles
          ASSIGN COMPONENT lw_col OF STRUCTURE &lt;line&gt; TO &lt;field_style&gt;.
          IF sy-subrc &lt;&gt; 0. &quot; Occurs when merged cell
            EXIT. &quot; exit do
          ENDIF.
          CONCATENATE lw_xml
                      &apos;&lt;w:tc&gt;&apos;
                      INTO lw_xml.

          CLEAR : lw_style,
                  lw_stylep.
          IF NOT &lt;field_style&gt;-bgcolor IS INITIAL.
            CONCATENATE lw_style
                        &apos;&lt;w:shd w:fill=&quot;&apos;
                        &lt;field_style&gt;-bgcolor
                        &apos;&quot;/&gt;&apos;
                        INTO lw_style.
          ENDIF.
          IF NOT &lt;field_style&gt;-valign IS INITIAL.
            CONCATENATE lw_style
                        &apos;&lt;w:vAlign w:val=&quot;&apos;
                        &lt;field_style&gt;-valign
                        &apos;&quot;/&gt;&apos;
                        INTO lw_style.
          ENDIF.
          IF &lt;field_style&gt;-merge &gt; 1.
            lw_col_inc = &lt;field_style&gt;-merge.
            lw_merge = &lt;field_style&gt;-merge.
            CONDENSE lw_merge NO-GAPS.
            CONCATENATE lw_style
                        &apos;&lt;w:gridSpan w:val=&quot;&apos;
                        lw_merge
                        &apos;&quot;/&gt;&apos;
                        INTO lw_style.
          ENDIF.

          IF NOT lw_style IS INITIAL.
            CONCATENATE &apos;&lt;w:tcPr&gt;&apos; lw_style &apos;&lt;/w:tcPr&gt;&apos; INTO lw_style.
          ENDIF.

          CLEAR lw_string.
          IF NOT &lt;field_style&gt;-xml IS INITIAL.
            CONCATENATE lw_xml
                        lw_style
                        &lt;field_style&gt;-xml
                        INTO lw_xml.
          ELSEIF NOT &lt;field_style&gt;-image_id IS INITIAL.
            CLEAR lw_string.
            insert_image( EXPORTING style        = &lt;field_style&gt;-line_style
                                    style_effect = &lt;field_style&gt;-line_style_effect
                          IMPORTING virtual      = lw_string
                          CHANGING  id           = &lt;field_style&gt;-image_id ).

            CONCATENATE lw_xml
                        lw_style
                        lw_string
                        INTO lw_xml.
          ELSE.
            write_text( EXPORTING textline     = &lt;field_style&gt;-textline
                                  style_effect = &lt;field_style&gt;-style_effect
                                  style        = &lt;field_style&gt;-style
                        IMPORTING virtual      = lw_string ).

            IF    NOT &lt;field_style&gt;-line_style        IS INITIAL
               OR NOT &lt;field_style&gt;-line_style_effect IS INITIAL.
              _build_paragraph_style( EXPORTING style        = &lt;field_style&gt;-line_style
                                                style_effect = &lt;field_style&gt;-line_style_effect
                                      IMPORTING xml          = lw_stylep ).
            ENDIF.

            CONCATENATE lw_xml
                        lw_style
                        &apos;&lt;w:p&gt;&apos;
                        lw_stylep
                        lw_string
                        &apos;&lt;/w:p&gt;&apos;
                        INTO lw_xml.
          ENDIF.
        ENDIF.
        CONCATENATE lw_xml &apos;&lt;/w:tc&gt;&apos; INTO lw_xml.
        lw_col = lw_col + lw_col_inc.
      ENDDO.
      CONCATENATE lw_xml &apos;&lt;/w:tr&gt;&apos; INTO lw_xml.
    ENDLOOP.

    CONCATENATE lw_xml
                &apos;&lt;/w:tbl&gt;&apos;
                INTO lw_xml.

    IF virtual IS SUPPLIED.
      virtual = lw_xml.
    ELSE.
      CONCATENATE mw_docxml
                  lw_xml
                  INTO mw_docxml.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TEXT" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="2 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TEXT" SCONAME="TEXTLINE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TEXT" SCONAME="STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TEXT" SCONAME="STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_CHARACTER_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TEXT" SCONAME="LINE_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TEXT" SCONAME="LINE_STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_PARAGRAPH_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TEXT" SCONAME="VIRTUAL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TEXT" SCONAME="INVALID_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TEXT" SCONAME="INVALID_LINE_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <source>METHOD write_text.
    DATA : lw_style  TYPE string,
           lw_string TYPE string,
           lw_field  TYPE string.
    DATA : lt_find_result TYPE match_result_tab,
           ls_find_result LIKE LINE OF lt_find_result,
           lw_off         TYPE i,
           lw_len         TYPE i.

* Get font style section
    IF style_effect IS SUPPLIED OR NOT style IS INITIAL.
      _build_character_style( EXPORTING style         = style
                                        style_effect  = style_effect
                              IMPORTING xml           = lw_style
                                        invalid_style = invalid_style ).
    ENDIF.

    lw_string = textline.
* Escape invalid character
    _protect_string( EXPORTING in  = lw_string
                     IMPORTING out = lw_string ).

* Replace fields in content
    IF lw_string CS &apos;##FIELD#&apos;.
* Regex to search all fields to replace
      FIND ALL OCCURRENCES OF REGEX &apos;##FIELD#([A-Z ])*##&apos; IN lw_string RESULTS lt_find_result.
      SORT lt_find_result BY offset DESCENDING.
* For each result, replace
      LOOP AT lt_find_result INTO ls_find_result.
        lw_off = ls_find_result-offset + 8.
        lw_len = ls_find_result-length - 10.
        CASE lw_string+ls_find_result-offset(ls_find_result-length).
          WHEN c_field_pagecount OR c_field_pagetotal.
            CONCATENATE lw_string+lw_off(lw_len) &apos;\* Arabic&apos;
                        INTO lw_field SEPARATED BY space.
          WHEN c_field_filename.
            CONCATENATE lw_string+lw_off(lw_len) &apos;\p&apos;
                        INTO lw_field SEPARATED BY space.
          WHEN c_field_creationdate OR c_field_moddate
          OR c_field_todaydate.
            CONCATENATE lw_string+lw_off(lw_len)
                        &apos;\@ &amp;quot;dd/MM/yyyy&amp;quot;&apos;
                        INTO lw_field SEPARATED BY space.
          WHEN OTHERS.
            lw_field = lw_string+lw_off(lw_len).
        ENDCASE.
        CONCATENATE &apos;&lt;w:fldSimple w:instr=&quot;&apos;
                    lw_field
                    &apos; \* MERGEFORMAT&quot;/&gt;&apos;
                    INTO lw_field RESPECTING BLANKS.
        REPLACE lw_string+ls_find_result-offset(ls_find_result-length)
                IN lw_string WITH lw_field.
      ENDLOOP.
    ENDIF.

* Replace label anchor by it&apos;s value
    IF NOT style_effect-label IS INITIAL AND lw_string CS c_label_anchor.
      _protect_label( EXPORTING in  = style_effect-label
                      IMPORTING out = lw_field ).
      CONCATENATE &apos;&lt;w:fldSimple w:instr=&quot; SEQ &apos;
                  lw_field
                  &apos; \* ARABIC &quot;/&gt;&apos;
                  INTO lw_field RESPECTING BLANKS.
      REPLACE c_label_anchor IN lw_string WITH lw_field.
    ENDIF.

    IF virtual IS SUPPLIED.
      CONCATENATE &apos;&lt;w:r&gt;&apos;
                  lw_style
                  &apos;&lt;w:t xml:space=&quot;preserve&quot;&gt;&apos;
                  lw_string
                  &apos;&lt;/w:t&gt;&apos;
                  &apos;&lt;/w:r&gt;&apos;
                  INTO virtual RESPECTING BLANKS.

      IF    (     line_style        IS SUPPLIED AND line_style IS NOT INITIAL )
         OR (     line_style_effect IS SUPPLIED
              AND line_style_effect IS NOT INITIAL ).
        write_line( EXPORTING style         = line_style
                              style_effect  = line_style_effect
                    IMPORTING invalid_style = invalid_line_style
                    CHANGING  virtual       = virtual ).
      ENDIF.

      RETURN.
    ELSE.
      CONCATENATE mw_fragxml
                  &apos;&lt;w:r&gt;&apos;
                  lw_style
                  &apos;&lt;w:t xml:space=&quot;preserve&quot;&gt;&apos;
                  lw_string
                  &apos;&lt;/w:t&gt;&apos;
                  &apos;&lt;/w:r&gt;&apos;
                  INTO mw_fragxml RESPECTING BLANKS.

      IF    (     line_style        IS SUPPLIED AND line_style IS NOT INITIAL )
         OR (     line_style_effect IS SUPPLIED
              AND line_style_effect IS NOT INITIAL ).
        write_line( EXPORTING style         = line_style
                              style_effect  = line_style_effect
                    IMPORTING invalid_style = invalid_line_style ).
      ENDIF.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TOC" VERSION="1" LANGU="S" EXPOSURE="2" STATE="1" EDITORDER="10 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TOC" SCONAME="DEFAULT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="WRITE_TOC" SCONAME="LABEL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <source>METHOD write_toc.
    DATA : lw_default TYPE string,
           lw_content TYPE string.

* Classic TOC
    IF label IS INITIAL.
      lw_default = &apos;--== Table of content - please refresh ==--&apos;.
      lw_content = &apos;\o &quot;1-9&quot;&apos;.

* Table of content for specific label (table, figure, ...)
    ELSE.
      CONCATENATE &apos;--== Table of &apos;
                  label
                  &apos; - please refresh ==--&apos;
                  INTO lw_default RESPECTING BLANKS.

      _protect_label( EXPORTING in  = label
                      IMPORTING out = lw_content ).

      CONCATENATE &apos;\h \h \c &quot;&apos;
                  lw_content
                  &apos;&quot;&apos;
                  INTO lw_content.
    ENDIF.

* If specified, use given default text
    IF NOT default IS INITIAL.
      lw_default = default.
    ENDIF.

* Write TOC
    CONCATENATE mw_docxml
                &apos;&lt;w:p&gt;&apos;
                &apos;&lt;w:r&gt;&lt;w:fldChar w:fldCharType=&quot;begin&quot;/&gt;&lt;/w:r&gt;&apos;
                &apos;&lt;w:r&gt;&lt;w:instrText&gt; TOC &apos;
                lw_content
                &apos; &lt;/w:instrText&gt;&lt;/w:r&gt;&apos;
                &apos;&lt;/w:p&gt;&apos;

* Add a default text for initial TOC value
                &apos;&lt;w:p&gt;&apos;
                &apos;&lt;w:pPr&gt;&lt;w:jc w:val=&quot;center&quot;/&gt;&lt;/w:pPr&gt;&apos;
                &apos;&lt;w:r&gt;&apos;
                &apos;&lt;w:fldChar w:fldCharType=&quot;separate&quot;/&gt;&lt;/w:r&gt;&apos;
                &apos;&lt;w:r&gt;&apos;
                &apos;&lt;w:rPr&gt;&lt;w:sz w:val=&quot;36&quot;/&gt;&lt;w:szCs w:val=&quot;36&quot;/&gt;&lt;/w:rPr&gt;&apos;
                &apos;&lt;w:t&gt;&apos;
                lw_default
                &apos;&lt;/w:t&gt;&lt;/w:r&gt;&apos;
                &apos;&lt;/w:p&gt;&apos;

                &apos;&lt;w:p&gt;&apos;
                &apos;&lt;w:r&gt;&lt;w:fldChar w:fldCharType=&quot;end&quot;/&gt;&lt;/w:r&gt;&apos;
                &apos;&lt;/w:p&gt;&apos;

                INTO mw_docxml RESPECTING BLANKS.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="_BUILD_CHARACTER_STYLE" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="9 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_BUILD_CHARACTER_STYLE" SCONAME="STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_BUILD_CHARACTER_STYLE" SCONAME="STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_CHARACTER_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_BUILD_CHARACTER_STYLE" SCONAME="XML" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_BUILD_CHARACTER_STYLE" SCONAME="INVALID_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <source>METHOD _build_character_style.
    DATA : lw_string  TYPE string,
           lw_intsize TYPE i,
           lw_char6   TYPE c LENGTH 6.

    CLEAR xml.

    IF style_effect IS SUPPLIED.
      IF NOT style_effect-color IS INITIAL.
        CONCATENATE xml
                    &apos;&lt;w:color w:val=&quot;&apos;
                    style_effect-color
                    &apos;&quot;/&gt;&apos;
                    INTO xml.
      ENDIF.

      IF NOT style_effect-bgcolor IS INITIAL.
        CONCATENATE xml
                    &apos;&lt;w:shd w:val=&quot;clear&quot; w:color=&quot;auto&quot; w:fill=&quot;&apos;
                    style_effect-bgcolor
                    &apos;&quot;/&gt;&apos;
                    INTO xml.
      ENDIF.

      IF style_effect-bold = c_true.
        CONCATENATE xml
                    &apos;&lt;w:b/&gt;&apos;
                    INTO xml.
      ENDIF.

      IF style_effect-italic = c_true.
        CONCATENATE xml
                    &apos;&lt;w:i/&gt;&apos;
                    INTO xml.
      ENDIF.

      IF style_effect-underline = c_true.
        CONCATENATE xml
                    &apos;&lt;w:u w:val=&quot;single&quot;/&gt;&apos;
                    INTO xml.
      ENDIF.

      IF style_effect-strike = c_true.
        CONCATENATE xml
                    &apos;&lt;w:strike/&gt;&apos;
                    INTO xml.
      ENDIF.

      IF style_effect-caps = c_true.
        CONCATENATE xml
                    &apos;&lt;w:caps/&gt;&apos;
                    INTO xml.
      ENDIF.

      IF style_effect-smallcaps = c_true.
        CONCATENATE xml
                    &apos;&lt;w:smallCaps/&gt;&apos;
                    INTO xml.
      ENDIF.

      IF NOT style_effect-highlight IS INITIAL.
        CONCATENATE xml
                    &apos;&lt;w:highlight w:val=&quot;&apos;
                    style_effect-highlight
                    &apos;&quot;/&gt;&apos;
                    INTO xml.
      ENDIF.

      IF NOT style_effect-spacing IS INITIAL AND style_effect-spacing CO &apos;0123456789 -&apos;.
        IF style_effect-spacing &gt; 0.
          lw_string = style_effect-spacing.
          CONDENSE lw_string NO-GAPS.
        ELSE.
          lw_string = - style_effect-spacing.
          CONDENSE lw_string NO-GAPS.
          CONCATENATE &apos;-&apos; lw_string INTO lw_string.
        ENDIF.
        CONCATENATE xml
                    &apos;&lt;w:spacing w:val=&quot;&apos;
                    lw_string
                    &apos;&quot;/&gt;&apos;
                    INTO xml.
      ENDIF.

      IF style_effect-size IS NOT INITIAL.
        lw_intsize = style_effect-size * 2.
        lw_char6 = lw_intsize.
        CONDENSE lw_char6 NO-GAPS.
        CONCATENATE xml
                    &apos;&lt;w:sz w:val=&quot;&apos;
                    lw_char6
                    &apos;&quot;/&gt;&apos;
                    &apos;&lt;w:szCs w:val=&quot;&apos;
                    lw_char6
                    &apos;&quot;/&gt;&apos;
                    INTO xml.
      ENDIF.

      IF style_effect-sup = c_true.
        CONCATENATE xml
                    &apos;&lt;w:vertAlign w:val=&quot;superscript&quot;/&gt;&apos;
                    INTO xml.
      ELSEIF style_effect-sub = c_true.
        CONCATENATE xml
                    &apos;&lt;w:vertAlign w:val=&quot;subscript&quot;/&gt;&apos;
                    INTO xml.
      ENDIF.

      IF NOT style_effect-font IS INITIAL.
        CONCATENATE xml
                    &apos;&lt;w:rFonts w:ascii=&quot;&apos;
                    style_effect-font
                    &apos;&quot; w:hAnsi=&quot;&apos;
                    style_effect-font
                    &apos;&quot;/&gt;&apos;
                    INTO xml.
      ENDIF.
    ENDIF.

    IF style IS SUPPLIED AND style IS NOT INITIAL.
      IF line_exists( mt_list_style[ type = c_type_character
                                     name = style ] ).
        CONCATENATE xml
                    &apos;&lt;w:rStyle w:val=&quot;&apos;
                    style
                    &apos;&quot;/&gt;&apos;
                    INTO xml.
      ELSE.
        invalid_style = c_true.
      ENDIF.
    ENDIF.

    IF NOT xml IS INITIAL.
      CONCATENATE &apos;&lt;w:rPr&gt;&apos;
                  xml
                  &apos;&lt;/w:rPr&gt;&apos;
                  INTO xml.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="_BUILD_PARAGRAPH_STYLE" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="10 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_BUILD_PARAGRAPH_STYLE" SCONAME="STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_BUILD_PARAGRAPH_STYLE" SCONAME="STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_PARAGRAPH_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_BUILD_PARAGRAPH_STYLE" SCONAME="XML" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_BUILD_PARAGRAPH_STYLE" SCONAME="INVALID_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <source>METHOD _build_paragraph_style.
    DATA : lw_size     TYPE string,
           lw_substyle TYPE string,
           lw_space    TYPE string,
           lw_indent   TYPE string.

    IF style IS SUPPLIED AND NOT style IS INITIAL.
      IF line_exists( mt_list_style[ type = c_type_paragraph
                                     name = style ] ).
        CONCATENATE xml
                    &apos;&lt;w:pStyle w:val=&quot;&apos;
                    style
                    &apos;&quot;/&gt;&apos;
                    INTO xml.
      ELSE.
        invalid_style = c_true.
      ENDIF.
    ENDIF.

    IF style_effect-break_before = c_true.
      CONCATENATE xml
                  &apos;&lt;w:pageBreakBefore/&gt;&apos;
                  INTO xml.
    ENDIF.

    IF NOT style_effect-hierarchy_level IS INITIAL.
      lw_size = style_effect-hierarchy_level - 1.
      CONDENSE lw_size NO-GAPS.
      CONCATENATE xml
                  &apos;&lt;w:outlineLvl w:val=&quot;&apos;
                  lw_size
                  &apos;&quot;/&gt;&apos;
                  INTO xml.
    ENDIF.

    IF NOT style_effect-alignment IS INITIAL.
      CONCATENATE xml
                  &apos;&lt;w:jc w:val=&quot;&apos;
                  style_effect-alignment
                  &apos;&quot;/&gt;&apos;
                  INTO xml.
    ENDIF.

    IF NOT style_effect-bgcolor IS INITIAL.
      CONCATENATE xml
                  &apos;&lt;w:shd w:val=&quot;clear&quot; w:color=&quot;auto&quot; w:fill=&quot;&apos;
                  style_effect-bgcolor
                  &apos;&quot;/&gt;&apos;
                  INTO xml.
    ENDIF.

    CLEAR lw_substyle.
    IF style_effect-spacing_before_auto = c_true.
      lw_substyle = &apos; w:beforeAutospacing=&quot;1&quot;&apos;.
    ELSEIF NOT style_effect-spacing_before IS INITIAL AND style_effect-spacing_before CO &apos;0123456789 &apos;.
      lw_space = style_effect-spacing_before.
      CONDENSE lw_space NO-GAPS.
      CONCATENATE lw_substyle
                  &apos; w:beforeAutospacing=&quot;0&quot; w:before=&quot;&apos;
                  lw_space
                  &apos;&quot;&apos;
                  INTO lw_substyle RESPECTING BLANKS.
    ENDIF.

    IF style_effect-spacing_after_auto = c_true.
      CONCATENATE lw_substyle
                  &apos; w:afterAutospacing=&quot;1&quot;&apos;
                  INTO lw_substyle RESPECTING BLANKS.
    ELSEIF NOT style_effect-spacing_after IS INITIAL AND style_effect-spacing_after CO &apos;0123456789 &apos;.
      lw_space = style_effect-spacing_after.
      CONDENSE lw_space NO-GAPS.
      CONCATENATE lw_substyle
                  &apos; w:afterAutospacing=&quot;0&quot; w:after=&quot;&apos;
                  lw_space
                  &apos;&quot;&apos;
                  INTO lw_substyle RESPECTING BLANKS.
    ENDIF.

    IF NOT style_effect-interline IS INITIAL.
      lw_space = style_effect-interline.
      CONDENSE lw_space NO-GAPS.
      CONCATENATE lw_substyle
                  &apos; w:line=&quot;&apos;
                  lw_space
                  &apos;&quot;&apos;
                  INTO lw_substyle RESPECTING BLANKS.
    ENDIF.

    IF NOT lw_substyle IS INITIAL.
      CONCATENATE xml
                  &apos;&lt;w:spacing &apos;
                  lw_substyle
                  &apos;/&gt;&apos;
                  INTO xml RESPECTING BLANKS.
    ENDIF.

    CLEAR lw_substyle.
    IF NOT style_effect-leftindent IS INITIAL AND style_effect-leftindent CO &apos;0123456789 &apos;.
      lw_indent = style_effect-leftindent.
      CONDENSE lw_indent NO-GAPS.
      CONCATENATE &apos; w:left=&quot;&apos;
                  lw_indent
                  &apos;&quot;&apos;
                  INTO lw_substyle RESPECTING BLANKS.
    ENDIF.

    IF NOT style_effect-rightindent IS INITIAL AND style_effect-rightindent CO &apos;0123456789 &apos;.
      lw_indent = style_effect-rightindent.
      CONDENSE lw_indent NO-GAPS.
      CONCATENATE lw_substyle
                  &apos; w:right=&quot;&apos;
                  lw_indent
                  &apos;&quot;&apos;
                  INTO lw_substyle RESPECTING BLANKS.
    ENDIF.

    IF NOT style_effect-firstindent IS INITIAL AND style_effect-firstindent CO &apos;-0123456789 &apos;.
      IF style_effect-firstindent &lt; 0.
        lw_indent = - style_effect-firstindent.
        CONDENSE lw_indent NO-GAPS.
        CONCATENATE lw_substyle
                    &apos; w:hanging=&quot;&apos;
                    lw_indent
                    &apos;&quot;&apos;
                    INTO lw_substyle RESPECTING BLANKS.
      ELSE.
        lw_indent = style_effect-firstindent.
        CONDENSE lw_indent NO-GAPS.
        CONCATENATE lw_substyle
                    &apos; w:firstLine=&quot;&apos;
                    lw_indent
                    &apos;&quot;&apos;
                    INTO lw_substyle RESPECTING BLANKS.
      ENDIF.
    ENDIF.

    IF NOT lw_substyle IS INITIAL.
      CONCATENATE xml
                  &apos;&lt;w:ind &apos;
                  lw_substyle
                  &apos;/&gt;&apos;
                  INTO xml RESPECTING BLANKS.
    ENDIF.

* Borders
    CLEAR lw_substyle.
    IF     NOT style_effect-border_left-style IS INITIAL
       AND NOT style_effect-border_left-width IS INITIAL.
      lw_size = style_effect-border_left-width.
      CONDENSE lw_size NO-GAPS.
      lw_space = style_effect-border_left-space.
      CONDENSE lw_space NO-GAPS.
      CONCATENATE lw_substyle
                  &apos;&lt;w:left w:val=&quot;&apos;
                  style_effect-border_left-style
                  &apos;&quot; w:sz=&quot;&apos;
                  lw_size
                  &apos;&quot; w:space=&quot;&apos;
                  lw_space
                  &apos;&quot; w:color=&quot;&apos;
                  style_effect-border_left-color
                  &apos;&quot;/&gt;&apos;
                  INTO lw_substyle RESPECTING BLANKS.
    ENDIF.
    IF     NOT style_effect-border_top-style IS INITIAL
       AND NOT style_effect-border_top-width IS INITIAL.
      lw_size = style_effect-border_top-width.
      CONDENSE lw_size NO-GAPS.
      lw_space = style_effect-border_top-space.
      CONDENSE lw_space NO-GAPS.
      CONCATENATE lw_substyle
                  &apos;&lt;w:top w:val=&quot;&apos;
                  style_effect-border_top-style
                  &apos;&quot; w:sz=&quot;&apos;
                  lw_size
                  &apos;&quot; w:space=&quot;&apos;
                  lw_space
                  &apos;&quot; w:color=&quot;&apos;
                  style_effect-border_top-color
                  &apos;&quot;/&gt;&apos;
                  INTO lw_substyle RESPECTING BLANKS.
    ENDIF.
    IF     NOT style_effect-border_right-style IS INITIAL
       AND NOT style_effect-border_right-width IS INITIAL.
      lw_size = style_effect-border_right-width.
      CONDENSE lw_size NO-GAPS.
      lw_space = style_effect-border_right-space.
      CONDENSE lw_space NO-GAPS.
      CONCATENATE lw_substyle
                  &apos;&lt;w:right w:val=&quot;&apos;
                  style_effect-border_right-style
                  &apos;&quot; w:sz=&quot;&apos;
                  lw_size
                  &apos;&quot; w:space=&quot;&apos;
                  lw_space
                  &apos;&quot; w:color=&quot;&apos;
                  style_effect-border_right-color
                  &apos;&quot;/&gt;&apos;
                  INTO lw_substyle RESPECTING BLANKS.
    ENDIF.
    IF     NOT style_effect-border_bottom-style IS INITIAL
       AND NOT style_effect-border_bottom-width IS INITIAL.
      lw_size = style_effect-border_bottom-width.
      CONDENSE lw_size NO-GAPS.
      lw_space = style_effect-border_bottom-space.
      CONDENSE lw_space NO-GAPS.
      CONCATENATE lw_substyle
                  &apos;&lt;w:bottom w:val=&quot;&apos;
                  style_effect-border_bottom-style
                  &apos;&quot; w:sz=&quot;&apos;
                  lw_size
                  &apos;&quot; w:space=&quot;&apos;
                  lw_space
                  &apos;&quot; w:color=&quot;&apos;
                  style_effect-border_bottom-color
                  &apos;&quot;/&gt;&apos;
                  INTO lw_substyle RESPECTING BLANKS.
    ENDIF.
    IF NOT lw_substyle IS INITIAL.
      CONCATENATE xml
                  &apos;&lt;w:pBdr&gt;&apos;
                  lw_substyle
                  &apos;&lt;/w:pBdr&gt;&apos;
                  INTO xml RESPECTING BLANKS.
    ENDIF.
* Add section info if required
    IF NOT mw_section_xml IS INITIAL.
      CONCATENATE xml
                  mw_section_xml
                  INTO xml.
      CLEAR mw_section_xml.
    ENDIF.

    IF NOT xml IS INITIAL.
      CONCATENATE &apos;&lt;w:pPr&gt;&apos;
                  xml
                  &apos;&lt;/w:pPr&gt;&apos;
                  INTO xml.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="_CREATE_NOTE" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="6 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_CREATE_NOTE" SCONAME="TEXT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_CREATE_NOTE" SCONAME="TYPE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_CREATE_NOTE" SCONAME="STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_CREATE_NOTE" SCONAME="STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_CHARACTER_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_CREATE_NOTE" SCONAME="LINE_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_CREATE_NOTE" SCONAME="LINE_STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_PARAGRAPH_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_CREATE_NOTE" SCONAME="LINK_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="7 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_CREATE_NOTE" SCONAME="LINK_STYLE_EFFECT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="8 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="TY_CHARACTER_STYLE_EFFECT" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_CREATE_NOTE" SCONAME="INVALID_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="9 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_CREATE_NOTE" SCONAME="INVALID_LINE_STYLE" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="10 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_CREATE_NOTE" SCONAME="ID" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="11 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD _create_note.
    DATA : lw_filename   TYPE string,
           lw_file       TYPE string,
           lw_string     TYPE string,
           lw_id         TYPE string,
           lw_xmlns      TYPE string,
           lw_text       TYPE string,
           lw_link_style TYPE string,
           lw_line_style TYPE string.

* Search if notes file exist
    IF type = c_notetype_foot.
      lw_filename = &apos;word/footnotes.xml&apos;.
    ELSEIF type = c_notetype_end.
      lw_filename = &apos;word/endnotes.xml&apos;.
    ELSE.
      RETURN.
    ENDIF.

    IF line_exists( mo_zip-&gt;files[ name = lw_filename ] ).
* If foot/end notes exists, load the file
      _get_zip_file( EXPORTING filename = lw_filename
                     IMPORTING content  = lw_file ).
    ELSE.
* If footnotes doesn&apos;t exist, declare it and create it
* Add footnotes in content_types
      _get_zip_file( EXPORTING filename = &apos;[Content_Types].xml&apos;
                     IMPORTING content  = lw_file ).

      IF type = c_notetype_foot.
        CONCATENATE &apos;&lt;Override&apos;
                    &apos; ContentType=&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml&quot;&apos;
                    &apos; PartName=&quot;/word/footnotes.xml&quot;/&gt;&lt;/Types&gt;&apos;
                    INTO lw_string RESPECTING BLANKS.
      ELSEIF type = c_notetype_end.
        CONCATENATE &apos;&lt;Override&apos;
                    &apos; ContentType=&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml&quot;&apos;
                    &apos; PartName=&quot;/word/endnotes.xml&quot;/&gt;&lt;/Types&gt;&apos;
                    INTO lw_string RESPECTING BLANKS.
      ENDIF.
      REPLACE &apos;&lt;/Types&gt;&apos; WITH lw_string
              INTO lw_file.

      _update_zip_file( filename = &apos;[Content_Types].xml&apos;
                        content  = lw_file ).

* Add footnotes in relation file
      _get_zip_file( EXPORTING filename = &apos;word/_rels/document.xml.rels&apos;
                     IMPORTING content  = lw_file ).

* Create footnotes relation ID
      DO.
        lw_id = sy-index.
        CONDENSE lw_id NO-GAPS.
        CONCATENATE &apos;rId&apos; lw_id INTO lw_id ##NO_TEXT.
        CONCATENATE &apos;Id=&quot;&apos; lw_id &apos;&quot;&apos; INTO lw_string ##NO_TEXT.
        FIND FIRST OCCURRENCE OF lw_string IN lw_file IGNORING CASE.
        IF sy-subrc &lt;&gt; 0.
          EXIT. &quot; exit do
        ENDIF.
      ENDDO.

* Add relation
      IF type = c_notetype_foot.
        CONCATENATE &apos;&lt;Relationship Target=&quot;footnotes.xml&quot;&apos;
                    &apos; Type=&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/footnotes&quot;&apos;
                    &apos; Id=&quot;&apos;
                    lw_id
                    &apos;&quot;/&gt;&apos;
                    &apos;&lt;/Relationships&gt;&apos;
                    INTO lw_string RESPECTING BLANKS.
      ELSEIF type = c_notetype_end.
        CONCATENATE &apos;&lt;Relationship Target=&quot;endnotes.xml&quot;&apos;
                    &apos; Type=&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/endnotes&quot;&apos;
                    &apos; Id=&quot;&apos;
                    lw_id
                    &apos;&quot;/&gt;&apos;
                    &apos;&lt;/Relationships&gt;&apos;
                    INTO lw_string RESPECTING BLANKS.
      ENDIF.
      REPLACE &apos;&lt;/Relationships&gt;&apos; WITH lw_string INTO lw_file.

* Update relation file
      _update_zip_file( filename = &apos;word/_rels/document.xml.rels&apos;
                        content  = lw_file ).

      _get_xml_ns( IMPORTING xml = lw_xmlns ).

* Create notes file
      IF type = c_notetype_foot.
        CONCATENATE &apos;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;&apos;
                    &apos;&lt;w:footnotes &apos;
                    lw_xmlns
                    &apos;&gt;&apos;
                    &apos;&lt;w:footnote w:id=&quot;-1&quot; w:type=&quot;separator&quot;&gt;&apos;
                    &apos;&lt;w:p&gt;&apos;
                    &apos;&lt;w:pPr&gt;&lt;w:spacing w:lineRule=&quot;auto&quot; w:line=&quot;240&quot; w:after=&quot;0&quot;/&gt;&lt;/w:pPr&gt;&apos;
                    &apos;&lt;w:r&gt;&lt;w:separator/&gt;&lt;/w:r&gt;&apos;
                    &apos;&lt;/w:p&gt;&apos;
                    &apos;&lt;/w:footnote&gt;&apos;
                    &apos;&lt;w:footnote w:id=&quot;0&quot; w:type=&quot;continuationSeparator&quot;&gt;&apos;
                    &apos;&lt;w:p&gt;&apos;
                    &apos;&lt;w:pPr&gt;&lt;w:spacing w:lineRule=&quot;auto&quot; w:line=&quot;240&quot; w:after=&quot;0&quot;/&gt;&lt;/w:pPr&gt;&apos;
                    &apos;&lt;w:r&gt;&lt;w:continuationSeparator/&gt;&lt;/w:r&gt;&apos;
                    &apos;&lt;/w:p&gt;&apos;
                    &apos;&lt;/w:footnote&gt;&apos;
                    &apos;&lt;/w:footnotes&gt;&apos;
                    INTO lw_file RESPECTING BLANKS.
      ELSEIF type = c_notetype_end.
        CONCATENATE &apos;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;&apos;
                    &apos;&lt;w:endnotes &apos;
                    lw_xmlns
                    &apos;&gt;&apos;
                    &apos;&lt;w:endnote w:id=&quot;-1&quot; w:type=&quot;separator&quot;&gt;&apos;
                    &apos;&lt;w:p&gt;&apos;
                    &apos;&lt;w:pPr&gt;&lt;w:spacing w:lineRule=&quot;auto&quot; w:line=&quot;240&quot; w:after=&quot;0&quot;/&gt;&lt;/w:pPr&gt;&apos;
                    &apos;&lt;w:r&gt;&lt;w:separator/&gt;&lt;/w:r&gt;&apos;
                    &apos;&lt;/w:p&gt;&apos;
                    &apos;&lt;/w:endnote&gt;&apos;
                    &apos;&lt;w:endnote w:id=&quot;0&quot; w:type=&quot;continuationSeparator&quot;&gt;&apos;
                    &apos;&lt;w:p&gt;&apos;
                    &apos;&lt;w:pPr&gt;&lt;w:spacing w:lineRule=&quot;auto&quot; w:line=&quot;240&quot; w:after=&quot;0&quot;/&gt;&lt;/w:pPr&gt;&apos;
                    &apos;&lt;w:r&gt;&lt;w:continuationSeparator/&gt;&lt;/w:r&gt;&apos;
                    &apos;&lt;/w:p&gt;&apos;
                    &apos;&lt;/w:endnote&gt;&apos;
                    &apos;&lt;/w:endnotes&gt;&apos;
                    INTO lw_file RESPECTING BLANKS.
      ENDIF.
    ENDIF.

* Search available note id
    DO.
      id = sy-index.
      CONDENSE id NO-GAPS.
      CONCATENATE &apos;w:id=&quot;&apos; id &apos;&quot;&apos; INTO lw_string ##NO_TEXT.
      FIND FIRST OCCURRENCE OF lw_string IN lw_file IGNORING CASE.
      IF sy-subrc &lt;&gt; 0.
        EXIT. &quot; exit do
      ENDIF.
    ENDDO.

* Add blank at start of note
    lw_text = text.
    IF lw_text IS INITIAL OR lw_text(1) &lt;&gt; space.
      CONCATENATE space lw_text INTO lw_text RESPECTING BLANKS.
    ENDIF.

    write_text( EXPORTING textline      = lw_text
                          style_effect  = style_effect
                          style         = style
                IMPORTING virtual       = lw_text
                          invalid_style = invalid_style ).

    IF NOT link_style_effect IS INITIAL OR NOT link_style IS INITIAL.
      _build_character_style( EXPORTING style        = link_style
                                        style_effect = link_style_effect
                              IMPORTING xml          = lw_link_style ).
    ENDIF.

    IF NOT line_style_effect IS INITIAL OR NOT line_style IS INITIAL.
      _build_paragraph_style( EXPORTING style         = line_style
                                        style_effect  = line_style_effect
                              IMPORTING xml           = lw_line_style
                                        invalid_style = invalid_line_style ).
    ENDIF.

* Add note
    IF type = c_notetype_foot.
      CONCATENATE &apos;&lt;w:footnote w:id=&quot;&apos;
                  id
                  &apos;&quot;&gt;&apos;
                  &apos;&lt;w:p&gt;&apos;
                  lw_line_style
                  &apos;&lt;w:r&gt;&apos;
                  lw_link_style
                  &apos;&lt;w:footnoteRef/&gt;&apos;
                  &apos;&lt;/w:r&gt;&apos;
                  lw_text
                  &apos;&lt;/w:p&gt;&apos;
                  &apos;&lt;/w:footnote&gt;&apos;
                  &apos;&lt;/w:footnotes&gt;&apos;
                  INTO lw_string RESPECTING BLANKS.
      REPLACE FIRST OCCURRENCE OF &apos;&lt;/w:footnotes&gt;&apos; IN lw_file WITH lw_string.
    ELSEIF type = c_notetype_end.
      CONCATENATE &apos;&lt;w:endnote w:id=&quot;&apos;
                  id
                  &apos;&quot;&gt;&apos;
                  &apos;&lt;w:p&gt;&apos;
                  lw_line_style
                  &apos;&lt;w:r&gt;&apos;
                  lw_link_style
                  &apos;&lt;w:endnoteRef/&gt;&apos;
                  &apos;&lt;/w:r&gt;&apos;
                  lw_text
                  &apos;&lt;/w:p&gt;&apos;
                  &apos;&lt;/w:endnote&gt;&apos;
                  &apos;&lt;/w:endnotes&gt;&apos;
                  INTO lw_string RESPECTING BLANKS.
      REPLACE FIRST OCCURRENCE OF &apos;&lt;/w:endnotes&gt;&apos; IN lw_file WITH lw_string.
    ENDIF.

* Update footnotes file
    _update_zip_file( filename = lw_filename
                      content  = lw_file ).
  ENDMETHOD.                    &quot;_create_footnote</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="_GET_XML_NS" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="11 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_GET_XML_NS" SCONAME="XML" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD _get_xml_ns.
    CLEAR xml.
    CONCATENATE
                &apos; xmlns:wpc=&quot;http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas&quot;&apos;
                &apos; xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;&apos;
                &apos; xmlns:o=&quot;urn:schemas-microsoft-com:office:office&quot;&apos;
                &apos; xmlns:r=&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships&quot;&apos;
                &apos; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&apos;
                &apos; xmlns:v=&quot;urn:schemas-microsoft-com:vml&quot;&apos;
                &apos; xmlns:wp14=&quot;http://schemas.microsoft.com/office/word/2010/wordprocessingDrawing&quot;&apos;
                &apos; xmlns:wp=&quot;http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing&quot;&apos;
                &apos; xmlns:w10=&quot;urn:schemas-microsoft-com:office:word&quot;&apos;
                &apos; xmlns:w=&quot;http://schemas.openxmlformats.org/wordprocessingml/2006/main&quot;&apos;
                &apos; xmlns:w14=&quot;http://schemas.microsoft.com/office/word/2010/wordml&quot;&apos;
                &apos; xmlns:wpg=&quot;http://schemas.microsoft.com/office/word/2010/wordprocessingGroup&quot;&apos;
                &apos; xmlns:wpi=&quot;http://schemas.microsoft.com/office/word/2010/wordprocessingInk&quot;&apos;
                &apos; xmlns:wne=&quot;http://schemas.microsoft.com/office/word/2006/wordml&quot;&apos;
                &apos; xmlns:wps=&quot;http://schemas.microsoft.com/office/word/2010/wordprocessingShape&quot;&apos;
                &apos; mc:Ignorable=&quot;w14 wp14&quot; &apos; ##NO_TEXT
                INTO xml RESPECTING BLANKS.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="_GET_ZIP_FILE" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="2 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_GET_ZIP_FILE" SCONAME="FILENAME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_GET_ZIP_FILE" SCONAME="CONTENT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD _get_zip_file.
    DATA : lw_xmlx        TYPE xstring,
           lw_xmlx_length TYPE i,
           lt_xmlx        TYPE STANDARD TABLE OF x255.

* Get zipped file
    mo_zip-&gt;get( EXPORTING  name    = filename
                 IMPORTING  content = lw_xmlx
                 EXCEPTIONS OTHERS  = 2 ).

* Transform xstring to string in 2 steps
    CALL FUNCTION &apos;SCMS_XSTRING_TO_BINARY&apos;
      EXPORTING buffer        = lw_xmlx
      IMPORTING output_length = lw_xmlx_length
      TABLES    binary_tab    = lt_xmlx.

    CALL FUNCTION &apos;SCMS_BINARY_TO_STRING&apos;
      EXPORTING input_length = lw_xmlx_length
      IMPORTING text_buffer  = content
      TABLES    binary_tab   = lt_xmlx.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="_LOAD_FILE" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="4 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_LOAD_FILE" SCONAME="FILENAME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_LOAD_FILE" SCONAME="XCONTENT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="XSTRING"/>
  <source>METHOD _load_file.
    DATA : lw_url_begin TYPE c LENGTH 6,
           lw_length    TYPE i,
           lt_data_tab  TYPE STANDARD TABLE OF x255.
    DATA : ls_query  TYPE w3query,
           lt_query  TYPE TABLE OF w3query,
           lt_html   TYPE TABLE OF w3html,
           lt_mime   TYPE TABLE OF w3mime,
           lw_return TYPE w3param-ret_code,
           lw_type   TYPE w3param-cont_type.

    CLEAR xcontent.
    lw_url_begin = filename.

* Load image
    IF lw_url_begin = c_sapwr_prefix.
* For SAPWR, read file from DB
      ls_query-name  = &apos;_OBJECT_ID&apos;.
      ls_query-value = filename+6.
      APPEND ls_query TO lt_query.
      CALL FUNCTION &apos;WWW_GET_MIME_OBJECT&apos;
        TABLES     query_string   = lt_query
                   html           = lt_html
                   mime           = lt_mime
        CHANGING   return_code    = lw_return
                   content_type   = lw_type
                   content_length = lw_length
        EXCEPTIONS OTHERS         = 3.
      IF sy-subrc &lt;&gt; 0.
        RETURN.
      ENDIF.

* Convert xchar table to xstring
      CALL FUNCTION &apos;SCMS_BINARY_TO_XSTRING&apos;
        EXPORTING  input_length = lw_length
        IMPORTING  buffer       = xcontent
        TABLES     binary_tab   = lt_mime
        EXCEPTIONS OTHERS       = 2.
    ELSE.
* For others, read file
      cl_gui_frontend_services=&gt;gui_upload( EXPORTING  filename   = filename
                                                       filetype   = &apos;BIN&apos;
                                            IMPORTING  filelength = lw_length
                                            CHANGING   data_tab   = lt_data_tab
                                            EXCEPTIONS OTHERS     = 19 ).
      IF sy-subrc &lt;&gt; 0.
        RETURN.
      ENDIF.
      CALL FUNCTION &apos;SCMS_BINARY_TO_XSTRING&apos;
        EXPORTING  input_length = lw_length
        IMPORTING  buffer       = xcontent
        TABLES     binary_tab   = lt_data_tab
        EXCEPTIONS OTHERS       = 2.
    ENDIF.
    IF sy-subrc &lt;&gt; 0.
      RETURN.
    ENDIF.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="_LOAD_IMAGE" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="5 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_LOAD_IMAGE" SCONAME="URL" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_LOAD_IMAGE" SCONAME="FILE_CONTENT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="XSTRING" PAROPTIONL="X"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_LOAD_IMAGE" SCONAME="IMGRES_X" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="3 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_LOAD_IMAGE" SCONAME="IMGRES_Y" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="4 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="I"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_LOAD_IMAGE" SCONAME="EXTENSION" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="5 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_LOAD_IMAGE" SCONAME="ID" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="6 " DISPID="0 " PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD _load_image.
    DATA : ls_list_object LIKE LINE OF mt_list_object,
           lw_filex       TYPE xstring,
           lw_url_begin   TYPE c LENGTH 6,
           lw_filename    TYPE string,
           lw_file        TYPE string,
           lw_string      TYPE string.

    CLEAR : extension,
            imgres_x,
            imgres_y.

* For existing image (ID given), just get img_res and extension.
    IF NOT id IS INITIAL.
      READ TABLE mt_list_object WITH KEY type = c_type_image
                                         id   = id
           INTO ls_list_object.
      IF sy-subrc &lt;&gt; 0.
        CLEAR id.
        RETURN.
      ENDIF.
      IF extension IS SUPPLIED.
        FIND ALL OCCURRENCES OF &apos;.&apos; IN ls_list_object-path
             MATCH OFFSET sy-fdpos.
        IF sy-subrc = 0.
          sy-fdpos = sy-fdpos + 1.
          extension = ls_list_object-path+sy-fdpos.
          extension = to_lower( extension ).
          IF extension = &apos;jpeg&apos;.
            extension = &apos;jpg&apos;.
          ENDIF.
        ENDIF.
      ENDIF.
      IF imgres_x IS SUPPLIED OR imgres_y IS SUPPLIED.
        mo_zip-&gt;get( EXPORTING  name    = ls_list_object-path
                     IMPORTING  content = lw_filex
                     EXCEPTIONS OTHERS  = 2 ).
        IF sy-subrc = 0.
          cl_fxs_image_info=&gt;determine_info( EXPORTING iv_data = lw_filex
                                             IMPORTING ev_xres = imgres_x
                                                       ev_yres = imgres_y ).
        ENDIF.
      ENDIF.
      RETURN.
    ENDIF.

* For new image, load image
    lw_url_begin = url.
    lw_url_begin = to_upper( lw_url_begin ).
* For image from sapwr, get file extension from DB
    IF lw_url_begin = c_sapwr_prefix.
      SELECT SINGLE value INTO extension
        FROM wwwparams
        WHERE relid = &apos;MI&apos;
          AND objid = url+6
          AND name  = &apos;fileextension&apos;.
      IF NOT extension IS INITIAL AND extension(1) = &apos;.&apos;.
        extension = extension+1.
      ENDIF.
    ELSE.
* For other image, get file extension from filename
      FIND ALL OCCURRENCES OF &apos;.&apos; IN url MATCH OFFSET sy-fdpos.
      IF sy-subrc = 0.
        sy-fdpos = sy-fdpos + 1.
        extension = url+sy-fdpos.
        extension = to_lower( extension ).
        IF extension = &apos;jpeg&apos;.
          extension = &apos;jpg&apos;.
        ENDIF.
      ENDIF.
    ENDIF.
* Cannot add image other than jpg/png/gif
    IF     extension &lt;&gt; &apos;jpg&apos;
       AND extension &lt;&gt; &apos;png&apos;
       AND extension &lt;&gt; &apos;gif&apos;.
      RETURN.
    ENDIF.

* Load image
    IF file_content IS INITIAL.
      _load_file( EXPORTING filename = url
                  IMPORTING xcontent = lw_filex ).
      IF lw_filex IS INITIAL.
        RETURN.
      ENDIF.
    ELSE.
      lw_filex = file_content.
    ENDIF.

* Get image resolution
    IF imgres_x IS SUPPLIED OR imgres_y IS SUPPLIED.
      cl_fxs_image_info=&gt;determine_info( EXPORTING iv_data = lw_filex
                                         IMPORTING ev_xres = imgres_x
                                                   ev_yres = imgres_y ).
    ENDIF.

* Search available image name
    DO.
      lw_filename = sy-index.
      CONDENSE lw_filename NO-GAPS.
      CONCATENATE &apos;word/media/image&apos; lw_filename &apos;.&apos; extension
                  INTO lw_filename.
      IF NOT line_exists( mo_zip-&gt;files[ name = lw_filename ] ).
        EXIT. &quot; exit do
      ENDIF.
    ENDDO.

* Add image in ZIP
    mo_zip-&gt;add( name    = lw_filename
                 content = lw_filex ).

* Get file extension list
    _get_zip_file( EXPORTING filename = &apos;[Content_Types].xml&apos;
                   IMPORTING content  = lw_file ).

* Search if file extension exist
    CONCATENATE &apos;extension=&quot;&apos; extension &apos;&quot;&apos; INTO lw_string.
    FIND FIRST OCCURRENCE OF lw_string IN lw_file IGNORING CASE.
    IF sy-subrc &lt;&gt; 0.
* If extension is not yet declared, it&apos;s time !
      CASE extension.
        WHEN &apos;jpg&apos;.
          REPLACE &apos;&lt;/Types&gt;&apos; WITH &apos;&lt;Default ContentType=&quot;image/jpeg&quot; Extension=&quot;jpg&quot;/&gt;&lt;/Types&gt;&apos;
                  INTO lw_file.
        WHEN &apos;png&apos;.
          REPLACE &apos;&lt;/Types&gt;&apos; WITH &apos;&lt;Default ContentType=&quot;image/png&quot; Extension=&quot;png&quot;/&gt;&lt;/Types&gt;&apos;
                  INTO lw_file.
        WHEN &apos;gif&apos;.
          REPLACE &apos;&lt;/Types&gt;&apos; WITH &apos;&lt;Default ContentType=&quot;image/gif&quot; Extension=&quot;gif&quot;/&gt;&lt;/Types&gt;&apos;
                  INTO lw_file.
      ENDCASE.

* Update file extension list
      _update_zip_file( filename = &apos;[Content_Types].xml&apos;
                        content  = lw_file ).
    ENDIF.

* Get relation file
    _get_zip_file( EXPORTING filename = &apos;word/_rels/document.xml.rels&apos;
                   IMPORTING content  = lw_file ).

* Create Image ID
    DO.
      id = sy-index.
      CONDENSE id NO-GAPS.
      CONCATENATE &apos;rId&apos; id INTO id ##NO_TEXT.
      CONCATENATE &apos;Id=&quot;&apos; id &apos;&quot;&apos; INTO lw_string ##NO_TEXT.
      FIND FIRST OCCURRENCE OF lw_string IN lw_file IGNORING CASE.
      IF sy-subrc &lt;&gt; 0.
        EXIT. &quot; exit do
      ENDIF.
    ENDDO.

* Update object list
    CLEAR ls_list_object.
    ls_list_object-id   = id.
    ls_list_object-type = c_type_image.
    ls_list_object-path = lw_filename.
    APPEND ls_list_object TO mt_list_object.

* Add relation
    lw_filename = lw_filename+5.
    CONCATENATE &apos;&lt;Relationship Target=&quot;&apos;
                lw_filename
                &apos;&quot; Type=&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/image&quot; Id=&quot;&apos;
                id
                &apos;&quot;/&gt;&apos;
                &apos;&lt;/Relationships&gt;&apos;
                INTO lw_string.
    REPLACE &apos;&lt;/Relationships&gt;&apos; WITH lw_string INTO lw_file.

* Update relation file
    _update_zip_file( filename = &apos;word/_rels/document.xml.rels&apos;
                      content  = lw_file ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="_PROTECT_LABEL" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="8 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_PROTECT_LABEL" SCONAME="IN" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_PROTECT_LABEL" SCONAME="OUT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD _protect_label.
    out = in.
    out = translate( val  = out
                     from = ` `
                     to   = `_` ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="_PROTECT_STRING" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="7 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_PROTECT_STRING" SCONAME="IN" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_PROTECT_STRING" SCONAME="OUT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="1" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD _protect_string.
    out = in.
    REPLACE ALL OCCURRENCES OF &apos;&amp;&apos; IN out WITH &apos;&amp;amp;&apos;.
    REPLACE ALL OCCURRENCES OF &apos;&lt;&apos; IN out WITH &apos;&amp;lt;&apos;.
    REPLACE ALL OCCURRENCES OF &apos;&gt;&apos; IN out WITH &apos;&amp;gt;&apos;.
    REPLACE ALL OCCURRENCES OF &apos;&quot;&apos; IN out WITH &apos;&amp;quot;&apos;.
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="_UPDATE_ZIP_FILE" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="3 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_UPDATE_ZIP_FILE" SCONAME="FILENAME" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="1 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <parameter CLSNAME="ZCL_AP_DOCX" CMPNAME="_UPDATE_ZIP_FILE" SCONAME="CONTENT" VERSION="1" LANGU="S" CMPTYPE="1" MTDTYPE="0" EDITORDER="2 " DISPID="0 " PARDECLTYP="0" PARPASSTYP="1" TYPTYPE="1" TYPE="STRING"/>
  <source>METHOD _update_zip_file.
    DATA lw_docx TYPE xstring.

* File content string =&gt; xstring
    CALL FUNCTION &apos;SCMS_STRING_TO_XSTRING&apos;
      EXPORTING text   = content
      IMPORTING buffer = lw_docx.

* If target file already exist, remove it
    IF line_exists( mo_zip-&gt;files[ name = filename ] ).
      mo_zip-&gt;delete( name = filename ).
    ENDIF.

* Add modified file into zip
    mo_zip-&gt;add( name    = filename
                 content = lw_docx ).
  ENDMETHOD.</source>
 </method>
 <method CLSNAME="ZCL_AP_DOCX" CMPNAME="_WRITE_SECTION" VERSION="1" LANGU="S" EXPOSURE="0" STATE="1" EDITORDER="1 " DISPID="0 " MTDTYPE="0" MTDDECLTYP="0" BCMTDCAT="00" BCMTDSYN="0">
  <source>METHOD _write_section.
    DATA : lw_substyle TYPE string,
           lw_size     TYPE string,
           lw_space    TYPE string.

    CLEAR mw_section_xml.

* In case of keep template content, first document section is the last
* template section
    IF NOT mw_tpl_section_xml IS INITIAL.
      mw_section_xml = mw_tpl_section_xml.
      CLEAR mw_tpl_section_xml.
      CLEAR ms_section.
      RETURN.
    ENDIF.

* Define header/footer
    IF NOT ms_section-header IS INITIAL.
      CONCATENATE mw_section_xml
                  &apos;&lt;w:headerReference w:type=&quot;default&quot; r:id=&quot;&apos;
                  ms_section-header
                  &apos;&quot;/&gt;&apos;
                  INTO mw_section_xml.
    ENDIF.
    IF NOT ms_section-footer IS INITIAL.
      CONCATENATE mw_section_xml
                  &apos;&lt;w:footerReference w:type=&quot;default&quot; r:id=&quot;&apos;
                  ms_section-footer
                  &apos;&quot;/&gt;&apos;
                  INTO mw_section_xml.
    ENDIF.
    IF NOT ms_section-header_first IS INITIAL.
      CONCATENATE mw_section_xml
                  &apos;&lt;w:headerReference w:type=&quot;first&quot; r:id=&quot;&apos;
                  ms_section-header_first
                  &apos;&quot;/&gt;&apos;
                  INTO mw_section_xml.
    ENDIF.
    IF NOT ms_section-footer_first IS INITIAL.
      CONCATENATE mw_section_xml
                  &apos;&lt;w:footerReference w:type=&quot;first&quot; r:id=&quot;&apos;
                  ms_section-footer_first
                  &apos;&quot;/&gt;&apos;
                  INTO mw_section_xml.
    ENDIF.

* Define page orientation
    IF ms_section-landscape = c_true.
      CONCATENATE mw_section_xml
                  &apos;&lt;w:pgSz w:w=&quot;16838&quot; w:h=&quot;11906&quot; w:orient=&quot;landscape&quot;/&gt;&apos;
                  INTO mw_section_xml.
    ELSE.
      CONCATENATE mw_section_xml
                  &apos;&lt;w:pgSz w:w=&quot;11906&quot; w:h=&quot;16838&quot;/&gt;&apos;
                  INTO mw_section_xml.
    ENDIF.

* Border ?
    CLEAR lw_substyle.
    IF     NOT ms_section-border_left-style IS INITIAL
       AND NOT ms_section-border_left-width IS INITIAL.
      lw_size = ms_section-border_left-width.
      CONDENSE lw_size NO-GAPS.
      lw_space = ms_section-border_left-space.
      CONDENSE lw_space NO-GAPS.
      CONCATENATE lw_substyle
                  &apos;&lt;w:left w:val=&quot;&apos;
                  ms_section-border_left-style
                  &apos;&quot; w:sz=&quot;&apos;
                  lw_size
                  &apos;&quot; w:space=&quot;&apos;
                  lw_space
                  &apos;&quot; w:color=&quot;&apos;
                  ms_section-border_left-color
                  &apos;&quot;/&gt;&apos;
                  INTO lw_substyle RESPECTING BLANKS.
    ENDIF.
    IF     NOT ms_section-border_top-style IS INITIAL
       AND NOT ms_section-border_top-width IS INITIAL.
      lw_size = ms_section-border_top-width.
      CONDENSE lw_size NO-GAPS.
      lw_space = ms_section-border_top-space.
      CONDENSE lw_space NO-GAPS.
      CONCATENATE lw_substyle
                  &apos;&lt;w:top w:val=&quot;&apos;
                  ms_section-border_top-style
                  &apos;&quot; w:sz=&quot;&apos;
                  lw_size
                  &apos;&quot; w:space=&quot;&apos;
                  lw_space
                  &apos;&quot; w:color=&quot;&apos;
                  ms_section-border_top-color
                  &apos;&quot;/&gt;&apos;
                  INTO lw_substyle RESPECTING BLANKS.
    ENDIF.
    IF     NOT ms_section-border_right-style IS INITIAL
       AND NOT ms_section-border_right-width IS INITIAL.
      lw_size = ms_section-border_right-width.
      CONDENSE lw_size NO-GAPS.
      lw_space = ms_section-border_right-space.
      CONDENSE lw_space NO-GAPS.
      CONCATENATE lw_substyle
                  &apos;&lt;w:right w:val=&quot;&apos;
                  ms_section-border_right-style
                  &apos;&quot; w:sz=&quot;&apos;
                  lw_size
                  &apos;&quot; w:space=&quot;&apos;
                  lw_space
                  &apos;&quot; w:color=&quot;&apos;
                  ms_section-border_right-color
                  &apos;&quot;/&gt;&apos;
                  INTO lw_substyle RESPECTING BLANKS.
    ENDIF.
    IF     NOT ms_section-border_bottom-style IS INITIAL
       AND NOT ms_section-border_bottom-width IS INITIAL.
      lw_size = ms_section-border_bottom-width.
      CONDENSE lw_size NO-GAPS.
      lw_space = ms_section-border_bottom-space.
      CONDENSE lw_space NO-GAPS.
      CONCATENATE lw_substyle
                  &apos;&lt;w:bottom w:val=&quot;&apos;
                  ms_section-border_bottom-style
                  &apos;&quot; w:sz=&quot;&apos;
                  lw_size
                  &apos;&quot; w:space=&quot;&apos;
                  lw_space
                  &apos;&quot; w:color=&quot;&apos;
                  ms_section-border_bottom-color
                  &apos;&quot;/&gt;&apos;
                  INTO lw_substyle RESPECTING BLANKS.
    ENDIF.
    IF NOT lw_substyle IS INITIAL.
      CONCATENATE mw_section_xml
                  &apos;&lt;w:pgBorders w:offsetFrom=&quot;page&quot;&gt;&apos;
                  lw_substyle
                  &apos;&lt;/w:pgBorders&gt;&apos;
                  INTO mw_section_xml RESPECTING BLANKS.
    ENDIF.

* Default section values / Standard page
    CONCATENATE mw_section_xml
                &apos;&lt;w:cols w:space=&quot;708&quot;/&gt;&apos;
                &apos;&lt;w:docGrid w:linePitch=&quot;360&quot;/&gt;&apos;
                &apos;&lt;w:pgMar w:top=&quot;1417&quot; w:right=&quot;1417&quot; w:bottom=&quot;1417&quot; w:left=&quot;1417&quot; w:header=&quot;708&quot; w:footer=&quot;708&quot; w:gutter=&quot;0&quot;/&gt;&apos;
                INTO mw_section_xml.

    IF ms_section-continuous = c_true.
      CONCATENATE mw_section_xml
                  &apos;&lt;w:type w:val=&quot;continuous&quot;/&gt;&apos;
                  INTO mw_section_xml.
    ENDIF.

    IF    NOT ms_section-header_first IS INITIAL
       OR NOT ms_section-footer_first IS INITIAL.
      CONCATENATE mw_section_xml
                  &apos;&lt;w:titlePg/&gt;&apos;
                  INTO mw_section_xml.
    ENDIF.

    CONCATENATE &apos;&lt;w:sectPr&gt;&apos;
                mw_section_xml
                &apos;&lt;/w:sectPr&gt;&apos;
                INTO mw_section_xml.

    CLEAR ms_section.
  ENDMETHOD.                    &quot; write_section</source>
 </method>
</CLAS>
